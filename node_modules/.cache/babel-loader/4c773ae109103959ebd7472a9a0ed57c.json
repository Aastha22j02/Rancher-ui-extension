{"remainingRequest":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js??ref--16-1!/home/ubuntu/suseconf/node_modules/@rancher/shell/config/router/navigation-guards/authentication.js","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/config/router/navigation-guards/authentication.js","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/babel.config.js","mtime":1725343995893},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX3JlZ2VuZXJhdG9yUnVudGltZSBmcm9tICIvaG9tZS91YnVudHUvc3VzZWNvbmYvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL3JlZ2VuZXJhdG9yL2luZGV4LmpzIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgeyByb3V0ZVJlcXVpcmVzQXV0aGVudGljYXRpb24gfSBmcm9tICdAc2hlbGwvdXRpbHMvcm91dGVyJzsKaW1wb3J0IHsgaXNMb2dnZWRJbiwgbm90TG9nZ2VkSW4sIG5vQXV0aCwgZmluZE1lIH0gZnJvbSAnQHNoZWxsL3V0aWxzL2F1dGgnOwpleHBvcnQgZnVuY3Rpb24gaW5zdGFsbChyb3V0ZXIsIGNvbnRleHQpIHsKICByb3V0ZXIuYmVmb3JlRWFjaChmdW5jdGlvbiAodG8sIGZyb20sIG5leHQpIHsKICAgIHJldHVybiBhdXRoZW50aWNhdGUodG8sIGZyb20sIG5leHQsIGNvbnRleHQpOwogIH0pOwp9CmV4cG9ydCBmdW5jdGlvbiBhdXRoZW50aWNhdGUoX3gsIF94MiwgX3gzLCBfeDQpIHsKICByZXR1cm4gX2F1dGhlbnRpY2F0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CmZ1bmN0aW9uIF9hdXRoZW50aWNhdGUoKSB7CiAgX2F1dGhlbnRpY2F0ZSA9IF9hc3luY1RvR2VuZXJhdG9yKC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSh0bywgZnJvbSwgbmV4dCwgX3JlZikgewogICAgdmFyIHN0b3JlLCB2M1VzZXIsIGZyb21IZWFkZXIsIG1lLCBfbWUsIHN0YXR1czsKICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBzdG9yZSA9IF9yZWYuc3RvcmU7CiAgICAgICAgICBpZiAocm91dGVSZXF1aXJlc0F1dGhlbnRpY2F0aW9uKHRvKSkgewogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBuZXh0KCkpOwogICAgICAgIGNhc2UgMzoKICAgICAgICAgIGlmICghKHN0b3JlLmdldHRlcnNbJ2F1dGgvZW5hYmxlZCddICE9PSBmYWxzZSAmJiAhc3RvcmUuZ2V0dGVyc1snYXV0aC9sb2dnZWRJbiddKSkgewogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDM7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgX2NvbnRleHQubmV4dCA9IDY7CiAgICAgICAgICByZXR1cm4gc3RvcmUuZGlzcGF0Y2goJ2F1dGgvZ2V0VXNlcicpOwogICAgICAgIGNhc2UgNjoKICAgICAgICAgIHYzVXNlciA9IHN0b3JlLmdldHRlcnNbJ2F1dGgvdjNVc2VyJ10gfHwge307CiAgICAgICAgICBpZiAoISh2M1VzZXIgIT09IG51bGwgJiYgdjNVc2VyICE9PSB2b2lkIDAgJiYgdjNVc2VyLm11c3RDaGFuZ2VQYXNzd29yZCkpIHsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgbmV4dCh7CiAgICAgICAgICAgIG5hbWU6ICdhdXRoLXNldHVwJwogICAgICAgICAgfSkpOwogICAgICAgIGNhc2UgOToKICAgICAgICAgIC8vIEluIG5ld2VyIHZlcnNpb25zIHRoZSBBUEkgY2FsbHMgcmV0dXJuIHRoZSBhdXRoIHN0YXRlIGluc3RlYWQgb2YgaGF2aW5nIHRvIG1ha2UgYSBuZXcgY2FsbCBhbGwgdGhlIHRpbWUuCiAgICAgICAgICBmcm9tSGVhZGVyID0gc3RvcmUuZ2V0dGVyc1snYXV0aC9mcm9tSGVhZGVyJ107CiAgICAgICAgICBpZiAoIShmcm9tSGVhZGVyID09PSAnbm9uZScpKSB7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBub0F1dGgoc3RvcmUpOwogICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxNDoKICAgICAgICAgIGlmICghKGZyb21IZWFkZXIgPT09ICd0cnVlJykpIHsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDIxOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNzsKICAgICAgICAgIHJldHVybiBmaW5kTWUoc3RvcmUpOwogICAgICAgIGNhc2UgMTc6CiAgICAgICAgICBtZSA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICBpc0xvZ2dlZEluKHN0b3JlLCBtZSk7CiAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDIxOgogICAgICAgICAgaWYgKCEoZnJvbUhlYWRlciA9PT0gJ2ZhbHNlJykpIHsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI2OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIG5vdExvZ2dlZEluKHN0b3JlLCBuZXh0LCB0byk7CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iKTsKICAgICAgICBjYXNlIDI2OgogICAgICAgICAgX2NvbnRleHQucHJldiA9IDI2OwogICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI5OwogICAgICAgICAgcmV0dXJuIGZpbmRNZShzdG9yZSk7CiAgICAgICAgY2FzZSAyOToKICAgICAgICAgIF9tZSA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICBpc0xvZ2dlZEluKHN0b3JlLCBfbWUpOwogICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzMzoKICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAzMzsKICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oMjYpOwogICAgICAgICAgc3RhdHVzID0gX2NvbnRleHQudDAgPT09IG51bGwgfHwgX2NvbnRleHQudDAgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jb250ZXh0LnQwLl9zdGF0dXM7CiAgICAgICAgICBpZiAoIShzdGF0dXMgPT09IDQwNCkpIHsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQwOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIG5vQXV0aChzdG9yZSk7CiAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDQwOgogICAgICAgICAgaWYgKHN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICAgIG5vdExvZ2dlZEluKHN0b3JlLCBuZXh0LCB0byk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdG9yZS5jb21taXQoJ3NldEVycm9yJywgewogICAgICAgICAgICAgIGVycm9yOiBfY29udGV4dC50MCwKICAgICAgICAgICAgICBsb2NhdGlvbkVycm9yOiBuZXcgRXJyb3IoJ0F1dGggTWlkZGxld2FyZScpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIik7CiAgICAgICAgY2FzZSA0MjoKICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKCdnY1N0YXJ0SW50ZXJ2YWxzJyk7CiAgICAgICAgY2FzZSA0MzoKICAgICAgICAgIG5leHQoKTsKICAgICAgICBjYXNlIDQ0OgogICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICB9CiAgICB9LCBfY2FsbGVlLCBudWxsLCBbWzI2LCAzM11dKTsKICB9KSk7CiAgcmV0dXJuIF9hdXRoZW50aWNhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQ=="},{"version":3,"names":["routeRequiresAuthentication","isLoggedIn","notLoggedIn","noAuth","findMe","install","router","context","beforeEach","to","from","next","authenticate","_x","_x2","_x3","_x4","_authenticate","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_ref","store","v3User","fromHeader","me","_me","status","wrap","_callee$","_context","prev","abrupt","getters","dispatch","mustChangePassword","name","sent","t0","_status","commit","error","locationError","Error","stop"],"sources":["/home/ubuntu/suseconf/node_modules/@rancher/shell/config/router/navigation-guards/authentication.js"],"sourcesContent":["import { routeRequiresAuthentication } from '@shell/utils/router';\nimport { isLoggedIn, notLoggedIn, noAuth, findMe } from '@shell/utils/auth';\n\nexport function install(router, context) {\n  router.beforeEach((to, from, next) => authenticate(to, from, next, context));\n}\n\nexport async function authenticate(to, from, next, { store }) {\n  if (!routeRequiresAuthentication(to)) {\n    return next();\n  }\n\n  if ( store.getters['auth/enabled'] !== false && !store.getters['auth/loggedIn'] ) {\n    // `await` so we have one successfully request whilst possibly logged in (ensures fromHeader is populated from `x-api-cattle-auth`)\n    await store.dispatch('auth/getUser');\n\n    const v3User = store.getters['auth/v3User'] || {};\n\n    if (v3User?.mustChangePassword) {\n      return next({ name: 'auth-setup' });\n    }\n\n    // In newer versions the API calls return the auth state instead of having to make a new call all the time.\n    const fromHeader = store.getters['auth/fromHeader'];\n\n    if ( fromHeader === 'none' ) {\n      noAuth(store);\n    } else if ( fromHeader === 'true' ) {\n      const me = await findMe(store);\n\n      isLoggedIn(store, me);\n    } else if ( fromHeader === 'false' ) {\n      notLoggedIn(store, next, to);\n\n      return;\n    } else {\n      // Older versions look at principals and see what happens\n      try {\n        const me = await findMe(store);\n\n        isLoggedIn(store, me);\n      } catch (e) {\n        const status = e?._status;\n\n        if ( status === 404 ) {\n          noAuth(store);\n        } else {\n          if ( status === 401 ) {\n            notLoggedIn(store, next, to);\n          } else {\n            store.commit('setError', { error: e, locationError: new Error('Auth Middleware') });\n          }\n\n          return;\n        }\n      }\n    }\n\n    store.dispatch('gcStartIntervals');\n  }\n\n  next();\n}\n"],"mappings":"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","ignoreList":[]}]}