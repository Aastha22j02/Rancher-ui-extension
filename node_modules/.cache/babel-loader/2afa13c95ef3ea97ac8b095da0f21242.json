{"remainingRequest":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js??ref--16-1!/home/ubuntu/suseconf/node_modules/@rancher/shell/models/apps.deployment.js","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/models/apps.deployment.js","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/babel.config.js","mtime":1725343995893},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVmbGVjdC5jb25zdHJ1Y3QuanMiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2dldFByb3RvdHlwZU9mIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9pbmhlcml0cyI7CmltcG9ydCBfcmVnZW5lcmF0b3JSdW50aW1lIGZyb20gIi9ob21lL3VidW50dS9zdXNlY29uZi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvcmVnZW5lcmF0b3IvaW5kZXguanMiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmNsdWRlcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UuanMiOwpmdW5jdGlvbiBfY2FsbFN1cGVyKHQsIG8sIGUpIHsgcmV0dXJuIG8gPSBfZ2V0UHJvdG90eXBlT2YobyksIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHQsIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSA/IFJlZmxlY3QuY29uc3RydWN0KG8sIGUgfHwgW10sIF9nZXRQcm90b3R5cGVPZih0KS5jb25zdHJ1Y3RvcikgOiBvLmFwcGx5KHQsIGUpKTsgfQpmdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkgeyB0cnkgeyB2YXIgdCA9ICFCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uICgpIHt9KSk7IH0gY2F0Y2ggKHQpIHt9IHJldHVybiAoX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCA9IGZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7IHJldHVybiAhIXQ7IH0pKCk7IH0KaW1wb3J0IHsgV09SS0xPQURfVFlQRVMgfSBmcm9tICdAc2hlbGwvY29uZmlnL3R5cGVzJzsKaW1wb3J0IFdvcmtsb2FkIGZyb20gJy4vd29ya2xvYWQnOwp2YXIgSUdOT1JFRF9BTk5PVEFUSU9OUyA9IFsna3ViZWN0bC5rdWJlcm5ldGVzLmlvL2xhc3QtYXBwbGllZC1jb25maWd1cmF0aW9uJywgJ2RlcGxveW1lbnQua3ViZXJuZXRlcy5pby9yZXZpc2lvbicsICdkZXBsb3ltZW50Lmt1YmVybmV0ZXMuaW8vcmV2aXNpb24taGlzdG9yeScsICdkZXBsb3ltZW50Lmt1YmVybmV0ZXMuaW8vZGVzaXJlZC1yZXBsaWNhcycsICdkZXBsb3ltZW50Lmt1YmVybmV0ZXMuaW8vbWF4LXJlcGxpY2FzJywgJ2RlcHJlY2F0ZWQuZGVwbG95bWVudC5yb2xsYmFjay50byddOwp2YXIgRGVwbG95bWVudCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1dvcmtsb2FkKSB7CiAgZnVuY3Rpb24gRGVwbG95bWVudCgpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEZXBsb3ltZW50KTsKICAgIHJldHVybiBfY2FsbFN1cGVyKHRoaXMsIERlcGxveW1lbnQsIGFyZ3VtZW50cyk7CiAgfQogIF9pbmhlcml0cyhEZXBsb3ltZW50LCBfV29ya2xvYWQpOwogIHJldHVybiBfY3JlYXRlQ2xhc3MoRGVwbG95bWVudCwgW3sKICAgIGtleTogInJlcGxpY2FTZXRJZCIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgdmFyIF90aGlzJG1ldGFkYXRhLCBfc2V0JHRvSWQ7CiAgICAgIHZhciBzZXQgPSAoX3RoaXMkbWV0YWRhdGEgPSB0aGlzLm1ldGFkYXRhKSA9PT0gbnVsbCB8fCBfdGhpcyRtZXRhZGF0YSA9PT0gdm9pZCAwIHx8IChfdGhpcyRtZXRhZGF0YSA9IF90aGlzJG1ldGFkYXRhLnJlbGF0aW9uc2hpcHMpID09PSBudWxsIHx8IF90aGlzJG1ldGFkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRtZXRhZGF0YS5maW5kKGZ1bmN0aW9uIChyZWxhdGlvbnNoaXApIHsKICAgICAgICByZXR1cm4gcmVsYXRpb25zaGlwLnJlbCA9PT0gJ293bmVyJyAmJiByZWxhdGlvbnNoaXAudG9UeXBlID09PSBXT1JLTE9BRF9UWVBFUy5SRVBMSUNBX1NFVDsKICAgICAgfSk7CiAgICAgIHJldHVybiBzZXQgPT09IG51bGwgfHwgc2V0ID09PSB2b2lkIDAgfHwgKF9zZXQkdG9JZCA9IHNldC50b0lkKSA9PT0gbnVsbCB8fCBfc2V0JHRvSWQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zZXQkdG9JZC5yZXBsYWNlKCIiLmNvbmNhdCh0aGlzLm5hbWVzcGFjZSwgIi8iKSwgJycpOwogICAgfQogIH0sIHsKICAgIGtleTogInJvbGxCYWNrIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcm9sbEJhY2sgPSBfYXN5bmNUb0dlbmVyYXRvcigvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoY2x1c3RlciwgZGVwbG95bWVudCwgcmV2aXNpb24pIHsKICAgICAgICB2YXIgX3JldmlzaW9uJHNwZWMkdGVtcGxhLCBfcmV2aXNpb24kc3BlYyR0ZW1wbGEyOwogICAgICAgIHZhciBib2R5OwogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBib2R5ID0gW3sKICAgICAgICAgICAgICAgIG9wOiAncmVwbGFjZScsCiAgICAgICAgICAgICAgICBwYXRoOiAnL3NwZWMvdGVtcGxhdGUnLAogICAgICAgICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgICAgICAgbWV0YWRhdGE6IHsKICAgICAgICAgICAgICAgICAgICBjcmVhdGlvblRpbWVzdGFtcDogbnVsbCwKICAgICAgICAgICAgICAgICAgICBsYWJlbHM6IE9iamVjdC5rZXlzKCgoX3JldmlzaW9uJHNwZWMkdGVtcGxhID0gcmV2aXNpb24uc3BlYy50ZW1wbGF0ZS5tZXRhZGF0YSkgPT09IG51bGwgfHwgX3JldmlzaW9uJHNwZWMkdGVtcGxhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfcmV2aXNpb24kc3BlYyR0ZW1wbGEubGFiZWxzKSB8fCB7fSkucmVkdWNlKGZ1bmN0aW9uIChwcmV2LCBrZXkpIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgIT09ICdwb2QtdGVtcGxhdGUtaGFzaCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJldltrZXldID0gcmV2aXNpb24uc3BlYy50ZW1wbGF0ZS5tZXRhZGF0YS5sYWJlbHNba2V5XTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwcmV2OwogICAgICAgICAgICAgICAgICAgIH0sIHt9KSwKICAgICAgICAgICAgICAgICAgICBhbm5vdGF0aW9uczogT2JqZWN0LmtleXMoKChfcmV2aXNpb24kc3BlYyR0ZW1wbGEyID0gcmV2aXNpb24uc3BlYy50ZW1wbGF0ZS5tZXRhZGF0YSkgPT09IG51bGwgfHwgX3JldmlzaW9uJHNwZWMkdGVtcGxhMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3JldmlzaW9uJHNwZWMkdGVtcGxhMi5hbm5vdGF0aW9ucykgfHwge30pLnJlZHVjZShmdW5jdGlvbiAocHJldiwga2V5KSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIUlHTk9SRURfQU5OT1RBVElPTlMuaW5jbHVkZXMoa2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICBwcmV2W2tleV0gPSByZXZpc2lvbi5zcGVjLnRlbXBsYXRlLm1ldGFkYXRhLmFubm90YXRpb25zW2tleV07CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJldjsKICAgICAgICAgICAgICAgICAgICB9LCB7fSkKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgc3BlYzogcmV2aXNpb24uc3BlYy50ZW1wbGF0ZS5zcGVjCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgb3A6ICdyZXBsYWNlJywKICAgICAgICAgICAgICAgIHBhdGg6ICcvbWV0YWRhdGEvYW5ub3RhdGlvbnMnLAogICAgICAgICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgICAgICAgJ2RlcGxveW1lbnQua3ViZXJuZXRlcy5pby9yZXZpc2lvbic6IHJldmlzaW9uLm1ldGFkYXRhLmFubm90YXRpb25zWydkZXBsb3ltZW50Lmt1YmVybmV0ZXMuaW8vcmV2aXNpb24nXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH1dOwogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLnJvbGxCYWNrV29ya2xvYWQoY2x1c3RlciwgZGVwbG95bWVudCwgJ2RlcGxveW1lbnRzJywgYm9keSk7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICB9KSk7CiAgICAgIGZ1bmN0aW9uIHJvbGxCYWNrKF94LCBfeDIsIF94MykgewogICAgICAgIHJldHVybiBfcm9sbEJhY2suYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgICByZXR1cm4gcm9sbEJhY2s7CiAgICB9KCkKICB9XSk7Cn0oV29ya2xvYWQpOwpleHBvcnQgeyBEZXBsb3ltZW50IGFzIGRlZmF1bHQgfTs="},{"version":3,"names":["WORKLOAD_TYPES","Workload","IGNORED_ANNOTATIONS","Deployment","_Workload","_classCallCheck","_callSuper","arguments","_inherits","_createClass","key","get","_this$metadata","_set$toId","set","metadata","relationships","find","relationship","rel","toType","REPLICA_SET","toId","replace","concat","namespace","value","_rollBack","_asyncToGenerator","_regeneratorRuntime","mark","_callee","cluster","deployment","revision","_revision$spec$templa","_revision$spec$templa2","body","wrap","_callee$","_context","prev","next","op","path","creationTimestamp","labels","Object","keys","spec","template","reduce","annotations","includes","rollBackWorkload","stop","rollBack","_x","_x2","_x3","apply","default"],"sources":["/home/ubuntu/suseconf/node_modules/@rancher/shell/models/apps.deployment.js"],"sourcesContent":["import { WORKLOAD_TYPES } from '@shell/config/types';\nimport Workload from './workload';\n\nconst IGNORED_ANNOTATIONS = [\n  'kubectl.kubernetes.io/last-applied-configuration',\n  'deployment.kubernetes.io/revision',\n  'deployment.kubernetes.io/revision-history',\n  'deployment.kubernetes.io/desired-replicas',\n  'deployment.kubernetes.io/max-replicas',\n  'deprecated.deployment.rollback.to',\n];\n\nexport default class Deployment extends Workload {\n  get replicaSetId() {\n    const set = this.metadata?.relationships?.find((relationship) => {\n      return relationship.rel === 'owner' &&\n            relationship.toType === WORKLOAD_TYPES.REPLICA_SET;\n    });\n\n    return set?.toId?.replace(`${ this.namespace }/`, '');\n  }\n\n  async rollBack(cluster, deployment, revision) {\n    const body = [\n      {\n        op:    'replace',\n        path:  '/spec/template',\n        value: {\n          metadata: {\n            creationTimestamp: null,\n            labels:            Object.keys(revision.spec.template.metadata?.labels || {}).reduce((prev, key) => {\n              if (key !== 'pod-template-hash') {\n                prev[key] = revision.spec.template.metadata.labels[key];\n              }\n\n              return prev;\n            }, {}),\n            annotations: Object.keys(revision.spec.template.metadata?.annotations || {}).reduce((prev, key) => {\n              if (!IGNORED_ANNOTATIONS.includes(key)) {\n                prev[key] = revision.spec.template.metadata.annotations[key];\n              }\n\n              return prev;\n            }, {}),\n          },\n          spec: revision.spec.template.spec\n        }\n      }, {\n        op:    'replace',\n        path:  '/metadata/annotations',\n        value: { 'deployment.kubernetes.io/revision': revision.metadata.annotations['deployment.kubernetes.io/revision'] }\n      }\n    ];\n\n    await this.rollBackWorkload(cluster, deployment, 'deployments', body);\n  }\n}\n"],"mappings":"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","ignoreList":[]}]}