{"remainingRequest":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js??ref--16-1!/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js??ref--17-0!/home/ubuntu/suseconf/node_modules/ts-loader/index.js??ref--17-1!/home/ubuntu/suseconf/node_modules/@rancher/shell/plugins/steve/projectAndNamespaceFiltering.utils.ts","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/plugins/steve/projectAndNamespaceFiltering.utils.ts","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/babel.config.js","mtime":1725343995893},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/ts-loader/index.js","mtime":1725271299135}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3RhcnRzLXdpdGguanMiOwppbXBvcnQgeyBOQU1FU1BBQ0VfRklMVEVSX05TX0ZVTExfUFJFRklYLCBOQU1FU1BBQ0VfRklMVEVSX1BfRlVMTF9QUkVGSVggfSBmcm9tICdAc2hlbGwvdXRpbHMvbmFtZXNwYWNlLWZpbHRlcic7CmltcG9ydCB7IGdldFBlcmZvcm1hbmNlU2V0dGluZyB9IGZyb20gJ0BzaGVsbC91dGlscy9zZXR0aW5ncyc7CnZhciBQcm9qZWN0QW5kTmFtZXNwYWNlRmlsdGVyaW5nID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBQcm9qZWN0QW5kTmFtZXNwYWNlRmlsdGVyaW5nKCkgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFByb2plY3RBbmROYW1lc3BhY2VGaWx0ZXJpbmcpOwogIH0KICByZXR1cm4gX2NyZWF0ZUNsYXNzKFByb2plY3RBbmROYW1lc3BhY2VGaWx0ZXJpbmcsIFt7CiAgICBrZXk6ICJpc0FwcGxpY2FibGUiLAogICAgdmFsdWU6CiAgICAvKioKICAgICAqIERvZXMgdGhlIHJlcXVlc3QgYG9wdGAgZGVmaW5pdGlvbiByZXF1aXJlIHJlc291cmNlcyBhcmUgZmV0Y2hlZCBmcm9tIGEgc3BlY2lmaWMgc2V0IG5hbWVzcGFjZXMvcHJvamVjdHM/CiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzQXBwbGljYWJsZShvcHQpIHsKICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkob3B0Lm5hbWVzcGFjZWQpOwogICAgfQogIH0sIHsKICAgIGtleTogImlzRW5hYmxlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNFbmFibGVkKHJvb3RHZXR0ZXJzKSB7CiAgICAgIHZhciBfYTsKICAgICAgdmFyIGN1cnJlbnRQcm9kdWN0ID0gcm9vdEdldHRlcnNbJ2N1cnJlbnRQcm9kdWN0J107CiAgICAgIC8vIE9ubHkgZW5hYmxlIGZvciB0aGUgY2x1c3RlciBzdG9yZSBhdCB0aGUgbW9tZW50LiBJbiB0aGVvcnkgdGhpcyBzaG91bGQgd29yayBpbiBtYW5hZ2VtZW50IGFzIHdlbGwsIGFzIHRoZXkncmUgYm90aCAnc3RldmUnIHN0b3JlcwogICAgICBpZiAoKGN1cnJlbnRQcm9kdWN0ID09PSBudWxsIHx8IGN1cnJlbnRQcm9kdWN0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjdXJyZW50UHJvZHVjdC5pblN0b3JlKSAhPT0gJ2NsdXN0ZXInKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmIChjdXJyZW50UHJvZHVjdCA9PT0gbnVsbCB8fCBjdXJyZW50UHJvZHVjdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY3VycmVudFByb2R1Y3Quc2hvd1dvcmtzcGFjZVN3aXRjaGVyKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHZhciBwZXJmQ29uZmlnID0gZ2V0UGVyZm9ybWFuY2VTZXR0aW5nKHJvb3RHZXR0ZXJzKTsKICAgICAgaWYgKCEoKF9hID0gcGVyZkNvbmZpZy5mb3JjZU5zRmlsdGVyVjIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5lbmFibGVkKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYG9wdGAgcmVxdWlyZXMgcmVzb3VyY2VzIGZyb20gc3BlY2lmaWMgbnMvcHJvamVjdHMsIGlmIHNvIHJldHVybiB0aGUgcmVxdWlyZWQgcXVlcnkgcGFyYW0gKHg9eSkKICAgICAqLwogIH0sIHsKICAgIGtleTogImNoZWNrQW5kQ3JlYXRlUGFyYW0iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNoZWNrQW5kQ3JlYXRlUGFyYW0ob3B0KSB7CiAgICAgIGlmICghdGhpcy5pc0FwcGxpY2FibGUob3B0KSkgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5jcmVhdGVQYXJhbShvcHQubmFtZXNwYWNlZCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlUGFyYW0iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZVBhcmFtKG5hbWVzcGFjZUZpbHRlcikgewogICAgICBpZiAoIW5hbWVzcGFjZUZpbHRlciB8fCAhbmFtZXNwYWNlRmlsdGVyLmxlbmd0aCkgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQogICAgICB2YXIgbmFtZXNwYWNlcyA9IG5hbWVzcGFjZUZpbHRlci5yZWR1Y2UoZnVuY3Rpb24gKHJlcywgbikgewogICAgICAgIHZhciBuYW1lID0gbi5yZXBsYWNlKE5BTUVTUEFDRV9GSUxURVJfTlNfRlVMTF9QUkVGSVgsICcnKS5yZXBsYWNlKE5BTUVTUEFDRV9GSUxURVJfUF9GVUxMX1BSRUZJWCwgJycpOwogICAgICAgIGlmIChuYW1lLnN0YXJ0c1dpdGgoJy0nKSkgewogICAgICAgICAgcmVzLmV4Y2x1ZGUucHVzaChuLnN1YnN0cmluZygxLCBuLmxlbmd0aCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXMuaW5jbHVkZS5wdXNoKG5hbWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzOwogICAgICB9LCB7CiAgICAgICAgaW5jbHVkZTogW10sCiAgICAgICAgZXhjbHVkZTogW10KICAgICAgfSk7CiAgICAgIHZhciByZXMgPSAnJzsKICAgICAgaWYgKG5hbWVzcGFjZXMuaW5jbHVkZS5sZW5ndGgpIHsKICAgICAgICByZXMgPSAiIi5jb25jYXQoUHJvamVjdEFuZE5hbWVzcGFjZUZpbHRlcmluZy5wYXJhbSwgIj0iKS5jb25jYXQobmFtZXNwYWNlcy5pbmNsdWRlLmpvaW4oJywnKSk7CiAgICAgIH0KICAgICAgaWYgKG5hbWVzcGFjZXMuZXhjbHVkZS5sZW5ndGgpIHsKICAgICAgICByZXMgPSAiIi5jb25jYXQoUHJvamVjdEFuZE5hbWVzcGFjZUZpbHRlcmluZy5wYXJhbSwgIiE9IikuY29uY2F0KG5hbWVzcGFjZXMuZXhjbHVkZS5qb2luKCcsJykpOwogICAgICB9CiAgICAgIHJldHVybiByZXM7CiAgICB9CiAgfV0pOwp9KCk7ClByb2plY3RBbmROYW1lc3BhY2VGaWx0ZXJpbmcucGFyYW0gPSAncHJvamVjdHNvcm5hbWVzcGFjZXMnOwpleHBvcnQgZGVmYXVsdCBuZXcgUHJvamVjdEFuZE5hbWVzcGFjZUZpbHRlcmluZygpOw=="},{"version":3,"names":["NAMESPACE_FILTER_NS_FULL_PREFIX","NAMESPACE_FILTER_P_FULL_PREFIX","getPerformanceSetting","ProjectAndNamespaceFiltering","_classCallCheck","_createClass","key","value","isApplicable","opt","Array","isArray","namespaced","isEnabled","rootGetters","currentProduct","inStore","showWorkspaceSwitcher","perfConfig","_a","forceNsFilterV2","enabled","checkAndCreateParam","createParam","namespaceFilter","length","namespaces","reduce","res","n","name","replace","startsWith","exclude","push","substring","include","concat","param","join"],"sources":["/home/ubuntu/suseconf/node_modules/@rancher/shell/plugins/steve/projectAndNamespaceFiltering.utils.ts"],"sourcesContent":["import { NAMESPACE_FILTER_NS_FULL_PREFIX, NAMESPACE_FILTER_P_FULL_PREFIX } from '@shell/utils/namespace-filter';\nimport { getPerformanceSetting } from '@shell/utils/settings';\nimport { ActionFindAllArgs } from '@shell/types/store/dashboard-store.types';\n\nclass ProjectAndNamespaceFiltering {\n  static param = 'projectsornamespaces'\n\n  /**\n   * Does the request `opt` definition require resources are fetched from a specific set namespaces/projects?\n   */\n  isApplicable(opt: ActionFindAllArgs): boolean {\n    return Array.isArray(opt.namespaced);\n  }\n\n  isEnabled(rootGetters: any): boolean {\n    const currentProduct = rootGetters['currentProduct'];\n\n    // Only enable for the cluster store at the moment. In theory this should work in management as well, as they're both 'steve' stores\n    if (currentProduct?.inStore !== 'cluster') {\n      return false;\n    }\n\n    if (currentProduct?.showWorkspaceSwitcher) {\n      return false;\n    }\n\n    const perfConfig = getPerformanceSetting(rootGetters);\n\n    if (!perfConfig.forceNsFilterV2?.enabled) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Check if `opt` requires resources from specific ns/projects, if so return the required query param (x=y)\n   */\n  checkAndCreateParam(opt: ActionFindAllArgs): string {\n    if (!this.isApplicable(opt)) {\n      return '';\n    }\n\n    return this.createParam(opt.namespaced);\n  }\n\n  public createParam(namespaceFilter: string[] | undefined): string {\n    if (!namespaceFilter || !namespaceFilter.length) {\n      return '';\n    }\n\n    const namespaces = namespaceFilter.reduce((res, n) => {\n      const name = n\n        .replace(NAMESPACE_FILTER_NS_FULL_PREFIX, '')\n        .replace(NAMESPACE_FILTER_P_FULL_PREFIX, '');\n\n      if (name.startsWith('-')) {\n        res.exclude.push(n.substring(1, n.length));\n      } else {\n        res.include.push(name);\n      }\n\n      return res;\n    }, { include: [] as string[], exclude: [] as string[] });\n\n    let res = '';\n\n    if (namespaces.include.length) {\n      res = `${ ProjectAndNamespaceFiltering.param }=${ namespaces.include.join(',') }`;\n    }\n\n    if (namespaces.exclude.length) {\n      res = `${ ProjectAndNamespaceFiltering.param }!=${ namespaces.exclude.join(',') }`;\n    }\n\n    return res;\n  }\n}\n\nexport default new ProjectAndNamespaceFiltering();\n"],"mappings":";;;;;;;;AAAA,SAASA,+BAA+B,EAAEC,8BAA8B,QAAQ,+BAA+B;AAC/G,SAASC,qBAAqB,QAAQ,uBAAuB;AAAC,IAGxDC,4BAA4B;EAAA,SAAAA,6BAAA;IAAAC,eAAA,OAAAD,4BAAA;EAAA;EAAA,OAAAE,YAAA,CAAAF,4BAAA;IAAAG,GAAA;IAAAC,KAAA;IAGhC;;;IAGA,SAAAC,YAAYA,CAACC,GAAsB;MACjC,OAAOC,KAAK,CAACC,OAAO,CAACF,GAAG,CAACG,UAAU,CAAC;IACtC;EAAC;IAAAN,GAAA;IAAAC,KAAA,EAED,SAAAM,SAASA,CAACC,WAAgB;;MACxB,IAAMC,cAAc,GAAGD,WAAW,CAAC,gBAAgB,CAAC;MAEpD;MACA,IAAI,CAAAC,cAAc,aAAdA,cAAc,uBAAdA,cAAc,CAAEC,OAAO,MAAK,SAAS,EAAE;QACzC,OAAO,KAAK;;MAGd,IAAID,cAAc,aAAdA,cAAc,uBAAdA,cAAc,CAAEE,qBAAqB,EAAE;QACzC,OAAO,KAAK;;MAGd,IAAMC,UAAU,GAAGhB,qBAAqB,CAACY,WAAW,CAAC;MAErD,IAAI,EAAC,CAAAK,EAAA,GAAAD,UAAU,CAACE,eAAe,cAAAD,EAAA,uBAAAA,EAAA,CAAEE,OAAO,GAAE;QACxC,OAAO,KAAK;;MAGd,OAAO,IAAI;IACb;IAEA;;;EAAA;IAAAf,GAAA;IAAAC,KAAA,EAGA,SAAAe,mBAAmBA,CAACb,GAAsB;MACxC,IAAI,CAAC,IAAI,CAACD,YAAY,CAACC,GAAG,CAAC,EAAE;QAC3B,OAAO,EAAE;;MAGX,OAAO,IAAI,CAACc,WAAW,CAACd,GAAG,CAACG,UAAU,CAAC;IACzC;EAAC;IAAAN,GAAA;IAAAC,KAAA,EAEM,SAAAgB,WAAWA,CAACC,eAAqC;MACtD,IAAI,CAACA,eAAe,IAAI,CAACA,eAAe,CAACC,MAAM,EAAE;QAC/C,OAAO,EAAE;;MAGX,IAAMC,UAAU,GAAGF,eAAe,CAACG,MAAM,CAAC,UAACC,GAAG,EAAEC,CAAC,EAAI;QACnD,IAAMC,IAAI,GAAGD,CAAC,CACXE,OAAO,CAAC/B,+BAA+B,EAAE,EAAE,CAAC,CAC5C+B,OAAO,CAAC9B,8BAA8B,EAAE,EAAE,CAAC;QAE9C,IAAI6B,IAAI,CAACE,UAAU,CAAC,GAAG,CAAC,EAAE;UACxBJ,GAAG,CAACK,OAAO,CAACC,IAAI,CAACL,CAAC,CAACM,SAAS,CAAC,CAAC,EAAEN,CAAC,CAACJ,MAAM,CAAC,CAAC;SAC3C,MAAM;UACLG,GAAG,CAACQ,OAAO,CAACF,IAAI,CAACJ,IAAI,CAAC;;QAGxB,OAAOF,GAAG;MACZ,CAAC,EAAE;QAAEQ,OAAO,EAAE,EAAc;QAAEH,OAAO,EAAE;MAAc,CAAE,CAAC;MAExD,IAAIL,GAAG,GAAG,EAAE;MAEZ,IAAIF,UAAU,CAACU,OAAO,CAACX,MAAM,EAAE;QAC7BG,GAAG,MAAAS,MAAA,CAAOlC,4BAA4B,CAACmC,KAAM,OAAAD,MAAA,CAAKX,UAAU,CAACU,OAAO,CAACG,IAAI,CAAC,GAAG,CAAE,CAAE;;MAGnF,IAAIb,UAAU,CAACO,OAAO,CAACR,MAAM,EAAE;QAC7BG,GAAG,MAAAS,MAAA,CAAOlC,4BAA4B,CAACmC,KAAM,QAAAD,MAAA,CAAMX,UAAU,CAACO,OAAO,CAACM,IAAI,CAAC,GAAG,CAAE,CAAE;;MAGpF,OAAOX,GAAG;IACZ;EAAC;AAAA;AAvEMzB,4BAAA,CAAAmC,KAAK,GAAG,sBAAsB;AA0EvC,eAAe,IAAInC,4BAA4B,EAAE","ignoreList":[]}]}