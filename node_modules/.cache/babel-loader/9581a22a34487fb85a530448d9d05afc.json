{"remainingRequest":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js??ref--16-1!/home/ubuntu/suseconf/node_modules/@rancher/shell/plugins/steve/subscribe.js","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/plugins/steve/subscribe.js","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/babel.config.js","mtime":1725343995893},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9zbGljZWRUb0FycmF5IGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3NsaWNlZFRvQXJyYXkiOwppbXBvcnQgX2RlZmluZVByb3BlcnR5IGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2RlZmluZVByb3BlcnR5IjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwpmdW5jdGlvbiBvd25LZXlzKGUsIHIpIHsgdmFyIHQgPSBPYmplY3Qua2V5cyhlKTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIG8gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUpOyByICYmIChvID0gby5maWx0ZXIoZnVuY3Rpb24gKHIpIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSwgcikuZW51bWVyYWJsZTsgfSkpLCB0LnB1c2guYXBwbHkodCwgbyk7IH0gcmV0dXJuIHQ7IH0KZnVuY3Rpb24gX29iamVjdFNwcmVhZChlKSB7IGZvciAodmFyIHIgPSAxOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKSB7IHZhciB0ID0gbnVsbCAhPSBhcmd1bWVudHNbcl0gPyBhcmd1bWVudHNbcl0gOiB7fTsgciAlIDIgPyBvd25LZXlzKE9iamVjdCh0KSwgITApLmZvckVhY2goZnVuY3Rpb24gKHIpIHsgX2RlZmluZVByb3BlcnR5KGUsIHIsIHRbcl0pOyB9KSA6IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoZSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnModCkpIDogb3duS2V5cyhPYmplY3QodCkpLmZvckVhY2goZnVuY3Rpb24gKHIpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIHIsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodCwgcikpOyB9KTsgfSByZXR1cm4gZTsgfQpmdW5jdGlvbiBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihyLCBlKSB7IHZhciB0ID0gInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiByW1N5bWJvbC5pdGVyYXRvcl0gfHwgclsiQEBpdGVyYXRvciJdOyBpZiAoIXQpIHsgaWYgKEFycmF5LmlzQXJyYXkocikgfHwgKHQgPSBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkocikpIHx8IGUgJiYgciAmJiAibnVtYmVyIiA9PSB0eXBlb2Ygci5sZW5ndGgpIHsgdCAmJiAociA9IHQpOyB2YXIgX24gPSAwLCBGID0gZnVuY3Rpb24gRigpIHt9OyByZXR1cm4geyBzOiBGLCBuOiBmdW5jdGlvbiBuKCkgeyByZXR1cm4gX24gPj0gci5sZW5ndGggPyB7IGRvbmU6ICEwIH0gOiB7IGRvbmU6ICExLCB2YWx1ZTogcltfbisrXSB9OyB9LCBlOiBmdW5jdGlvbiBlKHIpIHsgdGhyb3cgcjsgfSwgZjogRiB9OyB9IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBpdGVyYXRlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTsgfSB2YXIgbywgYSA9ICEwLCB1ID0gITE7IHJldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7IHQgPSB0LmNhbGwocik7IH0sIG46IGZ1bmN0aW9uIG4oKSB7IHZhciByID0gdC5uZXh0KCk7IHJldHVybiBhID0gci5kb25lLCByOyB9LCBlOiBmdW5jdGlvbiBlKHIpIHsgdSA9ICEwLCBvID0gcjsgfSwgZjogZnVuY3Rpb24gZigpIHsgdHJ5IHsgYSB8fCBudWxsID09IHQucmV0dXJuIHx8IHQucmV0dXJuKCk7IH0gZmluYWxseSB7IGlmICh1KSB0aHJvdyBvOyB9IH0gfTsgfQpmdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkociwgYSkgeyBpZiAocikgeyBpZiAoInN0cmluZyIgPT0gdHlwZW9mIHIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShyLCBhKTsgdmFyIHQgPSB7fS50b1N0cmluZy5jYWxsKHIpLnNsaWNlKDgsIC0xKTsgcmV0dXJuICJPYmplY3QiID09PSB0ICYmIHIuY29uc3RydWN0b3IgJiYgKHQgPSByLmNvbnN0cnVjdG9yLm5hbWUpLCAiTWFwIiA9PT0gdCB8fCAiU2V0IiA9PT0gdCA/IEFycmF5LmZyb20ocikgOiAiQXJndW1lbnRzIiA9PT0gdCB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdCh0KSA/IF9hcnJheUxpa2VUb0FycmF5KHIsIGEpIDogdm9pZCAwOyB9IH0KZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkociwgYSkgeyAobnVsbCA9PSBhIHx8IGEgPiByLmxlbmd0aCkgJiYgKGEgPSByLmxlbmd0aCk7IGZvciAodmFyIGUgPSAwLCBuID0gQXJyYXkoYSk7IGUgPCBhOyBlKyspIG5bZV0gPSByW2VdOyByZXR1cm4gbjsgfQppbXBvcnQgX3JlZ2VuZXJhdG9yUnVudGltZSBmcm9tICIvaG9tZS91YnVudHUvc3VzZWNvbmYvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL3JlZ2VuZXJhdG9yL2luZGV4LmpzIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zeW1ib2wuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zeW1ib2wuZGVzY3JpcHRpb24uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zeW1ib2wuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mcm9tLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZW50cmllcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9ycy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnByb21pc2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyI7Ci8qKgogKiBIYW5kbGVzIHN1YnNjcmlwdGlvbnMgdG8gd2Vic29ja2V0cyB3aGljaCByZWNlaXZlIHVwZGF0ZXMgdG8gcmVzb3VyY2VzCiAqCiAqIENvdmVycyB0aHJlZSB1c2UgY2FzZXMKICogMSkgSGFuZGxlcyBzdWJzY3JpcHRpb24gd2l0aGluIHRoaXMgZmlsZQogKiAyKSBIYW5kbGVzIGBjbHVzdGVyYCBzdWJzY3JpcHRpb25zIGZvciBzb21lIGJhc2ljIHR5cGVzIGluIGEgd2ViIHdvcmtlciAoU0VUVElORy5VSV9QRVJGT1JNQU5DRSBhZHZhbmNlZFdvcmtlciA9IGZhbHNlKQogKiAyKSBIYW5kbGVzIGBjbHVzdGVyYCBzdWJzY3JpcHRpb25zIGFuZCBvcHRpbWlzYXRpb25zIGluIGFuIGFkdmFuY2VkIHdvcmtlciAoU0VUVElORy5VSV9QRVJGT1JNQU5DRSBhZHZhbmNlZFdvcmtlciA9IHRydWUpCiAqLwoKaW1wb3J0IHsgYWRkT2JqZWN0LCBjbGVhciwgcmVtb3ZlT2JqZWN0IH0gZnJvbSAnQHNoZWxsL3V0aWxzL2FycmF5JzsKaW1wb3J0IHsgZ2V0IH0gZnJvbSAnQHNoZWxsL3V0aWxzL29iamVjdCc7CmltcG9ydCB7IFNDSEVNQSwgTUFOQUdFTUVOVCB9IGZyb20gJ0BzaGVsbC9jb25maWcvdHlwZXMnOwppbXBvcnQgeyBTRVRUSU5HIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy9zZXR0aW5ncyc7CmltcG9ydCB7IENTUkYgfSBmcm9tICdAc2hlbGwvY29uZmlnL2Nvb2tpZXMnOwppbXBvcnQgeyBnZXRQZXJmb3JtYW5jZVNldHRpbmcgfSBmcm9tICdAc2hlbGwvdXRpbHMvc2V0dGluZ3MnOwppbXBvcnQgU29ja2V0LCB7IEVWRU5UX0NPTk5FQ1RFRCwgRVZFTlRfRElTQ09OTkVDVEVELCBFVkVOVF9NRVNTQUdFLAovLyAgRVZFTlRfRlJBTUVfVElNRU9VVCwKRVZFTlRfQ09OTkVDVF9FUlJPUiwgRVZFTlRfRElTQ09OTkVDVF9FUlJPUiwgTk9fV0FUQ0gsIE5PX1NDSEVNQSwgUkVWSVNJT05fVE9PX09MRCwgTk9fUEVSTVMgfSBmcm9tICdAc2hlbGwvdXRpbHMvc29ja2V0JzsKaW1wb3J0IHsgbm9ybWFsaXplVHlwZSB9IGZyb20gJ0BzaGVsbC9wbHVnaW5zL2Rhc2hib2FyZC1zdG9yZS9ub3JtYWxpemUnOwppbXBvcnQgZGF5IGZyb20gJ2RheWpzJzsKaW1wb3J0IHsgREFURV9GT1JNQVQsIFRJTUVfRk9STUFUIH0gZnJvbSAnQHNoZWxsL3N0b3JlL3ByZWZzJzsKaW1wb3J0IHsgZXNjYXBlSHRtbCB9IGZyb20gJ0BzaGVsbC91dGlscy9zdHJpbmcnOwppbXBvcnQgeyBrZXlGb3JTdWJzY3JpYmUgfSBmcm9tICdAc2hlbGwvcGx1Z2lucy9zdGV2ZS9yZXNvdXJjZVdhdGNoZXInOwppbXBvcnQgeyB3YWl0Rm9yIH0gZnJvbSAnQHNoZWxsL3V0aWxzL2FzeW5jJzsKaW1wb3J0IHsgV09SS0VSX01PREVTIH0gZnJvbSAnLi93b3JrZXInOwppbXBvcnQgYWNjZXB0T3JSZWplY3RTb2NrZXRNZXNzYWdlIGZyb20gJy4vYWNjZXB0LW9yLXJlamVjdC1zb2NrZXQtbWVzc2FnZSc7CmltcG9ydCB7IEJMQU5LX0NMVVNURVIsIFNUT1JFIH0gZnJvbSAnQHNoZWxsL3N0b3JlL3N0b3JlLXR5cGVzLmpzJzsKaW1wb3J0IHBhZ2luYXRpb25VdGlscyBmcm9tICdAc2hlbGwvdXRpbHMvcGFnaW5hdGlvbi11dGlscyc7CgovLyBtaW5pbXVtIGxlbmd0aCBvZiB0aW1lIGEgZGlzY29ubmVjdCBub3RpZmljYXRpb24gaXMgc2hvd24KdmFyIE1JTklNVU1fVElNRV9OT1RJRklFRCA9IDMwMDA7CnZhciB3b3JrZXJRdWV1ZXMgPSB7fTsKdmFyIHN1cHBvcnRlZFN0b3JlcyA9IFtTVE9SRS5DTFVTVEVSLCBTVE9SRS5SQU5DSEVSLCBTVE9SRS5NQU5BR0VNRU5UXTsKdmFyIGlzV2FpdGluZ0ZvckRlc3Ryb3kgPSBmdW5jdGlvbiBpc1dhaXRpbmdGb3JEZXN0cm95KHN0b3JlTmFtZSwgc3RvcmUpIHsKICB2YXIgX3N0b3JlJCR3b3JrZXJzJHN0b3JlOwogIHJldHVybiAoKF9zdG9yZSQkd29ya2VycyRzdG9yZSA9IHN0b3JlLiR3b3JrZXJzW3N0b3JlTmFtZV0pID09PSBudWxsIHx8IF9zdG9yZSQkd29ya2VycyRzdG9yZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3N0b3JlJCR3b3JrZXJzJHN0b3JlLndhaXRpbmdGb3JEZXN0cm95KSAmJiBzdG9yZS4kd29ya2Vyc1tzdG9yZU5hbWVdLndhaXRpbmdGb3JEZXN0cm95KCk7Cn07CnZhciB3YWl0Rm9yU2V0dGluZ3NTY2hlbWEgPSBmdW5jdGlvbiB3YWl0Rm9yU2V0dGluZ3NTY2hlbWEoc3RvcmVOYW1lLCBzdG9yZSkgewogIHJldHVybiB3YWl0Rm9yKGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBpc1dhaXRpbmdGb3JEZXN0cm95KHN0b3JlTmFtZSwgc3RvcmUpIHx8ICEhc3RvcmUuZ2V0dGVyc1snbWFuYWdlbWVudC9ieUlkJ10oU0NIRU1BLCBNQU5BR0VNRU5ULlNFVFRJTkcpOwogIH0pOwp9Owp2YXIgd2FpdEZvclNldHRpbmdzID0gZnVuY3Rpb24gd2FpdEZvclNldHRpbmdzKHN0b3JlTmFtZSwgc3RvcmUpIHsKICByZXR1cm4gd2FpdEZvcihmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gaXNXYWl0aW5nRm9yRGVzdHJveShzdG9yZU5hbWUsIHN0b3JlKSB8fCAhIXN0b3JlLmdldHRlcnNbJ21hbmFnZW1lbnQvYnlJZCddKE1BTkFHRU1FTlQuU0VUVElORywgU0VUVElORy5VSV9QRVJGT1JNQU5DRSk7CiAgfSk7Cn07CnZhciBpc0FkdmFuY2VkV29ya2VyID0gZnVuY3Rpb24gaXNBZHZhbmNlZFdvcmtlcihjdHgpIHsKICB2YXIgcm9vdEdldHRlcnMgPSBjdHgucm9vdEdldHRlcnMsCiAgICBnZXR0ZXJzID0gY3R4LmdldHRlcnM7CiAgdmFyIHN0b3JlTmFtZSA9IGdldHRlcnMuc3RvcmVOYW1lOwogIHZhciBjbHVzdGVySWQgPSByb290R2V0dGVycy5jbHVzdGVySWQ7CiAgaWYgKCFzdXBwb3J0ZWRTdG9yZXMuaW5jbHVkZXMoc3RvcmVOYW1lKSB8fCBjbHVzdGVySWQgPT09IEJMQU5LX0NMVVNURVIgJiYgc3RvcmVOYW1lID09PSBTVE9SRS5DTFVTVEVSKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIHZhciBwZXJmU2V0dGluZyA9IGdldFBlcmZvcm1hbmNlU2V0dGluZyhyb290R2V0dGVycyk7CiAgcmV0dXJuIHBlcmZTZXR0aW5nID09PSBudWxsIHx8IHBlcmZTZXR0aW5nID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwZXJmU2V0dGluZy5hZHZhbmNlZFdvcmtlci5lbmFibGVkOwp9OwpleHBvcnQgZnVuY3Rpb24gY3JlYXRlV29ya2VyKF94LCBfeDIpIHsKICByZXR1cm4gX2NyZWF0ZVdvcmtlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CmZ1bmN0aW9uIF9jcmVhdGVXb3JrZXIoKSB7CiAgX2NyZWF0ZVdvcmtlciA9IF9hc3luY1RvR2VuZXJhdG9yKC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoc3RvcmUsIGN0eCkgewogICAgdmFyIGdldHRlcnMsIF9kaXNwYXRjaCwgc3RvcmVOYW1lLCBhZHZhbmNlZFdvcmtlciwgd29ya2VyQWN0aW9ucywgd29ya2VyTW9kZSwgd29ya2VyLCBfd29ya2VyUXVldWVzJHN0b3JlTmEsIG1lc3NhZ2U7CiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIGdldHRlcnMgPSBjdHguZ2V0dGVycywgX2Rpc3BhdGNoID0gY3R4LmRpc3BhdGNoOwogICAgICAgICAgc3RvcmVOYW1lID0gZ2V0dGVycy5zdG9yZU5hbWU7CiAgICAgICAgICBzdG9yZS4kd29ya2VycyA9IHN0b3JlLiR3b3JrZXJzIHx8IHt9OwogICAgICAgICAgaWYgKHN1cHBvcnRlZFN0b3Jlcy5pbmNsdWRlcyhzdG9yZU5hbWUpKSB7CiAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIik7CiAgICAgICAgY2FzZSA1OgogICAgICAgICAgaWYgKCFzdG9yZS4kd29ya2Vyc1tzdG9yZU5hbWVdKSB7CiAgICAgICAgICAgIC8vIHdlIGtub3cgd2UgbmVlZCBhIHdvcmtlciBhdCB0aGlzIHBvaW50IGJ1dCB3ZSBkb24ndCBrbm93IHdoaWNoIG9uZSBzbyB3ZSdyZSBjcmVhdGluZyBhIG1vY2sgaW50ZXJmYWNlCiAgICAgICAgICAgIC8vIGl0IHdpbGwgc2ltcGx5IHF1ZXVlIHVwIGFueSBtZXNzYWdlcyBmb3IgdGhlIHJlYWwgd29ya2VyIHRvIHByb2Nlc3Mgd2hlbiBpdCBsb2FkcyB1cAogICAgICAgICAgICBzdG9yZS4kd29ya2Vyc1tzdG9yZU5hbWVdID0gewogICAgICAgICAgICAgIHBvc3RNZXNzYWdlOiBmdW5jdGlvbiBwb3N0TWVzc2FnZShtc2cpIHsKICAgICAgICAgICAgICAgIHZhciBfT2JqZWN0JGtleXM7CiAgICAgICAgICAgICAgICBpZiAoKChfT2JqZWN0JGtleXMgPSBPYmplY3Qua2V5cyhtc2cpKSA9PT0gbnVsbCB8fCBfT2JqZWN0JGtleXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9PYmplY3Qka2V5c1swXSkgPT09ICdkZXN0cm95V29ya2VyJykgewogICAgICAgICAgICAgICAgICAvLyBUaGUgd29ya2VyIGhhcyBiZWVuIGRlc3Ryb3llZCBiZWZvcmUgaXQncyBiZWVuIHNldCB1cC4gRmxhZyB0aGlzIHNvIHdlIHN0b3Agd2FpdGluZyBmb3IgbWdtdCBzZXR0aW5ncyBhbmQgdGhlbiBjYW4gZGVzdHJveSB3b3JrZXIuCiAgICAgICAgICAgICAgICAgIC8vIFRoaXMgY2FuIG9jY3VyciB3aGVuIHRoZSB1c2VyIGlzIHJlZGlyZWN0ZWQgdG8gdGhlIGxvZyBpbiBwYWdlCiAgICAgICAgICAgICAgICAgIC8vIC0gd29ya2VycyBjcmVhdGVkIChidXQgd2FpdGluZykKICAgICAgICAgICAgICAgICAgLy8gLSBsb2dvdXQgaXMgY2FsbGVkCiAgICAgICAgICAgICAgICAgIC8vIC0gPHN0b3JlPi91bnN1YnNjcmliZSBpcyBkaXNwYXRjaGVkCiAgICAgICAgICAgICAgICAgIC8vIC0gd2FpdCBmb3Igd29ya2VyIG9iamVjdCB0byBiZSBkZXN0cm95ZWQgPC0tIHJlcXVpcmVzIGluaXRpYWwgd2FpdCB0byBiZSB1bmJsb2NrZWQKICAgICAgICAgICAgICAgICAgc3RvcmUuJHdvcmtlcnNbc3RvcmVOYW1lXS5tb2RlID0gV09SS0VSX01PREVTLkRFU1RST1lfTU9DSzsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHdvcmtlclF1ZXVlc1tzdG9yZU5hbWVdKSB7CiAgICAgICAgICAgICAgICAgIHdvcmtlclF1ZXVlc1tzdG9yZU5hbWVdLnB1c2gobXNnKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHdvcmtlclF1ZXVlc1tzdG9yZU5hbWVdID0gW21zZ107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBtb2RlOiBXT1JLRVJfTU9ERVMuV0FJVElORywKICAgICAgICAgICAgICB3YWl0aW5nRm9yRGVzdHJveTogZnVuY3Rpb24gd2FpdGluZ0ZvckRlc3Ryb3koKSB7CiAgICAgICAgICAgICAgICB2YXIgX3N0b3JlJCR3b3JrZXJzJHN0b3JlMjsKICAgICAgICAgICAgICAgIHJldHVybiAoKF9zdG9yZSQkd29ya2VycyRzdG9yZTIgPSBzdG9yZS4kd29ya2Vyc1tzdG9yZU5hbWVdKSA9PT0gbnVsbCB8fCBfc3RvcmUkJHdvcmtlcnMkc3RvcmUyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfc3RvcmUkJHdvcmtlcnMkc3RvcmUyLm1vZGUpID09PSBXT1JLRVJfTU9ERVMuREVTVFJPWV9NT0NLOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgICAgIC8vIFNpbWlsYXIgdG8gd29ya2VyQWN0aW9ucy5kZXN0cm95V29ya2VyCiAgICAgICAgICAgICAgICBkZWxldGUgc3RvcmUuJHdvcmtlcnNbc3RvcmVOYW1lXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDg7CiAgICAgICAgICByZXR1cm4gd2FpdEZvclNldHRpbmdzU2NoZW1hKHN0b3JlTmFtZSwgc3RvcmUpOwogICAgICAgIGNhc2UgODoKICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMTA7CiAgICAgICAgICByZXR1cm4gd2FpdEZvclNldHRpbmdzKHN0b3JlTmFtZSwgc3RvcmUpOwogICAgICAgIGNhc2UgMTA6CiAgICAgICAgICBpZiAoIXN0b3JlLiR3b3JrZXJzW3N0b3JlTmFtZV0ud2FpdGluZ0ZvckRlc3Ryb3koKSkgewogICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDEzOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHN0b3JlLiR3b3JrZXJzW3N0b3JlTmFtZV0uZGVzdHJveSgpOwogICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIpOwogICAgICAgIGNhc2UgMTM6CiAgICAgICAgICBhZHZhbmNlZFdvcmtlciA9IGlzQWR2YW5jZWRXb3JrZXIoY3R4KTsKICAgICAgICAgIHdvcmtlckFjdGlvbnMgPSBfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KHsKICAgICAgICAgICAgbG9hZDogZnVuY3Rpb24gbG9hZChyZXNvdXJjZSkgewogICAgICAgICAgICAgIHF1ZXVlQ2hhbmdlKGN0eCwgcmVzb3VyY2UsIHRydWUsICdDaGFuZ2UnKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVzdHJveVdvcmtlcjogZnVuY3Rpb24gZGVzdHJveVdvcmtlcigpIHsKICAgICAgICAgICAgICBpZiAoc3RvcmUuJHdvcmtlcnMpIHsKICAgICAgICAgICAgICAgIHN0b3JlLiR3b3JrZXJzW3N0b3JlTmFtZV0udGVybWluYXRlKCk7CiAgICAgICAgICAgICAgICBkZWxldGUgc3RvcmUuJHdvcmtlcnNbc3RvcmVOYW1lXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGJhdGNoQ2hhbmdlczogZnVuY3Rpb24gYmF0Y2hDaGFuZ2VzKGJhdGNoKSB7CiAgICAgICAgICAgICAgX2Rpc3BhdGNoKCdiYXRjaENoYW5nZXMnLCBhY2NlcHRPclJlamVjdFNvY2tldE1lc3NhZ2UudmFsaWRhdGVCYXRjaENoYW5nZShjdHgsIGJhdGNoKSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRpc3BhdGNoOiBmdW5jdGlvbiBkaXNwYXRjaChtc2cpIHsKICAgICAgICAgICAgICBfZGlzcGF0Y2goIndzLiIuY29uY2F0KG1zZy5uYW1lKSwgbXNnKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVkaXNwYXRjaDogZnVuY3Rpb24gcmVkaXNwYXRjaChtc2cpIHsKICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgKiBiZWNhdXNlIHdlIGhhZCB0byBxdWV1ZSB1cCBzb21lIG1lc3NhZ2VzIHByaW9yIHRvIGxvYWRpbmcgdGhlIHdvcmtlcjoKICAgICAgICAgICAgICAgKiB0aGUgYmFzaWMgd29ya2VyIHdpbGwgbmVlZCB0byByZWRpc3BhdGNoIHNvbWUgb2YgdGhlIHF1ZXVlZCBtZXNzYWdlcyBiYWNrIHRvIHRoZSBVSSB0aHJlYWQKICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICBPYmplY3QuZW50cmllcyhtc2cpLmZvckVhY2goZnVuY3Rpb24gKF9yZWYyMSkgewogICAgICAgICAgICAgICAgdmFyIF9yZWYyMiA9IF9zbGljZWRUb0FycmF5KF9yZWYyMSwgMiksCiAgICAgICAgICAgICAgICAgIGFjdGlvbiA9IF9yZWYyMlswXSwKICAgICAgICAgICAgICAgICAgcGFyYW1zID0gX3JlZjIyWzFdOwogICAgICAgICAgICAgICAgX2Rpc3BhdGNoKGFjdGlvbiwgcGFyYW1zKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgRVZFTlRfQ09OTkVDVF9FUlJPUiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgX2Rpc3BhdGNoKCdlcnJvcicsIGUpOwogICAgICAgICAgfSksIEVWRU5UX0RJU0NPTk5FQ1RfRVJST1IsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIF9kaXNwYXRjaCgnZXJyb3InLCBlKTsKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKCFzdG9yZS4kd29ya2Vyc1tzdG9yZU5hbWVdIHx8IHN0b3JlLiR3b3JrZXJzW3N0b3JlTmFtZV0ubW9kZSA9PT0gV09SS0VSX01PREVTLldBSVRJTkcpIHsKICAgICAgICAgICAgd29ya2VyTW9kZSA9IGFkdmFuY2VkV29ya2VyID8gV09SS0VSX01PREVTLkFEVkFOQ0VEIDogV09SS0VSX01PREVTLkJBU0lDOwogICAgICAgICAgICB3b3JrZXIgPSBzdG9yZS5zdGV2ZUNyZWF0ZVdvcmtlcih3b3JrZXJNb2RlKTsKICAgICAgICAgICAgc3RvcmUuJHdvcmtlcnNbc3RvcmVOYW1lXSA9IHdvcmtlcjsKICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICBpbml0V29ya2VyOiB7CiAgICAgICAgICAgICAgICBzdG9yZU5hbWU6IHN0b3JlTmFtZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQ292ZXJzIG1lc3NhZ2UgZnJvbSBXb3JrZXIgdG8gVUkgdGhyZWFkCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBzdG9yZS4kd29ya2Vyc1tzdG9yZU5hbWVdLm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgLyogb24gdGhlIG9mZiBjaGFuY2UgdGhlcmUncyBtb3JlIHRoYW4ga2V5IGluIHRoZSBtZXNzYWdlLCB3ZSBoYW5kbGUgdGhlbSBpbiB0aGUgb3JkZXIgdGhhdCB0aGV5ICJrZXlzIiBtZXRob2QgcHJvdmlkZXMgd2hpY2ggaXMKICAgICAgICAgICAgICAvLyBnb29kIGVub3VnaCBmb3Igbm93IGNvbnNpZGVyaW5nIHRoYXQgd2UgbmV2ZXIgc2VuZCBtb3JlIHRoYW4gb25lIG1lc3NhZ2UgYWN0aW9uIGF0IGEgdGltZSByaWdodCBub3cgKi8KICAgICAgICAgICAgICB2YXIgbWVzc2FnZUFjdGlvbnMgPSBPYmplY3Qua2V5cyhlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUuZGF0YSk7CiAgICAgICAgICAgICAgbWVzc2FnZUFjdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICAgICAgICAgICAgICB3b3JrZXJBY3Rpb25zW2FjdGlvbl0oZSA9PT0gbnVsbCB8fCBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlLmRhdGFbYWN0aW9uXSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICB3aGlsZSAoKF93b3JrZXJRdWV1ZXMkc3RvcmVOYSA9IHdvcmtlclF1ZXVlc1tzdG9yZU5hbWVdKSAhPT0gbnVsbCAmJiBfd29ya2VyUXVldWVzJHN0b3JlTmEgIT09IHZvaWQgMCAmJiBfd29ya2VyUXVldWVzJHN0b3JlTmEubGVuZ3RoKSB7CiAgICAgICAgICAgIG1lc3NhZ2UgPSB3b3JrZXJRdWV1ZXNbc3RvcmVOYW1lXS5zaGlmdCgpOwogICAgICAgICAgICBzdG9yZS4kd29ya2Vyc1tzdG9yZU5hbWVdLnBvc3RNZXNzYWdlKG1lc3NhZ2UpOwogICAgICAgICAgfQogICAgICAgIGNhc2UgMTc6CiAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICB9CiAgICB9LCBfY2FsbGVlNik7CiAgfSkpOwogIHJldHVybiBfY3JlYXRlV29ya2VyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KZXhwb3J0IGZ1bmN0aW9uIGVxdWl2YWxlbnRXYXRjaChhLCBiKSB7CiAgdmFyIGFyZXNvdXJjZVR5cGUgPSBhLnJlc291cmNlVHlwZSB8fCBhLnR5cGU7CiAgdmFyIGJyZXNvdXJjZVR5cGUgPSBiLnJlc291cmNlVHlwZSB8fCBiLnR5cGU7CiAgaWYgKGFyZXNvdXJjZVR5cGUgIT09IGJyZXNvdXJjZVR5cGUpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgaWYgKGEuaWQgIT09IGIuaWQgJiYgKGEuaWQgfHwgYi5pZCkpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgaWYgKGEubmFtZXNwYWNlICE9PSBiLm5hbWVzcGFjZSAmJiAoYS5uYW1lc3BhY2UgfHwgYi5uYW1lc3BhY2UpKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlmIChhLnNlbGVjdG9yICE9PSBiLnNlbGVjdG9yICYmIChhLnNlbGVjdG9yIHx8IGIuc2VsZWN0b3IpKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIHF1ZXVlQ2hhbmdlKF9yZWYsIF9yZWYyLCBsb2FkLCBsYWJlbCkgewogIHZhciBnZXR0ZXJzID0gX3JlZi5nZXR0ZXJzLAogICAgc3RhdGUgPSBfcmVmLnN0YXRlLAogICAgcm9vdEdldHRlcnMgPSBfcmVmLnJvb3RHZXR0ZXJzOwogIHZhciBkYXRhID0gX3JlZjIuZGF0YSwKICAgIHJldmlzaW9uID0gX3JlZjIucmV2aXNpb247CiAgdmFyIHR5cGUgPSBnZXR0ZXJzLm5vcm1hbGl6ZVR5cGUoZGF0YS50eXBlKTsKICB2YXIgZW50cnkgPSBnZXR0ZXJzLnR5cGVFbnRyeSh0eXBlKTsKICBpZiAoZW50cnkpIHsKICAgIGVudHJ5LnJldmlzaW9uID0gTWF0aC5tYXgoZW50cnkucmV2aXNpb24sIHBhcnNlSW50KHJldmlzaW9uLCAxMCkpOwogIH0gZWxzZSB7CiAgICByZXR1cm47CiAgfQoKICAvLyBjb25zb2xlLmxvZyhgJHsgbGFiZWwgfSBFdmVudCBbJHsgc3RhdGUuY29uZmlnLm5hbWVzcGFjZSB9XWAsIGRhdGEudHlwZSwgZGF0YS5pZCk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZQoKICBpZiAoIWFjY2VwdE9yUmVqZWN0U29ja2V0TWVzc2FnZS52YWxpZENoYW5nZSh7CiAgICBnZXR0ZXJzOiBnZXR0ZXJzLAogICAgcm9vdEdldHRlcnM6IHJvb3RHZXR0ZXJzCiAgfSwgdHlwZSwgZGF0YSkpIHsKICAgIHJldHVybjsKICB9CiAgaWYgKGxvYWQpIHsKICAgIHN0YXRlLnF1ZXVlLnB1c2goewogICAgICBhY3Rpb246ICdkaXNwYXRjaCcsCiAgICAgIGV2ZW50OiAnbG9hZCcsCiAgICAgIGJvZHk6IGRhdGEKICAgIH0pOwogIH0gZWxzZSB7CiAgICB2YXIgb2JqID0gZ2V0dGVycy5ieUlkKGRhdGEudHlwZSwgZGF0YS5pZCk7CiAgICBpZiAob2JqKSB7CiAgICAgIHN0YXRlLnF1ZXVlLnB1c2goewogICAgICAgIGFjdGlvbjogJ2NvbW1pdCcsCiAgICAgICAgZXZlbnQ6ICdyZW1vdmUnLAogICAgICAgIGJvZHk6IG9iagogICAgICB9KTsKICAgIH0KICAgIGlmICh0eXBlID09PSBTQ0hFTUEpIHsKICAgICAgLy8gQ2xlYXIgdGhlIGN1cnJlbnQgcmVjb3JkcyBpbiB0aGUgc3RvcmUgd2hlbiBhIHR5cGUgZGlzYXBwZWFycwogICAgICBzdGF0ZS5xdWV1ZS5wdXNoKHsKICAgICAgICBhY3Rpb246ICdjb21taXQnLAogICAgICAgIGV2ZW50OiAnZm9yZ2V0VHlwZScsCiAgICAgICAgYm9keTogZGF0YS5pZAogICAgICB9KTsKICAgIH0KICB9Cn0KZnVuY3Rpb24gZ3Jvd2xzRGlzYWJsZWQocm9vdEdldHRlcnMpIHsKICB2YXIgX2dldFBlcmZvcm1hbmNlU2V0dGluOwogIHJldHVybiAoX2dldFBlcmZvcm1hbmNlU2V0dGluID0gZ2V0UGVyZm9ybWFuY2VTZXR0aW5nKHJvb3RHZXR0ZXJzKSkgPT09IG51bGwgfHwgX2dldFBlcmZvcm1hbmNlU2V0dGluID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZ2V0UGVyZm9ybWFuY2VTZXR0aW4uZGlzYWJsZVdlYnNvY2tldE5vdGlmaWNhdGlvbjsKfQoKLyoqCiAqIEFjdGlvbnMgdGhhdCBjb3ZlciBhbGwgY2FzZXMgKHNlZSBmaWxlIGRlc2NyaXB0aW9uKQogKi8KdmFyIHNoYXJlZEFjdGlvbnMgPSB7CiAgc3Vic2NyaWJlOiBmdW5jdGlvbiBzdWJzY3JpYmUoY3R4LCBvcHQpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICB2YXIgX3Jvb3RHZXR0ZXJzJGlzU2luZ2xlOwogICAgICB2YXIgc3RhdGUsIGNvbW1pdCwgZGlzcGF0Y2gsIGdldHRlcnMsIHJvb3RHZXR0ZXJzLCBzb2NrZXQsIHVybCwgbWF4VHJpZXMsIG1ldGFkYXRhOwogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgc3RhdGUgPSBjdHguc3RhdGUsIGNvbW1pdCA9IGN0eC5jb21taXQsIGRpc3BhdGNoID0gY3R4LmRpc3BhdGNoLCBnZXR0ZXJzID0gY3R4LmdldHRlcnMsIHJvb3RHZXR0ZXJzID0gY3R4LnJvb3RHZXR0ZXJzOyAvLyBUb0RvOiBuZWVkIHRvIGtlZXAgdGhlIHdvcmtlciB1cCB0byBkYXRlIG9uIENTUkYgY29va2llCiAgICAgICAgICAgIGlmICghKChfcm9vdEdldHRlcnMkaXNTaW5nbGUgPSByb290R2V0dGVyc1snaXNTaW5nbGVQcm9kdWN0J10pICE9PSBudWxsICYmIF9yb290R2V0dGVycyRpc1NpbmdsZSAhPT0gdm9pZCAwICYmIF9yb290R2V0dGVycyRpc1NpbmdsZS5kaXNhYmxlU3RldmVTb2NrZXRzKSkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBzb2NrZXQgPSBzdGF0ZS5zb2NrZXQ7CiAgICAgICAgICAgIGNvbW1pdCgnc2V0V2FudFNvY2tldCcsIHRydWUpOwogICAgICAgICAgICBzdGF0ZS5kZWJ1Z1NvY2tldCAmJiBjb25zb2xlLmluZm8oIlN1YnNjcmliZSBbIi5jb25jYXQoZ2V0dGVycy5zdG9yZU5hbWUsICJdIikpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKICAgICAgICAgICAgdXJsID0gIiIuY29uY2F0KHN0YXRlLmNvbmZpZy5iYXNlVXJsLCAiL3N1YnNjcmliZSIpOwogICAgICAgICAgICBtYXhUcmllcyA9IGdyb3dsc0Rpc2FibGVkKHJvb3RHZXR0ZXJzKSA/IG51bGwgOiAzOwogICAgICAgICAgICBtZXRhZGF0YSA9IGdldChvcHQsICdtZXRhZGF0YScpOwogICAgICAgICAgICBpZiAoIWlzQWR2YW5jZWRXb3JrZXIoY3R4KSkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoX3RoaXMuJHdvcmtlcnNbZ2V0dGVycy5zdG9yZU5hbWVdKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEzOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMzsKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVdvcmtlcihfdGhpcywgY3R4KTsKICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgIC8vIGlmIHRoZSB3b3JrZXIgaXMgaW4gYWR2YW5jZWQgbW9kZSB0aGVuIGl0J2xsIGNvbnRhaW4gaXQncyBvd24gc29ja2V0IHdoaWNoIGl0IGNhbGxzIGEgJ3dhdGNoZXInCiAgICAgICAgICAgIF90aGlzLiR3b3JrZXJzW2dldHRlcnMuc3RvcmVOYW1lXS5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgY3JlYXRlV2F0Y2hlcjogewogICAgICAgICAgICAgICAgbWV0YWRhdGE6IG1ldGFkYXRhLAogICAgICAgICAgICAgICAgdXJsOiAiIi5jb25jYXQoc3RhdGUuY29uZmlnLmJhc2VVcmwsICIvc3Vic2NyaWJlIiksCiAgICAgICAgICAgICAgICBjc3JmOiBfdGhpcy4kY29va2llcy5nZXQoQ1NSRiwgewogICAgICAgICAgICAgICAgICBwYXJzZUpTT046IGZhbHNlCiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIG1heFRyaWVzOiBtYXhUcmllcwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICBpZiAoc29ja2V0KSB7CiAgICAgICAgICAgICAgc29ja2V0LnNldEF1dG9SZWNvbm5lY3QodHJ1ZSk7CiAgICAgICAgICAgICAgc29ja2V0LnNldFVybCh1cmwpOwogICAgICAgICAgICAgIHNvY2tldC5jb25uZWN0KG1ldGFkYXRhKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzb2NrZXQgPSBuZXcgU29ja2V0KCIiLmNvbmNhdChzdGF0ZS5jb25maWcuYmFzZVVybCwgIi9zdWJzY3JpYmUiKSwgdHJ1ZSwgbnVsbCwgbnVsbCwgbWF4VHJpZXMpOwogICAgICAgICAgICAgIGNvbW1pdCgnc2V0U29ja2V0Jywgc29ja2V0KTsKICAgICAgICAgICAgICBzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihFVkVOVF9DT05ORUNURUQsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICBkaXNwYXRjaCgnb3BlbmVkJywgZSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgc29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoRVZFTlRfRElTQ09OTkVDVEVELCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgZGlzcGF0Y2goJ2Nsb3NlZCcsIGUpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHNvY2tldC5hZGRFdmVudExpc3RlbmVyKEVWRU5UX0NPTk5FQ1RfRVJST1IsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICBkaXNwYXRjaCgnZXJyb3InLCBlKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihFVkVOVF9ESVNDT05ORUNUX0VSUk9SLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgZGlzcGF0Y2goJ2Vycm9yJywgZSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgc29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoRVZFTlRfTUVTU0FHRSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIHZhciBldmVudCA9IGUuZGV0YWlsOwogICAgICAgICAgICAgICAgaWYgKGV2ZW50LmRhdGEpIHsKICAgICAgICAgICAgICAgICAgdmFyIG1zZyA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7CiAgICAgICAgICAgICAgICAgIGlmIChtc2cubmFtZSkgewogICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoKCJ3cy4iLmNvbmNhdChtc2cubmFtZSksIG1zZyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBzb2NrZXQuY29ubmVjdChtZXRhZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZSk7CiAgICB9KSkoKTsKICB9LAogIHVuc3Vic2NyaWJlOiBmdW5jdGlvbiB1bnN1YnNjcmliZShfcmVmMykgewogICAgdmFyIF90aGlzMiA9IHRoaXM7CiAgICB2YXIgY29tbWl0ID0gX3JlZjMuY29tbWl0LAogICAgICBnZXR0ZXJzID0gX3JlZjMuZ2V0dGVycywKICAgICAgc3RhdGUgPSBfcmVmMy5zdGF0ZTsKICAgIHZhciBzb2NrZXQgPSBzdGF0ZS5zb2NrZXQ7CiAgICBjb21taXQoJ3NldFdhbnRTb2NrZXQnLCBmYWxzZSk7CiAgICB2YXIgY2xlYW51cFRhc2tzID0gW107CiAgICB2YXIgd29ya2VyID0gKHRoaXMuJHdvcmtlcnMgfHwge30pW2dldHRlcnMuc3RvcmVOYW1lXTsKICAgIGlmICh3b3JrZXIpIHsKICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHsKICAgICAgICBkZXN0cm95V29ya2VyOiB0cnVlCiAgICAgIH0pOyAvLyB3ZSdyZSBvbmx5IHBhc3NpbmcgdGhlIGJvb2xlYW4gaGVyZSBiZWNhdXNlIHRoZSBrZXkgbmVlZHMgdG8gYmUgc29tZXRoaW5nIHRydXRoeSB0byBlbnN1cmUgaXQncyBwYXNzZWQgb24gdGhlIG9iamVjdC4KICAgICAgY2xlYW51cFRhc2tzLnB1c2god2FpdEZvcihmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICFfdGhpczIuJHdvcmtlcnNbZ2V0dGVycy5zdG9yZU5hbWVdOwogICAgICB9LCAnV29ya2VyIGlzIGRlc3Ryb3llZCcpKTsKICAgIH0KICAgIGlmIChzb2NrZXQpIHsKICAgICAgY2xlYW51cFRhc2tzLnB1c2goc29ja2V0LmRpc2Nvbm5lY3QoKSk7CiAgICB9CiAgICByZXR1cm4gUHJvbWlzZS5hbGwoY2xlYW51cFRhc2tzKTsKICB9LAogIHdhdGNoOiBmdW5jdGlvbiB3YXRjaChfcmVmNCwgcGFyYW1zKSB7CiAgICB2YXIgX3NjaGVtYSRhdHRyaWJ1dGVzLCBfdGhpcyQkd29ya2VyczsKICAgIHZhciBzdGF0ZSA9IF9yZWY0LnN0YXRlLAogICAgICBkaXNwYXRjaCA9IF9yZWY0LmRpc3BhdGNoLAogICAgICBnZXR0ZXJzID0gX3JlZjQuZ2V0dGVycywKICAgICAgcm9vdEdldHRlcnMgPSBfcmVmNC5yb290R2V0dGVyczsKICAgIHN0YXRlLmRlYnVnU29ja2V0ICYmIGNvbnNvbGUuaW5mbygiV2F0Y2ggUmVxdWVzdCBbIi5jb25jYXQoZ2V0dGVycy5zdG9yZU5hbWUsICJdIiksIEpTT04uc3RyaW5naWZ5KHBhcmFtcykpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKCiAgICB2YXIgdHlwZSA9IHBhcmFtcy50eXBlLAogICAgICBzZWxlY3RvciA9IHBhcmFtcy5zZWxlY3RvciwKICAgICAgaWQgPSBwYXJhbXMuaWQsCiAgICAgIHJldmlzaW9uID0gcGFyYW1zLnJldmlzaW9uLAogICAgICBuYW1lc3BhY2UgPSBwYXJhbXMubmFtZXNwYWNlLAogICAgICBzdG9wID0gcGFyYW1zLnN0b3AsCiAgICAgIGZvcmNlID0gcGFyYW1zLmZvcmNlOwogICAgbmFtZXNwYWNlID0gYWNjZXB0T3JSZWplY3RTb2NrZXRNZXNzYWdlLnN1YnNjcmliZU5hbWVzcGFjZShuYW1lc3BhY2UpOwogICAgdHlwZSA9IGdldHRlcnMubm9ybWFsaXplVHlwZSh0eXBlKTsKICAgIGlmIChyb290R2V0dGVyc1sndHlwZS1tYXAvaXNTcG9vZmVkJ10odHlwZSkpIHsKICAgICAgc3RhdGUuZGVidWdTb2NrZXQgJiYgY29uc29sZS5pbmZvKCdXaWxsIG5vdCBXYXRjaCAodHlwZSBpcyBzcG9vZmVkKScsIEpTT04uc3RyaW5naWZ5KHBhcmFtcykpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKCiAgICAgIHJldHVybjsKICAgIH0KICAgIHZhciBzY2hlbWEgPSBnZXR0ZXJzLnNjaGVtYUZvcih0eXBlLCBmYWxzZSwgZmFsc2UpOwogICAgaWYgKCEhKHNjaGVtYSAhPT0gbnVsbCAmJiBzY2hlbWEgIT09IHZvaWQgMCAmJiAoX3NjaGVtYSRhdHRyaWJ1dGVzID0gc2NoZW1hLmF0dHJpYnV0ZXMpICE9PSBudWxsICYmIF9zY2hlbWEkYXR0cmlidXRlcyAhPT0gdm9pZCAwICYmIChfc2NoZW1hJGF0dHJpYnV0ZXMgPSBfc2NoZW1hJGF0dHJpYnV0ZXMudmVyYnMpICE9PSBudWxsICYmIF9zY2hlbWEkYXR0cmlidXRlcyAhPT0gdm9pZCAwICYmIF9zY2hlbWEkYXR0cmlidXRlcy5pbmNsdWRlcykgJiYgIXNjaGVtYS5hdHRyaWJ1dGVzLnZlcmJzLmluY2x1ZGVzKCd3YXRjaCcpKSB7CiAgICAgIHN0YXRlLmRlYnVnU29ja2V0ICYmIGNvbnNvbGUuaW5mbygnV2lsbCBub3QgV2F0Y2ggKHR5cGUgZG9lcyBub3QgaGF2ZSB3YXRjaCB2ZXJiKScsIEpTT04uc3RyaW5naWZ5KHBhcmFtcykpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKCiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBJZiBzb2NrZXQgaXMgaW4gZXJyb3IgZG9uJ3QgdHJ5IHRvIHdhdGNoLi4uLiB1bmxlc3Mgd2UgYGZvcmNlYCBpdAogICAgdmFyIGluRXJyb3IgPSBnZXR0ZXJzLmluRXJyb3IocGFyYW1zKTsKICAgIGlmICghc3RvcCAmJiAhZm9yY2UgJiYgaW5FcnJvcikgewogICAgICAvLyBSRVZJU0lPTl9UT09fT0xEIGlzIGEgdGVtcG9yYXJ5IHN0YXRlIGFuZCB3aWxsIGJlIGhhbmRsZWQgd2hlbiBgcmVzeW5jV2F0Y2hgIGNvbXBsZXRlcwogICAgICBpZiAoaW5FcnJvciAhPT0gUkVWSVNJT05fVE9PX09MRCkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkFib3J0aW5nIFdhdGNoIFJlcXVlc3QgWyIuY29uY2F0KGdldHRlcnMuc3RvcmVOYW1lLCAiXS4gV2F0Y2hlciBpbiBlcnJvciAoIikuY29uY2F0KGluRXJyb3IsICIpIiksIEpTT04uc3RyaW5naWZ5KHBhcmFtcykpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIXN0b3AgJiYgZ2V0dGVycy53YXRjaFN0YXJ0ZWQoewogICAgICB0eXBlOiB0eXBlLAogICAgICBpZDogaWQsCiAgICAgIHNlbGVjdG9yOiBzZWxlY3RvciwKICAgICAgbmFtZXNwYWNlOiBuYW1lc3BhY2UKICAgIH0pKSB7CiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlCiAgICAgIHN0YXRlLmRlYnVnU29ja2V0ICYmIGNvbnNvbGUuZGVidWcoIkFscmVhZHkgV2F0Y2hpbmcgWyIuY29uY2F0KGdldHRlcnMuc3RvcmVOYW1lLCAiXSIpLCB7CiAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICBpZDogaWQsCiAgICAgICAgc2VsZWN0b3I6IHNlbGVjdG9yLAogICAgICAgIG5hbWVzcGFjZTogbmFtZXNwYWNlCiAgICAgIH0pOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gaXNTdGV2ZUNhY2hlRW5hYmxlZCBjaGVjayBpcyB0ZW1wb3JhcnkgYW5kIHdpbGwgYmUgcmVtb3ZlZCBvbmNlIFBhcnQgMyBvZiBodHRwczovL2dpdGh1Yi5jb20vcmFuY2hlci9kYXNoYm9hcmQvcHVsbC8xMDM0OSBpcyByZXNvbHZlZCBieSBiYWNrZW5kCiAgICAvLyBTdGV2ZSBjYWNoZSBiYWNrZWQgYXBpIGRvZXMgbm90IHJldHVybiBhIHJldmlzaW9uLCBzbyBgcmV2aXNpb25gIGhlcmUgaXMgYWx3YXlzIHVuZGVmaW5lZAogICAgLy8gV2hpY2ggbWVhbnMgd2UgZmluZCBhIHJldmlzaW9uIHdpdGhpbiBhIHJlc291cmNlIGl0c2VsZiBhbmQgdXNlIGl0IGluIHRoZSB3YXRjaAogICAgLy8gVGhhdCByZXZpc2lvbiBpcyBwcm9iYWJseSB0b28gb2xkIGFuZCByZXN1bHRzIGluIGEgd2F0Y2ggZXJyb3IKICAgIC8vIFdhdGNoIGVycm9ycyBtZWFuIHdlIG1ha2UgYSBodHRwIHJlcXVlc3QgdG8gZ2V0IGxhdGVzdCByZXZpc2lvbiAod2hpY2ggaXMgc3RpbGwgbWlzc2luZykgYW5kIHRyeSB0byByZS13YXRjaCB3aXRoIGl0Li4uCiAgICAvLyBldGMKICAgIGlmICh0eXBlb2YgcmV2aXNpb24gPT09ICd1bmRlZmluZWQnICYmICFwYWdpbmF0aW9uVXRpbHMuaXNTdGV2ZUNhY2hlRW5hYmxlZCh7CiAgICAgIHJvb3RHZXR0ZXJzOiByb290R2V0dGVycwogICAgfSkpIHsKICAgICAgcmV2aXNpb24gPSBnZXR0ZXJzLm5leHRSZXNvdXJjZVZlcnNpb24odHlwZSwgaWQpOwogICAgfQogICAgdmFyIG1zZyA9IHsKICAgICAgcmVzb3VyY2VUeXBlOiB0eXBlCiAgICB9OwogICAgaWYgKHJldmlzaW9uKSB7CiAgICAgIG1zZy5yZXNvdXJjZVZlcnNpb24gPSAiIi5jb25jYXQocmV2aXNpb24pOwogICAgfQogICAgaWYgKG5hbWVzcGFjZSkgewogICAgICBtc2cubmFtZXNwYWNlID0gbmFtZXNwYWNlOwogICAgfQogICAgaWYgKHN0b3ApIHsKICAgICAgbXNnLnN0b3AgPSB0cnVlOwogICAgfQogICAgaWYgKGlkKSB7CiAgICAgIG1zZy5pZCA9IGlkOwogICAgfQogICAgaWYgKHNlbGVjdG9yKSB7CiAgICAgIG1zZy5zZWxlY3RvciA9IHNlbGVjdG9yOwogICAgfQogICAgdmFyIHdvcmtlciA9ICgoX3RoaXMkJHdvcmtlcnMgPSB0aGlzLiR3b3JrZXJzKSA9PT0gbnVsbCB8fCBfdGhpcyQkd29ya2VycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkJHdvcmtlcnNbZ2V0dGVycy5zdG9yZU5hbWVdKSB8fCB7fTsKICAgIGlmICh3b3JrZXIubW9kZSA9PT0gV09SS0VSX01PREVTLkFEVkFOQ0VEIHx8IHdvcmtlci5tb2RlID09PSBXT1JLRVJfTU9ERVMuV0FJVElORykgewogICAgICBpZiAoZm9yY2UpIHsKICAgICAgICBtc2cuZm9yY2UgPSB0cnVlOwogICAgICB9CiAgICAgIHdvcmtlci5wb3N0TWVzc2FnZSh7CiAgICAgICAgd2F0Y2g6IG1zZwogICAgICB9KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgcmV0dXJuIGRpc3BhdGNoKCdzZW5kJywgbXNnKTsKICB9LAogIHVud2F0Y2g6IGZ1bmN0aW9uIHVud2F0Y2goY3R4LCBfcmVmNSkgewogICAgdmFyIHR5cGUgPSBfcmVmNS50eXBlLAogICAgICBpZCA9IF9yZWY1LmlkLAogICAgICBuYW1lc3BhY2UgPSBfcmVmNS5uYW1lc3BhY2UsCiAgICAgIHNlbGVjdG9yID0gX3JlZjUuc2VsZWN0b3I7CiAgICB2YXIgY29tbWl0ID0gY3R4LmNvbW1pdCwKICAgICAgZ2V0dGVycyA9IGN0eC5nZXR0ZXJzLAogICAgICBkaXNwYXRjaCA9IGN0eC5kaXNwYXRjaDsKICAgIGlmIChnZXR0ZXJzWydzY2hlbWFGb3InXSh0eXBlKSkgewogICAgICBuYW1lc3BhY2UgPSBhY2NlcHRPclJlamVjdFNvY2tldE1lc3NhZ2Uuc3Vic2NyaWJlTmFtZXNwYWNlKG5hbWVzcGFjZSk7CiAgICAgIHZhciBvYmogPSB7CiAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICBpZDogaWQsCiAgICAgICAgbmFtZXNwYWNlOiBuYW1lc3BhY2UsCiAgICAgICAgc2VsZWN0b3I6IHNlbGVjdG9yLAogICAgICAgIHN0b3A6IHRydWUgLy8gU3RvcHMgdGhlIHdhdGNoIG9uIGEgdHlwZQogICAgICB9OwogICAgICBpZiAoaXNBZHZhbmNlZFdvcmtlcihjdHgpKSB7CiAgICAgICAgZGlzcGF0Y2goJ3dhdGNoJywgb2JqKTsgLy8gQXNrIHRoZSBiYWNrZW5kIHRvIHN0b3Agd2F0Y2hpbmcgdGhlIHR5cGUKICAgICAgfSBlbHNlIGlmIChnZXR0ZXJzWyd3YXRjaFN0YXJ0ZWQnXShvYmopKSB7CiAgICAgICAgLy8gU2V0IHRoYXQgd2UgZG9uJ3Qgd2FudCB0byB3YXRjaCB0aGlzIHR5cGUKICAgICAgICAvLyBPdGhlcndpc2UsIHRoZSBkaXNwYXRjaCB0byB1bndhdGNoIGJlbG93IHdpbGwganVzdCBjYXVzZSBhIHJlLXdhdGNoIHdoZW4gd2UKICAgICAgICAvLyBkZXRlY3QgdGhlIHN0b3AgbWVzc2FnZSBmcm9tIHRoZSBiYWNrZW5kIG92ZXIgdGhlIHdlYiBzb2NrZXQKICAgICAgICBjb21taXQoJ3NldFdhdGNoU3RvcHBlZCcsIG9iaik7CiAgICAgICAgZGlzcGF0Y2goJ3dhdGNoJywgb2JqKTsgLy8gQXNrIHRoZSBiYWNrZW5kIHRvIHN0b3Agd2F0Y2hpbmcgdGhlIHR5cGUKICAgICAgICAvLyBNYWtlIHN1cmUgYW55dGhpbmcgaW4gdGhlIHBlbmRpbmcgcXVldWUgZm9yIHRoZSB0eXBlIGlzIHJlbW92ZWQsIHNpbmNlIHdlJ3ZlIG5vdyByZW1vdmVkIHRoZSB0eXBlCiAgICAgICAgY29tbWl0KCdjbGVhckZyb21RdWV1ZScsIHR5cGUpOwogICAgICB9CiAgICB9CiAgfSwKICAnd3MucGluZyc6IGZ1bmN0aW9uIHdzUGluZyhfcmVmNiwgbXNnKSB7CiAgICB2YXIgZ2V0dGVycyA9IF9yZWY2LmdldHRlcnMsCiAgICAgIGRpc3BhdGNoID0gX3JlZjYuZGlzcGF0Y2g7CiAgICBpZiAoZ2V0dGVycy5zdG9yZU5hbWUgPT09ICdtYW5hZ2VtZW50JykgewogICAgICB2YXIgX21zZyRkYXRhOwogICAgICB2YXIgdmVyc2lvbiA9IChtc2cgPT09IG51bGwgfHwgbXNnID09PSB2b2lkIDAgfHwgKF9tc2ckZGF0YSA9IG1zZy5kYXRhKSA9PT0gbnVsbCB8fCBfbXNnJGRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9tc2ckZGF0YS52ZXJzaW9uKSB8fCBudWxsOwogICAgICBkaXNwYXRjaCgndXBkYXRlU2VydmVyVmVyc2lvbicsIHZlcnNpb24sIHsKICAgICAgICByb290OiB0cnVlCiAgICAgIH0pOwogICAgICBjb25zb2xlLmluZm8oIlBpbmcgWyIuY29uY2F0KGdldHRlcnMuc3RvcmVOYW1lLCAiXSBmcm9tICIpLmNvbmNhdCh2ZXJzaW9uIHx8ICd1bmtub3duIHZlcnNpb24nKSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZQogICAgfQogIH0KfTsKCi8qKgogKiBNdXRhdGlvbnMgdGhhdCBjb3ZlciBhbGwgY2FzZXMgKGJvdGggc3Vic2NyaXB0aW9ucyBoZXJlIGFuZCBpbiBhZHZhbmNlZCB3b3JrZXIpCiAqLwp2YXIgc2hhcmVkTXV0YXRpb25zID0gewogIGRlYnVnOiBmdW5jdGlvbiBkZWJ1ZyhzdGF0ZSwgb24sIHN0b3JlKSB7CiAgICBzdGF0ZS5kZWJ1Z1NvY2tldCA9IG9uICE9PSBmYWxzZTsKICAgIGlmIChzdG9yZSAmJiB0aGlzLiR3b3JrZXJzW3N0b3JlXSkgewogICAgICB0aGlzLiR3b3JrZXJzW3N0b3JlXS5wb3N0TWVzc2FnZSh7CiAgICAgICAgdG9nZ2xlRGVidWc6IG9uICE9PSBmYWxzZQogICAgICB9KTsKICAgIH0KICB9Cn07CgovKioKICogQWN0aW9ucyB0aGF0IGNvdmVyIGNhc2VzIDEgJiAyIChzZWUgZmlsZSBkZXNjcmlwdGlvbikKICovCnZhciBkZWZhdWx0QWN0aW9ucyA9IHsKICBmbHVzaDogZnVuY3Rpb24gZmx1c2goX3JlZjcpIHsKICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvcigvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICB2YXIgc3RhdGUsIGNvbW1pdCwgZGlzcGF0Y2gsIGdldHRlcnMsIHF1ZXVlLCB0b0xvYWQsIHN0YXJ0ZWQsIF9pdGVyYXRvciwgX3N0ZXAsIF9zdGVwJHZhbHVlLCBhY3Rpb24sIGV2ZW50LCBib2R5OwogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHN0YXRlID0gX3JlZjcuc3RhdGUsIGNvbW1pdCA9IF9yZWY3LmNvbW1pdCwgZGlzcGF0Y2ggPSBfcmVmNy5kaXNwYXRjaCwgZ2V0dGVycyA9IF9yZWY3LmdldHRlcnM7CiAgICAgICAgICAgIHF1ZXVlID0gc3RhdGUucXVldWU7CiAgICAgICAgICAgIHRvTG9hZCA9IFtdOwogICAgICAgICAgICBpZiAocXVldWUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA1OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgc3RhcnRlZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgICAgICBzdGF0ZS5xdWV1ZSA9IFtdOwogICAgICAgICAgICBzdGF0ZS5kZWJ1Z1NvY2tldCAmJiBjb25zb2xlLmRlYnVnKCJTdWJzY3JpYmUgRmx1c2ggWyIuY29uY2F0KGdldHRlcnMuc3RvcmVOYW1lLCAiXSIpLCBxdWV1ZS5sZW5ndGgsICdpdGVtcycpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKICAgICAgICAgICAgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIocXVldWUpOwogICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDk7CiAgICAgICAgICAgIF9pdGVyYXRvci5zKCk7CiAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICBpZiAoKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZSkgewogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzM7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3N0ZXAkdmFsdWUgPSBfc3RlcC52YWx1ZSwgYWN0aW9uID0gX3N0ZXAkdmFsdWUuYWN0aW9uLCBldmVudCA9IF9zdGVwJHZhbHVlLmV2ZW50LCBib2R5ID0gX3N0ZXAkdmFsdWUuYm9keTsKICAgICAgICAgICAgaWYgKCEoYWN0aW9uID09PSAnZGlzcGF0Y2gnICYmIGV2ZW50ID09PSAnbG9hZCcpKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBHcm91cCBsb2FkcyBpbnRvIG9uZSBsb2FkTXVsdGkgd2hlbiBwb3NzaWJsZQogICAgICAgICAgICB0b0xvYWQucHVzaChib2R5KTsKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICBpZiAoIXRvTG9hZC5sZW5ndGgpIHsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDIxOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjA7CiAgICAgICAgICAgIHJldHVybiBkaXNwYXRjaCgnbG9hZE11bHRpJywgdG9Mb2FkKTsKICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgIHRvTG9hZCA9IFtdOwogICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgaWYgKCEoYWN0aW9uID09PSAnZGlzcGF0Y2gnKSkgewogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjY7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyNDsKICAgICAgICAgICAgcmV0dXJuIGRpc3BhdGNoKGV2ZW50LCBib2R5KTsKICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAyNjoKICAgICAgICAgICAgaWYgKCEoYWN0aW9uID09PSAnY29tbWl0JykpIHsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDMwOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbW1pdChldmVudCwgYm9keSk7CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHF1ZXVlZCBhY3Rpb24nKTsKICAgICAgICAgIGNhc2UgMzE6CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzMzoKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzODsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDM1OgogICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDM1OwogICAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDJbImNhdGNoIl0oOSk7CiAgICAgICAgICAgIF9pdGVyYXRvci5lKF9jb250ZXh0Mi50MCk7CiAgICAgICAgICBjYXNlIDM4OgogICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDM4OwogICAgICAgICAgICBfaXRlcmF0b3IuZigpOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmZpbmlzaCgzOCk7CiAgICAgICAgICBjYXNlIDQxOgogICAgICAgICAgICBpZiAoIXRvTG9hZC5sZW5ndGgpIHsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ0OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNDQ7CiAgICAgICAgICAgIHJldHVybiBkaXNwYXRjaCgnbG9hZE11bHRpJywgdG9Mb2FkKTsKICAgICAgICAgIGNhc2UgNDQ6CiAgICAgICAgICAgIHN0YXRlLmRlYnVnU29ja2V0ICYmIGNvbnNvbGUuZGVidWcoIlN1YnNjcmliZSBGbHVzaCBbIi5jb25jYXQoZ2V0dGVycy5zdG9yZU5hbWUsICJdIGZpbmlzaGVkIiksIG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gc3RhcnRlZCwgJ21zJyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZQogICAgICAgICAgY2FzZSA0NToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZTIsIG51bGwsIFtbOSwgMzUsIDM4LCA0MV1dKTsKICAgIH0pKSgpOwogIH0sCiAgcmVoeWRyYXRlU3Vic2NyaWJlOiBmdW5jdGlvbiByZWh5ZHJhdGVTdWJzY3JpYmUoX3JlZjgpIHsKICAgIHZhciBzdGF0ZSA9IF9yZWY4LnN0YXRlLAogICAgICBkaXNwYXRjaCA9IF9yZWY4LmRpc3BhdGNoOwogICAgaWYgKHN0YXRlLndhbnRTb2NrZXQgJiYgIXN0YXRlLnNvY2tldCkgewogICAgICBkaXNwYXRjaCgnc3Vic2NyaWJlJyk7CiAgICB9CiAgfSwKICByZWNvbm5lY3RXYXRjaGVzOiBmdW5jdGlvbiByZWNvbm5lY3RXYXRjaGVzKF9yZWY5KSB7CiAgICB2YXIgc3RhdGUgPSBfcmVmOS5zdGF0ZSwKICAgICAgZ2V0dGVycyA9IF9yZWY5LmdldHRlcnMsCiAgICAgIGNvbW1pdCA9IF9yZWY5LmNvbW1pdCwKICAgICAgZGlzcGF0Y2ggPSBfcmVmOS5kaXNwYXRjaDsKICAgIHZhciBwcm9taXNlcyA9IFtdOwogICAgdmFyIF9pdGVyYXRvcjIgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihzdGF0ZS5zdGFydGVkLnNsaWNlKCkpLAogICAgICBfc3RlcDI7CiAgICB0cnkgewogICAgICBmb3IgKF9pdGVyYXRvcjIucygpOyAhKF9zdGVwMiA9IF9pdGVyYXRvcjIubigpKS5kb25lOykgewogICAgICAgIHZhciBlbnRyeSA9IF9zdGVwMi52YWx1ZTsKICAgICAgICBjb25zb2xlLmluZm8oIlJlY29ubmVjdCBbIi5jb25jYXQoZ2V0dGVycy5zdG9yZU5hbWUsICJdIiksIEpTT04uc3RyaW5naWZ5KGVudHJ5KSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZQoKICAgICAgICBpZiAoZ2V0dGVycy5zY2hlbWFGb3IoZW50cnkudHlwZSkpIHsKICAgICAgICAgIGNvbW1pdCgnc2V0V2F0Y2hTdG9wcGVkJywgZW50cnkpOwogICAgICAgICAgZGVsZXRlIGVudHJ5LnJldmlzaW9uOwogICAgICAgICAgcHJvbWlzZXMucHVzaChkaXNwYXRjaCgnd2F0Y2gnLCBlbnRyeSkpOwogICAgICAgIH0KICAgICAgfQogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIF9pdGVyYXRvcjIuZShlcnIpOwogICAgfSBmaW5hbGx5IHsKICAgICAgX2l0ZXJhdG9yMi5mKCk7CiAgICB9CiAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpOwogIH0sCiAgcmVzeW5jV2F0Y2g6IGZ1bmN0aW9uIHJlc3luY1dhdGNoKF9yZWYxMCwgcGFyYW1zKSB7CiAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgdmFyIHN0YXRlLCBnZXR0ZXJzLCBkaXNwYXRjaCwgY29tbWl0LCByZXNvdXJjZVR5cGUsIG5hbWVzcGFjZSwgaWQsIHNlbGVjdG9yLCBvcHQsIGhhdmUsIHdhbnQsIHdhbnRNYXAsIF9pdGVyYXRvcjMsIF9zdGVwMywgb2JqLCBfaXRlcmF0b3I0LCBfc3RlcDQsIF9vYmo7CiAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgc3RhdGUgPSBfcmVmMTAuc3RhdGUsIGdldHRlcnMgPSBfcmVmMTAuZ2V0dGVycywgZGlzcGF0Y2ggPSBfcmVmMTAuZGlzcGF0Y2gsIGNvbW1pdCA9IF9yZWYxMC5jb21taXQ7CiAgICAgICAgICAgIHJlc291cmNlVHlwZSA9IHBhcmFtcy5yZXNvdXJjZVR5cGUsIG5hbWVzcGFjZSA9IHBhcmFtcy5uYW1lc3BhY2UsIGlkID0gcGFyYW1zLmlkLCBzZWxlY3RvciA9IHBhcmFtcy5zZWxlY3RvcjsKICAgICAgICAgICAgY29uc29sZS5pbmZvKCJSZXN5bmMgWyIuY29uY2F0KGdldHRlcnMuc3RvcmVOYW1lLCAiXSIpLCBwYXJhbXMpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKICAgICAgICAgICAgb3B0ID0gewogICAgICAgICAgICAgIGZvcmNlOiB0cnVlLAogICAgICAgICAgICAgIGZvcmNlV2F0Y2g6IHRydWUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKCFpZCkgewogICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gODsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDc7CiAgICAgICAgICAgIHJldHVybiBkaXNwYXRjaCgnZmluZCcsIHsKICAgICAgICAgICAgICB0eXBlOiByZXNvdXJjZVR5cGUsCiAgICAgICAgICAgICAgaWQ6IGlkLAogICAgICAgICAgICAgIG9wdDogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBvcHQpLCB7fSwgewogICAgICAgICAgICAgICAgLy8gUGFzcyB0aGUgbmFtZXNwYWNlIHNvIGBmaW5kYCBjYW4gY29uc3RydWN0IHRoZSB1cmwgY29ycmVjdGx5CiAgICAgICAgICAgICAgICBuYW1lc3BhY2VkOiBuYW1lc3BhY2UsCiAgICAgICAgICAgICAgICAvLyBFbnN1cmUgdGhhdCBmaW5kIGNhbGxzIHdhdGNoIHdpdGggbm8gcmV2aXNpb24gKG90aGVyd2lzZSBpdCdsbCB1c2UgdGhlIHJldmlzaW9uIGZyb20gdGhlIHJlc291cmNlIHdoaWNoIGlzIHByb2JhYmx5IHN0YWxlKQogICAgICAgICAgICAgICAgcmV2aXNpb246IG51bGwKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIpOwogICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICBpZiAoIXNlbGVjdG9yKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxNTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBoYXZlID0gZ2V0dGVyc1snbWF0Y2hpbmcnXShyZXNvdXJjZVR5cGUsIHNlbGVjdG9yKS5zbGljZSgpOwogICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDEyOwogICAgICAgICAgICByZXR1cm4gZGlzcGF0Y2goJ2ZpbmRNYXRjaGluZycsIHsKICAgICAgICAgICAgICB0eXBlOiByZXNvdXJjZVR5cGUsCiAgICAgICAgICAgICAgc2VsZWN0b3I6IHNlbGVjdG9yLAogICAgICAgICAgICAgIG9wdDogb3B0CiAgICAgICAgICAgIH0pOwogICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgd2FudCA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDIwOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgIGhhdmUgPSBnZXR0ZXJzWydhbGwnXShyZXNvdXJjZVR5cGUpLnNsaWNlKCk7CiAgICAgICAgICAgIGlmIChuYW1lc3BhY2UpIHsKICAgICAgICAgICAgICBoYXZlID0gaGF2ZS5maWx0ZXIoZnVuY3Rpb24gKHgpIHsKICAgICAgICAgICAgICAgIHZhciBfeCRtZXRhZGF0YTsKICAgICAgICAgICAgICAgIHJldHVybiAoKF94JG1ldGFkYXRhID0geC5tZXRhZGF0YSkgPT09IG51bGwgfHwgX3gkbWV0YWRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF94JG1ldGFkYXRhLm5hbWVzcGFjZSkgPT09IG5hbWVzcGFjZTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDE5OwogICAgICAgICAgICByZXR1cm4gZGlzcGF0Y2goJ2ZpbmRBbGwnLCB7CiAgICAgICAgICAgICAgdHlwZTogcmVzb3VyY2VUeXBlLAogICAgICAgICAgICAgIHdhdGNoTmFtZXNwYWNlOiBuYW1lc3BhY2UsCiAgICAgICAgICAgICAgb3B0OiBvcHQKICAgICAgICAgICAgfSk7CiAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICB3YW50ID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICB3YW50TWFwID0ge307CiAgICAgICAgICAgIF9pdGVyYXRvcjMgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih3YW50KTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBmb3IgKF9pdGVyYXRvcjMucygpOyAhKF9zdGVwMyA9IF9pdGVyYXRvcjMubigpKS5kb25lOykgewogICAgICAgICAgICAgICAgb2JqID0gX3N0ZXAzLnZhbHVlOwogICAgICAgICAgICAgICAgd2FudE1hcFtvYmouaWRdID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgIF9pdGVyYXRvcjMuZShlcnIpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIF9pdGVyYXRvcjMuZigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9pdGVyYXRvcjQgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihoYXZlKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBmb3IgKF9pdGVyYXRvcjQucygpOyAhKF9zdGVwNCA9IF9pdGVyYXRvcjQubigpKS5kb25lOykgewogICAgICAgICAgICAgICAgX29iaiA9IF9zdGVwNC52YWx1ZTsKICAgICAgICAgICAgICAgIGlmICghd2FudE1hcFtfb2JqLmlkXSkgewogICAgICAgICAgICAgICAgICBzdGF0ZS5kZWJ1Z1NvY2tldCAmJiBjb25zb2xlLmluZm8oIlJlbW92ZSBzdGFsZSBbIi5jb25jYXQoZ2V0dGVycy5zdG9yZU5hbWUsICJdIiksIHJlc291cmNlVHlwZSwgX29iai5pZCk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZQoKICAgICAgICAgICAgICAgICAgY29tbWl0KCdyZW1vdmUnLCBfb2JqKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgIF9pdGVyYXRvcjQuZShlcnIpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIF9pdGVyYXRvcjQuZigpOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlMyk7CiAgICB9KSkoKTsKICB9LAogIG9wZW5lZDogZnVuY3Rpb24gb3BlbmVkKF9yZWYxMSwgZXZlbnQpIHsKICAgIHZhciBfdGhpczMgPSB0aGlzOwogICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoKSB7CiAgICAgIHZhciBfZXZlbnQkZGV0YWlsOwogICAgICB2YXIgY29tbWl0LCBkaXNwYXRjaCwgc3RhdGUsIGdldHRlcnMsIHJvb3RHZXR0ZXJzLCBzb2NrZXQsIHRyaWVzLCB0LCBkaXNhYmxlR3Jvd2wsIGdyb3dsRXJyLCBfaXRlcmF0b3I1LCBfc3RlcDUsIG9iajsKICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ1KSB7CiAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBjb21taXQgPSBfcmVmMTEuY29tbWl0LCBkaXNwYXRjaCA9IF9yZWYxMS5kaXNwYXRjaCwgc3RhdGUgPSBfcmVmMTEuc3RhdGUsIGdldHRlcnMgPSBfcmVmMTEuZ2V0dGVycywgcm9vdEdldHRlcnMgPSBfcmVmMTEucm9vdEdldHRlcnM7CiAgICAgICAgICAgIHN0YXRlLmRlYnVnU29ja2V0ICYmIGNvbnNvbGUuaW5mbygiV2ViU29ja2V0IE9wZW5lZCBbIi5jb25jYXQoZ2V0dGVycy5zdG9yZU5hbWUsICJdIikpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKICAgICAgICAgICAgc29ja2V0ID0gZXZlbnQuY3VycmVudFRhcmdldDsKICAgICAgICAgICAgdHJpZXMgPSBldmVudCA9PT0gbnVsbCB8fCBldmVudCA9PT0gdm9pZCAwIHx8IChfZXZlbnQkZGV0YWlsID0gZXZlbnQuZGV0YWlsKSA9PT0gbnVsbCB8fCBfZXZlbnQkZGV0YWlsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZXZlbnQkZGV0YWlsLnRyaWVzOyAvLyBoYXZlIHRvIHB1bGwgaXQgb2ZmIG9mIHRoZSBldmVudCBiZWNhdXNlIHRoZSBzb2NrZXQncyB0cmllcyBpcyBhbHJlYWR5IHJlc2V0IHRvIDAKICAgICAgICAgICAgdCA9IHJvb3RHZXR0ZXJzWydpMThuL3QnXTsKICAgICAgICAgICAgZGlzYWJsZUdyb3dsID0gZ3Jvd2xzRGlzYWJsZWQocm9vdEdldHRlcnMpOwogICAgICAgICAgICBfdGhpczMuJHNvY2tldCA9IHNvY2tldDsKICAgICAgICAgICAgaWYgKCFzdGF0ZS5xdWV1ZSkgewogICAgICAgICAgICAgIHN0YXRlLnF1ZXVlID0gW107CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFzdGF0ZS5xdWV1ZVRpbWVyKSB7CiAgICAgICAgICAgICAgc3RhdGUuZmx1c2hRdWV1ZSA9IC8qI19fUFVSRV9fKi9fYXN5bmNUb0dlbmVyYXRvcigvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0YXRlLnF1ZXVlLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRpc3BhdGNoKCdmbHVzaCcpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLnF1ZXVlVGltZXIgPSBzZXRUaW1lb3V0KHN0YXRlLmZsdXNoUXVldWUsIDEwMDApOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIF9jYWxsZWU0KTsKICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgc3RhdGUuZmx1c2hRdWV1ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghc29ja2V0Lmhhc1JlY29ubmVjdGVkKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAxNTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDEyOwogICAgICAgICAgICByZXR1cm4gZGlzcGF0Y2goJ3JlY29ubmVjdFdhdGNoZXMnKTsKICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgIC8vIENoZWNrIGZvciBkaXNjb25uZWN0IG5vdGlmaWNhdGlvbnMgYW5kIGNsZWFyIHRoZW0KICAgICAgICAgICAgZ3Jvd2xFcnIgPSByb290R2V0dGVyc1snZ3Jvd2wvZmluZCddKHsKICAgICAgICAgICAgICBrZXk6ICd1cmwnLAogICAgICAgICAgICAgIHZhbDogc29ja2V0LnVybAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGdyb3dsRXJyKSB7CiAgICAgICAgICAgICAgZGlzcGF0Y2goJ2dyb3dsL3JlbW92ZScsIGdyb3dsRXJyLmlkLCB7CiAgICAgICAgICAgICAgICByb290OiB0cnVlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRyaWVzID4gMSAmJiAhZGlzYWJsZUdyb3dsKSB7CiAgICAgICAgICAgICAgZGlzcGF0Y2goJ2dyb3dsL3N1Y2Nlc3MnLCB7CiAgICAgICAgICAgICAgICB0aXRsZTogdCgnZ3Jvd2wucmVjb25uZWN0ZWQudGl0bGUnKSwKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHQoJ2dyb3dsLnJlY29ubmVjdGVkLm1lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgICAgIHVybDogX3RoaXMzLiRzb2NrZXQudXJsLAogICAgICAgICAgICAgICAgICB0cmllczogdHJpZXMKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgcm9vdDogdHJ1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAvLyBUcnkgcmVzZW5kaW5nIGFueSBmcmFtZXMgdGhhdCB3ZXJlIGF0dGVtcHRlZCB0byBiZSBzZW50IHdoaWxlIHRoZSBzb2NrZXQgd2FzIGRvd24sIG9uY2UuCiAgICAgICAgICAgIF9pdGVyYXRvcjUgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihzdGF0ZS5wZW5kaW5nRnJhbWVzLnNsaWNlKCkpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yNS5zKCk7ICEoX3N0ZXA1ID0gX2l0ZXJhdG9yNS5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgICBvYmogPSBfc3RlcDUudmFsdWU7CiAgICAgICAgICAgICAgICBjb21taXQoJ2RlcXVldWVQZW5kaW5nRnJhbWUnLCBvYmopOwogICAgICAgICAgICAgICAgZGlzcGF0Y2goJ3NlbmRJbW1lZGlhdGUnLCBvYmopOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yNS5lKGVycik7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yNS5mKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWU1KTsKICAgIH0pKSgpOwogIH0sCiAgY2xvc2VkOiBmdW5jdGlvbiBjbG9zZWQoX3JlZjEzKSB7CiAgICB2YXIgc3RhdGUgPSBfcmVmMTMuc3RhdGUsCiAgICAgIGdldHRlcnMgPSBfcmVmMTMuZ2V0dGVyczsKICAgIHN0YXRlLmRlYnVnU29ja2V0ICYmIGNvbnNvbGUuaW5mbygiV2ViU29ja2V0IENsb3NlZCBbIi5jb25jYXQoZ2V0dGVycy5zdG9yZU5hbWUsICJdIikpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKICAgIGNsZWFyVGltZW91dChzdGF0ZS5xdWV1ZVRpbWVyKTsKICAgIHN0YXRlLnF1ZXVlVGltZXIgPSBudWxsOwogIH0sCiAgZXJyb3I6IGZ1bmN0aW9uIGVycm9yKF9yZWYxNCwgZSkgewogICAgdmFyIGdldHRlcnMgPSBfcmVmMTQuZ2V0dGVycywKICAgICAgc3RhdGUgPSBfcmVmMTQuc3RhdGUsCiAgICAgIGRpc3BhdGNoID0gX3JlZjE0LmRpc3BhdGNoLAogICAgICByb290R2V0dGVycyA9IF9yZWYxNC5yb290R2V0dGVyczsKICAgIGNsZWFyVGltZW91dChzdGF0ZS5xdWV1ZVRpbWVyKTsKICAgIHN0YXRlLnF1ZXVlVGltZXIgPSBudWxsOwoKICAgIC8vIGRldGVybWluZSBpZiB3ZWJzb2NrZXQgbm90aWZpY2F0aW9ucyBhcmUgZGlzYWJsZWQKICAgIHZhciBkaXNhYmxlR3Jvd2wgPSBncm93bHNEaXNhYmxlZChyb290R2V0dGVycyk7CiAgICBpZiAoIWRpc2FibGVHcm93bCkgewogICAgICB2YXIgX2Ukc3JjRWxlbWVudCwgX2Ukc3JjRWxlbWVudDIsIF9zdGF0ZSRzb2NrZXQ7CiAgICAgIHZhciBkYXRlRm9ybWF0ID0gZXNjYXBlSHRtbChyb290R2V0dGVyc1sncHJlZnMvZ2V0J10oREFURV9GT1JNQVQpKTsKICAgICAgdmFyIHRpbWVGb3JtYXQgPSBlc2NhcGVIdG1sKHJvb3RHZXR0ZXJzWydwcmVmcy9nZXQnXShUSU1FX0ZPUk1BVCkpOwogICAgICB2YXIgdGltZSA9IChlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCB8fCAoX2Ukc3JjRWxlbWVudCA9IGUuc3JjRWxlbWVudCkgPT09IG51bGwgfHwgX2Ukc3JjRWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Ukc3JjRWxlbWVudC5kaXNjb25uZWN0ZWRBdCkgfHwgRGF0ZS5ub3coKTsKICAgICAgdmFyIHRpbWVGb3JtYXR0ZWQgPSAiIi5jb25jYXQoZGF5KHRpbWUpLmZvcm1hdCgiIi5jb25jYXQoZGF0ZUZvcm1hdCwgIiAiKS5jb25jYXQodGltZUZvcm1hdCkpKTsKICAgICAgdmFyIHVybCA9IGUgPT09IG51bGwgfHwgZSA9PT0gdm9pZCAwIHx8IChfZSRzcmNFbGVtZW50MiA9IGUuc3JjRWxlbWVudCkgPT09IG51bGwgfHwgX2Ukc3JjRWxlbWVudDIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lJHNyY0VsZW1lbnQyLnVybDsKICAgICAgdmFyIHRyaWVzID0gc3RhdGUgPT09IG51bGwgfHwgc3RhdGUgPT09IHZvaWQgMCB8fCAoX3N0YXRlJHNvY2tldCA9IHN0YXRlLnNvY2tldCkgPT09IG51bGwgfHwgX3N0YXRlJHNvY2tldCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3N0YXRlJHNvY2tldC50cmllczsKICAgICAgdmFyIHQgPSByb290R2V0dGVyc1snaTE4bi90J107CiAgICAgIHZhciBncm93bEVyciA9IHJvb3RHZXR0ZXJzWydncm93bC9maW5kJ10oewogICAgICAgIGtleTogJ3VybCcsCiAgICAgICAgdmFsOiB1cmwKICAgICAgfSk7CiAgICAgIGlmIChlLnR5cGUgPT09IEVWRU5UX0NPTk5FQ1RfRVJST1IpIHsKICAgICAgICAvLyBpZiB0aGlzIG9jY3VycywgdGhlbiB3ZSdyZSBhdCBsZWFzdCByZXRyeWluZyB0byBjb25uZWN0CiAgICAgICAgaWYgKGdyb3dsRXJyKSB7CiAgICAgICAgICBkaXNwYXRjaCgnZ3Jvd2wvcmVtb3ZlJywgZ3Jvd2xFcnIuaWQsIHsKICAgICAgICAgICAgcm9vdDogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGRpc3BhdGNoKCdncm93bC9lcnJvcicsIHsKICAgICAgICAgIHRpdGxlOiB0KCdncm93bC5jb25uZWN0RXJyb3IudGl0bGUnKSwKICAgICAgICAgIG1lc3NhZ2U6IHQoJ2dyb3dsLmNvbm5lY3RFcnJvci5tZXNzYWdlJywgewogICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgdGltZTogdGltZUZvcm1hdHRlZCwKICAgICAgICAgICAgdHJpZXM6IHRyaWVzCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIHJhdzogdHJ1ZQogICAgICAgICAgfSksCiAgICAgICAgICBpY29uOiAnZXJyb3InLAogICAgICAgICAgZWFybGllc3RDbG9zZTogdGltZSArIE1JTklNVU1fVElNRV9OT1RJRklFRCwKICAgICAgICAgIHVybDogdXJsCiAgICAgICAgfSwgewogICAgICAgICAgcm9vdDogdHJ1ZQogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKGUudHlwZSA9PT0gRVZFTlRfRElTQ09OTkVDVF9FUlJPUikgewogICAgICAgIC8vIGlmIHRoaXMgb2NjdXJzLCB3ZSd2ZSBnaXZlbiB1cCBvbiB0cnlpbmcgdG8gcmVjb25uZWN0CiAgICAgICAgaWYgKGdyb3dsRXJyKSB7CiAgICAgICAgICBkaXNwYXRjaCgnZ3Jvd2wvcmVtb3ZlJywgZ3Jvd2xFcnIuaWQsIHsKICAgICAgICAgICAgcm9vdDogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGRpc3BhdGNoKCdncm93bC9lcnJvcicsIHsKICAgICAgICAgIHRpdGxlOiB0KCdncm93bC5kaXNjb25uZWN0RXJyb3IudGl0bGUnKSwKICAgICAgICAgIG1lc3NhZ2U6IHQoJ2dyb3dsLmRpc2Nvbm5lY3RFcnJvci5tZXNzYWdlJywgewogICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgdGltZTogdGltZUZvcm1hdHRlZCwKICAgICAgICAgICAgdHJpZXM6IHRyaWVzCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIHJhdzogdHJ1ZQogICAgICAgICAgfSksCiAgICAgICAgICBpY29uOiAnZXJyb3InLAogICAgICAgICAgZWFybGllc3RDbG9zZTogdGltZSArIE1JTklNVU1fVElNRV9OT1RJRklFRCwKICAgICAgICAgIHVybDogdXJsCiAgICAgICAgfSwgewogICAgICAgICAgcm9vdDogdHJ1ZQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIGlmIHRoZSBlcnJvciBpcyBub3QgYSBjb25uZWN0IGVycm9yIG9yIGRpc2Nvbm5lY3QgZXJyb3IsIHRoZSBzb2NrZXQgbmV2ZXIgd29ya2VkOiBsb2cgd2hldGhlciB0aGUgY3VycmVudCBicm93c2VyIGlzIHNhZmFyaQogICAgICAgIGNvbnNvbGUuZXJyb3IoIldlYlNvY2tldCBDb25uZWN0aW9uIEVycm9yIFsiLmNvbmNhdChnZXR0ZXJzLnN0b3JlTmFtZSwgIl0iKSwgZS5kZXRhaWwpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKICAgICAgfQogICAgfQogIH0sCiAgc2VuZDogZnVuY3Rpb24gc2VuZChfcmVmMTUsIG9iaikgewogICAgdmFyIHN0YXRlID0gX3JlZjE1LnN0YXRlLAogICAgICBjb21taXQgPSBfcmVmMTUuY29tbWl0OwogICAgaWYgKHN0YXRlLnNvY2tldCkgewogICAgICB2YXIgb2sgPSBzdGF0ZS5zb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeShvYmopKTsKICAgICAgaWYgKG9rKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CiAgICBjb21taXQoJ2VucXVldWVQZW5kaW5nRnJhbWUnLCBvYmopOwogIH0sCiAgc2VuZEltbWVkaWF0ZTogZnVuY3Rpb24gc2VuZEltbWVkaWF0ZShfcmVmMTYsIG9iaikgewogICAgdmFyIHN0YXRlID0gX3JlZjE2LnN0YXRlOwogICAgaWYgKHN0YXRlLnNvY2tldCkgewogICAgICByZXR1cm4gc3RhdGUuc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkob2JqKSk7CiAgICB9CiAgfSwKICAvKioKICAgKiBTdGV2ZSBvbmx5IGV2ZW50CiAgICovCiAgJ3dzLnJlc291cmNlLnN0YXJ0JzogZnVuY3Rpb24gd3NSZXNvdXJjZVN0YXJ0KF9yZWYxNywgbXNnKSB7CiAgICB2YXIgc3RhdGUgPSBfcmVmMTcuc3RhdGUsCiAgICAgIGdldHRlcnMgPSBfcmVmMTcuZ2V0dGVycywKICAgICAgY29tbWl0ID0gX3JlZjE3LmNvbW1pdCwKICAgICAgZGlzcGF0Y2ggPSBfcmVmMTcuZGlzcGF0Y2g7CiAgICBzdGF0ZS5kZWJ1Z1NvY2tldCAmJiBjb25zb2xlLmluZm8oIlJlc291cmNlIHN0YXJ0OiBbIi5jb25jYXQoZ2V0dGVycy5zdG9yZU5hbWUsICJdIiksIG1zZyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZQoKICAgIHZhciBuZXdXYXRjaCA9IHsKICAgICAgdHlwZTogbXNnLnJlc291cmNlVHlwZSwKICAgICAgbmFtZXNwYWNlOiBtc2cubmFtZXNwYWNlLAogICAgICBpZDogbXNnLmlkLAogICAgICBzZWxlY3RvcjogbXNnLnNlbGVjdG9yCiAgICB9OwogICAgc3RhdGUuc3RhcnRlZC5maWx0ZXIoZnVuY3Rpb24gKGVudHJ5KSB7CiAgICAgIGlmIChlbnRyeS50eXBlID09PSBuZXdXYXRjaC50eXBlICYmIGVudHJ5Lm5hbWVzcGFjZSAhPT0gbmV3V2F0Y2gubmFtZXNwYWNlKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0pLmZvckVhY2goZnVuY3Rpb24gKGVudHJ5KSB7CiAgICAgIGRpc3BhdGNoKCd1bndhdGNoJywgZW50cnkpOwogICAgfSk7CiAgICBjb21taXQoJ3NldFdhdGNoU3RhcnRlZCcsIG5ld1dhdGNoKTsKICB9LAogICd3cy5yZXNvdXJjZS5lcnJvcic6IGZ1bmN0aW9uIHdzUmVzb3VyY2VFcnJvcihfcmVmMTgsIG1zZykgewogICAgdmFyIF9tc2ckZGF0YTI7CiAgICB2YXIgZ2V0dGVycyA9IF9yZWYxOC5nZXR0ZXJzLAogICAgICBjb21taXQgPSBfcmVmMTguY29tbWl0LAogICAgICBkaXNwYXRjaCA9IF9yZWYxOC5kaXNwYXRjaDsKICAgIGNvbnNvbGUud2FybigiUmVzb3VyY2UgZXJyb3IgWyIuY29uY2F0KGdldHRlcnMuc3RvcmVOYW1lLCAiXSIpLCBtc2cucmVzb3VyY2VUeXBlLCAnOicsIG1zZy5kYXRhLmVycm9yKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCgogICAgdmFyIGVyciA9IChfbXNnJGRhdGEyID0gbXNnLmRhdGEpID09PSBudWxsIHx8IF9tc2ckZGF0YTIgPT09IHZvaWQgMCB8fCAoX21zZyRkYXRhMiA9IF9tc2ckZGF0YTIuZXJyb3IpID09PSBudWxsIHx8IF9tc2ckZGF0YTIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9tc2ckZGF0YTIudG9Mb3dlckNhc2UoKTsKICAgIGlmIChlcnIuaW5jbHVkZXMoJ3dhdGNoIG5vdCBhbGxvd2VkJykpIHsKICAgICAgY29tbWl0KCdzZXRJbkVycm9yJywgewogICAgICAgIG1zZzogbXNnLAogICAgICAgIHJlYXNvbjogTk9fV0FUQ0gKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKGVyci5pbmNsdWRlcygnZmFpbGVkIHRvIGZpbmQgc2NoZW1hJykpIHsKICAgICAgY29tbWl0KCdzZXRJbkVycm9yJywgewogICAgICAgIG1zZzogbXNnLAogICAgICAgIHJlYXNvbjogTk9fU0NIRU1BCiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChlcnIuaW5jbHVkZXMoJ3RvbyBvbGQnKSkgewogICAgICAvLyBTZXQgYW4gZXJyb3IgZm9yIChhbGwpIHN1YnMgb2YgdGhpcyB0eXBlLiBUaGlzLi4KICAgICAgLy8gMSkgYmxvY2tzIGF0dGVtcHRzIGJ5IHJlc291cmNlLnN0b3AgdG8gcmVzdWIgKGFzIHR5cGUgaXMgaW4gZXJyb3IpCiAgICAgIC8vIDIpIHdpbGwgYmUgY2xlYXJlZCB3aGVuIHJlc3luY1dhdGNoIC0tPiB3YXRjaCAod2l0aCBmb3JjZSkgLS0+IHJlc291cmNlLnN0YXJ0IGNvbXBsZXRlcwogICAgICBjb21taXQoJ3NldEluRXJyb3InLCB7CiAgICAgICAgbXNnOiBtc2csCiAgICAgICAgcmVhc29uOiBSRVZJU0lPTl9UT09fT0xECiAgICAgIH0pOwogICAgICBkaXNwYXRjaCgncmVzeW5jV2F0Y2gnLCBtc2cpOwogICAgfSBlbHNlIGlmIChlcnIuaW5jbHVkZXMoJ3RoZSBzZXJ2ZXIgZG9lcyBub3QgYWxsb3cgdGhpcyBtZXRob2Qgb24gdGhlIHJlcXVlc3RlZCByZXNvdXJjZScpKSB7CiAgICAgIGNvbW1pdCgnc2V0SW5FcnJvcicsIHsKICAgICAgICBtc2c6IG1zZywKICAgICAgICByZWFzb246IE5PX1BFUk1TCiAgICAgIH0pOwogICAgfQogIH0sCiAgLyoqCiAgICogU3RldmUgb25seSBldmVudAogICAqCiAgICogU3RldmUgaGFzIHN0b3BwZWQgd2F0Y2hpbmcgdGhpcyByZXNvdXJjZS4gVGhpcyBoYXBwZW5zIGZvciBhIGNvdXBsZSBvZiByZWFzb25zCiAgICogLSBXZSBoYXZlIHJlcXVlc3RlZCB0aGF0IHRoZSByZXNvdXJjZSB3YXRjaCBzaG91bGQgYmUgc3RvcHBlZCAoYW5kIHdlIHJlY2VpdmUgdGhpcyBldmVudCBhcyBjb25maXJtYXRpb24pCiAgICogLSBTdGV2ZSB0ZWxscyB1cyB0aGF0IHRoZSByZXNvdXJjZSB3YXRjaCBoYXMgYmVlbiBzdG9wcGVkLiBQb3NzaWJsZSByZWFzb25zCiAgICogICAtIFRoZSByYW5jaGVyIDwtLT4gazhzIHNvY2tldCBjbG9zZWQgKGhhcHBlbnMgZXZlcnkgfjMwIG1pbnMgb24gbWdtdCBzb2NrZXQpCiAgICogICAtIFBlcm1pc3Npb25zIGhhcyBjaGFuZ2VkIGZvciB0aGUgc3Vic2NyaWJlZCByZXNvdXJjZSwgc28gcmFuY2hlciBjbG9zZXMgc29ja2V0CiAgICovCiAgJ3dzLnJlc291cmNlLnN0b3AnOiBmdW5jdGlvbiB3c1Jlc291cmNlU3RvcChfcmVmMTksIG1zZykgewogICAgdmFyIHN0YXRlID0gX3JlZjE5LnN0YXRlLAogICAgICBnZXR0ZXJzID0gX3JlZjE5LmdldHRlcnMsCiAgICAgIGNvbW1pdCA9IF9yZWYxOS5jb21taXQsCiAgICAgIGRpc3BhdGNoID0gX3JlZjE5LmRpc3BhdGNoOwogICAgdmFyIHR5cGUgPSBtc2cucmVzb3VyY2VUeXBlOwogICAgdmFyIG9iaiA9IHsKICAgICAgdHlwZTogdHlwZSwKICAgICAgaWQ6IG1zZy5pZCwKICAgICAgbmFtZXNwYWNlOiBtc2cubmFtZXNwYWNlLAogICAgICBzZWxlY3RvcjogbXNnLnNlbGVjdG9yCiAgICB9OwogICAgc3RhdGUuZGVidWdTb2NrZXQgJiYgY29uc29sZS5pbmZvKCJSZXNvdXJjZSBTdG9wIFsiLmNvbmNhdChnZXR0ZXJzLnN0b3JlTmFtZSwgIl0iKSwgdHlwZSwgbXNnKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCgogICAgaWYgKCF0eXBlKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIlJlc291cmNlIFN0b3AgWyIuY29uY2F0KGdldHRlcnMuc3RvcmVOYW1lLCAiXS4gUmVjZWl2ZWQgcmVzb3VyY2Uuc3RvcCB3aXRoIGFuIGVtcHR5IHJlc291cmNlVHlwZSwgYWJvcnRpbmciKSwgbXNnKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCgogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gSWYgd2UncmUgdHJ5aW5nIHRvIHdhdGNoIHRoaXMgZXZlbnQsIGF0dGVtcHQgdG8gcmUtd2F0Y2gKICAgIC8vCiAgICAvLyBUbyBtYWtlIGxpZmUgZWFzaWVyIGluIHRoZSBhZHZhbmNlZCB3b3JrZXIgYHJlc291cmNlLnN0b3BgIC0tPiBgd2F0Y2hgIGlzIGhhbmRsZWQgaGVyZSAoYmFzaWNhbGx5IGZvciBhY2Nlc3MgdG8gZ2V0dGVycy5uZXh0UmVzb3VyY2VWZXJzaW9uKQogICAgLy8gVGhpcyBtZWFucyB0aGUgY29uY2VwdCBvZiByZXNvdXJjZSBzdWIgd2F0Y2ggc3RhdGUgbmVlZHMgbWFzc2FnaW5nCiAgICB2YXIgYWR2YW5jZWRXb3JrZXIgPSBtc2cuYWR2YW5jZWRXb3JrZXI7CiAgICB2YXIgbG9jYWxTdGF0ZSA9ICFhZHZhbmNlZFdvcmtlcjsKICAgIHZhciB3YXRjaFN0YXJ0ZWQgPSBsb2NhbFN0YXRlID8gZ2V0dGVyc1snd2F0Y2hTdGFydGVkJ10ob2JqKSA6IGFkdmFuY2VkV29ya2VyOwogICAgaWYgKGdldHRlcnNbJ3NjaGVtYUZvciddKHR5cGUpICYmIHdhdGNoU3RhcnRlZCkgewogICAgICBpZiAobG9jYWxTdGF0ZSkgewogICAgICAgIGNvbW1pdCgnc2V0V2F0Y2hTdG9wcGVkJywgb2JqKTsKICAgICAgfQogICAgICBkaXNwYXRjaCgnd2F0Y2gnLCBvYmopOwogICAgfQogIH0sCiAgJ3dzLnJlc291cmNlLmNyZWF0ZSc6IGZ1bmN0aW9uIHdzUmVzb3VyY2VDcmVhdGUoY3R4LCBtc2cpIHsKICAgIGN0eC5zdGF0ZS5kZWJ1Z1NvY2tldCAmJiBjb25zb2xlLmluZm8oIlJlc291cmNlIENyZWF0ZSBbIi5jb25jYXQoY3R4LmdldHRlcnMuc3RvcmVOYW1lLCAiXSIpLCBtc2cucmVzb3VyY2VUeXBlLCBtc2cpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKICAgIHF1ZXVlQ2hhbmdlKGN0eCwgbXNnLCB0cnVlLCAnQ3JlYXRlJyk7CiAgfSwKICAnd3MucmVzb3VyY2UuY2hhbmdlJzogZnVuY3Rpb24gd3NSZXNvdXJjZUNoYW5nZShjdHgsIG1zZykgewogICAgdmFyIF90eXBlT3B0aW9uJGFsaWFzOwogICAgdmFyIGRhdGEgPSBtc2cuZGF0YTsKICAgIHZhciB0eXBlID0gZGF0YS50eXBlOwoKICAgIC8vIFdvcmstYXJvdW5kIGZvciB3cy5lcnJvciBtZXNzYWdlcyBiZWluZyBzZW50IGFzIGNoYW5nZSBldmVudHMKICAgIC8vIFRoZXNlIGhhdmUgbm8gaWQgKG9yIG90aGVyIG1ldGFkYXRhKSB3aGljaCBicmVha3MgbG90cyBpZiB0aGV5IGFyZSBwcm9jZXNzZWQgYXMgY2hhbmdlIGV2ZW50cwogICAgaWYgKGRhdGEubWVzc2FnZSAmJiAhZGF0YS5pZCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gV2ViIHdvcmtlciBjYW4gcHJvY2VzcyBzY2hlbWFzIHRvIGNoZWNrIHRoYXQgdGhleSBhcmUgYWN0dWFsbHkgY2hhbmdpbmcgYW5kCiAgICAvLyBvbmx5IGxvYWQgdXBkYXRlcyBpZiB0aGUgc2NoZW1hIGRpZCBhY3R1YWxseSBjaGFuZ2UKICAgIGlmICh0eXBlID09PSBTQ0hFTUEpIHsKICAgICAgdmFyIHdvcmtlciA9ICh0aGlzLiR3b3JrZXJzIHx8IHt9KVtjdHguZ2V0dGVycy5zdG9yZU5hbWVdOwogICAgICBpZiAod29ya2VyKSB7CiAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIHVwZGF0ZVNjaGVtYTogZGF0YQogICAgICAgIH0pOwoKICAgICAgICAvLyBObyBmdXJ0aGVyIHByb2Nlc3NpbmcgLSBsZXQgdGhlIHdlYiB3b3JrZXIgY2hlY2sgdGhlIHNjaGVtYSB1cGRhdGVzCiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CiAgICBxdWV1ZUNoYW5nZShjdHgsIG1zZywgdHJ1ZSwgJ0NoYW5nZScpOwogICAgdmFyIHR5cGVPcHRpb24gPSBjdHgucm9vdEdldHRlcnNbJ3R5cGUtbWFwL29wdGlvbnNGb3InXSh0eXBlKTsKICAgIGlmICgodHlwZU9wdGlvbiA9PT0gbnVsbCB8fCB0eXBlT3B0aW9uID09PSB2b2lkIDAgfHwgKF90eXBlT3B0aW9uJGFsaWFzID0gdHlwZU9wdGlvbi5hbGlhcykgPT09IG51bGwgfHwgX3R5cGVPcHRpb24kYWxpYXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90eXBlT3B0aW9uJGFsaWFzLmxlbmd0aCkgPiAwKSB7CiAgICAgIHZhciBhbGlhcyA9ICh0eXBlT3B0aW9uID09PSBudWxsIHx8IHR5cGVPcHRpb24gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHR5cGVPcHRpb24uYWxpYXMpIHx8IFtdOwogICAgICBhbGlhcy5tYXAoZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgICBjdHguc3RhdGUucXVldWUucHVzaCh7CiAgICAgICAgICBhY3Rpb246ICdkaXNwYXRjaCcsCiAgICAgICAgICBldmVudDogJ2xvYWQnLAogICAgICAgICAgYm9keTogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBkYXRhKSwge30sIHsKICAgICAgICAgICAgdHlwZTogdHlwZQogICAgICAgICAgfSkKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwKICAnd3MucmVzb3VyY2UucmVtb3ZlJzogZnVuY3Rpb24gd3NSZXNvdXJjZVJlbW92ZShjdHgsIG1zZykgewogICAgdmFyIF90eXBlT3B0aW9uJGFsaWFzMjsKICAgIHZhciBkYXRhID0gbXNnLmRhdGE7CiAgICB2YXIgdHlwZSA9IGRhdGEudHlwZTsKICAgIGN0eC5zdGF0ZS5kZWJ1Z1NvY2tldCAmJiBjb25zb2xlLmluZm8oIlJlc291cmNlIFJlbW92ZSBbIi5jb25jYXQoY3R4LmdldHRlcnMuc3RvcmVOYW1lLCAiXSIpLCB0eXBlLCBtc2cpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKCiAgICBpZiAodHlwZSA9PT0gU0NIRU1BKSB7CiAgICAgIHZhciB3b3JrZXIgPSAodGhpcy4kd29ya2VycyB8fCB7fSlbY3R4LmdldHRlcnMuc3RvcmVOYW1lXTsKICAgICAgaWYgKHdvcmtlcikgewogICAgICAgIHdvcmtlci5wb3N0TWVzc2FnZSh7CiAgICAgICAgICByZW1vdmVTY2hlbWE6IGRhdGEuaWQKICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgcXVldWVDaGFuZ2UoY3R4LCBtc2csIGZhbHNlLCAnUmVtb3ZlJyk7CiAgICB2YXIgdHlwZU9wdGlvbiA9IGN0eC5yb290R2V0dGVyc1sndHlwZS1tYXAvb3B0aW9uc0ZvciddKHR5cGUpOwogICAgaWYgKCh0eXBlT3B0aW9uID09PSBudWxsIHx8IHR5cGVPcHRpb24gPT09IHZvaWQgMCB8fCAoX3R5cGVPcHRpb24kYWxpYXMyID0gdHlwZU9wdGlvbi5hbGlhcykgPT09IG51bGwgfHwgX3R5cGVPcHRpb24kYWxpYXMyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdHlwZU9wdGlvbiRhbGlhczIubGVuZ3RoKSA+IDApIHsKICAgICAgdmFyIGFsaWFzID0gKHR5cGVPcHRpb24gPT09IG51bGwgfHwgdHlwZU9wdGlvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogdHlwZU9wdGlvbi5hbGlhcykgfHwgW107CiAgICAgIGFsaWFzLm1hcChmdW5jdGlvbiAodHlwZSkgewogICAgICAgIHZhciBvYmogPSBjdHguZ2V0dGVycy5ieUlkKHR5cGUsIGRhdGEuaWQpOwogICAgICAgIGN0eC5zdGF0ZS5xdWV1ZS5wdXNoKHsKICAgICAgICAgIGFjdGlvbjogJ2NvbW1pdCcsCiAgICAgICAgICBldmVudDogJ3JlbW92ZScsCiAgICAgICAgICBib2R5OiBvYmoKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfQp9OwoKLyoqCiAqIE11dGF0aW9ucyB0aGF0IGNvdmVyIGNhc2VzIDEgJiAyIChzZWUgZmlsZSBkZXNjcmlwdGlvbikKICovCnZhciBkZWZhdWx0TXV0YXRpb25zID0gewogIHNldFNvY2tldDogZnVuY3Rpb24gc2V0U29ja2V0KHN0YXRlLCBzb2NrZXQpIHsKICAgIHN0YXRlLnNvY2tldCA9IHNvY2tldDsKICB9LAogIHNldFdhbnRTb2NrZXQ6IGZ1bmN0aW9uIHNldFdhbnRTb2NrZXQoc3RhdGUsIHdhbnQpIHsKICAgIHN0YXRlLndhbnRTb2NrZXQgPSB3YW50OwogIH0sCiAgZW5xdWV1ZVBlbmRpbmdGcmFtZTogZnVuY3Rpb24gZW5xdWV1ZVBlbmRpbmdGcmFtZShzdGF0ZSwgb2JqKSB7CiAgICBzdGF0ZS5wZW5kaW5nRnJhbWVzLnB1c2gob2JqKTsKICB9LAogIGRlcXVldWVQZW5kaW5nRnJhbWU6IGZ1bmN0aW9uIGRlcXVldWVQZW5kaW5nRnJhbWUoc3RhdGUsIG9iaikgewogICAgcmVtb3ZlT2JqZWN0KHN0YXRlLnBlbmRpbmdGcmFtZXMsIG9iaik7CiAgfSwKICBzZXRXYXRjaFN0YXJ0ZWQ6IGZ1bmN0aW9uIHNldFdhdGNoU3RhcnRlZChzdGF0ZSwgb2JqKSB7CiAgICB2YXIgZXhpc3RpbmcgPSBzdGF0ZS5zdGFydGVkLmZpbmQoZnVuY3Rpb24gKGVudHJ5KSB7CiAgICAgIHJldHVybiBlcXVpdmFsZW50V2F0Y2gob2JqLCBlbnRyeSk7CiAgICB9KTsKICAgIGlmICghZXhpc3RpbmcpIHsKICAgICAgYWRkT2JqZWN0KHN0YXRlLnN0YXJ0ZWQsIG9iaik7CiAgICB9CiAgICBkZWxldGUgc3RhdGUuaW5FcnJvcltrZXlGb3JTdWJzY3JpYmUob2JqKV07CiAgfSwKICBzZXRXYXRjaFN0b3BwZWQ6IGZ1bmN0aW9uIHNldFdhdGNoU3RvcHBlZChzdGF0ZSwgb2JqKSB7CiAgICB2YXIgZXhpc3RpbmcgPSBzdGF0ZS5zdGFydGVkLmZpbmQoZnVuY3Rpb24gKGVudHJ5KSB7CiAgICAgIHJldHVybiBlcXVpdmFsZW50V2F0Y2gob2JqLCBlbnRyeSk7CiAgICB9KTsKICAgIGlmIChleGlzdGluZykgewogICAgICByZW1vdmVPYmplY3Qoc3RhdGUuc3RhcnRlZCwgZXhpc3RpbmcpOwogICAgfSBlbHNlIHsKICAgICAgY29uc29sZS53YXJuKCJUcmllZCB0byByZW1vdmUgYSB3YXRjaCB0aGF0IGRvZXNuJ3QgZXhpc3QiLCBvYmopOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKICAgIH0KICB9LAogIHNldEluRXJyb3I6IGZ1bmN0aW9uIHNldEluRXJyb3Ioc3RhdGUsIF9yZWYyMCkgewogICAgdmFyIG1zZyA9IF9yZWYyMC5tc2csCiAgICAgIHJlYXNvbiA9IF9yZWYyMC5yZWFzb247CiAgICB2YXIga2V5ID0ga2V5Rm9yU3Vic2NyaWJlKG1zZyk7CiAgICBzdGF0ZS5pbkVycm9yW2tleV0gPSByZWFzb247CiAgfSwKICBjbGVhckluRXJyb3I6IGZ1bmN0aW9uIGNsZWFySW5FcnJvcihzdGF0ZSwgbXNnKSB7CiAgICB2YXIga2V5ID0ga2V5Rm9yU3Vic2NyaWJlKG1zZyk7CiAgICBkZWxldGUgc3RhdGUuaW5FcnJvcltrZXldOwogIH0sCiAgcmVzZXRTdWJzY3JpcHRpb25zOiBmdW5jdGlvbiByZXNldFN1YnNjcmlwdGlvbnMoc3RhdGUpIHsKICAgIC8vIENsZWFyIG91dCBzb2NrZXQgc3RhdGUuIFRoaXMgaXMgb25seSBldmVyIGNhbGxlZCBmcm9tIHJlc2V0Li4uIHdoaWNoIGlzIGFsd2F5cyBjYWxsZWQgYWZ0ZXIgd2UgYGRpc2Nvbm5lY3RgIGFib3ZlLgogICAgLy8gVGhpcyBjb3VsZCBwcm9iYWJseSBiZSBmb2xkZWQgaW4gdG8gdGhlcmUKICAgIGNsZWFyKHN0YXRlLnN0YXJ0ZWQpOwogICAgY2xlYXIoc3RhdGUucGVuZGluZ0ZyYW1lcyk7CiAgICBjbGVhcihzdGF0ZS5xdWV1ZSk7CiAgICBjbGVhclRpbWVvdXQoc3RhdGUucXVldWVUaW1lcik7CiAgICBzdGF0ZS5kZWZlcnJlZFJlcXVlc3RzID0ge307CiAgICBzdGF0ZS5xdWV1ZVRpbWVyID0gbnVsbDsKICB9LAogIGNsZWFyRnJvbVF1ZXVlOiBmdW5jdGlvbiBjbGVhckZyb21RdWV1ZShzdGF0ZSwgdHlwZSkgewogICAgLy8gUmVtb3ZlIGFueXRoaW5nIGluIHRoZSBxdWV1ZSB0aGF0IGlzIGEgcmVzb3VyY2UgdXBkYXRlIGZvciB0aGUgZ2l2ZW4gdHlwZQogICAgc3RhdGUucXVldWUgPSBzdGF0ZS5xdWV1ZS5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgdmFyIF9pdGVtJGJvZHk7CiAgICAgIHJldHVybiAoKF9pdGVtJGJvZHkgPSBpdGVtLmJvZHkpID09PSBudWxsIHx8IF9pdGVtJGJvZHkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9pdGVtJGJvZHkudHlwZSkgIT09IHR5cGU7CiAgICB9KTsKICB9Cn07CgovKioKICogR2V0dGVycyB0aGF0IGNvdmVyIGNhc2VzIDEgJiAyIChzZWUgZmlsZSBkZXNjcmlwdGlvbikKICovCnZhciBkZWZhdWx0R2V0dGVycyA9IHsKICBpbkVycm9yOiBmdW5jdGlvbiBpbkVycm9yKHN0YXRlKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKG9iaikgewogICAgICByZXR1cm4gc3RhdGUuaW5FcnJvcltrZXlGb3JTdWJzY3JpYmUob2JqKV07CiAgICB9OwogIH0sCiAgd2F0Y2hTdGFydGVkOiBmdW5jdGlvbiB3YXRjaFN0YXJ0ZWQoc3RhdGUpIHsKICAgIHJldHVybiBmdW5jdGlvbiAob2JqKSB7CiAgICAgIHJldHVybiAhIXN0YXRlLnN0YXJ0ZWQuZmluZChmdW5jdGlvbiAoZW50cnkpIHsKICAgICAgICByZXR1cm4gZXF1aXZhbGVudFdhdGNoKG9iaiwgZW50cnkpOwogICAgICB9KTsKICAgIH07CiAgfSwKICBuZXh0UmVzb3VyY2VWZXJzaW9uOiBmdW5jdGlvbiBuZXh0UmVzb3VyY2VWZXJzaW9uKHN0YXRlLCBnZXR0ZXJzKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKHR5cGUsIGlkKSB7CiAgICAgIHR5cGUgPSBub3JtYWxpemVUeXBlKHR5cGUpOwogICAgICB2YXIgcmV2aXNpb24gPSAwOwogICAgICBpZiAoaWQpIHsKICAgICAgICB2YXIgX2V4aXN0aW5nJG1ldGFkYXRhOwogICAgICAgIHZhciBleGlzdGluZyA9IGdldHRlcnNbJ2J5SWQnXSh0eXBlLCBpZCk7CiAgICAgICAgcmV2aXNpb24gPSBwYXJzZUludChleGlzdGluZyA9PT0gbnVsbCB8fCBleGlzdGluZyA9PT0gdm9pZCAwIHx8IChfZXhpc3RpbmckbWV0YWRhdGEgPSBleGlzdGluZy5tZXRhZGF0YSkgPT09IG51bGwgfHwgX2V4aXN0aW5nJG1ldGFkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZXhpc3RpbmckbWV0YWRhdGEucmVzb3VyY2VWZXJzaW9uLCAxMCk7CiAgICAgIH0KICAgICAgaWYgKCFyZXZpc2lvbikgewogICAgICAgIHZhciBjYWNoZSA9IHN0YXRlLnR5cGVzW3R5cGVdOwogICAgICAgIGlmICghY2FjaGUpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICByZXZpc2lvbiA9IGNhY2hlLnJldmlzaW9uOyAvLyBUaGlzIGlzIGFsd2F5cyB6ZXJvLi4uLi4KICAgICAgICB2YXIgX2l0ZXJhdG9yNiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGNhY2hlLmxpc3QpLAogICAgICAgICAgX3N0ZXA2OwogICAgICAgIHRyeSB7CiAgICAgICAgICBmb3IgKF9pdGVyYXRvcjYucygpOyAhKF9zdGVwNiA9IF9pdGVyYXRvcjYubigpKS5kb25lOykgewogICAgICAgICAgICB2YXIgb2JqID0gX3N0ZXA2LnZhbHVlOwogICAgICAgICAgICBpZiAob2JqICYmIG9iai5tZXRhZGF0YSkgewogICAgICAgICAgICAgIHZhciBuZXUgPSBwYXJzZUludChvYmoubWV0YWRhdGEucmVzb3VyY2VWZXJzaW9uLCAxMCk7CiAgICAgICAgICAgICAgcmV2aXNpb24gPSBNYXRoLm1heChyZXZpc2lvbiwgbmV1KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgX2l0ZXJhdG9yNi5lKGVycik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIF9pdGVyYXRvcjYuZigpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocmV2aXNpb24pIHsKICAgICAgICByZXR1cm4gcmV2aXNpb247CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9OwogIH0KfTsKZXhwb3J0IHZhciBhY3Rpb25zID0gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBzaGFyZWRBY3Rpb25zKSwgZGVmYXVsdEFjdGlvbnMpOwpleHBvcnQgdmFyIG11dGF0aW9ucyA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgc2hhcmVkTXV0YXRpb25zKSwgZGVmYXVsdE11dGF0aW9ucyk7CmV4cG9ydCB2YXIgZ2V0dGVycyA9IF9vYmplY3RTcHJlYWQoe30sIGRlZmF1bHRHZXR0ZXJzKTs="},{"version":3,"names":["addObject","clear","removeObject","get","SCHEMA","MANAGEMENT","SETTING","CSRF","getPerformanceSetting","Socket","EVENT_CONNECTED","EVENT_DISCONNECTED","EVENT_MESSAGE","EVENT_CONNECT_ERROR","EVENT_DISCONNECT_ERROR","NO_WATCH","NO_SCHEMA","REVISION_TOO_OLD","NO_PERMS","normalizeType","day","DATE_FORMAT","TIME_FORMAT","escapeHtml","keyForSubscribe","waitFor","WORKER_MODES","acceptOrRejectSocketMessage","BLANK_CLUSTER","STORE","paginationUtils","MINIMUM_TIME_NOTIFIED","workerQueues","supportedStores","CLUSTER","RANCHER","isWaitingForDestroy","storeName","store","_store$$workers$store","$workers","waitingForDestroy","waitForSettingsSchema","getters","waitForSettings","UI_PERFORMANCE","isAdvancedWorker","ctx","rootGetters","clusterId","includes","perfSetting","advancedWorker","enabled","createWorker","_x","_x2","_createWorker","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee6","_dispatch","workerActions","workerMode","worker","_workerQueues$storeNa","message","wrap","_callee6$","_context6","prev","next","dispatch","abrupt","postMessage","msg","_Object$keys","Object","keys","mode","DESTROY_MOCK","push","WAITING","_store$$workers$store2","destroy","_defineProperty","load","resource","queueChange","destroyWorker","terminate","batchChanges","batch","validateBatchChange","concat","name","redispatch","entries","forEach","_ref21","_ref22","_slicedToArray","action","params","e","ADVANCED","BASIC","steveCreateWorker","initWorker","onmessage","messageActions","data","length","shift","stop","equivalentWatch","a","b","aresourceType","resourceType","type","bresourceType","id","namespace","selector","_ref","_ref2","label","state","revision","entry","typeEntry","Math","max","parseInt","validChange","queue","event","body","obj","byId","growlsDisabled","_getPerformanceSettin","disableWebsocketNotification","sharedActions","subscribe","opt","_this","_callee","_rootGetters$isSingle","commit","socket","url","maxTries","metadata","_callee$","_context","disableSteveSockets","debugSocket","console","info","config","baseUrl","createWatcher","csrf","$cookies","parseJSON","setAutoReconnect","setUrl","connect","addEventListener","detail","JSON","parse","unsubscribe","_ref3","_this2","cleanupTasks","disconnect","Promise","all","watch","_ref4","_schema$attributes","_this$$workers","stringify","force","subscribeNamespace","schema","schemaFor","attributes","verbs","inError","error","watchStarted","debug","isSteveCacheEnabled","nextResourceVersion","resourceVersion","unwatch","_ref5","wsPing","_ref6","_msg$data","version","root","sharedMutations","on","toggleDebug","defaultActions","flush","_ref7","_callee2","toLoad","started","_iterator","_step","_step$value","_callee2$","_context2","Date","getTime","_createForOfIteratorHelper","s","n","done","value","Error","t0","f","finish","rehydrateSubscribe","_ref8","wantSocket","reconnectWatches","_ref9","promises","_iterator2","slice","_step2","err","resyncWatch","_ref10","_callee3","have","want","wantMap","_iterator3","_step3","_iterator4","_step4","_obj","_callee3$","_context3","forceWatch","_objectSpread","namespaced","sent","filter","x","_x$metadata","watchNamespace","opened","_ref11","_this3","_callee5","_event$detail","tries","t","disableGrowl","growlErr","_iterator5","_step5","_callee5$","_context5","currentTarget","$socket","queueTimer","flushQueue","_callee4","_callee4$","_context4","setTimeout","hasReconnected","key","val","title","pendingFrames","closed","_ref13","clearTimeout","_ref14","_e$srcElement","_e$srcElement2","_state$socket","dateFormat","timeFormat","time","srcElement","disconnectedAt","now","timeFormatted","format","raw","icon","earliestClose","send","_ref15","ok","sendImmediate","_ref16","wsResourceStart","_ref17","newWatch","wsResourceError","_ref18","_msg$data2","warn","toLowerCase","reason","wsResourceStop","_ref19","localState","wsResourceCreate","wsResourceChange","_typeOption$alias","updateSchema","typeOption","alias","map","wsResourceRemove","_typeOption$alias2","removeSchema","defaultMutations","setSocket","setWantSocket","enqueuePendingFrame","dequeuePendingFrame","setWatchStarted","existing","find","setWatchStopped","setInError","_ref20","clearInError","resetSubscriptions","deferredRequests","clearFromQueue","item","_item$body","defaultGetters","_existing$metadata","cache","types","_iterator6","list","_step6","neu","actions","mutations"],"sources":["/home/ubuntu/suseconf/node_modules/@rancher/shell/plugins/steve/subscribe.js"],"sourcesContent":["/**\n * Handles subscriptions to websockets which receive updates to resources\n *\n * Covers three use cases\n * 1) Handles subscription within this file\n * 2) Handles `cluster` subscriptions for some basic types in a web worker (SETTING.UI_PERFORMANCE advancedWorker = false)\n * 2) Handles `cluster` subscriptions and optimisations in an advanced worker (SETTING.UI_PERFORMANCE advancedWorker = true)\n */\n\nimport { addObject, clear, removeObject } from '@shell/utils/array';\nimport { get } from '@shell/utils/object';\nimport { SCHEMA, MANAGEMENT } from '@shell/config/types';\nimport { SETTING } from '@shell/config/settings';\nimport { CSRF } from '@shell/config/cookies';\nimport { getPerformanceSetting } from '@shell/utils/settings';\nimport Socket, {\n  EVENT_CONNECTED,\n  EVENT_DISCONNECTED,\n  EVENT_MESSAGE,\n  //  EVENT_FRAME_TIMEOUT,\n  EVENT_CONNECT_ERROR,\n  EVENT_DISCONNECT_ERROR,\n  NO_WATCH,\n  NO_SCHEMA,\n  REVISION_TOO_OLD,\n  NO_PERMS\n} from '@shell/utils/socket';\nimport { normalizeType } from '@shell/plugins/dashboard-store/normalize';\nimport day from 'dayjs';\nimport { DATE_FORMAT, TIME_FORMAT } from '@shell/store/prefs';\nimport { escapeHtml } from '@shell/utils/string';\nimport { keyForSubscribe } from '@shell/plugins/steve/resourceWatcher';\nimport { waitFor } from '@shell/utils/async';\nimport { WORKER_MODES } from './worker';\nimport acceptOrRejectSocketMessage from './accept-or-reject-socket-message';\nimport { BLANK_CLUSTER, STORE } from '@shell/store/store-types.js';\nimport paginationUtils from '@shell/utils/pagination-utils';\n\n// minimum length of time a disconnect notification is shown\nconst MINIMUM_TIME_NOTIFIED = 3000;\n\nconst workerQueues = {};\n\nconst supportedStores = [STORE.CLUSTER, STORE.RANCHER, STORE.MANAGEMENT];\n\nconst isWaitingForDestroy = (storeName, store) => {\n  return store.$workers[storeName]?.waitingForDestroy && store.$workers[storeName].waitingForDestroy();\n};\n\nconst waitForSettingsSchema = (storeName, store) => {\n  return waitFor(() => isWaitingForDestroy(storeName, store) || !!store.getters['management/byId'](SCHEMA, MANAGEMENT.SETTING));\n};\n\nconst waitForSettings = (storeName, store) => {\n  return waitFor(() => isWaitingForDestroy(storeName, store) || !!store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.UI_PERFORMANCE));\n};\n\nconst isAdvancedWorker = (ctx) => {\n  const { rootGetters, getters } = ctx;\n  const storeName = getters.storeName;\n  const clusterId = rootGetters.clusterId;\n\n  if (!supportedStores.includes(storeName) || (clusterId === BLANK_CLUSTER && storeName === STORE.CLUSTER)) {\n    return false;\n  }\n\n  const perfSetting = getPerformanceSetting(rootGetters);\n\n  return perfSetting?.advancedWorker.enabled;\n};\n\nexport async function createWorker(store, ctx) {\n  const { getters, dispatch } = ctx;\n  const storeName = getters.storeName;\n\n  store.$workers = store.$workers || {};\n\n  if (!supportedStores.includes(storeName)) {\n    return;\n  }\n\n  if (!store.$workers[storeName]) {\n    // we know we need a worker at this point but we don't know which one so we're creating a mock interface\n    // it will simply queue up any messages for the real worker to process when it loads up\n    store.$workers[storeName] = {\n      postMessage: (msg) => {\n        if (Object.keys(msg)?.[0] === 'destroyWorker') {\n          // The worker has been destroyed before it's been set up. Flag this so we stop waiting for mgmt settings and then can destroy worker.\n          // This can occurr when the user is redirected to the log in page\n          // - workers created (but waiting)\n          // - logout is called\n          // - <store>/unsubscribe is dispatched\n          // - wait for worker object to be destroyed <-- requires initial wait to be unblocked\n          store.$workers[storeName].mode = WORKER_MODES.DESTROY_MOCK;\n\n          return;\n        }\n        if (workerQueues[storeName]) {\n          workerQueues[storeName].push(msg);\n        } else {\n          workerQueues[storeName] = [msg];\n        }\n      },\n      mode:              WORKER_MODES.WAITING,\n      waitingForDestroy: () => {\n        return store.$workers[storeName]?.mode === WORKER_MODES.DESTROY_MOCK;\n      },\n      destroy: () => {\n        // Similar to workerActions.destroyWorker\n        delete store.$workers[storeName];\n      }\n    };\n  }\n\n  await waitForSettingsSchema(storeName, store);\n  await waitForSettings(storeName, store);\n  if (store.$workers[storeName].waitingForDestroy()) {\n    store.$workers[storeName].destroy();\n\n    return;\n  }\n  const advancedWorker = isAdvancedWorker(ctx);\n\n  const workerActions = {\n    load: (resource) => {\n      queueChange(ctx, resource, true, 'Change');\n    },\n    destroyWorker: () => {\n      if (store.$workers) {\n        store.$workers[storeName].terminate();\n        delete store.$workers[storeName];\n      }\n    },\n    batchChanges: (batch) => {\n      dispatch('batchChanges', acceptOrRejectSocketMessage.validateBatchChange(ctx, batch));\n    },\n    dispatch: (msg) => {\n      dispatch(`ws.${ msg.name }`, msg);\n    },\n    redispatch: (msg) => {\n      /**\n       * because we had to queue up some messages prior to loading the worker:\n       * the basic worker will need to redispatch some of the queued messages back to the UI thread\n       */\n      Object.entries(msg).forEach(([action, params]) => {\n        dispatch(action, params);\n      });\n    },\n    [EVENT_CONNECT_ERROR]: (e) => {\n      dispatch('error', e );\n    },\n    [EVENT_DISCONNECT_ERROR]: (e) => {\n      dispatch('error', e );\n    },\n  };\n\n  if (!store.$workers[storeName] || store.$workers[storeName].mode === WORKER_MODES.WAITING) {\n    const workerMode = advancedWorker ? WORKER_MODES.ADVANCED : WORKER_MODES.BASIC;\n    const worker = store.steveCreateWorker(workerMode);\n\n    store.$workers[storeName] = worker;\n\n    worker.postMessage({ initWorker: { storeName } });\n\n    /**\n     * Covers message from Worker to UI thread\n     */\n    store.$workers[storeName].onmessage = (e) => {\n      /* on the off chance there's more than key in the message, we handle them in the order that they \"keys\" method provides which is\n      // good enough for now considering that we never send more than one message action at a time right now */\n      const messageActions = Object.keys(e?.data);\n\n      messageActions.forEach((action) => {\n        workerActions[action](e?.data[action]);\n      });\n    };\n  }\n\n  while (workerQueues[storeName]?.length) {\n    const message = workerQueues[storeName].shift();\n\n    store.$workers[storeName].postMessage(message);\n  }\n}\n\nexport function equivalentWatch(a, b) {\n  const aresourceType = a.resourceType || a.type;\n  const bresourceType = b.resourceType || b.type;\n\n  if ( aresourceType !== bresourceType ) {\n    return false;\n  }\n\n  if ( a.id !== b.id && (a.id || b.id) ) {\n    return false;\n  }\n\n  if ( a.namespace !== b.namespace && (a.namespace || b.namespace) ) {\n    return false;\n  }\n\n  if ( a.selector !== b.selector && (a.selector || b.selector) ) {\n    return false;\n  }\n\n  return true;\n}\n\nfunction queueChange({ getters, state, rootGetters }, { data, revision }, load, label) {\n  const type = getters.normalizeType(data.type);\n\n  const entry = getters.typeEntry(type);\n\n  if ( entry ) {\n    entry.revision = Math.max(entry.revision, parseInt(revision, 10));\n  } else {\n    return;\n  }\n\n  // console.log(`${ label } Event [${ state.config.namespace }]`, data.type, data.id); // eslint-disable-line no-console\n\n  if (!acceptOrRejectSocketMessage.validChange({ getters, rootGetters }, type, data)) {\n    return;\n  }\n\n  if ( load ) {\n    state.queue.push({\n      action: 'dispatch',\n      event:  'load',\n      body:   data\n    });\n  } else {\n    const obj = getters.byId(data.type, data.id);\n\n    if ( obj ) {\n      state.queue.push({\n        action: 'commit',\n        event:  'remove',\n        body:   obj\n      });\n    }\n\n    if ( type === SCHEMA ) {\n      // Clear the current records in the store when a type disappears\n      state.queue.push({\n        action: 'commit',\n        event:  'forgetType',\n        body:   data.id\n      });\n    }\n  }\n}\n\nfunction growlsDisabled(rootGetters) {\n  return getPerformanceSetting(rootGetters)?.disableWebsocketNotification;\n}\n\n/**\n * Actions that cover all cases (see file description)\n */\nconst sharedActions = {\n  async subscribe(ctx, opt) {\n    const {\n      state, commit, dispatch, getters, rootGetters\n    } = ctx;\n\n    // ToDo: need to keep the worker up to date on CSRF cookie\n\n    if (rootGetters['isSingleProduct']?.disableSteveSockets) {\n      return;\n    }\n\n    let socket = state.socket;\n\n    commit('setWantSocket', true);\n\n    state.debugSocket && console.info(`Subscribe [${ getters.storeName }]`); // eslint-disable-line no-console\n\n    const url = `${ state.config.baseUrl }/subscribe`;\n    const maxTries = growlsDisabled(rootGetters) ? null : 3;\n    const metadata = get(opt, 'metadata');\n\n    if (isAdvancedWorker(ctx)) {\n      if (!this.$workers[getters.storeName]) {\n        await createWorker(this, ctx);\n      }\n\n      // if the worker is in advanced mode then it'll contain it's own socket which it calls a 'watcher'\n      this.$workers[getters.storeName].postMessage({\n        createWatcher: {\n          metadata,\n          url:  `${ state.config.baseUrl }/subscribe`,\n          csrf: this.$cookies.get(CSRF, { parseJSON: false }),\n          maxTries\n        }\n      });\n    } else if ( socket ) {\n      socket.setAutoReconnect(true);\n      socket.setUrl(url);\n      socket.connect(metadata);\n    } else {\n      socket = new Socket(`${ state.config.baseUrl }/subscribe`, true, null, null, maxTries);\n\n      commit('setSocket', socket);\n      socket.addEventListener(EVENT_CONNECTED, (e) => {\n        dispatch('opened', e);\n      });\n\n      socket.addEventListener(EVENT_DISCONNECTED, (e) => {\n        dispatch('closed', e);\n      });\n\n      socket.addEventListener(EVENT_CONNECT_ERROR, (e) => {\n        dispatch('error', e );\n      });\n\n      socket.addEventListener(EVENT_DISCONNECT_ERROR, (e) => {\n        dispatch('error', e );\n      });\n\n      socket.addEventListener(EVENT_MESSAGE, (e) => {\n        const event = e.detail;\n\n        if ( event.data) {\n          const msg = JSON.parse(event.data);\n\n          if (msg.name) {\n            dispatch(`ws.${ msg.name }`, msg);\n          }\n        }\n      });\n      socket.connect(metadata);\n    }\n  },\n\n  unsubscribe({ commit, getters, state }) {\n    const socket = state.socket;\n\n    commit('setWantSocket', false);\n    const cleanupTasks = [];\n\n    const worker = (this.$workers || {})[getters.storeName];\n\n    if (worker) {\n      worker.postMessage({ destroyWorker: true }); // we're only passing the boolean here because the key needs to be something truthy to ensure it's passed on the object.\n      cleanupTasks.push(waitFor(() => !this.$workers[getters.storeName], 'Worker is destroyed'));\n    }\n\n    if ( socket ) {\n      cleanupTasks.push(socket.disconnect());\n    }\n\n    return Promise.all(cleanupTasks);\n  },\n\n  watch({\n    state, dispatch, getters, rootGetters\n  }, params) {\n    state.debugSocket && console.info(`Watch Request [${ getters.storeName }]`, JSON.stringify(params)); // eslint-disable-line no-console\n\n    let {\n      // eslint-disable-next-line prefer-const\n      type, selector, id, revision, namespace, stop, force\n    } = params;\n\n    namespace = acceptOrRejectSocketMessage.subscribeNamespace(namespace);\n    type = getters.normalizeType(type);\n\n    if (rootGetters['type-map/isSpoofed'](type)) {\n      state.debugSocket && console.info('Will not Watch (type is spoofed)', JSON.stringify(params)); // eslint-disable-line no-console\n\n      return;\n    }\n\n    const schema = getters.schemaFor(type, false, false);\n\n    if (!!schema?.attributes?.verbs?.includes && !schema.attributes.verbs.includes('watch')) {\n      state.debugSocket && console.info('Will not Watch (type does not have watch verb)', JSON.stringify(params)); // eslint-disable-line no-console\n\n      return;\n    }\n\n    // If socket is in error don't try to watch.... unless we `force` it\n    const inError = getters.inError(params);\n\n    if ( !stop && !force && inError ) {\n      // REVISION_TOO_OLD is a temporary state and will be handled when `resyncWatch` completes\n      if (inError !== REVISION_TOO_OLD) {\n        console.error(`Aborting Watch Request [${ getters.storeName }]. Watcher in error (${ inError })`, JSON.stringify(params)); // eslint-disable-line no-console\n      }\n\n      return;\n    }\n\n    if ( !stop && getters.watchStarted({\n      type, id, selector, namespace\n    }) ) {\n      // eslint-disable-next-line no-console\n      state.debugSocket && console.debug(`Already Watching [${ getters.storeName }]`, {\n        type, id, selector, namespace\n      });\n\n      return;\n    }\n\n    // isSteveCacheEnabled check is temporary and will be removed once Part 3 of https://github.com/rancher/dashboard/pull/10349 is resolved by backend\n    // Steve cache backed api does not return a revision, so `revision` here is always undefined\n    // Which means we find a revision within a resource itself and use it in the watch\n    // That revision is probably too old and results in a watch error\n    // Watch errors mean we make a http request to get latest revision (which is still missing) and try to re-watch with it...\n    // etc\n    if (typeof revision === 'undefined' && !paginationUtils.isSteveCacheEnabled({ rootGetters })) {\n      revision = getters.nextResourceVersion(type, id);\n    }\n\n    const msg = { resourceType: type };\n\n    if ( revision ) {\n      msg.resourceVersion = `${ revision }`;\n    }\n\n    if ( namespace ) {\n      msg.namespace = namespace;\n    }\n\n    if ( stop ) {\n      msg.stop = true;\n    }\n\n    if ( id ) {\n      msg.id = id;\n    }\n\n    if ( selector ) {\n      msg.selector = selector;\n    }\n\n    const worker = this.$workers?.[getters.storeName] || {};\n\n    if (worker.mode === WORKER_MODES.ADVANCED || worker.mode === WORKER_MODES.WAITING) {\n      if ( force ) {\n        msg.force = true;\n      }\n\n      worker.postMessage({ watch: msg });\n\n      return;\n    }\n\n    return dispatch('send', msg);\n  },\n\n  unwatch(ctx, {\n    type, id, namespace, selector\n  }) {\n    const { commit, getters, dispatch } = ctx;\n\n    if (getters['schemaFor'](type)) {\n      namespace = acceptOrRejectSocketMessage.subscribeNamespace(namespace);\n\n      const obj = {\n        type,\n        id,\n        namespace,\n        selector,\n        stop: true, // Stops the watch on a type\n      };\n\n      if (isAdvancedWorker(ctx)) {\n        dispatch('watch', obj); // Ask the backend to stop watching the type\n      } else if (getters['watchStarted'](obj)) {\n        // Set that we don't want to watch this type\n        // Otherwise, the dispatch to unwatch below will just cause a re-watch when we\n        // detect the stop message from the backend over the web socket\n        commit('setWatchStopped', obj);\n        dispatch('watch', obj); // Ask the backend to stop watching the type\n        // Make sure anything in the pending queue for the type is removed, since we've now removed the type\n        commit('clearFromQueue', type);\n      }\n    }\n  },\n\n  'ws.ping'({ getters, dispatch }, msg) {\n    if ( getters.storeName === 'management' ) {\n      const version = msg?.data?.version || null;\n\n      dispatch('updateServerVersion', version, { root: true });\n      console.info(`Ping [${ getters.storeName }] from ${ version || 'unknown version' }`); // eslint-disable-line no-console\n    }\n  },\n};\n\n/**\n * Mutations that cover all cases (both subscriptions here and in advanced worker)\n */\nconst sharedMutations = {\n  debug(state, on, store) {\n    state.debugSocket = on !== false;\n    if (store && this.$workers[store]) {\n      this.$workers[store].postMessage({ toggleDebug: on !== false });\n    }\n  },\n};\n\n/**\n * Actions that cover cases 1 & 2 (see file description)\n */\nconst defaultActions = {\n\n  async flush({\n    state, commit, dispatch, getters\n  }) {\n    const queue = state.queue;\n    let toLoad = [];\n\n    if ( !queue.length ) {\n      return;\n    }\n\n    const started = new Date().getTime();\n\n    state.queue = [];\n\n    state.debugSocket && console.debug(`Subscribe Flush [${ getters.storeName }]`, queue.length, 'items'); // eslint-disable-line no-console\n\n    for ( const { action, event, body } of queue ) {\n      if ( action === 'dispatch' && event === 'load' ) {\n        // Group loads into one loadMulti when possible\n        toLoad.push(body);\n      } else {\n        // When we hit a different kind of event, process all the previous loads, then the other event.\n        if ( toLoad.length ) {\n          await dispatch('loadMulti', toLoad);\n          toLoad = [];\n        }\n\n        if ( action === 'dispatch' ) {\n          await dispatch(event, body);\n        } else if ( action === 'commit' ) {\n          commit(event, body);\n        } else {\n          throw new Error('Invalid queued action');\n        }\n      }\n    }\n\n    // Process any remaining loads\n    if ( toLoad.length ) {\n      await dispatch('loadMulti', toLoad);\n    }\n\n    state.debugSocket && console.debug(`Subscribe Flush [${ getters.storeName }] finished`, (new Date().getTime()) - started, 'ms'); // eslint-disable-line no-console\n  },\n\n  rehydrateSubscribe({ state, dispatch }) {\n    if ( state.wantSocket && !state.socket ) {\n      dispatch('subscribe');\n    }\n  },\n\n  reconnectWatches({\n    state, getters, commit, dispatch\n  }) {\n    const promises = [];\n\n    for ( const entry of state.started.slice() ) {\n      console.info(`Reconnect [${ getters.storeName }]`, JSON.stringify(entry)); // eslint-disable-line no-console\n\n      if ( getters.schemaFor(entry.type) ) {\n        commit('setWatchStopped', entry);\n        delete entry.revision;\n        promises.push(dispatch('watch', entry));\n      }\n    }\n\n    return Promise.all(promises);\n  },\n\n  async resyncWatch({\n    state, getters, dispatch, commit\n  }, params) {\n    const {\n      resourceType, namespace, id, selector\n    } = params;\n\n    console.info(`Resync [${ getters.storeName }]`, params); // eslint-disable-line no-console\n\n    const opt = { force: true, forceWatch: true };\n\n    if ( id ) {\n      await dispatch('find', {\n        type: resourceType,\n        id,\n        opt:  {\n          ...opt,\n          // Pass the namespace so `find` can construct the url correctly\n          namespaced: namespace,\n          // Ensure that find calls watch with no revision (otherwise it'll use the revision from the resource which is probably stale)\n          revision:   null\n        },\n      });\n\n      return;\n    }\n    let have, want;\n\n    if ( selector ) {\n      have = getters['matching'](resourceType, selector).slice();\n      want = await dispatch('findMatching', {\n        type: resourceType,\n        selector,\n        opt,\n      });\n    } else {\n      have = getters['all'](resourceType).slice();\n\n      if ( namespace ) {\n        have = have.filter((x) => x.metadata?.namespace === namespace);\n      }\n\n      want = await dispatch('findAll', {\n        type:           resourceType,\n        watchNamespace: namespace,\n        opt\n      });\n    }\n\n    const wantMap = {};\n\n    for ( const obj of want ) {\n      wantMap[obj.id] = true;\n    }\n\n    for ( const obj of have ) {\n      if ( !wantMap[obj.id] ) {\n        state.debugSocket && console.info(`Remove stale [${ getters.storeName }]`, resourceType, obj.id); // eslint-disable-line no-console\n\n        commit('remove', obj);\n      }\n    }\n  },\n\n  async opened({\n    commit, dispatch, state, getters, rootGetters\n  }, event) {\n    state.debugSocket && console.info(`WebSocket Opened [${ getters.storeName }]`); // eslint-disable-line no-console\n    const socket = event.currentTarget;\n    const tries = event?.detail?.tries; // have to pull it off of the event because the socket's tries is already reset to 0\n    const t = rootGetters['i18n/t'];\n    const disableGrowl = growlsDisabled(rootGetters);\n\n    this.$socket = socket;\n\n    if ( !state.queue ) {\n      state.queue = [];\n    }\n\n    if ( !state.queueTimer ) {\n      state.flushQueue = async() => {\n        if ( state.queue.length ) {\n          await dispatch('flush');\n        }\n\n        state.queueTimer = setTimeout(state.flushQueue, 1000);\n      };\n\n      state.flushQueue();\n    }\n\n    if ( socket.hasReconnected ) {\n      await dispatch('reconnectWatches');\n      // Check for disconnect notifications and clear them\n      const growlErr = rootGetters['growl/find']({ key: 'url', val: socket.url });\n\n      if (growlErr) {\n        dispatch('growl/remove', growlErr.id, { root: true });\n      }\n      if (tries > 1 && !disableGrowl) {\n        dispatch('growl/success', {\n          title:   t('growl.reconnected.title'),\n          message: t('growl.reconnected.message', { url: this.$socket.url, tries }),\n        }, { root: true });\n      }\n    }\n\n    // Try resending any frames that were attempted to be sent while the socket was down, once.\n    for ( const obj of state.pendingFrames.slice() ) {\n      commit('dequeuePendingFrame', obj);\n      dispatch('sendImmediate', obj);\n    }\n  },\n\n  closed({ state, getters }) {\n    state.debugSocket && console.info(`WebSocket Closed [${ getters.storeName }]`); // eslint-disable-line no-console\n    clearTimeout(state.queueTimer);\n    state.queueTimer = null;\n  },\n\n  error({\n    getters, state, dispatch, rootGetters\n  }, e) {\n    clearTimeout(state.queueTimer);\n    state.queueTimer = null;\n\n    // determine if websocket notifications are disabled\n    const disableGrowl = growlsDisabled(rootGetters);\n\n    if (!disableGrowl) {\n      const dateFormat = escapeHtml( rootGetters['prefs/get'](DATE_FORMAT));\n      const timeFormat = escapeHtml( rootGetters['prefs/get'](TIME_FORMAT));\n      const time = e?.srcElement?.disconnectedAt || Date.now();\n\n      const timeFormatted = `${ day(time).format(`${ dateFormat } ${ timeFormat }`) }`;\n      const url = e?.srcElement?.url;\n      const tries = state?.socket?.tries;\n\n      const t = rootGetters['i18n/t'];\n\n      const growlErr = rootGetters['growl/find']({ key: 'url', val: url });\n\n      if (e.type === EVENT_CONNECT_ERROR) { // if this occurs, then we're at least retrying to connect\n        if (growlErr) {\n          dispatch('growl/remove', growlErr.id, { root: true });\n        }\n        dispatch('growl/error', {\n          title:   t('growl.connectError.title'),\n          message: t('growl.connectError.message', {\n            url, time: timeFormatted, tries\n          }, { raw: true }),\n          icon:          'error',\n          earliestClose: time + MINIMUM_TIME_NOTIFIED,\n          url\n        }, { root: true });\n      } else if (e.type === EVENT_DISCONNECT_ERROR) { // if this occurs, we've given up on trying to reconnect\n        if (growlErr) {\n          dispatch('growl/remove', growlErr.id, { root: true });\n        }\n        dispatch('growl/error', {\n          title:   t('growl.disconnectError.title'),\n          message: t('growl.disconnectError.message', {\n            url, time: timeFormatted, tries\n          }, { raw: true }),\n          icon:          'error',\n          earliestClose: time + MINIMUM_TIME_NOTIFIED,\n          url\n        }, { root: true });\n      } else {\n        // if the error is not a connect error or disconnect error, the socket never worked: log whether the current browser is safari\n        console.error(`WebSocket Connection Error [${ getters.storeName }]`, e.detail); // eslint-disable-line no-console\n      }\n    }\n  },\n\n  send({ state, commit }, obj) {\n    if ( state.socket ) {\n      const ok = state.socket.send(JSON.stringify(obj));\n\n      if ( ok ) {\n        return;\n      }\n    }\n\n    commit('enqueuePendingFrame', obj);\n  },\n\n  sendImmediate({ state }, obj) {\n    if ( state.socket ) {\n      return state.socket.send(JSON.stringify(obj));\n    }\n  },\n\n  /**\n   * Steve only event\n   */\n  'ws.resource.start'({\n    state, getters, commit, dispatch\n  }, msg) {\n    state.debugSocket && console.info(`Resource start: [${ getters.storeName }]`, msg); // eslint-disable-line no-console\n\n    const newWatch = {\n      type:      msg.resourceType,\n      namespace: msg.namespace,\n      id:        msg.id,\n      selector:  msg.selector\n    };\n\n    state.started.filter((entry) => {\n      if (\n        entry.type === newWatch.type &&\n        entry.namespace !== newWatch.namespace\n      ) {\n        return true;\n      }\n    }).forEach((entry) => {\n      dispatch('unwatch', entry);\n    });\n\n    commit('setWatchStarted', newWatch);\n  },\n\n  'ws.resource.error'({ getters, commit, dispatch }, msg) {\n    console.warn(`Resource error [${ getters.storeName }]`, msg.resourceType, ':', msg.data.error); // eslint-disable-line no-console\n\n    const err = msg.data?.error?.toLowerCase();\n\n    if ( err.includes('watch not allowed') ) {\n      commit('setInError', { msg, reason: NO_WATCH });\n    } else if ( err.includes('failed to find schema') ) {\n      commit('setInError', { msg, reason: NO_SCHEMA });\n    } else if ( err.includes('too old') ) {\n      // Set an error for (all) subs of this type. This..\n      // 1) blocks attempts by resource.stop to resub (as type is in error)\n      // 2) will be cleared when resyncWatch --> watch (with force) --> resource.start completes\n      commit('setInError', { msg, reason: REVISION_TOO_OLD });\n      dispatch('resyncWatch', msg);\n    } else if ( err.includes('the server does not allow this method on the requested resource')) {\n      commit('setInError', { msg, reason: NO_PERMS });\n    }\n  },\n\n  /**\n   * Steve only event\n   *\n   * Steve has stopped watching this resource. This happens for a couple of reasons\n   * - We have requested that the resource watch should be stopped (and we receive this event as confirmation)\n   * - Steve tells us that the resource watch has been stopped. Possible reasons\n   *   - The rancher <--> k8s socket closed (happens every ~30 mins on mgmt socket)\n   *   - Permissions has changed for the subscribed resource, so rancher closes socket\n   */\n  'ws.resource.stop'({\n    state, getters, commit, dispatch\n  }, msg) {\n    const type = msg.resourceType;\n    const obj = {\n      type,\n      id:        msg.id,\n      namespace: msg.namespace,\n      selector:  msg.selector\n    };\n\n    state.debugSocket && console.info(`Resource Stop [${ getters.storeName }]`, type, msg); // eslint-disable-line no-console\n\n    if (!type) {\n      console.error(`Resource Stop [${ getters.storeName }]. Received resource.stop with an empty resourceType, aborting`, msg); // eslint-disable-line no-console\n\n      return;\n    }\n\n    // If we're trying to watch this event, attempt to re-watch\n    //\n    // To make life easier in the advanced worker `resource.stop` --> `watch` is handled here (basically for access to getters.nextResourceVersion)\n    // This means the concept of resource sub watch state needs massaging\n    const advancedWorker = msg.advancedWorker;\n    const localState = !advancedWorker;\n    const watchStarted = localState ? getters['watchStarted'](obj) : advancedWorker;\n\n    if ( getters['schemaFor'](type) && watchStarted) {\n      if (localState) {\n        commit('setWatchStopped', obj);\n      }\n\n      dispatch('watch', obj);\n    }\n  },\n\n  'ws.resource.create'(ctx, msg) {\n    ctx.state.debugSocket && console.info(`Resource Create [${ ctx.getters.storeName }]`, msg.resourceType, msg); // eslint-disable-line no-console\n    queueChange(ctx, msg, true, 'Create');\n  },\n\n  'ws.resource.change'(ctx, msg) {\n    const data = msg.data;\n    const type = data.type;\n\n    // Work-around for ws.error messages being sent as change events\n    // These have no id (or other metadata) which breaks lots if they are processed as change events\n    if (data.message && !data.id) {\n      return;\n    }\n\n    // Web worker can process schemas to check that they are actually changing and\n    // only load updates if the schema did actually change\n    if (type === SCHEMA) {\n      const worker = (this.$workers || {})[ctx.getters.storeName];\n\n      if (worker) {\n        worker.postMessage({ updateSchema: data });\n\n        // No further processing - let the web worker check the schema updates\n        return;\n      }\n    }\n\n    queueChange(ctx, msg, true, 'Change');\n\n    const typeOption = ctx.rootGetters['type-map/optionsFor'](type);\n\n    if (typeOption?.alias?.length > 0) {\n      const alias = typeOption?.alias || [];\n\n      alias.map((type) => {\n        ctx.state.queue.push({\n          action: 'dispatch',\n          event:  'load',\n          body:   {\n            ...data,\n            type,\n          },\n        });\n      });\n    }\n  },\n\n  'ws.resource.remove'(ctx, msg) {\n    const data = msg.data;\n    const type = data.type;\n\n    ctx.state.debugSocket && console.info(`Resource Remove [${ ctx.getters.storeName }]`, type, msg); // eslint-disable-line no-console\n\n    if (type === SCHEMA) {\n      const worker = (this.$workers || {})[ctx.getters.storeName];\n\n      if (worker) {\n        worker.postMessage({ removeSchema: data.id });\n      }\n    }\n\n    queueChange(ctx, msg, false, 'Remove');\n\n    const typeOption = ctx.rootGetters['type-map/optionsFor'](type);\n\n    if (typeOption?.alias?.length > 0) {\n      const alias = typeOption?.alias || [];\n\n      alias.map((type) => {\n        const obj = ctx.getters.byId(type, data.id);\n\n        ctx.state.queue.push({\n          action: 'commit',\n          event:  'remove',\n          body:   obj,\n        });\n      });\n    }\n  },\n};\n\n/**\n * Mutations that cover cases 1 & 2 (see file description)\n */\nconst defaultMutations = {\n  setSocket(state, socket) {\n    state.socket = socket;\n  },\n\n  setWantSocket(state, want) {\n    state.wantSocket = want;\n  },\n\n  enqueuePendingFrame(state, obj) {\n    state.pendingFrames.push(obj);\n  },\n\n  dequeuePendingFrame(state, obj) {\n    removeObject(state.pendingFrames, obj);\n  },\n\n  setWatchStarted(state, obj) {\n    const existing = state.started.find((entry) => equivalentWatch(obj, entry));\n\n    if ( !existing ) {\n      addObject(state.started, obj);\n    }\n\n    delete state.inError[keyForSubscribe(obj)];\n  },\n\n  setWatchStopped(state, obj) {\n    const existing = state.started.find((entry) => equivalentWatch(obj, entry));\n\n    if ( existing ) {\n      removeObject(state.started, existing);\n    } else {\n      console.warn(\"Tried to remove a watch that doesn't exist\", obj); // eslint-disable-line no-console\n    }\n  },\n\n  setInError(state, { msg, reason }) {\n    const key = keyForSubscribe(msg);\n\n    state.inError[key] = reason;\n  },\n\n  clearInError(state, msg) {\n    const key = keyForSubscribe(msg);\n\n    delete state.inError[key];\n  },\n\n  resetSubscriptions(state) {\n    // Clear out socket state. This is only ever called from reset... which is always called after we `disconnect` above.\n    // This could probably be folded in to there\n    clear(state.started);\n    clear(state.pendingFrames);\n    clear(state.queue);\n    clearTimeout(state.queueTimer);\n    state.deferredRequests = {};\n    state.queueTimer = null;\n  },\n\n  clearFromQueue(state, type) {\n    // Remove anything in the queue that is a resource update for the given type\n    state.queue = state.queue.filter((item) => {\n      return item.body?.type !== type;\n    });\n  },\n};\n\n/**\n * Getters that cover cases 1 & 2 (see file description)\n */\nconst defaultGetters = {\n  inError: (state) => (obj) => {\n    return state.inError[keyForSubscribe(obj)];\n  },\n\n  watchStarted: (state) => (obj) => {\n    return !!state.started.find((entry) => equivalentWatch(obj, entry));\n  },\n\n  nextResourceVersion: (state, getters) => (type, id) => {\n    type = normalizeType(type);\n    let revision = 0;\n\n    if ( id ) {\n      const existing = getters['byId'](type, id);\n\n      revision = parseInt(existing?.metadata?.resourceVersion, 10);\n    }\n\n    if ( !revision ) {\n      const cache = state.types[type];\n\n      if ( !cache ) {\n        return null;\n      }\n\n      revision = cache.revision; // This is always zero.....\n\n      for ( const obj of cache.list ) {\n        if ( obj && obj.metadata ) {\n          const neu = parseInt(obj.metadata.resourceVersion, 10);\n\n          revision = Math.max(revision, neu);\n        }\n      }\n    }\n\n    if ( revision ) {\n      return revision;\n    }\n\n    return null;\n  },\n};\n\nexport const actions = {\n  ...sharedActions,\n  ...defaultActions,\n};\n\nexport const mutations = {\n  ...sharedMutations,\n  ...defaultMutations,\n};\n\nexport const getters = { ...defaultGetters };\n"],"mappings":"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","ignoreList":[]}]}