{"remainingRequest":"/home/ubuntu/susecon-2024-ext-demo/node_modules/babel-loader/lib/index.js??ref--16-1!/home/ubuntu/susecon-2024-ext-demo/node_modules/@rancher/shell/models/apps.deployment.js","dependencies":[{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/@rancher/shell/models/apps.deployment.js","mtime":1725271280091},{"path":"/home/ubuntu/susecon-2024-ext-demo/babel.config.js","mtime":1725268750245},{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/babel-loader/lib/index.js","mtime":1725271298942}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVmbGVjdC5jb25zdHJ1Y3QuanMiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2dldFByb3RvdHlwZU9mIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9pbmhlcml0cyI7CmltcG9ydCBfcmVnZW5lcmF0b3JSdW50aW1lIGZyb20gIi9ob21lL3VidW50dS9zdXNlY29uLTIwMjQtZXh0LWRlbW8vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL3JlZ2VuZXJhdG9yL2luZGV4LmpzIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlLmpzIjsKZnVuY3Rpb24gX2NhbGxTdXBlcih0LCBvLCBlKSB7IHJldHVybiBvID0gX2dldFByb3RvdHlwZU9mKG8pLCBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0LCBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkgPyBSZWZsZWN0LmNvbnN0cnVjdChvLCBlIHx8IFtdLCBfZ2V0UHJvdG90eXBlT2YodCkuY29uc3RydWN0b3IpIDogby5hcHBseSh0LCBlKSk7IH0KZnVuY3Rpb24gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpIHsgdHJ5IHsgdmFyIHQgPSAhQm9vbGVhbi5wcm90b3R5cGUudmFsdWVPZi5jYWxsKFJlZmxlY3QuY29uc3RydWN0KEJvb2xlYW4sIFtdLCBmdW5jdGlvbiAoKSB7fSkpOyB9IGNhdGNoICh0KSB7fSByZXR1cm4gKF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QgPSBmdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkgeyByZXR1cm4gISF0OyB9KSgpOyB9CmltcG9ydCB7IFdPUktMT0FEX1RZUEVTIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy90eXBlcyc7CmltcG9ydCBXb3JrbG9hZCBmcm9tICcuL3dvcmtsb2FkJzsKdmFyIElHTk9SRURfQU5OT1RBVElPTlMgPSBbJ2t1YmVjdGwua3ViZXJuZXRlcy5pby9sYXN0LWFwcGxpZWQtY29uZmlndXJhdGlvbicsICdkZXBsb3ltZW50Lmt1YmVybmV0ZXMuaW8vcmV2aXNpb24nLCAnZGVwbG95bWVudC5rdWJlcm5ldGVzLmlvL3JldmlzaW9uLWhpc3RvcnknLCAnZGVwbG95bWVudC5rdWJlcm5ldGVzLmlvL2Rlc2lyZWQtcmVwbGljYXMnLCAnZGVwbG95bWVudC5rdWJlcm5ldGVzLmlvL21heC1yZXBsaWNhcycsICdkZXByZWNhdGVkLmRlcGxveW1lbnQucm9sbGJhY2sudG8nXTsKdmFyIERlcGxveW1lbnQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Xb3JrbG9hZCkgewogIGZ1bmN0aW9uIERlcGxveW1lbnQoKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRGVwbG95bWVudCk7CiAgICByZXR1cm4gX2NhbGxTdXBlcih0aGlzLCBEZXBsb3ltZW50LCBhcmd1bWVudHMpOwogIH0KICBfaW5oZXJpdHMoRGVwbG95bWVudCwgX1dvcmtsb2FkKTsKICByZXR1cm4gX2NyZWF0ZUNsYXNzKERlcGxveW1lbnQsIFt7CiAgICBrZXk6ICJyZXBsaWNhU2V0SWQiLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHZhciBfdGhpcyRtZXRhZGF0YSwgX3NldCR0b0lkOwogICAgICB2YXIgc2V0ID0gKF90aGlzJG1ldGFkYXRhID0gdGhpcy5tZXRhZGF0YSkgPT09IG51bGwgfHwgX3RoaXMkbWV0YWRhdGEgPT09IHZvaWQgMCB8fCAoX3RoaXMkbWV0YWRhdGEgPSBfdGhpcyRtZXRhZGF0YS5yZWxhdGlvbnNoaXBzKSA9PT0gbnVsbCB8fCBfdGhpcyRtZXRhZGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkbWV0YWRhdGEuZmluZChmdW5jdGlvbiAocmVsYXRpb25zaGlwKSB7CiAgICAgICAgcmV0dXJuIHJlbGF0aW9uc2hpcC5yZWwgPT09ICdvd25lcicgJiYgcmVsYXRpb25zaGlwLnRvVHlwZSA9PT0gV09SS0xPQURfVFlQRVMuUkVQTElDQV9TRVQ7CiAgICAgIH0pOwogICAgICByZXR1cm4gc2V0ID09PSBudWxsIHx8IHNldCA9PT0gdm9pZCAwIHx8IChfc2V0JHRvSWQgPSBzZXQudG9JZCkgPT09IG51bGwgfHwgX3NldCR0b0lkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfc2V0JHRvSWQucmVwbGFjZSgiIi5jb25jYXQodGhpcy5uYW1lc3BhY2UsICIvIiksICcnKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyb2xsQmFjayIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3JvbGxCYWNrID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShjbHVzdGVyLCBkZXBsb3ltZW50LCByZXZpc2lvbikgewogICAgICAgIHZhciBfcmV2aXNpb24kc3BlYyR0ZW1wbGEsIF9yZXZpc2lvbiRzcGVjJHRlbXBsYTI7CiAgICAgICAgdmFyIGJvZHk7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGJvZHkgPSBbewogICAgICAgICAgICAgICAgb3A6ICdyZXBsYWNlJywKICAgICAgICAgICAgICAgIHBhdGg6ICcvc3BlYy90ZW1wbGF0ZScsCiAgICAgICAgICAgICAgICB2YWx1ZTogewogICAgICAgICAgICAgICAgICBtZXRhZGF0YTogewogICAgICAgICAgICAgICAgICAgIGNyZWF0aW9uVGltZXN0YW1wOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGxhYmVsczogT2JqZWN0LmtleXMoKChfcmV2aXNpb24kc3BlYyR0ZW1wbGEgPSByZXZpc2lvbi5zcGVjLnRlbXBsYXRlLm1ldGFkYXRhKSA9PT0gbnVsbCB8fCBfcmV2aXNpb24kc3BlYyR0ZW1wbGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9yZXZpc2lvbiRzcGVjJHRlbXBsYS5sYWJlbHMpIHx8IHt9KS5yZWR1Y2UoZnVuY3Rpb24gKHByZXYsIGtleSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSAhPT0gJ3BvZC10ZW1wbGF0ZS1oYXNoJykgewogICAgICAgICAgICAgICAgICAgICAgICBwcmV2W2tleV0gPSByZXZpc2lvbi5zcGVjLnRlbXBsYXRlLm1ldGFkYXRhLmxhYmVsc1trZXldOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByZXY7CiAgICAgICAgICAgICAgICAgICAgfSwge30pLAogICAgICAgICAgICAgICAgICAgIGFubm90YXRpb25zOiBPYmplY3Qua2V5cygoKF9yZXZpc2lvbiRzcGVjJHRlbXBsYTIgPSByZXZpc2lvbi5zcGVjLnRlbXBsYXRlLm1ldGFkYXRhKSA9PT0gbnVsbCB8fCBfcmV2aXNpb24kc3BlYyR0ZW1wbGEyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfcmV2aXNpb24kc3BlYyR0ZW1wbGEyLmFubm90YXRpb25zKSB8fCB7fSkucmVkdWNlKGZ1bmN0aW9uIChwcmV2LCBrZXkpIHsKICAgICAgICAgICAgICAgICAgICAgIGlmICghSUdOT1JFRF9BTk5PVEFUSU9OUy5pbmNsdWRlcyhrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZba2V5XSA9IHJldmlzaW9uLnNwZWMudGVtcGxhdGUubWV0YWRhdGEuYW5ub3RhdGlvbnNba2V5XTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwcmV2OwogICAgICAgICAgICAgICAgICAgIH0sIHt9KQogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBzcGVjOiByZXZpc2lvbi5zcGVjLnRlbXBsYXRlLnNwZWMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBvcDogJ3JlcGxhY2UnLAogICAgICAgICAgICAgICAgcGF0aDogJy9tZXRhZGF0YS9hbm5vdGF0aW9ucycsCiAgICAgICAgICAgICAgICB2YWx1ZTogewogICAgICAgICAgICAgICAgICAnZGVwbG95bWVudC5rdWJlcm5ldGVzLmlvL3JldmlzaW9uJzogcmV2aXNpb24ubWV0YWRhdGEuYW5ub3RhdGlvbnNbJ2RlcGxveW1lbnQua3ViZXJuZXRlcy5pby9yZXZpc2lvbiddCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfV07CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucm9sbEJhY2tXb3JrbG9hZChjbHVzdGVyLCBkZXBsb3ltZW50LCAnZGVwbG95bWVudHMnLCBib2R5KTsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgIH0pKTsKICAgICAgZnVuY3Rpb24gcm9sbEJhY2soX3gsIF94MiwgX3gzKSB7CiAgICAgICAgcmV0dXJuIF9yb2xsQmFjay5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CiAgICAgIHJldHVybiByb2xsQmFjazsKICAgIH0oKQogIH1dKTsKfShXb3JrbG9hZCk7CmV4cG9ydCB7IERlcGxveW1lbnQgYXMgZGVmYXVsdCB9Ow=="},{"version":3,"names":["WORKLOAD_TYPES","Workload","IGNORED_ANNOTATIONS","Deployment","_Workload","_classCallCheck","_callSuper","arguments","_inherits","_createClass","key","get","_this$metadata","_set$toId","set","metadata","relationships","find","relationship","rel","toType","REPLICA_SET","toId","replace","concat","namespace","value","_rollBack","_asyncToGenerator","_regeneratorRuntime","mark","_callee","cluster","deployment","revision","_revision$spec$templa","_revision$spec$templa2","body","wrap","_callee$","_context","prev","next","op","path","creationTimestamp","labels","Object","keys","spec","template","reduce","annotations","includes","rollBackWorkload","stop","rollBack","_x","_x2","_x3","apply","default"],"sources":["/home/ubuntu/susecon-2024-ext-demo/node_modules/@rancher/shell/models/apps.deployment.js"],"sourcesContent":["import { WORKLOAD_TYPES } from '@shell/config/types';\nimport Workload from './workload';\n\nconst IGNORED_ANNOTATIONS = [\n  'kubectl.kubernetes.io/last-applied-configuration',\n  'deployment.kubernetes.io/revision',\n  'deployment.kubernetes.io/revision-history',\n  'deployment.kubernetes.io/desired-replicas',\n  'deployment.kubernetes.io/max-replicas',\n  'deprecated.deployment.rollback.to',\n];\n\nexport default class Deployment extends Workload {\n  get replicaSetId() {\n    const set = this.metadata?.relationships?.find((relationship) => {\n      return relationship.rel === 'owner' &&\n            relationship.toType === WORKLOAD_TYPES.REPLICA_SET;\n    });\n\n    return set?.toId?.replace(`${ this.namespace }/`, '');\n  }\n\n  async rollBack(cluster, deployment, revision) {\n    const body = [\n      {\n        op:    'replace',\n        path:  '/spec/template',\n        value: {\n          metadata: {\n            creationTimestamp: null,\n            labels:            Object.keys(revision.spec.template.metadata?.labels || {}).reduce((prev, key) => {\n              if (key !== 'pod-template-hash') {\n                prev[key] = revision.spec.template.metadata.labels[key];\n              }\n\n              return prev;\n            }, {}),\n            annotations: Object.keys(revision.spec.template.metadata?.annotations || {}).reduce((prev, key) => {\n              if (!IGNORED_ANNOTATIONS.includes(key)) {\n                prev[key] = revision.spec.template.metadata.annotations[key];\n              }\n\n              return prev;\n            }, {}),\n          },\n          spec: revision.spec.template.spec\n        }\n      }, {\n        op:    'replace',\n        path:  '/metadata/annotations',\n        value: { 'deployment.kubernetes.io/revision': revision.metadata.annotations['deployment.kubernetes.io/revision'] }\n      }\n    ];\n\n    await this.rollBackWorkload(cluster, deployment, 'deployments', body);\n  }\n}\n"],"mappings":"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","ignoreList":[]}]}