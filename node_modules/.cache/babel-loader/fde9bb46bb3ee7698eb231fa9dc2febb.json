{"remainingRequest":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js??ref--16-1!/home/ubuntu/suseconf/node_modules/@rancher/shell/config/router/navigation-guards/attempt-first-login.js","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/config/router/navigation-guards/attempt-first-login.js","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/babel.config.js","mtime":1725343995893},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX3JlZ2VuZXJhdG9yUnVudGltZSBmcm9tICIvaG9tZS91YnVudHUvc3VzZWNvbmYvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL3JlZ2VuZXJhdG9yL2luZGV4LmpzIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgeyBTRVRVUCB9IGZyb20gJ0BzaGVsbC9jb25maWcvcXVlcnktcGFyYW1zJzsKaW1wb3J0IHsgU0VUVElORyB9IGZyb20gJ0BzaGVsbC9jb25maWcvc2V0dGluZ3MnOwppbXBvcnQgeyBNQU5BR0VNRU5ULCBOT1JNQU4gfSBmcm9tICdAc2hlbGwvY29uZmlnL3R5cGVzJzsKaW1wb3J0IHsgdHJ5SW5pdGlhbFNldHVwIH0gZnJvbSAnQHNoZWxsL3V0aWxzL2F1dGgnOwppbXBvcnQgeyByb3V0ZVJlcXVpcmVzQXV0aGVudGljYXRpb24gfSBmcm9tICdAc2hlbGwvdXRpbHMvcm91dGVyJzsKZXhwb3J0IGZ1bmN0aW9uIGluc3RhbGwocm91dGVyLCBjb250ZXh0KSB7CiAgcm91dGVyLmJlZm9yZUVhY2goZnVuY3Rpb24gKHRvLCBmcm9tLCBuZXh0KSB7CiAgICByZXR1cm4gYXR0ZW1wdEZpcnN0TG9naW4odG8sIGZyb20sIG5leHQsIGNvbnRleHQpOwogIH0pOwp9CmV4cG9ydCBmdW5jdGlvbiBhdHRlbXB0Rmlyc3RMb2dpbihfeCwgX3gyLCBfeDMsIF94NCkgewogIHJldHVybiBfYXR0ZW1wdEZpcnN0TG9naW4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQpmdW5jdGlvbiBfYXR0ZW1wdEZpcnN0TG9naW4oKSB7CiAgX2F0dGVtcHRGaXJzdExvZ2luID0gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKHRvLCBmcm9tLCBuZXh0LCBfcmVmKSB7CiAgICB2YXIgc3RvcmUsIGluaXRpYWxQYXNzLCBmaXJzdExvZ2luLCByZXMsIHBsU2V0dGluZywgX3JlcywgX3BsU2V0dGluZywgb2s7CiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgc3RvcmUgPSBfcmVmLnN0b3JlOwogICAgICAgICAgaWYgKHJvdXRlUmVxdWlyZXNBdXRoZW50aWNhdGlvbih0bykpIHsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgbmV4dCgpKTsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICAvLyBJbml0aWFsID9zZXR1cD1hZG1pbi1wYXNzd29yZCBjYW4gdGVjaG5pY2FsbHkgYmUgb24gYW55IHJvdXRlCiAgICAgICAgICBpbml0aWFsUGFzcyA9IHRvLnF1ZXJ5W1NFVFVQXTsKICAgICAgICAgIGZpcnN0TG9naW4gPSBudWxsOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmVzID0gc3RvcmUuZ2V0dGVyc1snbWFuYWdlbWVudC9ieUlkJ10oTUFOQUdFTUVOVC5TRVRUSU5HLCBTRVRUSU5HLkZJUlNUX0xPR0lOKTsKICAgICAgICAgICAgcGxTZXR0aW5nID0gc3RvcmUuZ2V0dGVyc1snbWFuYWdlbWVudC9ieUlkJ10oTUFOQUdFTUVOVC5TRVRUSU5HLCBTRVRUSU5HLlBMKTsKICAgICAgICAgICAgZmlyc3RMb2dpbiA9IChyZXMgPT09IG51bGwgfHwgcmVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXMudmFsdWUpID09PSAndHJ1ZSc7CiAgICAgICAgICAgIGlmICghaW5pdGlhbFBhc3MgJiYgKHBsU2V0dGluZyA9PT0gbnVsbCB8fCBwbFNldHRpbmcgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBsU2V0dGluZy52YWx1ZSkgPT09ICdIYXJ2ZXN0ZXInKSB7CiAgICAgICAgICAgICAgaW5pdGlhbFBhc3MgPSAnYWRtaW4nOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCBsb29raW5nIHVwIGZpcnN0IGxvZ2luIHNldHRpbmcnLCBlKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIShmaXJzdExvZ2luID09PSBudWxsKSkgewogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgX2NvbnRleHQucHJldiA9IDc7CiAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTA7CiAgICAgICAgICByZXR1cm4gc3RvcmUuZGlzcGF0Y2goJ3JhbmNoZXIvZmluZCcsIHsKICAgICAgICAgICAgdHlwZTogTk9STUFOLlNFVFRJTkcsCiAgICAgICAgICAgIGlkOiBTRVRUSU5HLkZJUlNUX0xPR0lOLAogICAgICAgICAgICBvcHQ6IHsKICAgICAgICAgICAgICB1cmw6ICIvdjMvc2V0dGluZ3MvIi5jb25jYXQoU0VUVElORy5GSVJTVF9MT0dJTikKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgY2FzZSAxMDoKICAgICAgICAgIF9yZXMgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgZmlyc3RMb2dpbiA9IChfcmVzID09PSBudWxsIHx8IF9yZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9yZXMudmFsdWUpID09PSAndHJ1ZSc7CiAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTQ7CiAgICAgICAgICByZXR1cm4gc3RvcmUuZGlzcGF0Y2goJ3JhbmNoZXIvZmluZCcsIHsKICAgICAgICAgICAgdHlwZTogTk9STUFOLlNFVFRJTkcsCiAgICAgICAgICAgIGlkOiBTRVRUSU5HLlBMLAogICAgICAgICAgICBvcHQ6IHsKICAgICAgICAgICAgICB1cmw6ICIvdjMvc2V0dGluZ3MvIi5jb25jYXQoU0VUVElORy5QTCkKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgY2FzZSAxNDoKICAgICAgICAgIF9wbFNldHRpbmcgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgaWYgKCFpbml0aWFsUGFzcyAmJiAoX3BsU2V0dGluZyA9PT0gbnVsbCB8fCBfcGxTZXR0aW5nID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfcGxTZXR0aW5nLnZhbHVlKSA9PT0gJ0hhcnZlc3RlcicpIHsKICAgICAgICAgICAgaW5pdGlhbFBhc3MgPSAnYWRtaW4nOwogICAgICAgICAgfQogICAgICAgICAgX2NvbnRleHQubmV4dCA9IDIxOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxODoKICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxODsKICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oNyk7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgbG9va2luZyB1cCBmaXJzdCBsb2dpbiBzZXR0aW5nJywgX2NvbnRleHQudDApOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKICAgICAgICBjYXNlIDIxOgogICAgICAgICAgaWYgKCFmaXJzdExvZ2luKSB7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjQ7CiAgICAgICAgICByZXR1cm4gdHJ5SW5pdGlhbFNldHVwKHN0b3JlLCBpbml0aWFsUGFzcyk7CiAgICAgICAgY2FzZSAyNDoKICAgICAgICAgIG9rID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgIGlmICghb2spIHsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMwOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpbml0aWFsUGFzcykgewogICAgICAgICAgICBzdG9yZS5kaXNwYXRjaCgnYXV0aC9zZXRJbml0aWFsUGFzcycsIGluaXRpYWxQYXNzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIG5leHQoewogICAgICAgICAgICBuYW1lOiAnYXV0aC1zZXR1cCcKICAgICAgICAgIH0pKTsKICAgICAgICBjYXNlIDMwOgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgbmV4dCh7CiAgICAgICAgICAgIG5hbWU6ICdhdXRoLWxvZ2luJwogICAgICAgICAgfSkpOwogICAgICAgIGNhc2UgMzE6CiAgICAgICAgICBuZXh0KCk7CiAgICAgICAgY2FzZSAzMjoKICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgfQogICAgfSwgX2NhbGxlZSwgbnVsbCwgW1s3LCAxOF1dKTsKICB9KSk7CiAgcmV0dXJuIF9hdHRlbXB0Rmlyc3RMb2dpbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9"},{"version":3,"names":["SETUP","SETTING","MANAGEMENT","NORMAN","tryInitialSetup","routeRequiresAuthentication","install","router","context","beforeEach","to","from","next","attemptFirstLogin","_x","_x2","_x3","_x4","_attemptFirstLogin","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_ref","store","initialPass","firstLogin","res","plSetting","_res","_plSetting","ok","wrap","_callee$","_context","prev","abrupt","query","getters","FIRST_LOGIN","PL","value","e","console","error","dispatch","type","id","opt","url","concat","sent","t0","name","stop"],"sources":["/home/ubuntu/suseconf/node_modules/@rancher/shell/config/router/navigation-guards/attempt-first-login.js"],"sourcesContent":["import { SETUP } from '@shell/config/query-params';\nimport { SETTING } from '@shell/config/settings';\nimport { MANAGEMENT, NORMAN } from '@shell/config/types';\nimport { tryInitialSetup } from '@shell/utils/auth';\nimport { routeRequiresAuthentication } from '@shell/utils/router';\n\nexport function install(router, context) {\n  router.beforeEach((to, from, next) => attemptFirstLogin(to, from, next, context));\n}\n\nexport async function attemptFirstLogin(to, from, next, { store }) {\n  if (!routeRequiresAuthentication(to)) {\n    return next();\n  }\n\n  // Initial ?setup=admin-password can technically be on any route\n  let initialPass = to.query[SETUP];\n  let firstLogin = null;\n\n  try {\n    const res = store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.FIRST_LOGIN);\n    const plSetting = store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.PL);\n\n    firstLogin = res?.value === 'true';\n\n    if (!initialPass && plSetting?.value === 'Harvester') {\n      initialPass = 'admin';\n    }\n  } catch (e) {\n    console.error('Failed looking up first login setting', e); // eslint-disable-line no-console\n  }\n\n  if ( firstLogin === null ) {\n    try {\n      const res = await store.dispatch('rancher/find', {\n        type: NORMAN.SETTING,\n        id:   SETTING.FIRST_LOGIN,\n        opt:  { url: `/v3/settings/${ SETTING.FIRST_LOGIN }` }\n      });\n\n      firstLogin = res?.value === 'true';\n\n      const plSetting = await store.dispatch('rancher/find', {\n        type: NORMAN.SETTING,\n        id:   SETTING.PL,\n        opt:  { url: `/v3/settings/${ SETTING.PL }` }\n      });\n\n      if (!initialPass && plSetting?.value === 'Harvester') {\n        initialPass = 'admin';\n      }\n    } catch (e) {\n      console.error('Failed looking up first login setting', e); // eslint-disable-line no-console\n    }\n  }\n\n  // TODO show error if firstLogin and default pass doesn't work\n  if ( firstLogin ) {\n    const ok = await tryInitialSetup(store, initialPass);\n\n    if (ok) {\n      if (initialPass) {\n        store.dispatch('auth/setInitialPass', initialPass);\n      }\n\n      return next({ name: 'auth-setup' });\n    } else {\n      return next({ name: 'auth-login' });\n    }\n  }\n\n  next();\n}\n"],"mappings":"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","ignoreList":[]}]}