{"remainingRequest":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ubuntu/suseconf/node_modules/@rancher/shell/pages/auth/verify.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/pages/auth/verify.vue","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1725271300920}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IEdJVEhVQl9DT0RFLCBHSVRIVUJfTk9OQ0UsIEJBQ0tfVE8gfSBmcm9tICdAc2hlbGwvY29uZmlnL3F1ZXJ5LXBhcmFtcyc7CmltcG9ydCB7IGdldCB9IGZyb20gJ0BzaGVsbC91dGlscy9vYmplY3QnOwppbXBvcnQgeyBiYXNlNjREZWNvZGUgfSBmcm9tICdAc2hlbGwvdXRpbHMvY3J5cHRvJzsKaW1wb3J0IGxvYWRQbHVnaW5zIGZyb20gJ0BzaGVsbC9wbHVnaW5zL3BsdWdpbic7Cgpjb25zdCBzYW1sUHJvdmlkZXJzID0gWydwaW5nJywgJ2FkZnMnLCAna2V5Y2xvYWsnLCAnb2t0YScsICdzaGliYm9sZXRoJ107CgpmdW5jdGlvbiByZXBseShlcnIsIGNvZGUpIHsKICB0cnkgewogICAgd2luZG93Lm9wZW5lci53aW5kb3cub25BdXRoVGVzdChlcnIsIGNvZGUpOwogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgIHdpbmRvdy5jbG9zZSgpOwogICAgfSwgMjUwKTsKICB9IGNhdGNoIChlKSB7CiAgICB3aW5kb3cuY2xvc2UoKTsKICB9Cn0KCmZ1bmN0aW9uIGlzU2FtbCgkcm91dGUpIHsKICBjb25zdCB7IHF1ZXJ5IH0gPSAkcm91dGU7CiAgY29uc3QgY29uZmlnUXVlcnkgPSBnZXQocXVlcnksICdjb25maWcnKTsKCiAgcmV0dXJuIHNhbWxQcm92aWRlcnMuaW5jbHVkZXMoY29uZmlnUXVlcnkpOwp9CgpleHBvcnQgZGVmYXVsdCB7CiAgYXN5bmMgZmV0Y2goKSB7CiAgICBjb25zdCBjb2RlID0gdGhpcy4kcm91dGUucXVlcnlbR0lUSFVCX0NPREVdOwogICAgY29uc3Qgc3RhdGVTdHIgPSB0aGlzLiRyb3V0ZS5xdWVyeVtHSVRIVUJfTk9OQ0VdOwogICAgY29uc3QgewogICAgICBlcnJvciwgZXJyb3JfZGVzY3JpcHRpb246IGVycm9yRGVzY3JpcHRpb24sIGVycm9yQ29kZSwgZXJyb3JNc2cKICAgIH0gPSB0aGlzLiRyb3V0ZS5xdWVyeTsKCiAgICBpZiAoZXJyb3IgfHwgZXJyb3JEZXNjcmlwdGlvbiB8fCBlcnJvckNvZGUgfHwgZXJyb3JNc2cpIHsKICAgICAgbGV0IG91dCA9IGVycm9yRGVzY3JpcHRpb24gfHwgZXJyb3IgfHwgZXJyb3JDb2RlOwoKICAgICAgaWYgKGVycm9yTXNnKSB7CiAgICAgICAgb3V0ID0gdGhpcy4kc3RvcmUuZ2V0dGVyc1snaTE4bi93aXRoRmFsbGJhY2snXShgbG9naW4uc2VydmVyRXJyb3IuJHsgZXJyb3JNc2cgfWAsIG51bGwsIGVycm9yTXNnKTsKICAgICAgfQoKICAgICAgdGhpcy4kcm91dGVyLnJlcGxhY2UoYC9hdXRoL2xvZ2luP2Vycj0keyBlc2NhcGUob3V0KSB9YCk7CgogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgcGFyc2VkOwoKICAgIHRyeSB7CiAgICAgIHBhcnNlZCA9IEpTT04ucGFyc2UoYmFzZTY0RGVjb2RlKChzdGF0ZVN0cikpKTsKICAgIH0gY2F0Y2ggKGVycikgewogICAgICBpZiAoaXNTYW1sKHRoaXMuJHJvdXRlKSkgewogICAgICAgIC8vIFRoaXMgaXMgYW4gb2sgZmFpbHVyZS4gU0FNTCBoYXMgbm8gc3RhdGUgc3RyaW5nIHNvIGEgZmFpbHVyZSBpcyBmaW5lIChzZWUgc2ltaWxhciBjaGVjayBpbiBtb3VudGVkKS4KICAgICAgICAvLyBUaGlzIHdob2xlIGZpbGUgY291bGQgYmUgcmUtd3JpdHRlbiB3aXRoIHRoYXQgaW4gbWluZCwgYnV0IHRoaXMgY2hhbmdlIGtlZXBzIHRoaW5ncyBzaW1wbGUgYW5kIGZpeGVzIGEgYnJlYWtpbmcgYWRkaXRpb24KICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3Qgb3V0ID0gdGhpcy4kc3RvcmUuZ2V0dGVyc1snaTE4bi90J10oYGxvZ2luLmVycm9yYCk7CgogICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gcGFyc2Ugbm9uY2UnLCBzdGF0ZVN0ciwgZXJyKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCgogICAgICB0aGlzLiRyb3V0ZXIucmVwbGFjZShgL2F1dGgvbG9naW4/ZXJyPSR7IGVzY2FwZShvdXQpIH1gKTsKCiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCB7IHRlc3QsIHByb3ZpZGVyLCBub25jZSB9ID0gcGFyc2VkOwoKICAgIGlmICh0ZXN0KSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB0cnkgewogICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnYXV0aC92ZXJpZnlPQXV0aCcsIHsKICAgICAgICBjb2RlLAogICAgICAgIG5vbmNlLAogICAgICAgIHByb3ZpZGVyCiAgICAgIH0pOwoKICAgICAgaWYgKCByZXMuX3N0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgY29uc3QgYmFja1RvID0gdGhpcy4kcm91dGUucXVlcnlbQkFDS19UT10gfHwgJy8nOwoKICAgICAgICAvLyBMb2FkIHBsdWdpbnMKICAgICAgICBhd2FpdCBsb2FkUGx1Z2lucyh7CiAgICAgICAgICBhcHA6ICAgICB0aGlzLiRzdG9yZS5hcHAsCiAgICAgICAgICBzdG9yZTogICB0aGlzLiRzdG9yZSwKICAgICAgICAgICRwbHVnaW46IHRoaXMuJHN0b3JlLiRwbHVnaW4KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy4kcm91dGVyLnJlcGxhY2UoYmFja1RvKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRyb3V0ZXIucmVwbGFjZShgL2F1dGgvbG9naW4/ZXJyPSR7IGVzY2FwZShyZXMpIH1gKTsKICAgICAgfQogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIHRoaXMuJHJvdXRlci5yZXBsYWNlKGAvYXV0aC9sb2dpbj9lcnI9JHsgZXNjYXBlKGVycikgfWApOwogICAgfQogIH0sCgogIGRhdGEoKSB7CiAgICBjb25zdCBzdGF0ZUpTT04gPSB0aGlzLiRyb3V0ZS5xdWVyeVtHSVRIVUJfTk9OQ0VdIHx8ICcnOwoKICAgIGxldCBwYXJzZWQgPSB7fTsKCiAgICB0cnkgewogICAgICBwYXJzZWQgPSBKU09OLnBhcnNlKGJhc2U2NERlY29kZShzdGF0ZUpTT04pKTsKICAgIH0gY2F0Y2ggewogICAgfQoKICAgIGNvbnN0IHsgdGVzdCB9ID0gcGFyc2VkOwoKICAgIHJldHVybiB7IHRlc3Rpbmc6IHRlc3QgfTsKICB9LAoKICBtb3VudGVkKCkgewogICAgaWYgKCB0aGlzLnRlc3RpbmcgKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgZXJyb3I6IHJlc3BFcnJvciwgZXJyb3JfZGVzY3JpcHRpb246IHJlc3BFcnJvckRlc2NyaXB0aW9uLCBbR0lUSFVCX0NPREVdOiBjb2RlLCBlcnJvck1zZwogICAgICAgIH0gPSB0aGlzLiRyb3V0ZS5xdWVyeTsKCiAgICAgICAgbGV0IGVycm9yID0gcmVzcEVycm9yRGVzY3JpcHRpb24gfHwgcmVzcEVycm9yIHx8ICghY29kZSA/ICdObyBjb2RlIHN1cHBsaWVkIGJ5IGF1dGggcHJvdmlkZXInIDogbnVsbCk7CgogICAgICAgIGlmIChlcnJvck1zZykgewogICAgICAgICAgZXJyb3IgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzWydpMThuL3dpdGhGYWxsYmFjayddKGBsb2dpbi5zZXJ2ZXJFcnJvci4keyBlcnJvck1zZyB9YCwgbnVsbCwgZXJyb3JNc2cpOwogICAgICAgIH0KCiAgICAgICAgcmVwbHkoZXJyb3IsIGNvZGUgKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHdpbmRvdy5jbG9zZSgpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpZiAoIHdpbmRvdy5vcGVuZXIgKSB7CiAgICAgICAgaWYgKGlzU2FtbCh0aGlzLiRyb3V0ZSkpIHsKICAgICAgICAgIGlmICggd2luZG93Lm9wZW5lci53aW5kb3cub25BdXRoVGVzdCApIHsKICAgICAgICAgICAgcmVwbHkobnVsbCwgbnVsbCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXBseSh7IGVycjogJ2ZhaWx1cmUnIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfTsK"},{"version":3,"sources":["verify.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"verify.vue","sourceRoot":"node_modules/@rancher/shell/pages/auth","sourcesContent":["<script>\nimport { GITHUB_CODE, GITHUB_NONCE, BACK_TO } from '@shell/config/query-params';\nimport { get } from '@shell/utils/object';\nimport { base64Decode } from '@shell/utils/crypto';\nimport loadPlugins from '@shell/plugins/plugin';\n\nconst samlProviders = ['ping', 'adfs', 'keycloak', 'okta', 'shibboleth'];\n\nfunction reply(err, code) {\n  try {\n    window.opener.window.onAuthTest(err, code);\n    setTimeout(() => {\n      window.close();\n    }, 250);\n  } catch (e) {\n    window.close();\n  }\n}\n\nfunction isSaml($route) {\n  const { query } = $route;\n  const configQuery = get(query, 'config');\n\n  return samlProviders.includes(configQuery);\n}\n\nexport default {\n  async fetch() {\n    const code = this.$route.query[GITHUB_CODE];\n    const stateStr = this.$route.query[GITHUB_NONCE];\n    const {\n      error, error_description: errorDescription, errorCode, errorMsg\n    } = this.$route.query;\n\n    if (error || errorDescription || errorCode || errorMsg) {\n      let out = errorDescription || error || errorCode;\n\n      if (errorMsg) {\n        out = this.$store.getters['i18n/withFallback'](`login.serverError.${ errorMsg }`, null, errorMsg);\n      }\n\n      this.$router.replace(`/auth/login?err=${ escape(out) }`);\n\n      return;\n    }\n    let parsed;\n\n    try {\n      parsed = JSON.parse(base64Decode((stateStr)));\n    } catch (err) {\n      if (isSaml(this.$route)) {\n        // This is an ok failure. SAML has no state string so a failure is fine (see similar check in mounted).\n        // This whole file could be re-written with that in mind, but this change keeps things simple and fixes a breaking addition\n        return;\n      }\n      const out = this.$store.getters['i18n/t'](`login.error`);\n\n      console.error('Failed to parse nonce', stateStr, err); // eslint-disable-line no-console\n\n      this.$router.replace(`/auth/login?err=${ escape(out) }`);\n\n      return;\n    }\n\n    const { test, provider, nonce } = parsed;\n\n    if (test) {\n      return;\n    }\n\n    try {\n      const res = await this.$store.dispatch('auth/verifyOAuth', {\n        code,\n        nonce,\n        provider\n      });\n\n      if ( res._status === 200) {\n        const backTo = this.$route.query[BACK_TO] || '/';\n\n        // Load plugins\n        await loadPlugins({\n          app:     this.$store.app,\n          store:   this.$store,\n          $plugin: this.$store.$plugin\n        });\n\n        this.$router.replace(backTo);\n      } else {\n        this.$router.replace(`/auth/login?err=${ escape(res) }`);\n      }\n    } catch (err) {\n      this.$router.replace(`/auth/login?err=${ escape(err) }`);\n    }\n  },\n\n  data() {\n    const stateJSON = this.$route.query[GITHUB_NONCE] || '';\n\n    let parsed = {};\n\n    try {\n      parsed = JSON.parse(base64Decode(stateJSON));\n    } catch {\n    }\n\n    const { test } = parsed;\n\n    return { testing: test };\n  },\n\n  mounted() {\n    if ( this.testing ) {\n      try {\n        const {\n          error: respError, error_description: respErrorDescription, [GITHUB_CODE]: code, errorMsg\n        } = this.$route.query;\n\n        let error = respErrorDescription || respError || (!code ? 'No code supplied by auth provider' : null);\n\n        if (errorMsg) {\n          error = this.$store.getters['i18n/withFallback'](`login.serverError.${ errorMsg }`, null, errorMsg);\n        }\n\n        reply(error, code );\n      } catch (e) {\n        window.close();\n      }\n    } else {\n      if ( window.opener ) {\n        if (isSaml(this.$route)) {\n          if ( window.opener.window.onAuthTest ) {\n            reply(null, null);\n          } else {\n            reply({ err: 'failure' });\n          }\n        }\n      }\n    }\n  }\n};\n</script>\n\n<template>\n  <main class=\"main-layout\">\n    <h1 class=\"text-center mt-50\">\n      <span v-if=\"testing\">\n        Testing Configuration&hellip;\n      </span>\n      <span v-else>\n        Logging In&hellip;\n      </span>\n    </h1>\n  </main>\n</template>\n"]}]}