{"remainingRequest":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ubuntu/suseconf/node_modules/@rancher/shell/components/nav/WindowManager/ContainerLogs.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/components/nav/WindowManager/ContainerLogs.vue","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1725271300920}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IHNhdmVBcyB9IGZyb20gJ2ZpbGUtc2F2ZXInOwppbXBvcnQgQW5zaVVwIGZyb20gJ2Fuc2lfdXAnOwppbXBvcnQgeyBhZGRQYXJhbXMgfSBmcm9tICdAc2hlbGwvdXRpbHMvdXJsJzsKaW1wb3J0IHsgYmFzZTY0RGVjb2RlVG9CdWZmZXIgfSBmcm9tICdAc2hlbGwvdXRpbHMvY3J5cHRvJzsKaW1wb3J0IHsgTE9HU19SQU5HRSwgTE9HU19USU1FLCBMT0dTX1dSQVAgfSBmcm9tICdAc2hlbGwvc3RvcmUvcHJlZnMnOwppbXBvcnQgTGFiZWxlZFNlbGVjdCBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtL0xhYmVsZWRTZWxlY3QnOwppbXBvcnQgeyBDaGVja2JveCB9IGZyb20gJ0Bjb21wb25lbnRzL0Zvcm0vQ2hlY2tib3gnOwppbXBvcnQgQXN5bmNCdXR0b24gZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvQXN5bmNCdXR0b24nOwppbXBvcnQgU2VsZWN0IGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vU2VsZWN0JzsKaW1wb3J0IFZpcnR1YWxMaXN0IGZyb20gJ3Z1ZS12aXJ0dWFsLXNjcm9sbC1saXN0JzsKaW1wb3J0IExvZ0l0ZW0gZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvTG9nSXRlbSc7CgppbXBvcnQgeyBlc2NhcGVSZWdleCB9IGZyb20gJ0BzaGVsbC91dGlscy9zdHJpbmcnOwppbXBvcnQgeyBIQVJWRVNURVJfTkFNRSBhcyBWSVJUVUFMIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy9mZWF0dXJlcyc7CgppbXBvcnQgU29ja2V0LCB7CiAgRVZFTlRfQ09OTkVDVEVELAogIEVWRU5UX0RJU0NPTk5FQ1RFRCwKICBFVkVOVF9NRVNTQUdFLAogIC8vICBFVkVOVF9GUkFNRV9USU1FT1VULAogIEVWRU5UX0NPTk5FQ1RfRVJST1IKfSBmcm9tICdAc2hlbGwvdXRpbHMvc29ja2V0JzsKaW1wb3J0IFdpbmRvdyBmcm9tICcuL1dpbmRvdyc7CgpsZXQgbGFzdElkID0gMTsKY29uc3QgYW5zaXVwID0gbmV3IEFuc2lVcCgpOwovLyBDb252ZXJ0IGFycmF5QnVmZmVyKFVpbnQ4QXJyYXkpIHRvIHN0cmluZwovLyByZWY6IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9UZXh0RGVjb2RlcgovLyByZWY6IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL1R5cGVkQXJyYXkvb2YKY29uc3QgYWIyc3RyID0gKGlucHV0LCBvdXRwdXRFbmNvZGluZyA9ICd1dGY4JykgPT4gewogIGNvbnN0IGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIob3V0cHV0RW5jb2RpbmcpOwoKICByZXR1cm4gZGVjb2Rlci5kZWNvZGUoaW5wdXQpOwp9OwoKLy8gVGhlIHV0Zi04IGVuY29kZWQgbWVzc2FnZXMgcHVzaGVkIGJ5IHdlYnNvY2tldCBtYXkgdHJ1bmNhdGUgbXVsdGktYnl0ZSB1dGYtOCBjaGFyYWN0ZXJzLAovLyB3aGljaCBjYXVzZXMgdGhlIGZyb250LWVuZCB0byBiZSB1bmFibGUgdG8gcGFyc2UgdGhlIHRydW5jYXRlZCBtdWx0aS1ieXRlIHV0Zi04IGNoYXJhY3RlcnMgaW4gdGhlIHByZXZpb3VzIGFuZCBuZXh0IG1lc3NhZ2VzIHdoZW4gZGVjb2RpbmcuCi8vIFRoZXJlZm9yZSwgd2UgbmVlZCB0byBkZXRlcm1pbmUgd2hldGhlciB0aGUgbGFzdCA0IGJ5dGVzIG9mIHRoZSBjdXJyZW50IHB1c2hlZCBtZXNzYWdlIGNvbnRhaW4gaW5jb21wbGV0ZSB1dGYtOCBlbmNvZGVkIGNoYXJhY3RlcnMuCi8vIHJlZjogaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVVRGLTgjRW5jb2RpbmcKY29uc3QgaXNMb2dUcnVuY2F0ZWQgPSAodWludDhBcnJheUJ1ZmZlcikgPT4gewogIGNvbnN0IGxlbiA9IHVpbnQ4QXJyYXlCdWZmZXIubGVuZ3RoOwogIGNvbnN0IGNvdW50ID0gTWF0aC5taW4oNCwgbGVuKTsKICBsZXQgaXNUcnVuY2F0ZWQgPSBmYWxzZTsKCiAgLy8gUGFyc2VzIHRoZSBsYXN0ICR7Y291bnR9IGJ5dGVzIG9mIHRoZSBhcnJheSB0byBkZXRlcm1pbmUgaWYgdGhlcmUgYXJlIGFueSB0cnVuY2F0ZWQgdXRmLTggY2hhcmFjdGVycy4KICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrICkgewogICAgY29uc3QgYSA9IHVpbnQ4QXJyYXlCdWZmZXJbbGVuIC0gKDEgKyBpKV07CgogICAgLy8gMSBieXRlIHV0Zi04IGNoYXJhY3RlciBpbiBiaW5hcnkgZm9ybTogMHh4eHh4eHh4eAogICAgaWYgKChhICYgMGIxMDAwMDAwMCkgPT09IDBiMDAwMDAwMDApIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICAvLyBNdWx0aS1ieXRlIHV0Zi04IGNoYXJhY3RlciwgaW50ZXJtZWRpYXRlIGJpbmFyeSBmb3JtOiAxMHh4eHh4eAogICAgaWYgKChhICYgMGIxMTAwMDAwMCkgPT09IDBiMTAwMDAwMDApIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICAvLyAyIGJ5dGUgdXRmLTggY2hhcmFjdGVyIGluIGJpbmFyeSBmb3JtOiAxMTB4eHh4eCAxMHh4eHh4eAogICAgaWYgKChhICYgMGIxMTEwMDAwMCkgPT09IDBiMTEwMDAwMDApIHsKICAgICAgaWYgKCBpICE9PSAxKSB7CiAgICAgICAgaXNUcnVuY2F0ZWQgPSB0cnVlOwogICAgICB9CiAgICAgIGJyZWFrOwogICAgfQogICAgLy8gMyBieXRlIHV0Zi04IGNoYXJhY3RlciBpbiBiaW5hcnkgZm9ybTogMTExMHh4eHggMTB4eHh4eHggMTB4eHh4eHgKICAgIGlmICgoYSAmIDBiMTExMTAwMDApID09PSAwYjExMTAwMDAwKSB7CiAgICAgIGlmIChpICE9PSAyKSB7CiAgICAgICAgaXNUcnVuY2F0ZWQgPSB0cnVlOwogICAgICB9CiAgICAgIGJyZWFrOwogICAgfQogICAgLy8gNCBieXRlIHV0Zi04IGNoYXJhY3RlciBpbiBiaW5hcnkgZm9ybTogMTExMTB4eHggMTB4eHh4eHggMTB4eHh4eHggMTB4eHh4eHgKICAgIGlmICgoYSAmIDBiMTExMTEwMDApID09PSAwYjExMTEwMDAwKSB7CiAgICAgIGlmIChpICE9PSAzKSB7CiAgICAgICAgaXNUcnVuY2F0ZWQgPSB0cnVlOwogICAgICB9CiAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgcmV0dXJuIGlzVHJ1bmNhdGVkOwp9OwoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIFdpbmRvdywKICAgIFNlbGVjdCwKICAgIExhYmVsZWRTZWxlY3QsCiAgICBDaGVja2JveCwKICAgIEFzeW5jQnV0dG9uLAogICAgVmlydHVhbExpc3QsCiAgfSwKCiAgcHJvcHM6IHsKICAgIC8vIFRoZSBkZWZpbml0aW9uIG9mIHRoZSB0YWIgaXRzZWxmCiAgICB0YWI6IHsKICAgICAgdHlwZTogICAgIE9iamVjdCwKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICB9LAoKICAgIC8vIElzIHRoaXMgdGFiIGN1cnJlbnRseSBkaXNwbGF5ZWQKICAgIGFjdGl2ZTogewogICAgICB0eXBlOiAgICAgQm9vbGVhbiwKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICB9LAoKICAgIC8vIFRoZSBoZWlnaHQgb2YgdGhlIHdpbmRvdwogICAgaGVpZ2h0OiB7CiAgICAgIHR5cGU6ICAgICBOdW1iZXIsCiAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgfSwKCiAgICAvLyBUaGUgcG9kIHRvIGNvbm5lY3QgdG8KICAgIHBvZDogewogICAgICB0eXBlOiAgICAgT2JqZWN0LAogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgIH0sCgogICAgdXJsOiB7CiAgICAgIHR5cGU6ICAgIFN0cmluZywKICAgICAgZGVmYXVsdDogbnVsbCwKICAgIH0sCgogICAgLy8gVGhlIGNvbnRhaW5lciBpbiB0aGUgcG9kIHRvIGluaXRpYWxseSBzaG93CiAgICBpbml0aWFsQ29udGFpbmVyOiB7CiAgICAgIHR5cGU6ICAgIFN0cmluZywKICAgICAgZGVmYXVsdDogbnVsbCwKICAgIH0KICB9LAoKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgY29udGFpbmVyOiAgIHRoaXMuaW5pdGlhbENvbnRhaW5lciB8fCB0aGlzLnBvZD8uZGVmYXVsdENvbnRhaW5lck5hbWUsCiAgICAgIHNvY2tldDogICAgICBudWxsLAogICAgICBpc09wZW46ICAgICAgZmFsc2UsCiAgICAgIGlzRm9sbG93aW5nOiB0cnVlLAogICAgICB0aW1lc3RhbXBzOiAgdGhpcy4kc3RvcmUuZ2V0dGVyc1sncHJlZnMvZ2V0J10oTE9HU19USU1FKSwKICAgICAgd3JhcDogICAgICAgIHRoaXMuJHN0b3JlLmdldHRlcnNbJ3ByZWZzL2dldCddKExPR1NfV1JBUCksCiAgICAgIHByZXZpb3VzOiAgICBmYWxzZSwKICAgICAgc2VhcmNoOiAgICAgICcnLAogICAgICBiYWNrbG9nOiAgICAgW10sCiAgICAgIGxpbmVzOiAgICAgICBbXSwKICAgICAgbm93OiAgICAgICAgIG5ldyBEYXRlKCksCiAgICAgIGxvZ0l0ZW06ICAgICBMb2dJdGVtCiAgICB9OwogIH0sCgogIGZldGNoKCkgewogICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9yYW5jaGVyL2Rhc2hib2FyZC9pc3N1ZXMvNjEyMi4gQXQgc29tZSBwb2ludCBwcmlvciB0byAyLjYuNSBMT0dTX1JBTkdFIGhhcyBiZWNvbWUgcG9sbHV0ZWQgd2l0aCBzb21ldGhpbmcKICAgIC8vIGludmFsaWQuIFRvIGF2b2lkIGV2ZXJ5b25lIGhhdmluZyB0byBtYW51YWxseSByZW1vdmUgaW52YWxpZCB1c2VyIHByZWZlcmVuY2VzIGZpeCBpdCBhdXRvbWF0aWNhbGx5IGhlcmUKICAgIGNvbnN0IG9yaWdpbmFsUmFuZ2UgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzWydwcmVmcy9nZXQnXShMT0dTX1JBTkdFKTsKCiAgICB0aGlzLnJhbmdlID0gb3JpZ2luYWxSYW5nZS52YWx1ZSB8fCBvcmlnaW5hbFJhbmdlOwoKICAgIGlmIChvcmlnaW5hbFJhbmdlICE9PSB0aGlzLnJhbmdlKSB7IC8vIFJhbmNoZXIgd2FzIGJyb2tlbiwgc28gcGVyc2lzdCB0aGUgZml4CiAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdwcmVmcy9zZXQnLCB7IGtleTogTE9HU19SQU5HRSwgdmFsdWU6IHRoaXMucmFuZ2UgfSk7CiAgICB9CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIGNvbnRhaW5lckNob2ljZXMoKSB7CiAgICAgIGNvbnN0IGlzSGFydmVzdGVyID0gdGhpcy4kc3RvcmUuZ2V0dGVyc1snY3VycmVudFByb2R1Y3QnXS5pblN0b3JlID09PSBWSVJUVUFMOwoKICAgICAgY29uc3QgY29udGFpbmVycyA9ICh0aGlzLnBvZD8uc3BlYz8uY29udGFpbmVycyB8fCBbXSkubWFwKCh4KSA9PiB4Lm5hbWUpOwogICAgICBjb25zdCBpbml0Q29udGFpbmVycyA9ICh0aGlzLnBvZD8uc3BlYz8uaW5pdENvbnRhaW5lcnMgfHwgW10pLm1hcCgoeCkgPT4geC5uYW1lKTsKCiAgICAgIHJldHVybiBpc0hhcnZlc3RlciA/IFtdIDogWy4uLmNvbnRhaW5lcnMsIC4uLmluaXRDb250YWluZXJzXTsKICAgIH0sCgogICAgcmFuZ2VPcHRpb25zKCkgewogICAgICBjb25zdCBvdXQgPSBbXTsKICAgICAgY29uc3QgdCA9IHRoaXMuJHN0b3JlLmdldHRlcnNbJ2kxOG4vdCddOwoKICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMucmFuZ2U7CiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICBsZXQgdmFsdWU7CiAgICAgIGNvbnN0IGxpbmVzID0gWzEwMDAsIDEwMDAwLCAxMDAwMDBdOwogICAgICBjb25zdCBtaW51dGVzID0gWzEsIDE1LCAzMF07CiAgICAgIGNvbnN0IGhvdXJzID0gWzEsIDEyLCAyNF07CgogICAgICBmb3IgKCBjb25zdCB4IG9mIGxpbmVzICkgewogICAgICAgIHZhbHVlID0gYCR7IHggfSBsaW5lc2A7CiAgICAgICAgb3V0LnB1c2goewogICAgICAgICAgbGFiZWw6IHQoJ3dtLmNvbnRhaW5lckxvZ3MucmFuZ2UubGluZXMnLCB7IHZhbHVlOiB4IH0pLAogICAgICAgICAgdmFsdWUsCiAgICAgICAgfSk7CiAgICAgICAgdXBkYXRlRm91bmQodmFsdWUpOwogICAgICB9CgogICAgICBmb3IgKCBjb25zdCB4IG9mIG1pbnV0ZXMgKSB7CiAgICAgICAgdmFsdWUgPSBgJHsgeCB9IG1pbnV0ZXNgOwogICAgICAgIG91dC5wdXNoKHsKICAgICAgICAgIGxhYmVsOiB0KCd3bS5jb250YWluZXJMb2dzLnJhbmdlLm1pbnV0ZXMnLCB7IHZhbHVlOiB4IH0pLAogICAgICAgICAgdmFsdWUKICAgICAgICB9KTsKICAgICAgICB1cGRhdGVGb3VuZCh2YWx1ZSk7CiAgICAgIH0KCiAgICAgIGZvciAoIGNvbnN0IHggb2YgaG91cnMgKSB7CiAgICAgICAgdmFsdWUgPSBgJHsgeCB9IGhvdXJzYDsKICAgICAgICBvdXQucHVzaCh7CiAgICAgICAgICBsYWJlbDogdCgnd20uY29udGFpbmVyTG9ncy5yYW5nZS5ob3VycycsIHsgdmFsdWU6IHggfSksCiAgICAgICAgICB2YWx1ZSwKICAgICAgICB9KTsKICAgICAgICB1cGRhdGVGb3VuZCh2YWx1ZSk7CiAgICAgIH0KCiAgICAgIG91dC5wdXNoKHsKICAgICAgICBsYWJlbDogdCgnd20uY29udGFpbmVyTG9ncy5yYW5nZS5hbGwnKSwKICAgICAgICB2YWx1ZTogJ2FsbCcKICAgICAgfSk7CiAgICAgIHVwZGF0ZUZvdW5kKCdhbGwnKTsKCiAgICAgIGlmICggIWZvdW5kICYmIGN1cnJlbnQgKSB7CiAgICAgICAgb3V0LnB1c2goewogICAgICAgICAgbGFiZWw6IGN1cnJlbnQsCiAgICAgICAgICB2YWx1ZTogY3VycmVudCwKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIG91dDsKCiAgICAgIGZ1bmN0aW9uIHVwZGF0ZUZvdW5kKGVudHJ5KSB7CiAgICAgICAgZW50cnkgPSBlbnRyeS5yZXBsYWNlKC9bLCBdL2csICcnKS5yZXBsYWNlKC9zJC8sICcnKTsKICAgICAgICBjb25zdCBub3JtYWxpemVkID0gY3VycmVudC5yZXBsYWNlKC9bLCBdL2csICcnKS5yZXBsYWNlKC9zJC8sICcnKTsKCiAgICAgICAgaWYgKCBlbnRyeSA9PT0gbm9ybWFsaXplZCkgewogICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICBmaWx0ZXJlZCgpIHsKICAgICAgaWYgKCAhdGhpcy5zZWFyY2ggKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubGluZXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IHJlID0gbmV3IFJlZ0V4cChlc2NhcGVSZWdleCh0aGlzLnNlYXJjaCksICdpbWcnKTsKICAgICAgY29uc3Qgb3V0ID0gW107CgogICAgICBmb3IgKCBjb25zdCBsaW5lIG9mIHRoaXMubGluZXMgKSB7CiAgICAgICAgbGV0IG1zZyA9IGxpbmUucmF3TXNnOwogICAgICAgIGNvbnN0IG1hdGNoZXMgPSBtc2cubWF0Y2gocmUpOwoKICAgICAgICBpZiAoICFtYXRjaGVzICkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBwYXJ0cyA9IG1zZy5zcGxpdChyZSk7CgogICAgICAgIG1zZyA9ICcnOwogICAgICAgIHdoaWxlICggcGFydHMubGVuZ3RoIHx8IG1hdGNoZXMubGVuZ3RoICkgewogICAgICAgICAgaWYgKCBwYXJ0cy5sZW5ndGggKSB7CiAgICAgICAgICAgIG1zZyArPSBhbnNpdXAuYW5zaV90b19odG1sKHBhcnRzLnNoaWZ0KCkpOyAvLyBUaGlzIGFsc28gZXNjYXBlcwogICAgICAgICAgfQoKICAgICAgICAgIGlmICggbWF0Y2hlcy5sZW5ndGggKSB7CiAgICAgICAgICAgIG1zZyArPSBgPHNwYW4gY2xhc3M9ImhpZ2hsaWdodCI+JHsgYW5zaXVwLmFuc2lfdG9faHRtbChtYXRjaGVzLnNoaWZ0KCkpIH08L3NwYW4+YDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIG91dC5wdXNoKHsKICAgICAgICAgIGlkOiAgIGxpbmUuaWQsCiAgICAgICAgICB0aW1lOiBsaW5lLnRpbWUsCiAgICAgICAgICBtc2csCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgfSwKCiAgd2F0Y2g6IHsKICAgIGNvbnRhaW5lcigpIHsKICAgICAgdGhpcy5jb25uZWN0KCk7CiAgICB9LAoKICB9LAoKICBiZWZvcmVEZXN0cm95KCkgewogICAgdGhpcy5jbGVhbnVwKCk7CiAgfSwKCiAgYXN5bmMgbW91bnRlZCgpIHsKICAgIGF3YWl0IHRoaXMuY29ubmVjdCgpOwogICAgdGhpcy5ib3VuZEZsdXNoID0gdGhpcy5mbHVzaC5iaW5kKHRoaXMpOwogICAgdGhpcy50aW1lckZsdXNoID0gc2V0SW50ZXJ2YWwodGhpcy5ib3VuZEZsdXNoLCAxMDApOwogIH0sCgogIG1ldGhvZHM6IHsKICAgIGFzeW5jIGNvbm5lY3QoKSB7CiAgICAgIGlmICggdGhpcy5zb2NrZXQgKSB7CiAgICAgICAgYXdhaXQgdGhpcy5zb2NrZXQuZGlzY29ubmVjdCgpOwogICAgICAgIHRoaXMuc29ja2V0ID0gbnVsbDsKICAgICAgICB0aGlzLmxpbmVzID0gW107CiAgICAgIH0KCiAgICAgIGxldCBwYXJhbXMgPSB7CiAgICAgICAgcHJldmlvdXM6ICAgdGhpcy5wcmV2aW91cywKICAgICAgICBmb2xsb3c6ICAgICB0cnVlLAogICAgICAgIHRpbWVzdGFtcHM6IHRydWUsCiAgICAgICAgcHJldHR5OiAgICAgdHJ1ZSwKICAgICAgfTsKCiAgICAgIGlmICggdGhpcy5jb250YWluZXIgKSB7CiAgICAgICAgcGFyYW1zLmNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyOwogICAgICB9CgogICAgICBjb25zdCByYW5nZVBhcmFtcyA9IHRoaXMucGFyc2VSYW5nZSh0aGlzLnJhbmdlKTsKCiAgICAgIHBhcmFtcyA9IHsgLi4ucGFyYW1zLCAuLi5yYW5nZVBhcmFtcyB9OwoKICAgICAgbGV0IHVybCA9IHRoaXMudXJsIHx8IGAkeyB0aGlzLnBvZC5saW5rcy52aWV3IH0vbG9nYDsKCiAgICAgIHVybCA9IGFkZFBhcmFtcyh1cmwucmVwbGFjZSgvXmh0dHAvLCAnd3MnKSwgcGFyYW1zKTsKCiAgICAgIHRoaXMuc29ja2V0ID0gbmV3IFNvY2tldCh1cmwsIGZhbHNlLCAwLCAnYmFzZTY0LmJpbmFyeS5rOHMuaW8nKTsKICAgICAgdGhpcy5zb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihFVkVOVF9DT05ORUNURUQsIChlKSA9PiB7CiAgICAgICAgdGhpcy5pc09wZW4gPSB0cnVlOwogICAgICB9KTsKCiAgICAgIHRoaXMuc29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoRVZFTlRfRElTQ09OTkVDVEVELCAoZSkgPT4gewogICAgICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7CiAgICAgIH0pOwoKICAgICAgdGhpcy5zb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihFVkVOVF9DT05ORUNUX0VSUk9SLCAoZSkgPT4gewogICAgICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7CiAgICAgICAgY29uc29sZS5lcnJvcignQ29ubmVjdCBFcnJvcicsIGUpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKICAgICAgfSk7CgogICAgICBsZXQgbG9nQnVmZmVyID0gW107CiAgICAgIGxldCB0cnVuY2F0ZWRMb2cgPSAnJzsKCiAgICAgIHRoaXMuc29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoRVZFTlRfTUVTU0FHRSwgKGUpID0+IHsKICAgICAgICBjb25zdCBkZWNvZGVkRGF0YSA9IGUuZGV0YWlsPy5kYXRhIHx8ICcnOwogICAgICAgIGNvbnN0IHJlcGxhY2VkRGF0YSA9IGRlY29kZWREYXRhLnJlcGxhY2UoL1stX10vZywgKGNoYXIpID0+IGNoYXIgPT09ICctJyA/ICcrJyA6ICcvJyk7CiAgICAgICAgY29uc3QgYiA9IGJhc2U2NERlY29kZVRvQnVmZmVyKHJlcGxhY2VkRGF0YSk7CiAgICAgICAgY29uc3QgaXNUcnVuY2F0ZWQgPSBpc0xvZ1RydW5jYXRlZChiKTsKCiAgICAgICAgaWYgKGlzVHJ1bmNhdGVkID09PSB0cnVlKSB7CiAgICAgICAgICBsb2dCdWZmZXIucHVzaCguLi5iKTsKCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBsZXQgZDsKCiAgICAgICAgLy8gSWYgdGhlIGxvZ0J1ZmZlciBpcyBub3QgZW1wdHksCiAgICAgICAgLy8gdGhlcmUgYXJlIHRydW5jYXRlZCB1dGYtOCBjaGFyYWN0ZXJzIGluIHRoZSBwcmV2aW91cyBtZXNzYWdlCiAgICAgICAgLy8gdGhhdCBuZWVkIHRvIGJlIG1lcmdlZCB3aXRoIHRoZSBjdXJyZW50IG1lc3NhZ2UgYmVmb3JlIGRlY29kaW5nLgogICAgICAgIGlmIChsb2dCdWZmZXIubGVuZ3RoID4gMCkgewogICAgICAgICAgLy8gQ29udmVydCBhcnJheUJ1ZmZlcihVaW50OEFycmF5KSB0byBzdHJpbmcKICAgICAgICAgIC8vIHJlZjogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvVHlwZWRBcnJheS9vZgogICAgICAgICAgZCA9IGFiMnN0cihVaW50OEFycmF5Lm9mKC4uLmxvZ0J1ZmZlciwgLi4uYikpOwogICAgICAgICAgbG9nQnVmZmVyID0gW107CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGQgPSBiLnRvU3RyaW5nKCk7CiAgICAgICAgfQogICAgICAgIGxldCBkYXRhID0gZDsKCiAgICAgICAgaWYgKHRydW5jYXRlZExvZykgewogICAgICAgICAgZGF0YSA9IGAkeyB0cnVuY2F0ZWRMb2cgfSR7IGQgfWA7CiAgICAgICAgICB0cnVuY2F0ZWRMb2cgPSAnJzsKICAgICAgICB9CgogICAgICAgIGlmICghZC5lbmRzV2l0aCgnXG4nKSkgewogICAgICAgICAgY29uc3QgbGluZXMgPSBkYXRhLnNwbGl0KC9cbi8pOwoKICAgICAgICAgIGlmIChsaW5lcy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgdHJ1bmNhdGVkTG9nID0gZGF0YTsKCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGRhdGEgPSBsaW5lcy5zbGljZSgwLCAtMSkuam9pbignXG4nKTsKICAgICAgICAgIHRydW5jYXRlZExvZyA9IGxpbmVzLnNsaWNlKC0xKTsKICAgICAgICB9CiAgICAgICAgLy8gV2Vic29ja2V0IG1lc3NhZ2UgbWF5IGNvbnRhaW4gbXVsdGlwbGUgbGluZXMgLSBsb29wIHRocm91Z2ggZWFjaCBsaW5lLCBvbmUgYnkgb25lCiAgICAgICAgZGF0YS5zcGxpdCgnXG4nKS5maWx0ZXIoKGxpbmUpID0+IGxpbmUpLmZvckVhY2goKGxpbmUpID0+IHsKICAgICAgICAgIGxldCBtc2cgPSBsaW5lOwogICAgICAgICAgbGV0IHRpbWUgPSBudWxsOwoKICAgICAgICAgIGNvbnN0IGlkeCA9IGxpbmUuaW5kZXhPZignICcpOwoKICAgICAgICAgIGlmICggaWR4ID4gMCApIHsKICAgICAgICAgICAgY29uc3QgdGltZVN0ciA9IGxpbmUuc3Vic3RyKDAsIGlkeCk7CiAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSh0aW1lU3RyKTsKCiAgICAgICAgICAgIGlmICggIWlzTmFOKGRhdGUuZ2V0U2Vjb25kcygpKSApIHsKICAgICAgICAgICAgICB0aW1lID0gZGF0ZS50b0lTT1N0cmluZygpOwogICAgICAgICAgICAgIG1zZyA9IGxpbmUuc3Vic3RyKGlkeCArIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgcGFyc2VkTGluZSA9IHsKICAgICAgICAgICAgaWQ6ICAgICBsYXN0SWQrKywKICAgICAgICAgICAgbXNnOiAgICBhbnNpdXAuYW5zaV90b19odG1sKG1zZyksCiAgICAgICAgICAgIHJhd01zZzogbXNnLAogICAgICAgICAgICB0aW1lLAogICAgICAgICAgfTsKCiAgICAgICAgICBPYmplY3QuZnJlZXplKHBhcnNlZExpbmUpOwoKICAgICAgICAgIHRoaXMuYmFja2xvZy5wdXNoKHBhcnNlZExpbmUpOwogICAgICAgIH0pOwogICAgICB9KTsKCiAgICAgIHRoaXMuc29ja2V0LmNvbm5lY3QoKTsKICAgIH0sCgogICAgZmx1c2goKSB7CiAgICAgIGlmICggdGhpcy5iYWNrbG9nLmxlbmd0aCApIHsKICAgICAgICB0aGlzLmxpbmVzLnB1c2goLi4udGhpcy5iYWNrbG9nKTsKICAgICAgICB0aGlzLmJhY2tsb2cgPSBbXTsKICAgICAgICBjb25zdCBtYXhMaW5lcyA9IHRoaXMucGFyc2VSYW5nZSh0aGlzLnJhbmdlKT8udGFpbExpbmVzOwoKICAgICAgICBpZiAobWF4TGluZXMgJiYgdGhpcy5saW5lcy5sZW5ndGggPiBtYXhMaW5lcykgewogICAgICAgICAgdGhpcy5saW5lcyA9IHRoaXMubGluZXMuc2xpY2UoLW1heExpbmVzKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICggdGhpcy5pc0ZvbGxvd2luZyApIHsKICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICB0aGlzLmZvbGxvdygpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAoKICAgIHVwZGF0ZUZvbGxvd2luZygpIHsKICAgICAgY29uc3QgdmlydHVhbExpc3QgPSB0aGlzLiRyZWZzLnZpcnR1YWxMaXN0OwoKICAgICAgaWYgKHZpcnR1YWxMaXN0KSB7CiAgICAgICAgdGhpcy5pc0ZvbGxvd2luZyA9IHZpcnR1YWxMaXN0LmdldFNjcm9sbFNpemUoKSAtIHZpcnR1YWxMaXN0LmdldENsaWVudFNpemUoKSA9PT0gdmlydHVhbExpc3QuZ2V0T2Zmc2V0KCk7CiAgICAgIH0KICAgIH0sCgogICAgcGFyc2VSYW5nZShyYW5nZSkgewogICAgICByYW5nZSA9IGAkeyByYW5nZSB9YC50cmltKCkudG9Mb3dlckNhc2UoKTsKICAgICAgY29uc3QgbWF0Y2ggPSByYW5nZS5tYXRjaCgvXihcZCspP1xzKiguKj8pcz8kLyk7CgogICAgICBjb25zdCBvdXQgPSB7fTsKCiAgICAgIGlmICggbWF0Y2ggKSB7CiAgICAgICAgY29uc3QgY291bnQgPSBwYXJzZUludChtYXRjaFsxXSwgMTApIHx8IDE7CiAgICAgICAgY29uc3QgdW5pdCA9IG1hdGNoWzJdOwoKICAgICAgICBzd2l0Y2ggKCB1bml0ICkgewogICAgICAgIGNhc2UgJ2FsbCc6CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdsaW5lJzoKICAgICAgICAgIG91dC50YWlsTGluZXMgPSBjb3VudDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ3NlY29uZCc6CiAgICAgICAgICBvdXQuc2luY2VTZWNvbmRzID0gY291bnQ7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdtaW51dGUnOgogICAgICAgICAgb3V0LnNpbmNlU2Vjb25kcyA9IGNvdW50ICogNjA7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdob3VyJzoKICAgICAgICAgIG91dC5zaW5jZVNlY29uZHMgPSBjb3VudCAqIDYwICogNjA7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdkYXknOgogICAgICAgICAgb3V0LnNpbmNlU2Vjb25kcyA9IGNvdW50ICogNjAgKiA2MCAqIDI0OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIG91dC50YWlsTGluZXMgPSAxMDA7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXQ7CiAgICB9LAoKICAgIGNsZWFyKCkgewogICAgICB0aGlzLmxpbmVzID0gW107CiAgICB9LAoKICAgIGFzeW5jIGRvd25sb2FkKGJ0bkNiKSB7CiAgICAgIGxldCB1cmwgPSB0aGlzLnVybCB8fCBgJHsgdGhpcy5wb2QubGlua3MudmlldyB9L2xvZ2A7CgogICAgICBpZiAoIHRoaXMuY29udGFpbmVyICkgewogICAgICAgIHVybCA9IGFkZFBhcmFtcyh1cmwsIHsgY29udGFpbmVyOiB0aGlzLmNvbnRhaW5lciB9KTsKICAgICAgfQoKICAgICAgdXJsID0gYWRkUGFyYW1zKHVybCwgewogICAgICAgIHByZXZpb3VzOiAgIHRoaXMucHJldmlvdXMsCiAgICAgICAgcHJldHR5OiAgICAgdHJ1ZSwKICAgICAgICBsaW1pdEJ5dGVzOiA3NTAgKiAxMDI0ICogMTAyNCwKICAgICAgfSk7CgogICAgICB0cnkgewogICAgICAgIGNvbnN0IGluU3RvcmUgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzWydjdXJyZW50U3RvcmUnXSgpOwogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKGAkeyBpblN0b3JlIH0vcmVxdWVzdGAsIHsgdXJsLCByZXNwb25zZVR5cGU6ICdibG9iJyB9KTsKICAgICAgICAvLyBjb25zdCBibG9iID0gbmV3IEJsb2IoW3Jlc10sIHsgdHlwZTogJ3RleHQvcGxhaW47Y2hhcnNldD11dGYtOCcgfSk7CiAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBgJHsgdGhpcy5wb2QubmFtZURpc3BsYXkgfV8keyB0aGlzLmNvbnRhaW5lciB9LmxvZ2A7CgogICAgICAgIHNhdmVBcyhyZXMuZGF0YSwgZmlsZU5hbWUpOwogICAgICAgIGJ0bkNiKHRydWUpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgYnRuQ2IoZmFsc2UpOwogICAgICB9CiAgICB9LAoKICAgIGZvbGxvdygpIHsKICAgICAgY29uc3QgdmlydHVhbExpc3QgPSB0aGlzLiRyZWZzLnZpcnR1YWxMaXN0OwoKICAgICAgaWYgKHZpcnR1YWxMaXN0KSB7CiAgICAgICAgdmlydHVhbExpc3QuJGVsLnNjcm9sbFRvcCA9IHZpcnR1YWxMaXN0LmdldFNjcm9sbFNpemUoKTsKICAgICAgfQogICAgfSwKCiAgICB0b2dnbGVXcmFwKG9uKSB7CiAgICAgIHRoaXMud3JhcCA9IG9uOwogICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgncHJlZnMvc2V0JywgeyBrZXk6IExPR1NfV1JBUCwgdmFsdWU6IHRoaXMud3JhcCB9KTsKICAgIH0sCgogICAgdG9nZ2xlUHJldmlvdXMob24pIHsKICAgICAgdGhpcy5wcmV2aW91cyA9IG9uOwogICAgICAvLyBJbnRlbnRpb25hbGx5IG5vdCBzYXZlZCBhcyBhIHByZWYKICAgICAgdGhpcy5jb25uZWN0KCk7CiAgICB9LAoKICAgIHRvZ2dsZVRpbWVzdGFtcHMob24pIHsKICAgICAgdGhpcy50aW1lc3RhbXBzID0gb247CiAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdwcmVmcy9zZXQnLCB7IGtleTogTE9HU19USU1FLCB2YWx1ZTogdGhpcy50aW1lc3RhbXBzIH0pOwogICAgfSwKCiAgICB0b2dnbGVSYW5nZShyYW5nZSkgewogICAgICB0aGlzLnJhbmdlID0gcmFuZ2U7CiAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdwcmVmcy9zZXQnLCB7IGtleTogTE9HU19SQU5HRSwgdmFsdWU6IHRoaXMucmFuZ2UgfSk7CiAgICAgIHRoaXMuY29ubmVjdCgpOwogICAgfSwKCiAgICBjbGVhbnVwKCkgewogICAgICBpZiAoIHRoaXMuc29ja2V0ICkgewogICAgICAgIHRoaXMuc29ja2V0LmRpc2Nvbm5lY3QoKTsKICAgICAgICB0aGlzLnNvY2tldCA9IG51bGw7CiAgICAgIH0KICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVyRmx1c2gpOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["ContainerLogs.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ContainerLogs.vue","sourceRoot":"node_modules/@rancher/shell/components/nav/WindowManager","sourcesContent":["<script>\nimport { saveAs } from 'file-saver';\nimport AnsiUp from 'ansi_up';\nimport { addParams } from '@shell/utils/url';\nimport { base64DecodeToBuffer } from '@shell/utils/crypto';\nimport { LOGS_RANGE, LOGS_TIME, LOGS_WRAP } from '@shell/store/prefs';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\nimport { Checkbox } from '@components/Form/Checkbox';\nimport AsyncButton from '@shell/components/AsyncButton';\nimport Select from '@shell/components/form/Select';\nimport VirtualList from 'vue-virtual-scroll-list';\nimport LogItem from '@shell/components/LogItem';\n\nimport { escapeRegex } from '@shell/utils/string';\nimport { HARVESTER_NAME as VIRTUAL } from '@shell/config/features';\n\nimport Socket, {\n  EVENT_CONNECTED,\n  EVENT_DISCONNECTED,\n  EVENT_MESSAGE,\n  //  EVENT_FRAME_TIMEOUT,\n  EVENT_CONNECT_ERROR\n} from '@shell/utils/socket';\nimport Window from './Window';\n\nlet lastId = 1;\nconst ansiup = new AnsiUp();\n// Convert arrayBuffer(Uint8Array) to string\n// ref: https://developer.mozilla.org/en-US/docs/Web/API/TextDecoder\n// ref: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray/of\nconst ab2str = (input, outputEncoding = 'utf8') => {\n  const decoder = new TextDecoder(outputEncoding);\n\n  return decoder.decode(input);\n};\n\n// The utf-8 encoded messages pushed by websocket may truncate multi-byte utf-8 characters,\n// which causes the front-end to be unable to parse the truncated multi-byte utf-8 characters in the previous and next messages when decoding.\n// Therefore, we need to determine whether the last 4 bytes of the current pushed message contain incomplete utf-8 encoded characters.\n// ref: https://en.wikipedia.org/wiki/UTF-8#Encoding\nconst isLogTruncated = (uint8ArrayBuffer) => {\n  const len = uint8ArrayBuffer.length;\n  const count = Math.min(4, len);\n  let isTruncated = false;\n\n  // Parses the last ${count} bytes of the array to determine if there are any truncated utf-8 characters.\n  for ( let i = 0; i < count; i++ ) {\n    const a = uint8ArrayBuffer[len - (1 + i)];\n\n    // 1 byte utf-8 character in binary form: 0xxxxxxxxx\n    if ((a & 0b10000000) === 0b00000000) {\n      break;\n    }\n    // Multi-byte utf-8 character, intermediate binary form: 10xxxxxx\n    if ((a & 0b11000000) === 0b10000000) {\n      continue;\n    }\n    // 2 byte utf-8 character in binary form: 110xxxxx 10xxxxxx\n    if ((a & 0b11100000) === 0b11000000) {\n      if ( i !== 1) {\n        isTruncated = true;\n      }\n      break;\n    }\n    // 3 byte utf-8 character in binary form: 1110xxxx 10xxxxxx 10xxxxxx\n    if ((a & 0b11110000) === 0b11100000) {\n      if (i !== 2) {\n        isTruncated = true;\n      }\n      break;\n    }\n    // 4 byte utf-8 character in binary form: 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx\n    if ((a & 0b11111000) === 0b11110000) {\n      if (i !== 3) {\n        isTruncated = true;\n      }\n      break;\n    }\n  }\n\n  return isTruncated;\n};\n\nexport default {\n  components: {\n    Window,\n    Select,\n    LabeledSelect,\n    Checkbox,\n    AsyncButton,\n    VirtualList,\n  },\n\n  props: {\n    // The definition of the tab itself\n    tab: {\n      type:     Object,\n      required: true,\n    },\n\n    // Is this tab currently displayed\n    active: {\n      type:     Boolean,\n      required: true,\n    },\n\n    // The height of the window\n    height: {\n      type:     Number,\n      required: true,\n    },\n\n    // The pod to connect to\n    pod: {\n      type:     Object,\n      required: true,\n    },\n\n    url: {\n      type:    String,\n      default: null,\n    },\n\n    // The container in the pod to initially show\n    initialContainer: {\n      type:    String,\n      default: null,\n    }\n  },\n\n  data() {\n    return {\n      container:   this.initialContainer || this.pod?.defaultContainerName,\n      socket:      null,\n      isOpen:      false,\n      isFollowing: true,\n      timestamps:  this.$store.getters['prefs/get'](LOGS_TIME),\n      wrap:        this.$store.getters['prefs/get'](LOGS_WRAP),\n      previous:    false,\n      search:      '',\n      backlog:     [],\n      lines:       [],\n      now:         new Date(),\n      logItem:     LogItem\n    };\n  },\n\n  fetch() {\n    // See https://github.com/rancher/dashboard/issues/6122. At some point prior to 2.6.5 LOGS_RANGE has become polluted with something\n    // invalid. To avoid everyone having to manually remove invalid user preferences fix it automatically here\n    const originalRange = this.$store.getters['prefs/get'](LOGS_RANGE);\n\n    this.range = originalRange.value || originalRange;\n\n    if (originalRange !== this.range) { // Rancher was broken, so persist the fix\n      this.$store.dispatch('prefs/set', { key: LOGS_RANGE, value: this.range });\n    }\n  },\n\n  computed: {\n    containerChoices() {\n      const isHarvester = this.$store.getters['currentProduct'].inStore === VIRTUAL;\n\n      const containers = (this.pod?.spec?.containers || []).map((x) => x.name);\n      const initContainers = (this.pod?.spec?.initContainers || []).map((x) => x.name);\n\n      return isHarvester ? [] : [...containers, ...initContainers];\n    },\n\n    rangeOptions() {\n      const out = [];\n      const t = this.$store.getters['i18n/t'];\n\n      const current = this.range;\n      let found = false;\n      let value;\n      const lines = [1000, 10000, 100000];\n      const minutes = [1, 15, 30];\n      const hours = [1, 12, 24];\n\n      for ( const x of lines ) {\n        value = `${ x } lines`;\n        out.push({\n          label: t('wm.containerLogs.range.lines', { value: x }),\n          value,\n        });\n        updateFound(value);\n      }\n\n      for ( const x of minutes ) {\n        value = `${ x } minutes`;\n        out.push({\n          label: t('wm.containerLogs.range.minutes', { value: x }),\n          value\n        });\n        updateFound(value);\n      }\n\n      for ( const x of hours ) {\n        value = `${ x } hours`;\n        out.push({\n          label: t('wm.containerLogs.range.hours', { value: x }),\n          value,\n        });\n        updateFound(value);\n      }\n\n      out.push({\n        label: t('wm.containerLogs.range.all'),\n        value: 'all'\n      });\n      updateFound('all');\n\n      if ( !found && current ) {\n        out.push({\n          label: current,\n          value: current,\n        });\n      }\n\n      return out;\n\n      function updateFound(entry) {\n        entry = entry.replace(/[, ]/g, '').replace(/s$/, '');\n        const normalized = current.replace(/[, ]/g, '').replace(/s$/, '');\n\n        if ( entry === normalized) {\n          found = true;\n        }\n      }\n    },\n\n    filtered() {\n      if ( !this.search ) {\n        return this.lines;\n      }\n\n      const re = new RegExp(escapeRegex(this.search), 'img');\n      const out = [];\n\n      for ( const line of this.lines ) {\n        let msg = line.rawMsg;\n        const matches = msg.match(re);\n\n        if ( !matches ) {\n          continue;\n        }\n\n        const parts = msg.split(re);\n\n        msg = '';\n        while ( parts.length || matches.length ) {\n          if ( parts.length ) {\n            msg += ansiup.ansi_to_html(parts.shift()); // This also escapes\n          }\n\n          if ( matches.length ) {\n            msg += `<span class=\"highlight\">${ ansiup.ansi_to_html(matches.shift()) }</span>`;\n          }\n        }\n\n        out.push({\n          id:   line.id,\n          time: line.time,\n          msg,\n        });\n      }\n\n      return out;\n    }\n  },\n\n  watch: {\n    container() {\n      this.connect();\n    },\n\n  },\n\n  beforeDestroy() {\n    this.cleanup();\n  },\n\n  async mounted() {\n    await this.connect();\n    this.boundFlush = this.flush.bind(this);\n    this.timerFlush = setInterval(this.boundFlush, 100);\n  },\n\n  methods: {\n    async connect() {\n      if ( this.socket ) {\n        await this.socket.disconnect();\n        this.socket = null;\n        this.lines = [];\n      }\n\n      let params = {\n        previous:   this.previous,\n        follow:     true,\n        timestamps: true,\n        pretty:     true,\n      };\n\n      if ( this.container ) {\n        params.container = this.container;\n      }\n\n      const rangeParams = this.parseRange(this.range);\n\n      params = { ...params, ...rangeParams };\n\n      let url = this.url || `${ this.pod.links.view }/log`;\n\n      url = addParams(url.replace(/^http/, 'ws'), params);\n\n      this.socket = new Socket(url, false, 0, 'base64.binary.k8s.io');\n      this.socket.addEventListener(EVENT_CONNECTED, (e) => {\n        this.isOpen = true;\n      });\n\n      this.socket.addEventListener(EVENT_DISCONNECTED, (e) => {\n        this.isOpen = false;\n      });\n\n      this.socket.addEventListener(EVENT_CONNECT_ERROR, (e) => {\n        this.isOpen = false;\n        console.error('Connect Error', e); // eslint-disable-line no-console\n      });\n\n      let logBuffer = [];\n      let truncatedLog = '';\n\n      this.socket.addEventListener(EVENT_MESSAGE, (e) => {\n        const decodedData = e.detail?.data || '';\n        const replacedData = decodedData.replace(/[-_]/g, (char) => char === '-' ? '+' : '/');\n        const b = base64DecodeToBuffer(replacedData);\n        const isTruncated = isLogTruncated(b);\n\n        if (isTruncated === true) {\n          logBuffer.push(...b);\n\n          return;\n        }\n\n        let d;\n\n        // If the logBuffer is not empty,\n        // there are truncated utf-8 characters in the previous message\n        // that need to be merged with the current message before decoding.\n        if (logBuffer.length > 0) {\n          // Convert arrayBuffer(Uint8Array) to string\n          // ref: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray/of\n          d = ab2str(Uint8Array.of(...logBuffer, ...b));\n          logBuffer = [];\n        } else {\n          d = b.toString();\n        }\n        let data = d;\n\n        if (truncatedLog) {\n          data = `${ truncatedLog }${ d }`;\n          truncatedLog = '';\n        }\n\n        if (!d.endsWith('\\n')) {\n          const lines = data.split(/\\n/);\n\n          if (lines.length === 1) {\n            truncatedLog = data;\n\n            return;\n          }\n          data = lines.slice(0, -1).join('\\n');\n          truncatedLog = lines.slice(-1);\n        }\n        // Websocket message may contain multiple lines - loop through each line, one by one\n        data.split('\\n').filter((line) => line).forEach((line) => {\n          let msg = line;\n          let time = null;\n\n          const idx = line.indexOf(' ');\n\n          if ( idx > 0 ) {\n            const timeStr = line.substr(0, idx);\n            const date = new Date(timeStr);\n\n            if ( !isNaN(date.getSeconds()) ) {\n              time = date.toISOString();\n              msg = line.substr(idx + 1);\n            }\n          }\n\n          const parsedLine = {\n            id:     lastId++,\n            msg:    ansiup.ansi_to_html(msg),\n            rawMsg: msg,\n            time,\n          };\n\n          Object.freeze(parsedLine);\n\n          this.backlog.push(parsedLine);\n        });\n      });\n\n      this.socket.connect();\n    },\n\n    flush() {\n      if ( this.backlog.length ) {\n        this.lines.push(...this.backlog);\n        this.backlog = [];\n        const maxLines = this.parseRange(this.range)?.tailLines;\n\n        if (maxLines && this.lines.length > maxLines) {\n          this.lines = this.lines.slice(-maxLines);\n        }\n      }\n\n      if ( this.isFollowing ) {\n        this.$nextTick(() => {\n          this.follow();\n        });\n      }\n    },\n\n    updateFollowing() {\n      const virtualList = this.$refs.virtualList;\n\n      if (virtualList) {\n        this.isFollowing = virtualList.getScrollSize() - virtualList.getClientSize() === virtualList.getOffset();\n      }\n    },\n\n    parseRange(range) {\n      range = `${ range }`.trim().toLowerCase();\n      const match = range.match(/^(\\d+)?\\s*(.*?)s?$/);\n\n      const out = {};\n\n      if ( match ) {\n        const count = parseInt(match[1], 10) || 1;\n        const unit = match[2];\n\n        switch ( unit ) {\n        case 'all':\n          break;\n        case 'line':\n          out.tailLines = count;\n          break;\n        case 'second':\n          out.sinceSeconds = count;\n          break;\n        case 'minute':\n          out.sinceSeconds = count * 60;\n          break;\n        case 'hour':\n          out.sinceSeconds = count * 60 * 60;\n          break;\n        case 'day':\n          out.sinceSeconds = count * 60 * 60 * 24;\n          break;\n        }\n      } else {\n        out.tailLines = 100;\n      }\n\n      return out;\n    },\n\n    clear() {\n      this.lines = [];\n    },\n\n    async download(btnCb) {\n      let url = this.url || `${ this.pod.links.view }/log`;\n\n      if ( this.container ) {\n        url = addParams(url, { container: this.container });\n      }\n\n      url = addParams(url, {\n        previous:   this.previous,\n        pretty:     true,\n        limitBytes: 750 * 1024 * 1024,\n      });\n\n      try {\n        const inStore = this.$store.getters['currentStore']();\n        const res = await this.$store.dispatch(`${ inStore }/request`, { url, responseType: 'blob' });\n        // const blob = new Blob([res], { type: 'text/plain;charset=utf-8' });\n        const fileName = `${ this.pod.nameDisplay }_${ this.container }.log`;\n\n        saveAs(res.data, fileName);\n        btnCb(true);\n      } catch (e) {\n        btnCb(false);\n      }\n    },\n\n    follow() {\n      const virtualList = this.$refs.virtualList;\n\n      if (virtualList) {\n        virtualList.$el.scrollTop = virtualList.getScrollSize();\n      }\n    },\n\n    toggleWrap(on) {\n      this.wrap = on;\n      this.$store.dispatch('prefs/set', { key: LOGS_WRAP, value: this.wrap });\n    },\n\n    togglePrevious(on) {\n      this.previous = on;\n      // Intentionally not saved as a pref\n      this.connect();\n    },\n\n    toggleTimestamps(on) {\n      this.timestamps = on;\n      this.$store.dispatch('prefs/set', { key: LOGS_TIME, value: this.timestamps });\n    },\n\n    toggleRange(range) {\n      this.range = range;\n      this.$store.dispatch('prefs/set', { key: LOGS_RANGE, value: this.range });\n      this.connect();\n    },\n\n    cleanup() {\n      if ( this.socket ) {\n        this.socket.disconnect();\n        this.socket = null;\n      }\n      clearInterval(this.timerFlush);\n    },\n  },\n};\n</script>\n\n<template>\n  <Window\n    :active=\"active\"\n    :before-close=\"cleanup\"\n  >\n    <template #title>\n      <div class=\"wm-button-bar\">\n        <Select\n          v-if=\"containerChoices.length > 0\"\n          v-model=\"container\"\n          :disabled=\"containerChoices.length === 1\"\n          class=\"containerPicker\"\n          :options=\"containerChoices\"\n          :clearable=\"false\"\n          placement=\"top\"\n        >\n          <template #selected-option=\"option\">\n            <t\n              v-if=\"option\"\n              k=\"wm.containerLogs.containerName\"\n              :label=\"option.label\"\n            />\n          </template>\n        </Select>\n        <div class=\"log-action log-action-group ml-5\">\n          <button\n            class=\"btn bg-primary wm-btn\"\n            :disabled=\"isFollowing\"\n            @click=\"follow\"\n          >\n            <t\n              class=\"wm-btn-large\"\n              k=\"wm.containerLogs.follow\"\n            />\n            <i class=\"wm-btn-small icon icon-chevron-end\" />\n          </button>\n          <button\n            class=\"btn bg-primary wm-btn\"\n            @click=\"clear\"\n          >\n            <t\n              class=\"wm-btn-large\"\n              k=\"wm.containerLogs.clear\"\n            />\n            <i class=\"wm-btn-small icon icon-close\" />\n          </button>\n          <AsyncButton\n            mode=\"download\"\n            @click=\"download\"\n          />\n        </div>\n\n        <div class=\"wm-seperator\" />\n\n        <div class=\"log-action log-previous ml-5\">\n          <div>\n            <Checkbox\n              :label=\"t('wm.containerLogs.previous')\"\n              :value=\"previous\"\n              @input=\"togglePrevious\"\n            />\n          </div>\n        </div>\n\n        <div class=\"log-action log-action-group ml-5\">\n          <v-popover\n            trigger=\"click\"\n            placement=\"top\"\n          >\n            <button class=\"btn bg-primary btn-cog\">\n              <i class=\"icon icon-gear\" />\n              <i class=\"icon icon-chevron-up\" />\n            </button>\n\n            <template slot=\"popover\">\n              <div class=\"filter-popup\">\n                <LabeledSelect\n                  v-model=\"range\"\n                  class=\"range\"\n                  :label=\"t('wm.containerLogs.range.label')\"\n                  :options=\"rangeOptions\"\n                  :clearable=\"false\"\n                  placement=\"top\"\n                  @input=\"toggleRange($event)\"\n                />\n                <div>\n                  <Checkbox\n                    :label=\"t('wm.containerLogs.wrap')\"\n                    :value=\"wrap\"\n                    @input=\"toggleWrap \"\n                  />\n                </div>\n                <div>\n                  <Checkbox\n                    :label=\"t('wm.containerLogs.timestamps')\"\n                    :value=\"timestamps\"\n                    @input=\"toggleTimestamps\"\n                  />\n                </div>\n              </div>\n            </template>\n          </v-popover>\n        </div>\n\n        <div class=\"log-action log-action-group ml-5\">\n          <input\n            v-model=\"search\"\n            class=\"input-sm\"\n            type=\"search\"\n            :placeholder=\"t('wm.containerLogs.search')\"\n          >\n        </div>\n\n        <div class=\"status log-action p-10\">\n          <t\n            :class=\"{'text-success': isOpen, 'text-error': !isOpen}\"\n            :k=\"isOpen ? 'wm.connection.connected' : 'wm.connection.disconnected'\"\n          />\n        </div>\n      </div>\n    </template>\n    <template #body>\n      <div\n        ref=\"body\"\n        :class=\"{'logs-container': true, 'open': isOpen, 'closed': !isOpen, 'show-times': timestamps && filtered.length, 'wrap-lines': wrap}\"\n      >\n        <VirtualList\n          v-show=\"filtered.length\"\n          ref=\"virtualList\"\n          data-key=\"id\"\n          :data-sources=\"filtered\"\n          :data-component=\"logItem\"\n          direction=\"vertical\"\n          class=\"virtual-list\"\n          :keeps=\"200\"\n          @scroll=\"updateFollowing\"\n        />\n        <template v-if=\"!filtered.length\">\n          <div v-if=\"search\">\n            <span class=\"msg text-muted\">{{ t('wm.containerLogs.noMatch') }}</span>\n          </div>\n          <div v-else>\n            <span class=\"msg text-muted\">{{ t('wm.containerLogs.noData') }}</span>\n          </div>\n        </template>\n      </div>\n    </template>\n  </Window>\n</template>\n\n<style lang=\"scss\" scoped>\n  .wm-button-bar {\n    display: flex;\n\n    .wm-seperator {\n      flex: 1;\n    }\n\n    .wm-btn-small {\n      display: none;\n      margin: 0;\n    }\n  }\n\n  .logs-container{\n    height: 100%;\n    overflow: auto;\n    padding: 5px;\n    background-color: var(--logs-bg);\n    font-family: Menlo,Consolas,monospace;\n    color: var(--logs-text);\n\n    .closed {\n      opacity: 0.25;\n    }\n\n    &.wrap-lines ::v-deep .msg {\n      white-space: pre-wrap;\n    }\n\n    &.show-times ::v-deep .time {\n      display: initial;\n      width: auto;\n    }\n\n  }\n\n  .containerPicker {\n    ::v-deep &.unlabeled-select {\n      display: inline-block;\n      min-width: 200px;\n      height: 30px;\n      min-height: 30px;\n      width: initial;\n    }\n  }\n\n  .log-action {\n    button {\n      border: 0 !important;\n      min-height: 30px;\n      line-height: 30px;\n    }\n\n    > input {\n      height: 30px;\n    }\n\n    .btn-cog {\n      padding: 0 5px;\n      > i {\n        margin: 0;\n      }\n    }\n  }\n\n  .log-action-group {\n    display: flex;\n    gap: 3px;\n\n    .input-sm {\n      min-width: 180px;\n    }\n  }\n\n  .log-previous {\n    align-items: center;\n    display: flex;\n    min-width: 175px;\n    height: 30px;\n    text-overflow : ellipsis;\n    overflow      : hidden;\n    white-space   : nowrap;\n  }\n\n  .status {\n    align-items: center;\n    display: flex;\n    justify-content: flex-end;\n    min-width: 105px;\n    height: 30px;\n  }\n\n  .filter-popup {\n    > * {\n      margin-bottom: 10px;\n    }\n  }\n\n  .virtual-list {\n    overflow-y: auto;\n    height:100%;\n  }\n\n  @media only screen and (max-width: 1060px) {\n    .wm-button-bar {\n      .wm-btn {\n        padding: 0 10px;\n\n        .wm-btn-large {\n          display: none;\n        }\n\n        .wm-btn-small {\n          display: inline;\n          margin: 0;\n        }\n      }\n    }\n  }\n</style>\n"]}]}