{"remainingRequest":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ubuntu/suseconf/node_modules/@rancher/shell/edit/networking.k8s.io.ingress/Rules.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/edit/networking.k8s.io.ingress/Rules.vue","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1725271300920}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IFdPUktMT0FEX1RZUEVTIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy90eXBlcyc7CmltcG9ydCBMb2FkaW5nIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL0xvYWRpbmcnOwppbXBvcnQgU29ydGFibGVUYWJsZSBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9Tb3J0YWJsZVRhYmxlJzsKaW1wb3J0IHsgX1ZJRVcgfSBmcm9tICdAc2hlbGwvY29uZmlnL3F1ZXJ5LXBhcmFtcyc7CmltcG9ydCBBcnJheUxpc3RHcm91cGVkIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vQXJyYXlMaXN0R3JvdXBlZCc7CmltcG9ydCB7IHJhbmRvbTMyIH0gZnJvbSAnQHNoZWxsL3V0aWxzL3N0cmluZyc7CmltcG9ydCBSdWxlIGZyb20gJy4vUnVsZSc7CgpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgQXJyYXlMaXN0R3JvdXBlZCwgTG9hZGluZywgUnVsZSwgU29ydGFibGVUYWJsZQogIH0sCgogIHByb3BzOiB7CiAgICB2YWx1ZTogewogICAgICB0eXBlOiAgICBPYmplY3QsCiAgICAgIGRlZmF1bHQ6ICgpID0+IHt9CiAgICB9LAoKICAgIG1vZGU6IHsKICAgICAgdHlwZTogICAgU3RyaW5nLAogICAgICBkZWZhdWx0OiAnZWRpdCcKICAgIH0sCgogICAgY2VydGlmaWNhdGVzOiB7CiAgICAgIHR5cGU6ICAgIEFycmF5LAogICAgICBkZWZhdWx0OiAoKSA9PiBbXQogICAgfSwKCiAgICBzZXJ2aWNlVGFyZ2V0czogewogICAgICB0eXBlOiAgICBBcnJheSwKICAgICAgZGVmYXVsdDogKCkgPT4gW10KICAgIH0sCgogICAgcnVsZXM6IHsKICAgICAgZGVmYXVsdDogKCkgPT4gKHsKICAgICAgICByZXF1ZXN0SG9zdDogW10sCiAgICAgICAgcGF0aDogICAgICAgIFtdLAogICAgICAgIHBvcnQ6ICAgICAgICBbXSwKICAgICAgICB0YXJnZXQ6ICAgICAgW10KICAgICAgfSksCiAgICAgIHR5cGU6IE9iamVjdCwKICAgIH0KICB9LAoKICBhc3luYyBmZXRjaCgpIHsKICAgIGlmICghdGhpcy4kc3RvcmUuZ2V0dGVyc1tgY2x1c3Rlci9wYWdpbmF0aW9uRW5hYmxlZGBdKCkpIHsKICAgICAgLy8gVGhpcyBpcyBvbmx5IHVzZWQgYnkgc2hlbGwvbW9kZWxzL25ldHdvcmtpbmcuazhzLmlvLmluZ3Jlc3MuanMgYHRhcmdldFRvYCwgd2hlcmUgd2UgZG8gc29tZSBkb2RneSBtYXRjaGluZyBvZiB3b3JrbG9hZHMgd2l0aCBuYW1lICdpbmdyZXNzLScKICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoT2JqZWN0LnZhbHVlcyhXT1JLTE9BRF9UWVBFUykubWFwKCh0eXBlKSA9PiB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnY2x1c3Rlci9maW5kQWxsJywgeyB0eXBlIH0pKSk7CiAgICB9CiAgfSwKCiAgYmVmb3JlVXBkYXRlKCkgewogICAgZm9yIChjb25zdCBydWxlIG9mIHRoaXMudmFsdWUuc3BlYy5ydWxlcykgewogICAgICBpZiAoIXJ1bGUudktleSkgewogICAgICAgIHRoaXMuJHNldChydWxlLCAndktleScsIHJhbmRvbTMyKDEpKTsKICAgICAgfQogICAgfQogIH0sCgogIGNvbXB1dGVkOiB7CiAgICB3b3JrbG9hZHMoKSB7CiAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKFdPUktMT0FEX1RZUEVTKS5mbGF0TWFwKCh0eXBlKSA9PiB0aGlzLiRzdG9yZS5nZXR0ZXJzWydjbHVzdGVyL2FsbCddKHR5cGUpKTsKICAgIH0sCiAgICBpc1ZpZXcoKSB7CiAgICAgIHJldHVybiB0aGlzLm1vZGUgPT09IF9WSUVXOwogICAgfSwKICAgIHJ1bGVIZWFkZXJzKCkgewogICAgICBjb25zdCBoZWFkZXJzID0gWwogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICAgICAgJ2Z1bGxQYXRoJywKICAgICAgICAgIGxhYmVsOiAgICAgdGhpcy50KCdpbmdyZXNzLnJ1bGVzLmhlYWRlcnMucGF0aCcpLAogICAgICAgICAgdmFsdWU6ICAgICAnJywKICAgICAgICAgIGZvcm1hdHRlcjogJ0luZ3Jlc3NGdWxsUGF0aCcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICAgICAgICAgICd0YXJnZXQnLAogICAgICAgICAgbGFiZWw6ICAgICAgICAgdGhpcy50KCdpbmdyZXNzLnJ1bGVzLmhlYWRlcnMudGFyZ2V0JyksCiAgICAgICAgICBmb3JtYXR0ZXI6ICAgICAnTGluaycsCiAgICAgICAgICBmb3JtYXR0ZXJPcHRzOiB7CiAgICAgICAgICAgIG9wdGlvbnM6IHsgaW50ZXJuYWw6IHRydWUgfSwgdXJsS2V5OiAndGFyZ2V0TGluay50bycsIGxhYmVsS2V5OiAnc2VydmljZU5hbWUnCiAgICAgICAgICB9LAogICAgICAgICAgdmFsdWU6ICd0YXJnZXRMaW5rJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICAncG9ydCcsCiAgICAgICAgICBsYWJlbDogdGhpcy50KCdpbmdyZXNzLnJ1bGVzLmhlYWRlcnMucG9ydCcpLAogICAgICAgICAgdmFsdWU6ICdwb3J0JywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICAgICAgJ2NlcnRzJywKICAgICAgICAgIGxhYmVsOiAgICAgdGhpcy50KCdpbmdyZXNzLnJ1bGVzLmhlYWRlcnMuY2VydGlmaWNhdGVzJyksCiAgICAgICAgICB2YWx1ZTogICAgICdjZXJ0cycsCiAgICAgICAgICBmb3JtYXR0ZXI6ICdMaXN0TGluaycsCiAgICAgICAgfSwKICAgICAgXTsKCiAgICAgIGlmICh0aGlzLnZhbHVlLnNob3dQYXRoVHlwZSkgewogICAgICAgIGhlYWRlcnMudW5zaGlmdCh7CiAgICAgICAgICBuYW1lOiAgJ3BhdGhUeXBlJywKICAgICAgICAgIGxhYmVsOiB0aGlzLnQoJ2luZ3Jlc3MucnVsZXMuaGVhZGVycy5wYXRoVHlwZScpLAogICAgICAgICAgdmFsdWU6ICdwYXRoVHlwZScsCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBoZWFkZXJzOwogICAgfSwKICAgIHJvd3MoKSB7CiAgICAgIHJldHVybiB0aGlzLnZhbHVlLmNyZWF0ZVJ1bGVzRm9yTGlzdFBhZ2UodGhpcy53b3JrbG9hZHMsIHRoaXMuY2VydGlmaWNhdGVzKTsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIG9uQWRkKCkgewogICAgICBpZiAodGhpcy4kcmVmcy5sYXN0UnVsZT8uZm9jdXMpIHsKICAgICAgICB0aGlzLiRyZWZzLmxhc3RSdWxlLmZvY3VzKCk7CiAgICAgIH0KICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["Rules.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Rules.vue","sourceRoot":"node_modules/@rancher/shell/edit/networking.k8s.io.ingress","sourcesContent":["<script>\nimport { WORKLOAD_TYPES } from '@shell/config/types';\nimport Loading from '@shell/components/Loading';\nimport SortableTable from '@shell/components/SortableTable';\nimport { _VIEW } from '@shell/config/query-params';\nimport ArrayListGrouped from '@shell/components/form/ArrayListGrouped';\nimport { random32 } from '@shell/utils/string';\nimport Rule from './Rule';\n\nexport default {\n  components: {\n    ArrayListGrouped, Loading, Rule, SortableTable\n  },\n\n  props: {\n    value: {\n      type:    Object,\n      default: () => {}\n    },\n\n    mode: {\n      type:    String,\n      default: 'edit'\n    },\n\n    certificates: {\n      type:    Array,\n      default: () => []\n    },\n\n    serviceTargets: {\n      type:    Array,\n      default: () => []\n    },\n\n    rules: {\n      default: () => ({\n        requestHost: [],\n        path:        [],\n        port:        [],\n        target:      []\n      }),\n      type: Object,\n    }\n  },\n\n  async fetch() {\n    if (!this.$store.getters[`cluster/paginationEnabled`]()) {\n      // This is only used by shell/models/networking.k8s.io.ingress.js `targetTo`, where we do some dodgy matching of workloads with name 'ingress-'\n      await Promise.all(Object.values(WORKLOAD_TYPES).map((type) => this.$store.dispatch('cluster/findAll', { type })));\n    }\n  },\n\n  beforeUpdate() {\n    for (const rule of this.value.spec.rules) {\n      if (!rule.vKey) {\n        this.$set(rule, 'vKey', random32(1));\n      }\n    }\n  },\n\n  computed: {\n    workloads() {\n      return Object.values(WORKLOAD_TYPES).flatMap((type) => this.$store.getters['cluster/all'](type));\n    },\n    isView() {\n      return this.mode === _VIEW;\n    },\n    ruleHeaders() {\n      const headers = [\n        {\n          name:      'fullPath',\n          label:     this.t('ingress.rules.headers.path'),\n          value:     '',\n          formatter: 'IngressFullPath'\n        },\n        {\n          name:          'target',\n          label:         this.t('ingress.rules.headers.target'),\n          formatter:     'Link',\n          formatterOpts: {\n            options: { internal: true }, urlKey: 'targetLink.to', labelKey: 'serviceName'\n          },\n          value: 'targetLink',\n        },\n        {\n          name:  'port',\n          label: this.t('ingress.rules.headers.port'),\n          value: 'port',\n        },\n        {\n          name:      'certs',\n          label:     this.t('ingress.rules.headers.certificates'),\n          value:     'certs',\n          formatter: 'ListLink',\n        },\n      ];\n\n      if (this.value.showPathType) {\n        headers.unshift({\n          name:  'pathType',\n          label: this.t('ingress.rules.headers.pathType'),\n          value: 'pathType',\n        });\n      }\n\n      return headers;\n    },\n    rows() {\n      return this.value.createRulesForListPage(this.workloads, this.certificates);\n    }\n  },\n  methods: {\n    onAdd() {\n      if (this.$refs.lastRule?.focus) {\n        this.$refs.lastRule.focus();\n      }\n    }\n  }\n};\n</script>\n\n<template>\n  <Loading v-if=\"$fetchState.pending\" />\n  <div v-else-if=\"isView\">\n    <SortableTable\n      :rows=\"rows\"\n      :headers=\"ruleHeaders\"\n      key-field=\"_key\"\n      :search=\"false\"\n      :table-actions=\"false\"\n      :row-actions=\"false\"\n    />\n  </div>\n  <div v-else>\n    <ArrayListGrouped\n      v-model=\"value.spec.rules\"\n      :add-label=\"t('ingress.rules.addRule')\"\n      :default-add-value=\"{}\"\n      :mode=\"mode\"\n      @add=\"onAdd\"\n    >\n      <template #default=\"props\">\n        <Rule\n          ref=\"lastRule\"\n          :key=\"props.row.value.vKey\"\n          v-model=\"props.row.value\"\n          :service-targets=\"serviceTargets\"\n          :ingress=\"value\"\n          :rules=\"rules\"\n        />\n      </template>\n    </ArrayListGrouped>\n  </div>\n</template>\n"]}]}