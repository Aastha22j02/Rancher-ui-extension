{"remainingRequest":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ubuntu/suseconf/node_modules/@rancher/shell/edit/resources.cattle.io.restore.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/edit/resources.cattle.io.restore.vue","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1725271300920}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBDcnVSZXNvdXJjZSBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9DcnVSZXNvdXJjZSc7CmltcG9ydCBjcmVhdGVFZGl0VmlldyBmcm9tICdAc2hlbGwvbWl4aW5zL2NyZWF0ZS1lZGl0LXZpZXcnOwppbXBvcnQgeyBMYWJlbGVkSW5wdXQgfSBmcm9tICdAY29tcG9uZW50cy9Gb3JtL0xhYmVsZWRJbnB1dCc7CmltcG9ydCBVbml0SW5wdXQgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvZm9ybS9Vbml0SW5wdXQnOwppbXBvcnQgeyBDaGVja2JveCB9IGZyb20gJ0Bjb21wb25lbnRzL0Zvcm0vQ2hlY2tib3gnOwppbXBvcnQgTGFiZWxlZFNlbGVjdCBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtL0xhYmVsZWRTZWxlY3QnOwppbXBvcnQgTG9hZGluZyBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9Mb2FkaW5nJzsKaW1wb3J0IHsgUmFkaW9Hcm91cCB9IGZyb20gJ0Bjb21wb25lbnRzL0Zvcm0vUmFkaW8nOwppbXBvcnQgUzMgZnJvbSAnQHNoZWxsL2NoYXJ0L3JhbmNoZXItYmFja3VwL1MzJzsKaW1wb3J0IHsgbWFwR2V0dGVycyB9IGZyb20gJ3Z1ZXgnOwppbXBvcnQgeyBTRUNSRVQsIEJBQ0tVUF9SRVNUT1JFLCBDQVRBTE9HIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy90eXBlcyc7CmltcG9ydCB7IGFsbEhhc2ggfSBmcm9tICdAc2hlbGwvdXRpbHMvcHJvbWlzZSc7CmltcG9ydCB7IGdldCB9IGZyb20gJ0BzaGVsbC91dGlscy9vYmplY3QnOwppbXBvcnQgeyBfQ1JFQVRFIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy9xdWVyeS1wYXJhbXMnOwppbXBvcnQgeyBmb3JtYXRFbmNyeXB0aW9uU2VjcmV0TmFtZXMgfSBmcm9tICdAc2hlbGwvdXRpbHMvZm9ybWF0dGVyJzsKaW1wb3J0IHsgRmlsdGVyQXJncywgUGFnaW5hdGlvblBhcmFtRmlsdGVyIH0gZnJvbSAnQHNoZWxsL3R5cGVzL3N0b3JlL3BhZ2luYXRpb24udHlwZXMnOwppbXBvcnQgeyBTRUNSRVRfVFlQRVMgfSBmcm9tICdAc2hlbGwvY29uZmlnL3NlY3JldCc7CgpleHBvcnQgZGVmYXVsdCB7CgogIGNvbXBvbmVudHM6IHsKICAgIENydVJlc291cmNlLAogICAgVW5pdElucHV0LAogICAgTGFiZWxlZElucHV0LAogICAgQ2hlY2tib3gsCiAgICBTMywKICAgIExhYmVsZWRTZWxlY3QsCiAgICBMb2FkaW5nLAogICAgUmFkaW9Hcm91cCwKICB9LAoKICBtaXhpbnM6IFtjcmVhdGVFZGl0Vmlld10sCgogIHByb3BzOiB7CiAgICB2YWx1ZTogewogICAgICB0eXBlOiAgICBPYmplY3QsCiAgICAgIGRlZmF1bHQ6ICgpID0+IHsKICAgICAgICByZXR1cm4ge307CiAgICAgIH0KICAgIH0sCiAgICBtb2RlOiB7CiAgICAgIHR5cGU6ICAgIFN0cmluZywKICAgICAgZGVmYXVsdDogJ2NyZWF0ZScKICAgIH0KICB9LAoKICBhc3luYyBmZXRjaCgpIHsKICAgIGNvbnN0IGhhc2ggPSBhd2FpdCBhbGxIYXNoKHsKICAgICAgY2F0YWxvZzogICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdjYXRhbG9nL2xvYWQnKSwKICAgICAgcmVzb3VyY2VTZXQ6IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdjbHVzdGVyL2ZpbmQnLCB7IHR5cGU6IEJBQ0tVUF9SRVNUT1JFLlJFU09VUkNFX1NFVCwgaWQ6IHRoaXMudmFsdWU/LnNwZWM/LnJlc291cmNlU2V0TmFtZSB8fCAncmFuY2hlci1yZXNvdXJjZS1zZXQnIH0pLAogICAgICBhcHBzOiAgICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2NsdXN0ZXIvZmluZEFsbCcsIHsgdHlwZTogQ0FUQUxPRy5BUFAgfSkKICAgIH0pOwoKICAgIHRoaXMuYXBwcyA9IGhhc2guYXBwczsKICAgIHRoaXMucmVzb3VyY2VTZXQgPSBoYXNoLnJlc291cmNlU2V0OwoKICAgIGNvbnN0IEJST1JlbGVhc2UgPSB0aGlzLmFwcHMuZmlsdGVyKChyZWxlYXNlKSA9PiBnZXQocmVsZWFzZSwgJ3NwZWMubmFtZScpID09PSAncmFuY2hlci1iYWNrdXAnKVswXTsKCiAgICB0aGlzLmNoYXJ0TmFtZXNwYWNlID0gQlJPUmVsZWFzZT8uc3BlYy5uYW1lc3BhY2UgfHwgJyc7CgogICAgaWYgKHRoaXMuJHN0b3JlLmdldHRlcnNbYGNsdXN0ZXIvcGFnaW5hdGlvbkVuYWJsZWRgXShTRUNSRVQpKSB7CiAgICAgIGNvbnN0IGZpbmRQYWdlQXJncyA9IHsgLy8gT2YgdHlwZSBBY3Rpb25GaW5kUGFnZUFyZ3MKICAgICAgICBuYW1lc3BhY2VkOiB0aGlzLmNoYXJ0TmFtZXNwYWNlLAogICAgICAgIHBhZ2luYXRpb246IG5ldyBGaWx0ZXJBcmdzKHsKICAgICAgICAgIGZpbHRlcnM6IFBhZ2luYXRpb25QYXJhbUZpbHRlci5jcmVhdGVTaW5nbGVGaWVsZCh7CiAgICAgICAgICAgIGZpZWxkOiAnbWV0YWRhdGEuZmllbGRzLjEnLAogICAgICAgICAgICB2YWx1ZTogU0VDUkVUX1RZUEVTLk9QQVFVRQogICAgICAgICAgfSkKICAgICAgICB9KSwKICAgICAgfTsKCiAgICAgIGNvbnN0IHVybCA9IHRoaXMuJHN0b3JlLmdldHRlcnNbYGNsdXN0ZXIvdXJsRm9yYF0oU0VDUkVULCBudWxsLCBmaW5kUGFnZUFyZ3MpOwogICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaChgY2x1c3Rlci9yZXF1ZXN0YCwgeyB1cmwgfSk7CgogICAgICB0aGlzLnNlY3JldHMgPSByZXM/LmRhdGEgfHwgW107CiAgICB9IGVsc2UgewogICAgICB0aGlzLnNlY3JldHMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnY2x1c3Rlci9maW5kQWxsJywgeyB0eXBlOiBTRUNSRVQgfSk7CiAgICB9CiAgfSwKCiAgZGF0YSgpIHsKICAgIGlmICghdGhpcy52YWx1ZS5zcGVjKSB7CiAgICAgIHRoaXMuJHNldCh0aGlzLnZhbHVlLCAnc3BlYycsIHsgcHJ1bmU6IHRydWUsIGRlbGV0ZVRpbWVvdXRTZWNvbmRzOiAxMCB9KTsKICAgIH0KCiAgICBpZiAoIXRoaXMudmFsdWUubWV0YWRhdGEubmFtZSkgewogICAgICB0aGlzLnZhbHVlLm1ldGFkYXRhLmdlbmVyYXRlTmFtZSA9ICdyZXN0b3JlLSc7CiAgICB9CgogICAgbGV0IHMzID0ge307CiAgICBsZXQgc3RvcmFnZVNvdXJjZSA9ICd1c2VEZWZhdWx0JzsKCiAgICBpZiAodGhpcy52YWx1ZT8uc3BlYz8uc3RvcmFnZUxvY2F0aW9uPy5zMykgewogICAgICBzdG9yYWdlU291cmNlID0gJ2NvbmZpZ3VyZVMzJzsKICAgICAgczMgPSB0aGlzLnZhbHVlLnNwZWMuc3RvcmFnZUxvY2F0aW9uLnMzOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIHNlY3JldHM6ICAgICAgICBbXSwKICAgICAgYWxsQmFja3VwczogICAgIFtdLAogICAgICBzMywKICAgICAgdGFyZ2V0QmFja3VwOiAgIG51bGwsCiAgICAgIHN0b3JhZ2VTb3VyY2UsCiAgICAgIGFwcHM6ICAgICAgICAgICBbXSwKICAgICAgY2hhcnROYW1lc3BhY2U6IG51bGwsCiAgICB9OwogIH0sCgogIGNvbXB1dGVkOiB7CiAgICBpc0Nsb25lKCkgewogICAgICByZXR1cm4gdGhpcy5tb2RlID09PSBfQ1JFQVRFICYmICEhdGhpcy5saXZlVmFsdWUuaWQ7CiAgICB9LAoKICAgIGF2YWlsYWJsZUJhY2t1cHMoKSB7CiAgICAgIHJldHVybiB0aGlzLmFsbEJhY2t1cHMuZmlsdGVyKChiYWNrdXApID0+IGJhY2t1cC5zdGF0ZSAhPT0gJ2Vycm9yJyk7CiAgICB9LAoKICAgIGVuY3J5cHRpb25TZWNyZXROYW1lcygpIHsKICAgICAgcmV0dXJuIGZvcm1hdEVuY3J5cHRpb25TZWNyZXROYW1lcyh0aGlzLnNlY3JldHMsIHRoaXMuY2hhcnROYW1lc3BhY2UpOwogICAgfSwKCiAgICBpc0VuY3J5cHRlZCgpIHsKICAgICAgcmV0dXJuICEhKCh0aGlzLnZhbHVlLnNwZWMuYmFja3VwRmlsZW5hbWUgfHwgJycpLm1hdGNoKC8uKlwuZW5jJC8pKTsKICAgIH0sCgogICAgcmFkaW9PcHRpb25zKCkgewogICAgICBjb25zdCBvcHRpb25zID0gWyd1c2VEZWZhdWx0JywgJ2NvbmZpZ3VyZVMzJ107CiAgICAgIGNvbnN0IGxhYmVscyA9IFt0aGlzLnQoJ2JhY2t1cFJlc3RvcmVPcGVyYXRvci5yZXN0b3JlRnJvbS5kZWZhdWx0JyksIHRoaXMudCgnYmFja3VwUmVzdG9yZU9wZXJhdG9yLnJlc3RvcmVGcm9tLnMzJyldOwoKICAgICAgaWYgKHRoaXMuYXZhaWxhYmxlQmFja3Vwcy5sZW5ndGggfHwgdGhpcy5zdG9yYWdlU291cmNlID09PSAndXNlQmFja3VwJykgewogICAgICAgIG9wdGlvbnMudW5zaGlmdCgndXNlQmFja3VwJyk7CiAgICAgICAgbGFiZWxzLnVuc2hpZnQoIHRoaXMudCgnYmFja3VwUmVzdG9yZU9wZXJhdG9yLnJlc3RvcmVGcm9tLmV4aXN0aW5nJykpOwogICAgICB9CgogICAgICByZXR1cm4geyBvcHRpb25zLCBsYWJlbHMgfTsKICAgIH0sCgogICAgdmFsaWRhdGlvblBhc3NlZCgpIHsKICAgICAgY29uc3QgaGFzQmFja3VwRmlsZSA9ICghIXRoaXMudmFsdWUuc3BlYy5iYWNrdXBGaWxlbmFtZSAmJiAhIXRoaXMudmFsdWUuc3BlYy5iYWNrdXBGaWxlbmFtZS5sZW5ndGgpOwogICAgICBjb25zdCBoYXNFbmNyeXB0aW9uID0gISF0aGlzLnZhbHVlLnNwZWMuZW5jcnlwdGlvbkNvbmZpZ1NlY3JldE5hbWU7CgogICAgICBpZiAoIWhhc0JhY2t1cEZpbGUpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiAhdGhpcy5pc0VuY3J5cHRlZCB8fCBoYXNFbmNyeXB0aW9uOwogICAgfSwKCiAgICB0YXJnZXRCYWNrdXBGaWxlbmFtZSgpIHsKICAgICAgcmV0dXJuIGdldCh0aGlzLnRhcmdldEJhY2t1cCwgJ3N0YXR1cy5maWxlbmFtZScpOwogICAgfSwKCiAgICAuLi5tYXBHZXR0ZXJzKHsgdDogJ2kxOG4vdCcgfSkKICB9LAoKICB3YXRjaDogewogICAgc3RvcmFnZVNvdXJjZShuZXUsIG9sZCkgewogICAgICBpZiAobmV1ID09PSAndXNlRGVmYXVsdCcpIHsKICAgICAgICBkZWxldGUgdGhpcy52YWx1ZS5zcGVjLnN0b3JhZ2VMb2NhdGlvbjsKICAgICAgICBkZWxldGUgdGhpcy52YWx1ZS5zcGVjLmJhY2t1cEZpbGVuYW1lOwogICAgICB9IGVsc2UgaWYgKCF0aGlzLnZhbHVlLnNwZWMuc3RvcmFnZUxvY2F0aW9uICYmIG5ldSA9PT0gJ2NvbmZpZ3VyZVMzJykgewogICAgICAgIHRoaXMuJHNldCh0aGlzLnZhbHVlLnNwZWMsICdzdG9yYWdlTG9jYXRpb24nLCB7IHMzOiB7fSB9KTsKICAgICAgICB0aGlzLnMzID0gdGhpcy52YWx1ZS5zcGVjLnN0b3JhZ2VMb2NhdGlvbi5zMzsKICAgICAgfQogICAgICBpZiAobmV1ID09PSAndXNlQmFja3VwJykgewogICAgICAgIGRlbGV0ZSB0aGlzLnZhbHVlLnNwZWMuc3RvcmFnZUxvY2F0aW9uOwoKICAgICAgICBpZiAodGhpcy5hdmFpbGFibGVCYWNrdXBzLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgdGhpcy51cGRhdGVUYXJnZXRCYWNrdXAodGhpcy5hdmFpbGFibGVCYWNrdXBzWzBdKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGVsZXRlIHRoaXMudmFsdWUuc3BlYy5iYWNrdXBGaWxlbmFtZTsKICAgICAgICB0aGlzLnZhbHVlLnNwZWMuc3RvcmFnZUxvY2F0aW9uID0geyBzMzogdGhpcy5zMyB9OwogICAgICB9CiAgICB9LAoKICAgIGF2YWlsYWJsZUJhY2t1cHMobmV1LCBvbGQpIHsKICAgICAgaWYgKChuZXUubGVuZ3RoICYmICFvbGQubGVuZ3RoKSAmJiAhdGhpcy5pc0Nsb25lICYmIHRoaXMubW9kZSAhPT0gJ3ZpZXcnKSB7CiAgICAgICAgdGhpcy5zdG9yYWdlU291cmNlID0gJ3VzZUJhY2t1cCc7CiAgICAgIH0KICAgIH0sCgogICAgdGFyZ2V0QmFja3VwRmlsZW5hbWUobmV1KSB7CiAgICAgIHRoaXMudmFsdWUuc3BlYy5iYWNrdXBGaWxlbmFtZSA9IG5ldTsKICAgIH0KICB9LAoKICBtZXRob2RzOiB7CiAgICB1cGRhdGVUYXJnZXRCYWNrdXAobmV1KSB7CiAgICAgIGNvbnN0IG91dCA9IHsgYmFja3VwRmlsZW5hbWU6IG5ldT8uc3RhdHVzPy5maWxlbmFtZSB9OwoKICAgICAgaWYgKG5ldT8uc3BlYz8uc3RvcmFnZUxvY2F0aW9uPy5zMykgewogICAgICAgIG91dC5zdG9yYWdlTG9jYXRpb24gPSBuZXUuc3BlYy5zdG9yYWdlTG9jYXRpb247CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGVsZXRlIHRoaXMudmFsdWUuc3BlYy5zdG9yYWdlTG9jYXRpb247CiAgICAgIH0KICAgICAgaWYgKG5ldS5zcGVjLmVuY3J5cHRpb25Db25maWdTZWNyZXROYW1lICYmIHRoaXMuZW5jcnlwdGlvblNlY3JldE5hbWVzLmluY2x1ZGVzKG5ldS5zcGVjLmVuY3J5cHRpb25Db25maWdTZWNyZXROYW1lKSkgewogICAgICAgIG91dC5lbmNyeXB0aW9uQ29uZmlnU2VjcmV0TmFtZSA9IG5ldS5zcGVjLmVuY3J5cHRpb25Db25maWdTZWNyZXROYW1lOwogICAgICB9CiAgICAgIHRoaXMuJHNldCh0aGlzLnZhbHVlLCAnc3BlYycsIHsgLi4udGhpcy52YWx1ZS5zcGVjLCAuLi5vdXQgfSk7CgogICAgICB0aGlzLnRhcmdldEJhY2t1cCA9IG5ldTsKICAgIH0KICB9Cgp9Owo="},{"version":3,"sources":["resources.cattle.io.restore.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA","file":"resources.cattle.io.restore.vue","sourceRoot":"node_modules/@rancher/shell/edit","sourcesContent":["<script>\nimport CruResource from '@shell/components/CruResource';\nimport createEditView from '@shell/mixins/create-edit-view';\nimport { LabeledInput } from '@components/Form/LabeledInput';\nimport UnitInput from '@shell/components/form/UnitInput';\nimport { Checkbox } from '@components/Form/Checkbox';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\nimport Loading from '@shell/components/Loading';\nimport { RadioGroup } from '@components/Form/Radio';\nimport S3 from '@shell/chart/rancher-backup/S3';\nimport { mapGetters } from 'vuex';\nimport { SECRET, BACKUP_RESTORE, CATALOG } from '@shell/config/types';\nimport { allHash } from '@shell/utils/promise';\nimport { get } from '@shell/utils/object';\nimport { _CREATE } from '@shell/config/query-params';\nimport { formatEncryptionSecretNames } from '@shell/utils/formatter';\nimport { FilterArgs, PaginationParamFilter } from '@shell/types/store/pagination.types';\nimport { SECRET_TYPES } from '@shell/config/secret';\n\nexport default {\n\n  components: {\n    CruResource,\n    UnitInput,\n    LabeledInput,\n    Checkbox,\n    S3,\n    LabeledSelect,\n    Loading,\n    RadioGroup,\n  },\n\n  mixins: [createEditView],\n\n  props: {\n    value: {\n      type:    Object,\n      default: () => {\n        return {};\n      }\n    },\n    mode: {\n      type:    String,\n      default: 'create'\n    }\n  },\n\n  async fetch() {\n    const hash = await allHash({\n      catalog:     this.$store.dispatch('catalog/load'),\n      resourceSet: this.$store.dispatch('cluster/find', { type: BACKUP_RESTORE.RESOURCE_SET, id: this.value?.spec?.resourceSetName || 'rancher-resource-set' }),\n      apps:        this.$store.dispatch('cluster/findAll', { type: CATALOG.APP })\n    });\n\n    this.apps = hash.apps;\n    this.resourceSet = hash.resourceSet;\n\n    const BRORelease = this.apps.filter((release) => get(release, 'spec.name') === 'rancher-backup')[0];\n\n    this.chartNamespace = BRORelease?.spec.namespace || '';\n\n    if (this.$store.getters[`cluster/paginationEnabled`](SECRET)) {\n      const findPageArgs = { // Of type ActionFindPageArgs\n        namespaced: this.chartNamespace,\n        pagination: new FilterArgs({\n          filters: PaginationParamFilter.createSingleField({\n            field: 'metadata.fields.1',\n            value: SECRET_TYPES.OPAQUE\n          })\n        }),\n      };\n\n      const url = this.$store.getters[`cluster/urlFor`](SECRET, null, findPageArgs);\n      const res = await this.$store.dispatch(`cluster/request`, { url });\n\n      this.secrets = res?.data || [];\n    } else {\n      this.secrets = await this.$store.dispatch('cluster/findAll', { type: SECRET });\n    }\n  },\n\n  data() {\n    if (!this.value.spec) {\n      this.$set(this.value, 'spec', { prune: true, deleteTimeoutSeconds: 10 });\n    }\n\n    if (!this.value.metadata.name) {\n      this.value.metadata.generateName = 'restore-';\n    }\n\n    let s3 = {};\n    let storageSource = 'useDefault';\n\n    if (this.value?.spec?.storageLocation?.s3) {\n      storageSource = 'configureS3';\n      s3 = this.value.spec.storageLocation.s3;\n    }\n\n    return {\n      secrets:        [],\n      allBackups:     [],\n      s3,\n      targetBackup:   null,\n      storageSource,\n      apps:           [],\n      chartNamespace: null,\n    };\n  },\n\n  computed: {\n    isClone() {\n      return this.mode === _CREATE && !!this.liveValue.id;\n    },\n\n    availableBackups() {\n      return this.allBackups.filter((backup) => backup.state !== 'error');\n    },\n\n    encryptionSecretNames() {\n      return formatEncryptionSecretNames(this.secrets, this.chartNamespace);\n    },\n\n    isEncrypted() {\n      return !!((this.value.spec.backupFilename || '').match(/.*\\.enc$/));\n    },\n\n    radioOptions() {\n      const options = ['useDefault', 'configureS3'];\n      const labels = [this.t('backupRestoreOperator.restoreFrom.default'), this.t('backupRestoreOperator.restoreFrom.s3')];\n\n      if (this.availableBackups.length || this.storageSource === 'useBackup') {\n        options.unshift('useBackup');\n        labels.unshift( this.t('backupRestoreOperator.restoreFrom.existing'));\n      }\n\n      return { options, labels };\n    },\n\n    validationPassed() {\n      const hasBackupFile = (!!this.value.spec.backupFilename && !!this.value.spec.backupFilename.length);\n      const hasEncryption = !!this.value.spec.encryptionConfigSecretName;\n\n      if (!hasBackupFile) {\n        return false;\n      }\n\n      return !this.isEncrypted || hasEncryption;\n    },\n\n    targetBackupFilename() {\n      return get(this.targetBackup, 'status.filename');\n    },\n\n    ...mapGetters({ t: 'i18n/t' })\n  },\n\n  watch: {\n    storageSource(neu, old) {\n      if (neu === 'useDefault') {\n        delete this.value.spec.storageLocation;\n        delete this.value.spec.backupFilename;\n      } else if (!this.value.spec.storageLocation && neu === 'configureS3') {\n        this.$set(this.value.spec, 'storageLocation', { s3: {} });\n        this.s3 = this.value.spec.storageLocation.s3;\n      }\n      if (neu === 'useBackup') {\n        delete this.value.spec.storageLocation;\n\n        if (this.availableBackups.length === 1) {\n          this.updateTargetBackup(this.availableBackups[0]);\n        }\n      } else {\n        delete this.value.spec.backupFilename;\n        this.value.spec.storageLocation = { s3: this.s3 };\n      }\n    },\n\n    availableBackups(neu, old) {\n      if ((neu.length && !old.length) && !this.isClone && this.mode !== 'view') {\n        this.storageSource = 'useBackup';\n      }\n    },\n\n    targetBackupFilename(neu) {\n      this.value.spec.backupFilename = neu;\n    }\n  },\n\n  methods: {\n    updateTargetBackup(neu) {\n      const out = { backupFilename: neu?.status?.filename };\n\n      if (neu?.spec?.storageLocation?.s3) {\n        out.storageLocation = neu.spec.storageLocation;\n      } else {\n        delete this.value.spec.storageLocation;\n      }\n      if (neu.spec.encryptionConfigSecretName && this.encryptionSecretNames.includes(neu.spec.encryptionConfigSecretName)) {\n        out.encryptionConfigSecretName = neu.spec.encryptionConfigSecretName;\n      }\n      this.$set(this.value, 'spec', { ...this.value.spec, ...out });\n\n      this.targetBackup = neu;\n    }\n  }\n\n};\n</script>\n\n<template>\n  <Loading v-if=\"$fetchState.pending\" />\n\n  <CruResource\n    v-else\n    :validation-passed=\"validationPassed\"\n    :done-route=\"doneRoute\"\n    :resource=\"value\"\n    :mode=\"mode\"\n    @finish=\"save\"\n  >\n    <template>\n      <div>\n        <div class=\"row mb-10\">\n          <div class=\"col span-12\">\n            <RadioGroup\n              v-model=\"storageSource\"\n              name=\"storageSource\"\n              :label=\"t('backupRestoreOperator.s3.titles.backupLocation')\"\n              :options=\"radioOptions.options\"\n              :labels=\"radioOptions.labels\"\n              :mode=\"mode\"\n            />\n          </div>\n        </div>\n        <template v-if=\"storageSource === 'configureS3'\">\n          <S3\n            v-model=\"s3\"\n            :mode=\"mode\"\n          />\n        </template>\n        <div\n          v-else-if=\"storageSource==='useBackup'\"\n          class=\"row mb-10\"\n        >\n          <div class=\"col span-6\">\n            <LabeledSelect\n              :disabled=\"!availableBackups.length\"\n              :value=\"targetBackup\"\n              :options=\"availableBackups\"\n              :mode=\"mode\"\n              option-label=\"metadata.name\"\n              :label=\"t('backupRestoreOperator.targetBackup')\"\n              @input=\"updateTargetBackup\"\n            />\n          </div>\n        </div>\n      </div>\n      <div class=\"spacer\" />\n\n      <div>\n        <div\n          :style=\"{'align-items':'center'}\"\n          class=\"row mb-10\"\n        >\n          <div class=\"col span-6\">\n            <LabeledInput\n              v-model=\"value.spec.backupFilename\"\n              :spellcheck=\"false\"\n              required\n              :mode=\"mode\"\n              :label=\"t('backupRestoreOperator.backupFilename')\"\n            />\n          </div>\n          <div class=\"col span-6\">\n            <LabeledSelect\n              v-if=\"isEncrypted\"\n              v-model=\"value.spec.encryptionConfigSecretName\"\n              :status=\"mode === 'view' ? null : 'warning'\"\n              :tooltip=\"mode === 'view' ? null : t('backupRestoreOperator.encryptionConfigName.restoretip')\"\n              :hover-tooltip=\"true\"\n              :mode=\"mode\"\n              :options=\"encryptionSecretNames\"\n              :label=\"t('backupRestoreOperator.encryptionConfigName.label')\"\n            />\n          </div>\n        </div>\n        <div\n          :style=\"{'align-items':'center'}\"\n          class=\"row\"\n        >\n          <div class=\"col span-6\">\n            <Checkbox\n              v-model=\"value.spec.prune\"\n              class=\"mb-5\"\n              :label=\"t('backupRestoreOperator.prune.label')\"\n              :mode=\"mode\"\n            >\n              <template #label>\n                <span\n                  v-clean-tooltip=\"t('backupRestoreOperator.prune.tip')\"\n                  class=\"text-label\"\n                >\n                  {{ t('backupRestoreOperator.prune.label') }} <i class=\"icon icon-info\" />\n                </span>\n              </template>\n            </Checkbox>\n            <UnitInput\n              v-if=\"value.spec.prune\"\n              v-model=\"value.spec.deleteTimeoutSeconds\"\n              :suffix=\"t('suffix.seconds', {count: value.spec.deleteTimeoutSeconds})\"\n              :mode=\"mode\"\n              :label=\"t('backupRestoreOperator.deleteTimeout.label')\"\n            >\n              <template #label>\n                <label\n                  v-clean-tooltip=\"t('backupRestoreOperator.deleteTimeout.tip')\"\n                  class=\"has-tooltip\"\n                >\n                  {{ t('backupRestoreOperator.deleteTimeout.label') }} <i class=\"icon icon-info\" />\n                </label>\n              </template>\n            </UnitInput>\n          </div>\n        </div>\n      </div>\n    </template>\n  </CruResource>\n</template>\n"]}]}