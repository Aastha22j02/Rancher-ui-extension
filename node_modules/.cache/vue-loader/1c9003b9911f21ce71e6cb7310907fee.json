{"remainingRequest":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ubuntu/suseconf/node_modules/@rancher/shell/pages/auth/setup.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/pages/auth/setup.vue","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1725271300920}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IHJhbmRvbVN0ciB9IGZyb20gJ0BzaGVsbC91dGlscy9zdHJpbmcnOwppbXBvcnQgeyBMYWJlbGVkSW5wdXQgfSBmcm9tICdAY29tcG9uZW50cy9Gb3JtL0xhYmVsZWRJbnB1dCc7CmltcG9ydCBDb3B5VG9DbGlwYm9hcmQgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvQ29weVRvQ2xpcGJvYXJkJzsKaW1wb3J0IEFzeW5jQnV0dG9uIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL0FzeW5jQnV0dG9uJzsKaW1wb3J0IHsgTE9HR0VEX09VVCwgU0VUVVAgfSBmcm9tICdAc2hlbGwvY29uZmlnL3F1ZXJ5LXBhcmFtcyc7CmltcG9ydCB7IE5PUk1BTiwgTUFOQUdFTUVOVCB9IGZyb20gJ0BzaGVsbC9jb25maWcvdHlwZXMnOwppbXBvcnQgeyBmaW5kQnkgfSBmcm9tICdAc2hlbGwvdXRpbHMvYXJyYXknOwppbXBvcnQgeyBDaGVja2JveCB9IGZyb20gJ0Bjb21wb25lbnRzL0Zvcm0vQ2hlY2tib3gnOwppbXBvcnQgeyBnZXRWZW5kb3IsIGdldFByb2R1Y3QsIHNldFZlbmRvciB9IGZyb20gJ0BzaGVsbC9jb25maWcvcHJpdmF0ZS1sYWJlbCc7CmltcG9ydCB7IFJhZGlvR3JvdXAgfSBmcm9tICdAY29tcG9uZW50cy9Gb3JtL1JhZGlvJzsKaW1wb3J0IHsgc2V0U2V0dGluZyB9IGZyb20gJ0BzaGVsbC91dGlscy9zZXR0aW5ncyc7CmltcG9ydCB7IFNFVFRJTkcgfSBmcm9tICdAc2hlbGwvY29uZmlnL3NldHRpbmdzJzsKaW1wb3J0IHsgaXNEZXZCdWlsZCB9IGZyb20gJ0BzaGVsbC91dGlscy92ZXJzaW9uJzsKaW1wb3J0IHsgZXhjZXB0aW9uVG9FcnJvcnNBcnJheSB9IGZyb20gJ0BzaGVsbC91dGlscy9lcnJvcic7CmltcG9ydCBQYXNzd29yZCBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtL1Bhc3N3b3JkJzsKaW1wb3J0IHsgYXBwbHlQcm9kdWN0cyB9IGZyb20gJ0BzaGVsbC9zdG9yZS90eXBlLW1hcCc7CmltcG9ydCBCcmFuZEltYWdlIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL0JyYW5kSW1hZ2UnOwppbXBvcnQgeyB3YWl0Rm9yIH0gZnJvbSAnQHNoZWxsL3V0aWxzL2FzeW5jJzsKaW1wb3J0IHsgQmFubmVyIH0gZnJvbSAnQGNvbXBvbmVudHMvQmFubmVyJzsKaW1wb3J0IEZvcm1WYWxpZGF0aW9uIGZyb20gJ0BzaGVsbC9taXhpbnMvZm9ybS12YWxpZGF0aW9uJzsKaW1wb3J0IGlzVXJsIGZyb20gJ2lzLXVybCc7CmltcG9ydCB7IGlzTG9jYWxob3N0IH0gZnJvbSAnQHNoZWxsL3V0aWxzL3ZhbGlkYXRvcnMvc2V0dGluZyc7CmltcG9ydCBMb2FkaW5nIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL0xvYWRpbmcnOwoKY29uc3QgY2FsY0lzRmlyc3RMb2dpbiA9IChzdG9yZSkgPT4gewogIGNvbnN0IGZpcnN0TG9naW5TZXR0aW5nID0gc3RvcmUuZ2V0dGVyc1snbWFuYWdlbWVudC9ieUlkJ10oTUFOQUdFTUVOVC5TRVRUSU5HLCBTRVRUSU5HLkZJUlNUX0xPR0lOKTsKCiAgcmV0dXJuIGZpcnN0TG9naW5TZXR0aW5nPy52YWx1ZSA9PT0gJ3RydWUnOwp9OwoKY29uc3QgY2FsY011c3RDaGFuZ2VQYXNzd29yZCA9IGFzeW5jKHN0b3JlKSA9PiB7CiAgYXdhaXQgc3RvcmUuZGlzcGF0Y2goJ2F1dGgvZ2V0VXNlcicpOwoKICBjb25zdCBvdXQgPSBzdG9yZS5nZXR0ZXJzWydhdXRoL3YzVXNlciddPy5tdXN0Q2hhbmdlUGFzc3dvcmQ7CgogIHJldHVybiBvdXQ7Cn07CgpleHBvcnQgZGVmYXVsdCB7CiAgbWl4aW5zOiBbRm9ybVZhbGlkYXRpb25dLAoKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcGFzc3dvcmRPcHRpb25zOiBbCiAgICAgICAgeyBsYWJlbDogdGhpcy50KCdzZXR1cC51c2VSYW5kb20nKSwgdmFsdWU6IHRydWUgfSwKICAgICAgICB7IGxhYmVsOiB0aGlzLnQoJ3NldHVwLnVzZU1hbnVhbCcpLCB2YWx1ZTogZmFsc2UgfV0sCiAgICAgIGZ2Rm9ybVJ1bGVTZXRzOiBbewogICAgICAgIHBhdGg6ICAgICAgICdzZXJ2ZXJVcmwnLAogICAgICAgIHJvb3RPYmplY3Q6IHRoaXMsCiAgICAgICAgcnVsZXM6ICAgICAgWydyZXF1aXJlZCcsICdodHRwcycsICd1cmwnLCAndHJhaWxpbmdGb3J3YXJkU2xhc2gnXQogICAgICB9XSwKICAgICAgcHJvZHVjdE5hbWU6ICcnLAogICAgICB2ZW5kb3I6ICAgICAgZ2V0VmVuZG9yKCksCiAgICAgIHByb2R1Y3Q6ICAgICBnZXRQcm9kdWN0KCksCiAgICAgIHN0ZXA6ICAgICAgICBwYXJzZUludCh0aGlzLiRyb3V0ZS5xdWVyeS5zdGVwLCAxMCkgfHwgMSwKCiAgICAgIHVzZVJhbmRvbTogICAgICAgICAgdHJ1ZSwKICAgICAgaGF2ZUN1cnJlbnQ6ICAgICAgICBmYWxzZSwKICAgICAgdXNlcm5hbWU6ICAgICAgICAgICBudWxsLAogICAgICBpc0ZpcnN0TG9naW46ICAgICAgIGZhbHNlLAogICAgICBtdXN0Q2hhbmdlUGFzc3dvcmQ6IGZhbHNlLAogICAgICBjdXJyZW50OiAgICAgICAgICAgIG51bGwsCiAgICAgIHBhc3N3b3JkOiAgICAgICAgICAgcmFuZG9tU3RyKCksCiAgICAgIGNvbmZpcm06ICAgICAgICAgICAgbnVsbCwKICAgICAgdjNVc2VyOiAgICAgICAgICAgICBudWxsLAogICAgICBzZXJ2ZXJVcmw6ICAgICAgICAgIG51bGwsCiAgICAgIG1jbUVuYWJsZWQ6ICAgICAgICAgbnVsbCwKICAgICAgdGVsZW1ldHJ5OiAgICAgICAgICBudWxsLAogICAgICBldWxhOiAgICAgICAgICAgICAgIGZhbHNlLAogICAgICBwcmluY2lwYWxzOiAgICAgICAgIG51bGwsCiAgICAgIGVycm9yczogICAgICAgICAgICAgW10KICAgIH07CiAgfSwKCiAgYXN5bmMgbWlkZGxld2FyZSh7IHN0b3JlLCByZWRpcmVjdCB9ICkgewogICAgY29uc3QgaXNGaXJzdExvZ2luID0gY2FsY0lzRmlyc3RMb2dpbihzdG9yZSk7CiAgICBjb25zdCBtdXN0Q2hhbmdlUGFzc3dvcmQgPSBhd2FpdCBjYWxjTXVzdENoYW5nZVBhc3N3b3JkKHN0b3JlKTsKCiAgICBpZiAoaXNGaXJzdExvZ2luKSB7CiAgICAgIC8vIEFsd2F5cyBzaG93IHNldHVwIGlmIHRoaXMgaXMgdGhlIGZpcnN0IGxvZyBpbgogICAgICByZXR1cm47CiAgICB9IGVsc2UgaWYgKG11c3RDaGFuZ2VQYXNzd29yZCkgewogICAgICAvLyBJZiB0aGUgcGFzc3dvcmQgbmVlZHMgY2hhbmdpbmcgYW5kIHRoaXMgaXNuJ3QgdGhlIGZpcnN0IGxvZyBpbiBlbnN1cmUgd2UgaGF2ZSB0aGUgcGFzc3dvcmQKICAgICAgaWYgKCEhc3RvcmUuZ2V0dGVyc1snYXV0aC9pbml0aWFsUGFzcyddKSB7CiAgICAgICAgLy8gR290IGl0Li4uIHNob3cgc2V0dXAKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgLy8gSGF2ZW4ndCBnb3QgaXQuLi4gcmVkaXJlY3QgdG8gbG9nIGluIHNvIHdlIGdldCBpdAogICAgICBhd2FpdCBzdG9yZS5kaXNwYXRjaCgnYXV0aC9sb2dvdXQnLCBudWxsLCB7IHJvb3Q6IHRydWUgfSk7CgogICAgICByZXR1cm4gcmVkaXJlY3QoMzAyLCBgL2F1dGgvbG9naW4/JHsgTE9HR0VEX09VVCB9YCk7CiAgICB9CgogICAgLy8gRm9yIGFsbCBvdGhlciBjYXNlcyB3ZSBkb24ndCBuZWVkIHRvIHNob3cgc2V0dXAKICAgIHJldHVybiByZWRpcmVjdCgnLycpOwogIH0sCgogIGNvbXBvbmVudHM6IHsKICAgIEFzeW5jQnV0dG9uLCBMYWJlbGVkSW5wdXQsIENvcHlUb0NsaXBib2FyZCwgQ2hlY2tib3gsIFJhZGlvR3JvdXAsIFBhc3N3b3JkLCBCcmFuZEltYWdlLCBCYW5uZXIsIExvYWRpbmcKICB9LAoKICBhc3luYyBmZXRjaCgpIHsKICAgIGNvbnN0IHRlbGVtZXRyeVNldHRpbmcgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzWydtYW5hZ2VtZW50L2J5SWQnXShNQU5BR0VNRU5ULlNFVFRJTkcsIFNFVFRJTkcuVEVMRU1FVFJZKTsKICAgIGNvbnN0IHNlcnZlclVybFNldHRpbmcgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzWydtYW5hZ2VtZW50L2J5SWQnXShNQU5BR0VNRU5ULlNFVFRJTkcsIFNFVFRJTkcuU0VSVkVSX1VSTCk7CiAgICBjb25zdCByYW5jaGVyVmVyc2lvblNldHRpbmcgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzWydtYW5hZ2VtZW50L2J5SWQnXShNQU5BR0VNRU5ULlNFVFRJTkcsIFNFVFRJTkcuVkVSU0lPTl9SQU5DSEVSKTsKICAgIGxldCB0ZWxlbWV0cnkgPSB0cnVlOwoKICAgIGlmICh0ZWxlbWV0cnlTZXR0aW5nPy52YWx1ZSAmJiB0ZWxlbWV0cnlTZXR0aW5nLnZhbHVlICE9PSAncHJvbXB0JykgewogICAgICB0ZWxlbWV0cnkgPSB0ZWxlbWV0cnlTZXR0aW5nLnZhbHVlICE9PSAnb3V0JzsKICAgIH0gZWxzZSBpZiAoIXJhbmNoZXJWZXJzaW9uU2V0dGluZz8udmFsdWUgfHwgaXNEZXZCdWlsZChyYW5jaGVyVmVyc2lvblNldHRpbmc/LnZhbHVlKSkgewogICAgICB0ZWxlbWV0cnkgPSBmYWxzZTsKICAgIH0KCiAgICBsZXQgcGxTZXR0aW5nOwoKICAgIHRyeSB7CiAgICAgIHBsU2V0dGluZyA9IHRoaXMuJHN0b3JlLmdldHRlcnNbJ21hbmFnZW1lbnQvYnlJZCddKE1BTkFHRU1FTlQuU0VUVElORywgU0VUVElORy5QTCk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIC8vIE9sZGVyIHZlcnNpb25zIHVzZWQgTm9ybWFuIEFQSSB0byBnZXQgdGhlc2UKICAgICAgcGxTZXR0aW5nID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3JhbmNoZXIvZmluZCcsIHsKICAgICAgICB0eXBlOiBOT1JNQU4uU0VUVElORywKICAgICAgICBpZDogICBTRVRUSU5HLlBMLAogICAgICAgIG9wdDogIHsgdXJsOiBgL3YzL3NldHRpbmdzLyR7IFNFVFRJTkcuUEwgfWAgfQogICAgICB9KTsKICAgIH0KCiAgICBpZiAocGxTZXR0aW5nLnZhbHVlPy5sZW5ndGggJiYgcGxTZXR0aW5nLnZhbHVlICE9PSBnZXRWZW5kb3IoKSkgewogICAgICBzZXRWZW5kb3IocGxTZXR0aW5nLnZhbHVlKTsKICAgIH0KCiAgICBjb25zdCBwcm9kdWN0TmFtZSA9IHBsU2V0dGluZy5kZWZhdWx0OwoKICAgIGNvbnN0IHByaW5jaXBhbHMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgncmFuY2hlci9maW5kQWxsJywgeyB0eXBlOiBOT1JNQU4uUFJJTkNJUEFMLCBvcHQ6IHsgdXJsOiAnL3YzL3ByaW5jaXBhbHMnIH0gfSk7CiAgICBjb25zdCBtZSA9IGZpbmRCeShwcmluY2lwYWxzLCAnbWUnLCB0cnVlKTsKCiAgICBjb25zdCBjdXJyZW50ID0gdGhpcy4kcm91dGUucXVlcnlbU0VUVVBdIHx8IHRoaXMuJHN0b3JlLmdldHRlcnNbJ2F1dGgvaW5pdGlhbFBhc3MnXTsKICAgIGNvbnN0IHYzVXNlciA9IHRoaXMuJHN0b3JlLmdldHRlcnNbJ2F1dGgvdjNVc2VyJ10gPz8ge307CgogICAgY29uc3QgbWNtRmVhdHVyZSA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtYW5hZ2VtZW50L2ZpbmQnLCB7CiAgICAgIHR5cGU6IE1BTkFHRU1FTlQuRkVBVFVSRSwgaWQ6ICdtdWx0aS1jbHVzdGVyLW1hbmFnZW1lbnQnLCBvcHQ6IHsgdXJsOiBgL3YxLyR7IE1BTkFHRU1FTlQuRkVBVFVSRSB9L211bHRpLWNsdXN0ZXItbWFuYWdlbWVudGAgfQogICAgfSk7CgogICAgY29uc3QgbWNtRW5hYmxlZCA9IG1jbUZlYXR1cmU/LnNwZWM/LnZhbHVlIHx8IG1jbUZlYXR1cmU/LnN0YXR1cz8uZGVmYXVsdDsKCiAgICBsZXQgc2VydmVyVXJsOwoKICAgIGlmIChzZXJ2ZXJVcmxTZXR0aW5nPy52YWx1ZSkgewogICAgICBzZXJ2ZXJVcmwgPSBzZXJ2ZXJVcmxTZXR0aW5nLnZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgc2VydmVyVXJsID0gd2luZG93LmxvY2F0aW9uLm9yaWdpbjsKICAgIH0KCiAgICBjb25zdCBpc0ZpcnN0TG9naW4gPSBhd2FpdCBjYWxjSXNGaXJzdExvZ2luKHRoaXMuJHN0b3JlKTsKICAgIGNvbnN0IG11c3RDaGFuZ2VQYXNzd29yZCA9IGF3YWl0IGNhbGNNdXN0Q2hhbmdlUGFzc3dvcmQodGhpcy4kc3RvcmUpOwoKICAgIHRoaXMuJHNldCh0aGlzLCAncHJvZHVjdE5hbWUnLCBwcm9kdWN0TmFtZSk7CiAgICB0aGlzLiRzZXQodGhpcywgJ2hhdmVDdXJyZW50JywgISFjdXJyZW50KTsKICAgIHRoaXMuJHNldCh0aGlzLCAndXNlcm5hbWUnLCBtZT8ubG9naW5OYW1lIHx8ICdhZG1pbicpOwogICAgdGhpcy4kc2V0KHRoaXMsICdpc0ZpcnN0TG9naW4nLCBpc0ZpcnN0TG9naW4pOwogICAgdGhpcy4kc2V0KHRoaXMsICdtdXN0Q2hhbmdlUGFzc3dvcmQnLCBtdXN0Q2hhbmdlUGFzc3dvcmQpOwogICAgdGhpcy4kc2V0KHRoaXMsICdjdXJyZW50JywgY3VycmVudCk7CiAgICB0aGlzLiRzZXQodGhpcywgJ3YzVXNlcicsIHYzVXNlcik7CiAgICB0aGlzLiRzZXQodGhpcywgJ3NlcnZlclVybCcsIHNlcnZlclVybCk7CiAgICB0aGlzLiRzZXQodGhpcywgJ21jbUVuYWJsZWQnLCBtY21FbmFibGVkKTsKICAgIHRoaXMuJHNldCh0aGlzLCAndGVsZW1ldHJ5JywgdGVsZW1ldHJ5KTsKICAgIHRoaXMuJHNldCh0aGlzLCAncHJpbmNpcGFscycsIHByaW5jaXBhbHMpOwogIH0sCgogIGNvbXB1dGVkOiB7CiAgICBzYXZlRW5hYmxlZCgpIHsKICAgICAgaWYgKCAhdGhpcy5ldWxhICYmIHRoaXMuaXNGaXJzdExvZ2luKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBpZiAoIHRoaXMubXVzdENoYW5nZVBhc3N3b3JkICkgewogICAgICAgIGlmICggIXRoaXMuY3VycmVudCApIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmICggIXRoaXMudXNlUmFuZG9tICkgewogICAgICAgICAgaWYgKCAhdGhpcy5wYXNzd29yZCB8fCB0aGlzLnBhc3N3b3JkICE9PSB0aGlzLmNvbmZpcm0gKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaXNVcmwodGhpcy5zZXJ2ZXJVcmwpIHx8IHRoaXMuZnZHZXRQYXRoRXJyb3JzKFsnc2VydmVyVXJsJ10pLmxlbmd0aCA+IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfSwKCiAgICBtZSgpIHsKICAgICAgY29uc3Qgb3V0ID0gZmluZEJ5KHRoaXMucHJpbmNpcGFscywgJ21lJywgdHJ1ZSk7CgogICAgICByZXR1cm4gb3V0OwogICAgfSwKCiAgICBzaG93TG9jYWxob3N0V2FybmluZygpIHsKICAgICAgcmV0dXJuIGlzTG9jYWxob3N0KHRoaXMuc2VydmVyVXJsKTsKICAgIH0KICB9LAoKICB3YXRjaDogewogICAgdXNlUmFuZG9tKG5ldSkgewogICAgICBpZiAobmV1KSB7CiAgICAgICAgdGhpcy5wYXNzd29yZCA9IHJhbmRvbVN0cigpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucGFzc3dvcmQgPSAnJzsKICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICB0aGlzLiRyZWZzLnBhc3N3b3JkLmZvY3VzKCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LAoKICBtZXRob2RzOiB7CiAgICBhc3luYyBzYXZlKGJ1dHRvbkNiKSB7CiAgICAgIGNvbnN0IHByb21pc2VzID0gW107CgogICAgICB0cnkgewogICAgICAgIGF3YWl0IGFwcGx5UHJvZHVjdHModGhpcy4kc3RvcmUsIHRoaXMuJHBsdWdpbik7CiAgICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2xvYWRNYW5hZ2VtZW50Jyk7CgogICAgICAgIGlmICggdGhpcy5tdXN0Q2hhbmdlUGFzc3dvcmQgKSB7CiAgICAgICAgICBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgncmFuY2hlci9yZXF1ZXN0JywgewogICAgICAgICAgICB1cmw6ICAgICcvdjMvdXNlcnM/YWN0aW9uPWNoYW5nZXBhc3N3b3JkJywKICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsCiAgICAgICAgICAgIGRhdGE6ICAgewogICAgICAgICAgICAgIGN1cnJlbnRQYXNzd29yZDogdGhpcy5jdXJyZW50LAogICAgICAgICAgICAgIG5ld1Bhc3N3b3JkOiAgICAgdGhpcy5wYXNzd29yZAogICAgICAgICAgICB9LAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHByb21pc2VzLnB1c2goc2V0U2V0dGluZyh0aGlzLiRzdG9yZSwgU0VUVElORy5GSVJTVF9MT0dJTiwgJ2ZhbHNlJykpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgdXNlciA9IHRoaXMudjNVc2VyOwoKICAgICAgICB1c2VyLm11c3RDaGFuZ2VQYXNzd29yZCA9IGZhbHNlOwogICAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdhdXRoL2dvdFVzZXInLCB1c2VyKTsKCiAgICAgICAgaWYgKHRoaXMuaXNGaXJzdExvZ2luKSB7CiAgICAgICAgICBwcm9taXNlcy5wdXNoKCBzZXRTZXR0aW5nKHRoaXMuJHN0b3JlLCBTRVRUSU5HLkVVTEFfQUdSRUVELCAobmV3IERhdGUoKSkudG9JU09TdHJpbmcoKSkgKTsKICAgICAgICAgIHByb21pc2VzLnB1c2goIHNldFNldHRpbmcodGhpcy4kc3RvcmUsIFNFVFRJTkcuVEVMRU1FVFJZLCB0aGlzLnRlbGVtZXRyeSA/ICdpbicgOiAnb3V0JykgKTsKCiAgICAgICAgICBpZiAoIHRoaXMubWNtRW5hYmxlZCAmJiB0aGlzLnNlcnZlclVybCApIHsKICAgICAgICAgICAgcHJvbWlzZXMucHVzaCggc2V0U2V0dGluZyh0aGlzLiRzdG9yZSwgU0VUVElORy5TRVJWRVJfVVJMLCB0aGlzLnNlcnZlclVybCkgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTsKCiAgICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiAhY2FsY0lzRmlyc3RMb2dpbih0aGlzLiRzdG9yZSksICdmaXJzdCBsb2dpbiB0byBiZSBjb21wbGV0ZWQnLCAxMDAwMCwgMTAwMCwgdHJ1ZSk7CgogICAgICAgIGJ1dHRvbkNiKHRydWUpOwogICAgICAgIHRoaXMuZG9uZSgpOwogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGVycikgOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKICAgICAgICBidXR0b25DYihmYWxzZSk7CiAgICAgICAgdGhpcy5lcnJvcnMgPSBleGNlcHRpb25Ub0Vycm9yc0FycmF5KGVycik7CiAgICAgIH0KICAgIH0sCgogICAgZG9uZSgpIHsKICAgICAgdGhpcy4kcm91dGVyLnJlcGxhY2UoJy8nKTsKICAgIH0sCgogICAgb25TZXJ2ZXJVcmxDaGFuZ2UodmFsdWUpIHsKICAgICAgdGhpcy5zZXJ2ZXJVcmwgPSB2YWx1ZS50cmltKCk7CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["setup.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"setup.vue","sourceRoot":"node_modules/@rancher/shell/pages/auth","sourcesContent":["<script>\nimport { randomStr } from '@shell/utils/string';\nimport { LabeledInput } from '@components/Form/LabeledInput';\nimport CopyToClipboard from '@shell/components/CopyToClipboard';\nimport AsyncButton from '@shell/components/AsyncButton';\nimport { LOGGED_OUT, SETUP } from '@shell/config/query-params';\nimport { NORMAN, MANAGEMENT } from '@shell/config/types';\nimport { findBy } from '@shell/utils/array';\nimport { Checkbox } from '@components/Form/Checkbox';\nimport { getVendor, getProduct, setVendor } from '@shell/config/private-label';\nimport { RadioGroup } from '@components/Form/Radio';\nimport { setSetting } from '@shell/utils/settings';\nimport { SETTING } from '@shell/config/settings';\nimport { isDevBuild } from '@shell/utils/version';\nimport { exceptionToErrorsArray } from '@shell/utils/error';\nimport Password from '@shell/components/form/Password';\nimport { applyProducts } from '@shell/store/type-map';\nimport BrandImage from '@shell/components/BrandImage';\nimport { waitFor } from '@shell/utils/async';\nimport { Banner } from '@components/Banner';\nimport FormValidation from '@shell/mixins/form-validation';\nimport isUrl from 'is-url';\nimport { isLocalhost } from '@shell/utils/validators/setting';\nimport Loading from '@shell/components/Loading';\n\nconst calcIsFirstLogin = (store) => {\n  const firstLoginSetting = store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.FIRST_LOGIN);\n\n  return firstLoginSetting?.value === 'true';\n};\n\nconst calcMustChangePassword = async(store) => {\n  await store.dispatch('auth/getUser');\n\n  const out = store.getters['auth/v3User']?.mustChangePassword;\n\n  return out;\n};\n\nexport default {\n  mixins: [FormValidation],\n\n  data() {\n    return {\n      passwordOptions: [\n        { label: this.t('setup.useRandom'), value: true },\n        { label: this.t('setup.useManual'), value: false }],\n      fvFormRuleSets: [{\n        path:       'serverUrl',\n        rootObject: this,\n        rules:      ['required', 'https', 'url', 'trailingForwardSlash']\n      }],\n      productName: '',\n      vendor:      getVendor(),\n      product:     getProduct(),\n      step:        parseInt(this.$route.query.step, 10) || 1,\n\n      useRandom:          true,\n      haveCurrent:        false,\n      username:           null,\n      isFirstLogin:       false,\n      mustChangePassword: false,\n      current:            null,\n      password:           randomStr(),\n      confirm:            null,\n      v3User:             null,\n      serverUrl:          null,\n      mcmEnabled:         null,\n      telemetry:          null,\n      eula:               false,\n      principals:         null,\n      errors:             []\n    };\n  },\n\n  async middleware({ store, redirect } ) {\n    const isFirstLogin = calcIsFirstLogin(store);\n    const mustChangePassword = await calcMustChangePassword(store);\n\n    if (isFirstLogin) {\n      // Always show setup if this is the first log in\n      return;\n    } else if (mustChangePassword) {\n      // If the password needs changing and this isn't the first log in ensure we have the password\n      if (!!store.getters['auth/initialPass']) {\n        // Got it... show setup\n        return;\n      }\n      // Haven't got it... redirect to log in so we get it\n      await store.dispatch('auth/logout', null, { root: true });\n\n      return redirect(302, `/auth/login?${ LOGGED_OUT }`);\n    }\n\n    // For all other cases we don't need to show setup\n    return redirect('/');\n  },\n\n  components: {\n    AsyncButton, LabeledInput, CopyToClipboard, Checkbox, RadioGroup, Password, BrandImage, Banner, Loading\n  },\n\n  async fetch() {\n    const telemetrySetting = this.$store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.TELEMETRY);\n    const serverUrlSetting = this.$store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.SERVER_URL);\n    const rancherVersionSetting = this.$store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.VERSION_RANCHER);\n    let telemetry = true;\n\n    if (telemetrySetting?.value && telemetrySetting.value !== 'prompt') {\n      telemetry = telemetrySetting.value !== 'out';\n    } else if (!rancherVersionSetting?.value || isDevBuild(rancherVersionSetting?.value)) {\n      telemetry = false;\n    }\n\n    let plSetting;\n\n    try {\n      plSetting = this.$store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.PL);\n    } catch (e) {\n      // Older versions used Norman API to get these\n      plSetting = await this.$store.dispatch('rancher/find', {\n        type: NORMAN.SETTING,\n        id:   SETTING.PL,\n        opt:  { url: `/v3/settings/${ SETTING.PL }` }\n      });\n    }\n\n    if (plSetting.value?.length && plSetting.value !== getVendor()) {\n      setVendor(plSetting.value);\n    }\n\n    const productName = plSetting.default;\n\n    const principals = await this.$store.dispatch('rancher/findAll', { type: NORMAN.PRINCIPAL, opt: { url: '/v3/principals' } });\n    const me = findBy(principals, 'me', true);\n\n    const current = this.$route.query[SETUP] || this.$store.getters['auth/initialPass'];\n    const v3User = this.$store.getters['auth/v3User'] ?? {};\n\n    const mcmFeature = await this.$store.dispatch('management/find', {\n      type: MANAGEMENT.FEATURE, id: 'multi-cluster-management', opt: { url: `/v1/${ MANAGEMENT.FEATURE }/multi-cluster-management` }\n    });\n\n    const mcmEnabled = mcmFeature?.spec?.value || mcmFeature?.status?.default;\n\n    let serverUrl;\n\n    if (serverUrlSetting?.value) {\n      serverUrl = serverUrlSetting.value;\n    } else {\n      serverUrl = window.location.origin;\n    }\n\n    const isFirstLogin = await calcIsFirstLogin(this.$store);\n    const mustChangePassword = await calcMustChangePassword(this.$store);\n\n    this.$set(this, 'productName', productName);\n    this.$set(this, 'haveCurrent', !!current);\n    this.$set(this, 'username', me?.loginName || 'admin');\n    this.$set(this, 'isFirstLogin', isFirstLogin);\n    this.$set(this, 'mustChangePassword', mustChangePassword);\n    this.$set(this, 'current', current);\n    this.$set(this, 'v3User', v3User);\n    this.$set(this, 'serverUrl', serverUrl);\n    this.$set(this, 'mcmEnabled', mcmEnabled);\n    this.$set(this, 'telemetry', telemetry);\n    this.$set(this, 'principals', principals);\n  },\n\n  computed: {\n    saveEnabled() {\n      if ( !this.eula && this.isFirstLogin) {\n        return false;\n      }\n\n      if ( this.mustChangePassword ) {\n        if ( !this.current ) {\n          return false;\n        }\n\n        if ( !this.useRandom ) {\n          if ( !this.password || this.password !== this.confirm ) {\n            return false;\n          }\n        }\n      }\n\n      if (!isUrl(this.serverUrl) || this.fvGetPathErrors(['serverUrl']).length > 0) {\n        return false;\n      }\n\n      return true;\n    },\n\n    me() {\n      const out = findBy(this.principals, 'me', true);\n\n      return out;\n    },\n\n    showLocalhostWarning() {\n      return isLocalhost(this.serverUrl);\n    }\n  },\n\n  watch: {\n    useRandom(neu) {\n      if (neu) {\n        this.password = randomStr();\n      } else {\n        this.password = '';\n        this.$nextTick(() => {\n          this.$refs.password.focus();\n        });\n      }\n    }\n  },\n\n  methods: {\n    async save(buttonCb) {\n      const promises = [];\n\n      try {\n        await applyProducts(this.$store, this.$plugin);\n        await this.$store.dispatch('loadManagement');\n\n        if ( this.mustChangePassword ) {\n          await this.$store.dispatch('rancher/request', {\n            url:    '/v3/users?action=changepassword',\n            method: 'post',\n            data:   {\n              currentPassword: this.current,\n              newPassword:     this.password\n            },\n          });\n        } else {\n          promises.push(setSetting(this.$store, SETTING.FIRST_LOGIN, 'false'));\n        }\n\n        const user = this.v3User;\n\n        user.mustChangePassword = false;\n        this.$store.dispatch('auth/gotUser', user);\n\n        if (this.isFirstLogin) {\n          promises.push( setSetting(this.$store, SETTING.EULA_AGREED, (new Date()).toISOString()) );\n          promises.push( setSetting(this.$store, SETTING.TELEMETRY, this.telemetry ? 'in' : 'out') );\n\n          if ( this.mcmEnabled && this.serverUrl ) {\n            promises.push( setSetting(this.$store, SETTING.SERVER_URL, this.serverUrl) );\n          }\n        }\n\n        await Promise.all(promises);\n\n        await waitFor(() => !calcIsFirstLogin(this.$store), 'first login to be completed', 10000, 1000, true);\n\n        buttonCb(true);\n        this.done();\n      } catch (err) {\n        console.error(err) ; // eslint-disable-line no-console\n        buttonCb(false);\n        this.errors = exceptionToErrorsArray(err);\n      }\n    },\n\n    done() {\n      this.$router.replace('/');\n    },\n\n    onServerUrlChange(value) {\n      this.serverUrl = value.trim();\n    },\n  },\n};\n</script>\n\n<template>\n  <Loading v-if=\"$fetchState.pending\" />\n  <form\n    v-else\n    class=\"setup\"\n  >\n    <div class=\"row\">\n      <div class=\"col span-6 form-col\">\n        <div>\n          &nbsp;\n        </div>\n        <div>\n          <h1 class=\"text-center\">\n            {{ t('setup.welcome', {product}) }}\n          </h1>\n\n          <template v-if=\"mustChangePassword\">\n            <p\n              v-clean-html=\"t(isFirstLogin ? 'setup.setPassword' : 'setup.newUserSetPassword', { username }, true)\"\n              class=\"text-center mb-20 mt-20 setup-title\"\n            />\n            <Password\n              v-if=\"!haveCurrent\"\n              v-model.trim=\"current\"\n              autocomplete=\"current-password\"\n              type=\"password\"\n              :label=\"t('setup.currentPassword')\"\n              class=\"mb-20\"\n              :required=\"true\"\n            />\n\n            <!-- For password managers... -->\n            <input\n              type=\"hidden\"\n              name=\"username\"\n              autocomplete=\"username\"\n              :value=\"username\"\n            >\n            <div class=\"mb-20\">\n              <RadioGroup\n                v-model=\"useRandom\"\n                data-testid=\"setup-password-mode\"\n                name=\"password-mode\"\n                :options=\"passwordOptions\"\n              />\n            </div>\n            <div class=\"mb-20\">\n              <LabeledInput\n                v-if=\"useRandom\"\n                ref=\"password\"\n                v-model.trim=\"password\"\n                :type=\"useRandom ? 'text' : 'password'\"\n                :disabled=\"useRandom\"\n                data-testid=\"setup-password-random\"\n                label-key=\"setup.newPassword\"\n              >\n                <template\n                  v-if=\"useRandom\"\n                  #suffix\n                >\n                  <div\n                    class=\"addon\"\n                    style=\"padding: 0 0 0 12px;\"\n                  >\n                    <CopyToClipboard\n                      :text=\"password\"\n                      class=\"btn-sm\"\n                    />\n                  </div>\n                </template>\n              </LabeledInput>\n              <Password\n                v-else\n                ref=\"password\"\n                v-model.trim=\"password\"\n                :label=\"t('setup.newPassword')\"\n                data-testid=\"setup-password\"\n                :required=\"true\"\n              />\n            </div>\n            <Password\n              v-show=\"!useRandom\"\n              v-model.trim=\"confirm\"\n              autocomplete=\"new-password\"\n              data-testid=\"setup-password-confirm\"\n              :label=\"t('setup.confirmPassword')\"\n              :required=\"true\"\n            />\n          </template>\n\n          <template v-if=\"isFirstLogin\">\n            <template v-if=\"mcmEnabled\">\n              <hr\n                v-if=\"mustChangePassword\"\n                class=\"mt-20 mb-20\"\n              >\n              <p>\n                <t\n                  k=\"setup.serverUrl.tip\"\n                  :raw=\"true\"\n                />\n              </p>\n              <div class=\"mt-20\">\n                <Banner\n                  v-if=\"showLocalhostWarning\"\n                  color=\"warning\"\n                  :label=\"t('validation.setting.serverUrl.localhost')\"\n                  data-testid=\"setup-serverurl-localhost-warning\"\n                />\n                <Banner\n                  v-for=\"(err, i) in fvGetPathErrors(['serverUrl'])\"\n                  :key=\"i\"\n                  color=\"error\"\n                  :label=\"err\"\n                  data-testid=\"setup-error-banner\"\n                />\n                <LabeledInput\n                  v-model=\"serverUrl\"\n                  :label=\"t('setup.serverUrl.label')\"\n                  data-testid=\"setup-server-url\"\n                  :rules=\"fvGetAndReportPathRules('serverUrl')\"\n                  :required=\"true\"\n                  @input=\"onServerUrlChange\"\n                />\n              </div>\n            </template>\n\n            <div class=\"checkbox mt-40\">\n              <Checkbox\n                id=\"checkbox-telemetry\"\n                v-model=\"telemetry\"\n              >\n                <template #label>\n                  <t\n                    k=\"setup.telemetry\"\n                    :raw=\"true\"\n                    :name=\"productName\"\n                  />\n                </template>\n              </Checkbox>\n            </div>\n            <div class=\"checkbox pt-10 eula\">\n              <Checkbox\n                id=\"checkbox-eula\"\n                v-model=\"eula\"\n                data-testid=\"setup-agreement\"\n              >\n                <template #label>\n                  <t\n                    k=\"setup.eula\"\n                    :raw=\"true\"\n                    :name=\"productName\"\n                  />\n                </template>\n              </Checkbox>\n            </div>\n          </template>\n\n          <div\n            id=\"submit\"\n            class=\"text-center mt-20\"\n          >\n            <AsyncButton\n              key=\"passwordSubmit\"\n              type=\"submit\"\n              mode=\"continue\"\n              :disabled=\"!saveEnabled\"\n              data-testid=\"setup-submit\"\n              @click=\"save\"\n            />\n          </div>\n\n          <div class=\"setup-errors mt-20\">\n            <h4\n              v-for=\"err in errors\"\n              :key=\"err\"\n              class=\"text-error text-center\"\n            >\n              {{ err }}\n            </h4>\n          </div>\n        </div>\n      </div>\n      <BrandImage\n        class=\"col span-6 landscape\"\n        file-name=\"login-landscape.svg\"\n      />\n    </div>\n  </form>\n</template>\n\n<style lang=\"scss\" scoped>\n  .principal {\n    display: block;\n    background: var(--box-bg);\n    border: 1px solid var(--border);\n    border-radius: 3px;\n    margin: 10px 0;\n    padding: 10px;\n    line-height: 40px;\n\n    img {\n      vertical-align: middle;\n      margin: 0 10px;\n    }\n  }\n\n  .setup {\n    overflow: hidden;\n\n    .row {\n      & .checkbox {\n        margin: auto\n      }\n\n      .span-6 {\n        padding: 0 60px;\n      }\n\n      .landscape {\n        height: 100vh;\n        margin: 0;\n        object-fit: cover;\n        padding: 0;\n      }\n    }\n\n    .form-col {\n      display: flex;\n      flex-direction: column;\n      overflow-y: auto;\n      position: relative;\n      height: 100vh;\n\n      & > div:first-of-type {\n        flex:3;\n      }\n      & > div:nth-of-type(2) {\n        flex: 9;\n      }\n    }\n\n    .setup-title {\n      ::v-deep code {\n        font-size: 12px;\n        padding: 0;\n      }\n    }\n\n    .setup-errors {\n      min-height: 50px;\n    }\n\n    p {\n      line-height: 20px;\n    }\n  }\n</style>\n"]}]}