{"remainingRequest":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ubuntu/suseconf/node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster/SelectCredential.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster/SelectCredential.vue","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1725271300920}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBMb2FkaW5nIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL0xvYWRpbmcnOwppbXBvcnQgTGFiZWxlZFNlbGVjdCBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtL0xhYmVsZWRTZWxlY3QnOwppbXBvcnQgeyBOT1JNQU4sIERFRkFVTFRfV09SS1NQQUNFIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy90eXBlcyc7CmltcG9ydCBDcmVhdGVFZGl0VmlldyBmcm9tICdAc2hlbGwvbWl4aW5zL2NyZWF0ZS1lZGl0LXZpZXcnOwppbXBvcnQgQ3J1UmVzb3VyY2UgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvQ3J1UmVzb3VyY2UnOwppbXBvcnQgTmFtZU5zRGVzY3JpcHRpb24gZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvZm9ybS9OYW1lTnNEZXNjcmlwdGlvbic7CmltcG9ydCB7IEJhbm5lciB9IGZyb20gJ0Bjb21wb25lbnRzL0Jhbm5lcic7CmltcG9ydCB7IENBUEkgfSBmcm9tICdAc2hlbGwvY29uZmlnL2xhYmVscy1hbm5vdGF0aW9ucyc7CmltcG9ydCB7IGNsZWFyIH0gZnJvbSAnQHNoZWxsL3V0aWxzL2FycmF5JzsKaW1wb3J0IGNsb25lRGVlcCBmcm9tICdsb2Rhc2gvY2xvbmVEZWVwJzsKCmNvbnN0IF9ORVcgPSAnX05FVyc7CmNvbnN0IF9OT05FID0gJ19OT05FJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBMb2FkaW5nLCBMYWJlbGVkU2VsZWN0LCBDcnVSZXNvdXJjZSwgTmFtZU5zRGVzY3JpcHRpb24sIEJhbm5lcgogIH0sCgogIG1peGluczogW0NyZWF0ZUVkaXRWaWV3XSwKCiAgcHJvcHM6IHsKICAgIHZhbHVlOiB7CiAgICAgIHR5cGU6ICAgIFN0cmluZywKICAgICAgZGVmYXVsdDogbnVsbCwKICAgIH0sCgogICAgcHJvdmlkZXI6IHsKICAgICAgdHlwZTogICAgU3RyaW5nLAogICAgICBkZWZhdWx0OiBudWxsLAogICAgfSwKCiAgICBjYW5jZWw6IHsKICAgICAgdHlwZTogICAgRnVuY3Rpb24sCiAgICAgIGRlZmF1bHQ6IG51bGwKICAgIH0sCgogICAgc2hvd2luZ0Zvcm06IHsKICAgICAgdHlwZTogICAgIEJvb2xlYW4sCiAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgfQogIH0sCgogIGFzeW5jIGZldGNoKCkgewogICAgdGhpcy5hbGxDcmVkZW50aWFscyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdyYW5jaGVyL2ZpbmRBbGwnLCB7IHR5cGU6IE5PUk1BTi5DTE9VRF9DUkVERU5USUFMIH0pOwoKICAgIGNvbnN0IGZpZWxkID0gdGhpcy4kc3RvcmUuZ2V0dGVyc1sncGx1Z2lucy9jcmVkZW50aWFsRmllbGRGb3JEcml2ZXInXSh0aGlzLmRyaXZlck5hbWUpOwoKICAgIHRoaXMubmV3Q3JlZGVudGlhbCA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdyYW5jaGVyL2NyZWF0ZScsIHsKICAgICAgdHlwZTogICAgIE5PUk1BTi5DTE9VRF9DUkVERU5USUFMLAogICAgICBtZXRhZGF0YTogewogICAgICAgIG5hbWVzcGFjZTogICBERUZBVUxUX1dPUktTUEFDRSwKICAgICAgICBhbm5vdGF0aW9uczogeyBbQ0FQSS5DUkVERU5USUFMX0RSSVZFUl06IHRoaXMuZHJpdmVyTmFtZSB9CiAgICAgIH0sCiAgICAgIFtgJHsgZmllbGQgfWNyZWRlbnRpYWxDb25maWdgXToge30KICAgIH0pOwoKICAgIGlmICggdGhpcy52YWx1ZSApIHsKICAgICAgdGhpcy5jcmVkZW50aWFsSWQgPSB0aGlzLnZhbHVlOwogICAgfSBlbHNlIGlmICggdGhpcy5maWx0ZXJlZENyZWRlbnRpYWxzLmxlbmd0aCA9PT0gMSApIHsKICAgICAgLy8gQXV0byBwaWNrIHRoZSBmaXJzdCBjcmVkZW50aWFsIGlmIHRoZXJlJ3Mgb25seSBvbmUKICAgICAgdGhpcy5jcmVkZW50aWFsSWQgPSB0aGlzLmZpbHRlcmVkQ3JlZGVudGlhbHNbMF0uaWQ7CiAgICB9IGVsc2UgaWYgKCAhdGhpcy5maWx0ZXJlZENyZWRlbnRpYWxzLmxlbmd0aCApIHsKICAgICAgdGhpcy5jcmVkZW50aWFsSWQgPSBfTkVXOwogICAgfQogIH0sCgogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBhbGxDcmVkZW50aWFsczogICAgICAgICAgICAgICAgW10sCiAgICAgIG5vZGVDb21wb25lbnQ6ICAgICAgICAgICAgICAgICBudWxsLAogICAgICBjcmVkZW50aWFsSWQ6ICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZSB8fCBfTk9ORSwKICAgICAgbmV3Q3JlZGVudGlhbDogICAgICAgICAgICAgICAgIG51bGwsCiAgICAgIGNyZWRDdXN0b21Db21wb25lbnRWYWxpZGF0aW9uOiBmYWxzZSwKICAgICAgbmFtZVJlcXVpcmVkVmFsaWRhdGlvbjogICAgICAgIGZhbHNlLAogICAgICBvcmlnaW5hbElkOiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZQogICAgfTsKICB9LAoKICBjb21wdXRlZDogewogICAgaXNOb25lKCkgewogICAgICByZXR1cm4gdGhpcy5jcmVkZW50aWFsSWQgPT09IG51bGwgfHwgdGhpcy5jcmVkZW50aWFsSWQgPT09IF9OT05FOwogICAgfSwKCiAgICBpc05ldygpIHsKICAgICAgcmV0dXJuIHRoaXMuY3JlZGVudGlhbElkID09PSBfTkVXOwogICAgfSwKCiAgICBpc1BpY2tlZCgpIHsKICAgICAgcmV0dXJuICEhdGhpcy5jcmVkZW50aWFsSWQgJiYgIXRoaXMuaXNOb25lICYmICF0aGlzLmlzTmV3OwogICAgfSwKCiAgICBkcml2ZXJOYW1lKCkgewogICAgICBsZXQgZHJpdmVyID0gdGhpcy5wcm92aWRlcjsKCiAgICAgIC8vIE1hcCBwcm92aWRlcnMgdGhhdCBzaGFyZSBhIGNvbW1vbiBjcmVkZW50aWFsIHRvIG9uZSBkcml2ZXIKICAgICAgZHJpdmVyID0gdGhpcy4kc3RvcmUuZ2V0dGVyc1sncGx1Z2lucy9jcmVkZW50aWFsRHJpdmVyRm9yJ10oZHJpdmVyKTsKCiAgICAgIHJldHVybiBkcml2ZXI7CiAgICB9LAoKICAgIGZpbHRlcmVkQ3JlZGVudGlhbHMoKSB7CiAgICAgIHJldHVybiB0aGlzLmFsbENyZWRlbnRpYWxzLmZpbHRlcigoeCkgPT4geC5wcm92aWRlciA9PT0gdGhpcy5kcml2ZXJOYW1lKTsKICAgIH0sCgogICAgb3B0aW9ucygpIHsKICAgICAgY29uc3QgZHVwbGljYXRlcyA9IHt9OwoKICAgICAgdGhpcy5maWx0ZXJlZENyZWRlbnRpYWxzLmZvckVhY2goKGNyZWQpID0+IHsKICAgICAgICBkdXBsaWNhdGVzW2NyZWQubmFtZURpc3BsYXldID0gZHVwbGljYXRlc1tjcmVkLm5hbWVEaXNwbGF5XSA9PT0gbnVsbCA/IHRydWUgOiBudWxsOwogICAgICB9KTsKCiAgICAgIGNvbnN0IG91dCA9IHRoaXMuZmlsdGVyZWRDcmVkZW50aWFscy5tYXAoKG9iaikgPT4gKHsKICAgICAgICAvLyBpZiBjcmVkZW50aWFsIG5hbWUgaXMgZHVwbGljYXRlZCB3ZSBhZGQgdGhlIGlkIHRvIHRoZSBsYWJlbAogICAgICAgIGxhYmVsOiBkdXBsaWNhdGVzW29iai5uYW1lRGlzcGxheV0gPyBgJHsgb2JqLm5hbWVEaXNwbGF5IH0gKCR7IG9iai5pZCB9KWAgOiBvYmoubmFtZURpc3BsYXksCiAgICAgICAgdmFsdWU6IG9iai5pZCwKICAgICAgfSkpOwoKICAgICAgaWYgKCB0aGlzLm9yaWdpbmFsSWQgJiYgIW91dC5maW5kKCh4KSA9PiB4LnZhbHVlID09PSB0aGlzLm9yaWdpbmFsSWQpICkgewogICAgICAgIG91dC51bnNoaWZ0KHsKICAgICAgICAgIGxhYmVsOiBgJHsgdGhpcy5vcmlnaW5hbElkLnJlcGxhY2UoL15jYXR0bGUtZ2xvYmFsLWRhdGE6LywgJycpIH0gKGN1cnJlbnQpYCwKICAgICAgICAgIHZhbHVlOiB0aGlzLm9yaWdpbmFsSWQKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgb3V0LnVuc2hpZnQoewogICAgICAgIGxhYmVsOiB0aGlzLnQoJ2NsdXN0ZXIuY3JlZGVudGlhbC5zZWxlY3Qub3B0aW9uLm5ldycpLAogICAgICAgIHZhbHVlOiBfTkVXLAogICAgICB9KTsKCiAgICAgIG91dC51bnNoaWZ0KHsKICAgICAgICBsYWJlbDogICAgdGhpcy50KCdjbHVzdGVyLmNyZWRlbnRpYWwuc2VsZWN0Lm9wdGlvbi5ub25lJyksCiAgICAgICAgdmFsdWU6ICAgIF9OT05FLAogICAgICAgIGRpc2FibGVkOiB0cnVlLAogICAgICB9KTsKCiAgICAgIHJldHVybiBvdXQ7CiAgICB9LAoKICAgIGNyZWF0ZUNvbXBvbmVudCgpIHsKICAgICAgaWYgKHRoaXMuJHN0b3JlLmdldHRlcnNbJ3R5cGUtbWFwL2hhc0N1c3RvbUNsb3VkQ3JlZGVudGlhbENvbXBvbmVudCddKHRoaXMuZHJpdmVyTmFtZSkpIHsKICAgICAgICByZXR1cm4gdGhpcy4kc3RvcmUuZ2V0dGVyc1sndHlwZS1tYXAvaW1wb3J0Q2xvdWRDcmVkZW50aWFsJ10odGhpcy5kcml2ZXJOYW1lKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLmdldHRlcnNbJ3R5cGUtbWFwL2ltcG9ydENsb3VkQ3JlZGVudGlhbCddKCdnZW5lcmljJyk7CiAgICB9LAoKICAgIHZhbGlkYXRpb25QYXNzZWQoKSB7CiAgICAgIGlmICggdGhpcy5jcmVkZW50aWFsSWQgPT09IF9OT05FICkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKCB0aGlzLmNyZWRlbnRpYWxJZCA9PT0gX05FVyApIHsKICAgICAgICByZXR1cm4gdGhpcy5jcmVkQ3VzdG9tQ29tcG9uZW50VmFsaWRhdGlvbiAmJiB0aGlzLm5hbWVSZXF1aXJlZFZhbGlkYXRpb247CiAgICAgIH0KCiAgICAgIHJldHVybiAhIXRoaXMuY3JlZGVudGlhbElkOwogICAgfSwKICB9LAoKICB3YXRjaDogewogICAgY3JlZGVudGlhbElkKHZhbCkgewogICAgICBpZiAoIHZhbCA9PT0gX05FVyB8fCB2YWwgPT09IF9OT05FICkgewogICAgICAgIHRoaXMuJGVtaXQoJ2lucHV0JywgbnVsbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCB2YWwpOwogICAgICB9CiAgICB9LAogIH0sCgogIG1ldGhvZHM6IHsKICAgIGhhbmRsZU5hbWVSZXF1aXJlZFZhbGlkYXRpb24oKSB7CiAgICAgIHRoaXMubmFtZVJlcXVpcmVkVmFsaWRhdGlvbiA9ICEhdGhpcy5uZXdDcmVkZW50aWFsPy5uYW1lPy5sZW5ndGg7CiAgICB9LAoKICAgIGFzeW5jIHNhdmUoYnRuQ2IpIHsKICAgICAgaWYgKCB0aGlzLmVycm9ycyApIHsKICAgICAgICBjbGVhcih0aGlzLmVycm9ycyk7CiAgICAgIH0KICAgICAgY29uc3QgZnVsbENyZWRlbnRpYWwgPSBjbG9uZURlZXAodGhpcy5uZXdDcmVkZW50aWFsKTsKCiAgICAgIGlmICggdHlwZW9mIHRoaXMuJHJlZnMuY3JlYXRlPy50ZXN0ID09PSAnZnVuY3Rpb24nICkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLiRyZWZzLmNyZWF0ZS50ZXN0KCk7CgogICAgICAgICAgaWYgKCAhcmVzICkgewogICAgICAgICAgICB0aGlzLmVycm9ycyA9IFsnQXV0aGVudGljYXRpb24gdGVzdCBmYWlsZWQsIHBsZWFzZSBjaGVjayB5b3VyIGNyZWRlbnRpYWxzJ107CiAgICAgICAgICAgIGJ0bkNiKGZhbHNlKTsKCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICB0aGlzLmVycm9ycyA9IFtlXTsKICAgICAgICAgIGJ0bkNiKGZhbHNlKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICggdGhpcy5uZXdDcmVkZW50aWFsLm1ldGFkYXRhLm5hbWUgKSB7CiAgICAgICAgZGVsZXRlIHRoaXMubmV3Q3JlZGVudGlhbC5tZXRhZGF0YS5nZW5lcmF0ZU5hbWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5uZXdDcmVkZW50aWFsLm1ldGFkYXRhLmdlbmVyYXRlTmFtZSA9ICdjbG91ZC1jcmVkZW50aWFsLSc7CiAgICAgIH0KCiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5uZXdDcmVkZW50aWFsLnNhdmUoKTsKCiAgICAgICAgdGhpcy5jcmVkZW50aWFsSWQgPSByZXMuaWQ7CiAgICAgICAgLy8gZnVsbCBjbG91ZCBjcmVkZW50aWFsIGRhdGEgaXMgbm90IHN0b3JlZCBpbiB0aGUgY2xvdWQgY3JlZGVudGFpbCBDUkQsIGJ1dCBjb25zdW1pbmcgY29tcG9uZW50cyBtYXkgd2FudCB0byB1c2UgaXQKICAgICAgICB0aGlzLiRlbWl0KCdjcmVkZW50aWFsLWNyZWF0ZWQnLCBmdWxsQ3JlZGVudGlhbCk7CiAgICAgICAgYnRuQ2IodHJ1ZSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICB0aGlzLmVycm9ycyA9IFtlXTsKICAgICAgICBidG5DYihmYWxzZSk7CiAgICAgIH0KICAgIH0sCgogICAgY3JlYXRlVmFsaWRhdGlvbkNoYW5nZWQocGFzc2VkKSB7CiAgICAgIHRoaXMuY3JlZEN1c3RvbUNvbXBvbmVudFZhbGlkYXRpb24gPSBwYXNzZWQ7CiAgICB9LAoKICAgIGJhY2tUb0V4aXN0aW5nKCkgewogICAgICB0aGlzLmNyZWRlbnRpYWxJZCA9IF9OT05FOwogICAgfQogIH0sCn07Cg=="},{"version":3,"sources":["SelectCredential.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"SelectCredential.vue","sourceRoot":"node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster","sourcesContent":["<script>\nimport Loading from '@shell/components/Loading';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\nimport { NORMAN, DEFAULT_WORKSPACE } from '@shell/config/types';\nimport CreateEditView from '@shell/mixins/create-edit-view';\nimport CruResource from '@shell/components/CruResource';\nimport NameNsDescription from '@shell/components/form/NameNsDescription';\nimport { Banner } from '@components/Banner';\nimport { CAPI } from '@shell/config/labels-annotations';\nimport { clear } from '@shell/utils/array';\nimport cloneDeep from 'lodash/cloneDeep';\n\nconst _NEW = '_NEW';\nconst _NONE = '_NONE';\n\nexport default {\n  components: {\n    Loading, LabeledSelect, CruResource, NameNsDescription, Banner\n  },\n\n  mixins: [CreateEditView],\n\n  props: {\n    value: {\n      type:    String,\n      default: null,\n    },\n\n    provider: {\n      type:    String,\n      default: null,\n    },\n\n    cancel: {\n      type:    Function,\n      default: null\n    },\n\n    showingForm: {\n      type:     Boolean,\n      required: true,\n    }\n  },\n\n  async fetch() {\n    this.allCredentials = await this.$store.dispatch('rancher/findAll', { type: NORMAN.CLOUD_CREDENTIAL });\n\n    const field = this.$store.getters['plugins/credentialFieldForDriver'](this.driverName);\n\n    this.newCredential = await this.$store.dispatch('rancher/create', {\n      type:     NORMAN.CLOUD_CREDENTIAL,\n      metadata: {\n        namespace:   DEFAULT_WORKSPACE,\n        annotations: { [CAPI.CREDENTIAL_DRIVER]: this.driverName }\n      },\n      [`${ field }credentialConfig`]: {}\n    });\n\n    if ( this.value ) {\n      this.credentialId = this.value;\n    } else if ( this.filteredCredentials.length === 1 ) {\n      // Auto pick the first credential if there's only one\n      this.credentialId = this.filteredCredentials[0].id;\n    } else if ( !this.filteredCredentials.length ) {\n      this.credentialId = _NEW;\n    }\n  },\n\n  data() {\n    return {\n      allCredentials:                [],\n      nodeComponent:                 null,\n      credentialId:                  this.value || _NONE,\n      newCredential:                 null,\n      credCustomComponentValidation: false,\n      nameRequiredValidation:        false,\n      originalId:                    this.value\n    };\n  },\n\n  computed: {\n    isNone() {\n      return this.credentialId === null || this.credentialId === _NONE;\n    },\n\n    isNew() {\n      return this.credentialId === _NEW;\n    },\n\n    isPicked() {\n      return !!this.credentialId && !this.isNone && !this.isNew;\n    },\n\n    driverName() {\n      let driver = this.provider;\n\n      // Map providers that share a common credential to one driver\n      driver = this.$store.getters['plugins/credentialDriverFor'](driver);\n\n      return driver;\n    },\n\n    filteredCredentials() {\n      return this.allCredentials.filter((x) => x.provider === this.driverName);\n    },\n\n    options() {\n      const duplicates = {};\n\n      this.filteredCredentials.forEach((cred) => {\n        duplicates[cred.nameDisplay] = duplicates[cred.nameDisplay] === null ? true : null;\n      });\n\n      const out = this.filteredCredentials.map((obj) => ({\n        // if credential name is duplicated we add the id to the label\n        label: duplicates[obj.nameDisplay] ? `${ obj.nameDisplay } (${ obj.id })` : obj.nameDisplay,\n        value: obj.id,\n      }));\n\n      if ( this.originalId && !out.find((x) => x.value === this.originalId) ) {\n        out.unshift({\n          label: `${ this.originalId.replace(/^cattle-global-data:/, '') } (current)`,\n          value: this.originalId\n        });\n      }\n\n      out.unshift({\n        label: this.t('cluster.credential.select.option.new'),\n        value: _NEW,\n      });\n\n      out.unshift({\n        label:    this.t('cluster.credential.select.option.none'),\n        value:    _NONE,\n        disabled: true,\n      });\n\n      return out;\n    },\n\n    createComponent() {\n      if (this.$store.getters['type-map/hasCustomCloudCredentialComponent'](this.driverName)) {\n        return this.$store.getters['type-map/importCloudCredential'](this.driverName);\n      }\n\n      return this.$store.getters['type-map/importCloudCredential']('generic');\n    },\n\n    validationPassed() {\n      if ( this.credentialId === _NONE ) {\n        return false;\n      }\n\n      if ( this.credentialId === _NEW ) {\n        return this.credCustomComponentValidation && this.nameRequiredValidation;\n      }\n\n      return !!this.credentialId;\n    },\n  },\n\n  watch: {\n    credentialId(val) {\n      if ( val === _NEW || val === _NONE ) {\n        this.$emit('input', null);\n      } else {\n        this.$emit('input', val);\n      }\n    },\n  },\n\n  methods: {\n    handleNameRequiredValidation() {\n      this.nameRequiredValidation = !!this.newCredential?.name?.length;\n    },\n\n    async save(btnCb) {\n      if ( this.errors ) {\n        clear(this.errors);\n      }\n      const fullCredential = cloneDeep(this.newCredential);\n\n      if ( typeof this.$refs.create?.test === 'function' ) {\n        try {\n          const res = await this.$refs.create.test();\n\n          if ( !res ) {\n            this.errors = ['Authentication test failed, please check your credentials'];\n            btnCb(false);\n\n            return;\n          }\n        } catch (e) {\n          this.errors = [e];\n          btnCb(false);\n        }\n      }\n\n      if ( this.newCredential.metadata.name ) {\n        delete this.newCredential.metadata.generateName;\n      } else {\n        this.newCredential.metadata.generateName = 'cloud-credential-';\n      }\n\n      try {\n        const res = await this.newCredential.save();\n\n        this.credentialId = res.id;\n        // full cloud credential data is not stored in the cloud credentail CRD, but consuming components may want to use it\n        this.$emit('credential-created', fullCredential);\n        btnCb(true);\n      } catch (e) {\n        this.errors = [e];\n        btnCb(false);\n      }\n    },\n\n    createValidationChanged(passed) {\n      this.credCustomComponentValidation = passed;\n    },\n\n    backToExisting() {\n      this.credentialId = _NONE;\n    }\n  },\n};\n</script>\n\n<template>\n  <Loading v-if=\"$fetchState.pending\" />\n  <CruResource\n    v-else\n    :mode=\"mode\"\n    :validation-passed=\"validationPassed\"\n    :resource=\"newCredential\"\n    :can-yaml=\"false\"\n    :cancel-event=\"true\"\n    :errors=\"errors\"\n    finish-button-mode=\"continue\"\n    class=\"select-credentials\"\n    :class=\"{'select-credentials__showingForm': showingForm}\"\n    @finish=\"save\"\n    @cancel=\"cancel\"\n    @error=\"e=>errors = e\"\n  >\n    <div v-if=\"isNew\">\n      <Banner\n        :label=\"t('cluster.credential.banner.createCredential', {length: options.length}, true)\"\n        color=\"info\"\n      />\n\n      <NameNsDescription\n        v-model=\"newCredential\"\n        :namespaced=\"false\"\n        :description-hidden=\"true\"\n        name-key=\"name\"\n        name-label=\"cluster.credential.name.label\"\n        name-placeholder=\"cluster.credential.name.placeholder\"\n        mode=\"create\"\n        @change=\"handleNameRequiredValidation\"\n      />\n\n      <component\n        :is=\"createComponent\"\n        ref=\"create\"\n        v-model=\"newCredential\"\n        mode=\"create\"\n        :driver-name=\"driverName\"\n        @validationChanged=\"createValidationChanged\"\n      />\n    </div>\n    <div v-else>\n      <Banner\n        v-if=\"!credentialId\"\n        label=\"First you need to pick or create the cloud credential that will be used to create the nodes for the cluster...\"\n        color=\"info\"\n      />\n\n      <LabeledSelect\n        v-model=\"credentialId\"\n        :label=\"t('cluster.credential.label')\"\n        :options=\"options\"\n        option-key=\"value\"\n        :mode=\"mode\"\n        :selectable=\"option => !option.disabled\"\n        data-testid=\"cluster-prov-select-credential\"\n      />\n    </div>\n\n    <template\n      v-if=\"isNew && options.length\"\n      #footer-prefix\n    >\n      <button\n        class=\"btn role-secondary\"\n        @click=\"backToExisting()\"\n      >\n        {{ t('cluster.credential.selectExisting.label') }}\n      </button>\n    </template>\n\n    <template\n      v-if=\"isPicked\"\n      #form-footer\n    >\n      <div><!-- Hide the outer footer --></div>\n    </template>\n  </CruResource>\n</template>\n\n<style lang='scss' scoped>\n  .select-credentials {\n    flex-grow: 1; // Do grow when on own\n    &__showingForm {\n      flex-grow: 0; // Don't grow when in rke2 form\n    }\n  }\n</style>\n"]}]}