{"remainingRequest":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ubuntu/suseconf/node_modules/@rancher/shell/pages/c/_cluster/uiplugins/CatalogList/CatalogUninstallDialog.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/pages/c/_cluster/uiplugins/CatalogList/CatalogUninstallDialog.vue","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1725271300920}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JzsKCmltcG9ydCB7IENBVEFMT0csIFVJX1BMVUdJTiwgU0VSVklDRSwgV09SS0xPQURfVFlQRVMgfSBmcm9tICdAc2hlbGwvY29uZmlnL3R5cGVzJzsKaW1wb3J0IHsgVUlfUExVR0lOX0xBQkVMUywgVUlfUExVR0lOX05BTUVTUEFDRSB9IGZyb20gJ0BzaGVsbC9jb25maWcvdWlwbHVnaW5zJzsKaW1wb3J0IHsgYWxsSGFzaCB9IGZyb20gJ0BzaGVsbC91dGlscy9wcm9taXNlJzsKCmltcG9ydCBBc3luY0J1dHRvbiBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9Bc3luY0J1dHRvbic7CmltcG9ydCBBcHBNb2RhbCBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9BcHBNb2RhbC52dWUnOwoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsgQXN5bmNCdXR0b24sIEFwcE1vZGFsIH0sCgogIGFzeW5jIGZldGNoKCkgewogICAgaWYgKCB0aGlzLiRzdG9yZS5nZXR0ZXJzWydtYW5hZ2VtZW50L3NjaGVtYUZvciddKFVJX1BMVUdJTikgKSB7CiAgICAgIGNvbnN0IHBsdWdpbnMgPSB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9maW5kQWxsJywgeyB0eXBlOiBVSV9QTFVHSU4gfSk7CgogICAgICB0aGlzLnBsdWdpbnMgPSBwbHVnaW5zIHx8IFtdOwogICAgfQogIH0sCgogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBjYXRhbG9nOiB1bmRlZmluZWQsIGJ1c3k6IGZhbHNlLCBwbHVnaW5zOiBudWxsLCBzaG93TW9kYWw6IGZhbHNlLAogICAgfTsKICB9LAoKICBjb21wdXRlZDogewogICAgLi4ubWFwR2V0dGVycyh7IGFsbENoYXJ0czogJ2NhdGFsb2cvY2hhcnRzJyB9KSwKCiAgICBwbHVnaW5zRnJvbUNhdGFsb2dJbWFnZSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGx1Z2lucy5maWx0ZXIoKHApID0+IHAubWV0YWRhdGE/LmxhYmVscz8uW1VJX1BMVUdJTl9MQUJFTFMuQ0FUQUxPR19JTUFHRV0pOwogICAgfQogIH0sCgogIG1ldGhvZHM6IHsKICAgIHNob3dEaWFsb2coY2F0YWxvZykgewogICAgICB0aGlzLmNhdGFsb2cgPSBjYXRhbG9nOwogICAgICB0aGlzLmJ1c3kgPSBmYWxzZTsKICAgICAgdGhpcy5zaG93TW9kYWwgPSB0cnVlOwogICAgfSwKCiAgICBjbG9zZURpYWxvZyhyZXN1bHQpIHsKICAgICAgdGhpcy5zaG93TW9kYWwgPSBmYWxzZTsKICAgICAgdGhpcy4kZW1pdCgnY2xvc2VkJywgcmVzdWx0KTsKCiAgICAgIGlmICggcmVzdWx0ICkgewogICAgICAgIHRoaXMuJGVtaXQoJ3JlZnJlc2gnKTsKICAgICAgfQogICAgfSwKCiAgICBhc3luYyB1bmluc3RhbGwoKSB7CiAgICAgIHRoaXMuYnVzeSA9IHRydWU7CgogICAgICBjb25zdCBjYXRhbG9nID0gdGhpcy5jYXRhbG9nOwogICAgICBjb25zdCBhcHBzID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZEFsbCcsIHsgdHlwZTogQ0FUQUxPRy5BUFAgfSk7CiAgICAgIGNvbnN0IHBsdWdpbkFwcHMgPSBhcHBzLmZpbHRlcigoYXBwKSA9PiB7CiAgICAgICAgaWYgKCBhcHAubmFtZXNwYWNlID09PSBVSV9QTFVHSU5fTkFNRVNQQUNFICkgewogICAgICAgICAgLy8gRmluZCB0aGUgcmVsYXRlZCBhcHBzIGZyb20gdGhlIGRlcGxveWVkIGhlbG0gcmVwb3NpdG9yeQogICAgICAgICAgY29uc3QgY2hhcnRzID0gdGhpcy5hbGxDaGFydHMuZmlsdGVyKChjaGFydCkgPT4gY2hhcnQucmVwb05hbWUgPT09IGNhdGFsb2cucmVwbz8ubWV0YWRhdGE/Lm5hbWUpOwoKICAgICAgICAgIHJldHVybiBjaGFydHMuc29tZSgoY2hhcnQpID0+IGNoYXJ0LmNoYXJ0TmFtZSA9PT0gYXBwLm1ldGFkYXRhLm5hbWUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9KTsKCiAgICAgIGF3YWl0IHRoaXMucmVtb3ZlQ2F0YWxvZ1Jlc291cmNlcyhjYXRhbG9nKTsKCiAgICAgIGlmICggcGx1Z2luQXBwcy5sZW5ndGggKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHBsdWdpbkFwcHMuZm9yRWFjaCgoYXBwKSA9PiB7CiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ3VwZGF0ZScsIGFwcC5uYW1lLCAndW5pbnN0YWxsJyk7CiAgICAgICAgICAgIGFwcC5yZW1vdmUoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdncm93bC9lcnJvcicsIHsKICAgICAgICAgICAgdGl0bGU6ICAgdGhpcy50KCdwbHVnaW5zLmVycm9yLmdlbmVyaWMnKSwKICAgICAgICAgICAgbWVzc2FnZTogZS5tZXNzYWdlID8gZS5tZXNzYWdlIDogZSwKICAgICAgICAgICAgdGltZW91dDogMTAwMDAKICAgICAgICAgIH0sIHsgcm9vdDogdHJ1ZSB9KTsKICAgICAgICB9CgogICAgICAgIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtYW5hZ2VtZW50L2ZpbmRBbGwnLCB7IHR5cGU6IENBVEFMT0cuT1BFUkFUSU9OIH0pOwogICAgICB9CgogICAgICB0aGlzLmNsb3NlRGlhbG9nKGNhdGFsb2cpOwogICAgfSwKCiAgICBhc3luYyByZW1vdmVDYXRhbG9nUmVzb3VyY2VzKGNhdGFsb2cpIHsKICAgICAgY29uc3Qgc2VsZWN0b3IgPSBgJHsgVUlfUExVR0lOX0xBQkVMUy5DQVRBTE9HX0lNQUdFIH09JHsgY2F0YWxvZy5uYW1lIH1gOwogICAgICBjb25zdCBuYW1lc3BhY2UgPSBVSV9QTFVHSU5fTkFNRVNQQUNFOwoKICAgICAgaWYgKCBzZWxlY3RvciApIHsKICAgICAgICBjb25zdCBoYXNoID0gYXdhaXQgYWxsSGFzaCh7CiAgICAgICAgICBkZXBsb3ltZW50OiB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9maW5kTWF0Y2hpbmcnLCB7CiAgICAgICAgICAgIHR5cGU6IFdPUktMT0FEX1RZUEVTLkRFUExPWU1FTlQsIHNlbGVjdG9yLCBuYW1lc3BhY2UKICAgICAgICAgIH0pLAogICAgICAgICAgc2VydmljZTogdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZE1hdGNoaW5nJywgewogICAgICAgICAgICB0eXBlOiBTRVJWSUNFLCBzZWxlY3RvciwgbmFtZXNwYWNlCiAgICAgICAgICB9KSwKICAgICAgICAgIHJlcG86IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtYW5hZ2VtZW50L2ZpbmRNYXRjaGluZycsIHsgdHlwZTogQ0FUQUxPRy5DTFVTVEVSX1JFUE8sIHNlbGVjdG9yIH0pCiAgICAgICAgfSk7CgogICAgICAgIGZvciAoIGNvbnN0IHJlc291cmNlIG9mIE9iamVjdC5rZXlzKGhhc2gpICkgewogICAgICAgICAgaWYgKCBoYXNoW3Jlc291cmNlXSApIHsKICAgICAgICAgICAgaGFzaFtyZXNvdXJjZV0uZm9yRWFjaCgocikgPT4gci5yZW1vdmUoKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9Owo="},{"version":3,"sources":["CatalogUninstallDialog.vue"],"names":[],"mappings":";AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CatalogUninstallDialog.vue","sourceRoot":"node_modules/@rancher/shell/pages/c/_cluster/uiplugins/CatalogList","sourcesContent":["<script>\nimport { mapGetters } from 'vuex';\n\nimport { CATALOG, UI_PLUGIN, SERVICE, WORKLOAD_TYPES } from '@shell/config/types';\nimport { UI_PLUGIN_LABELS, UI_PLUGIN_NAMESPACE } from '@shell/config/uiplugins';\nimport { allHash } from '@shell/utils/promise';\n\nimport AsyncButton from '@shell/components/AsyncButton';\nimport AppModal from '@shell/components/AppModal.vue';\n\nexport default {\n  components: { AsyncButton, AppModal },\n\n  async fetch() {\n    if ( this.$store.getters['management/schemaFor'](UI_PLUGIN) ) {\n      const plugins = this.$store.dispatch('management/findAll', { type: UI_PLUGIN });\n\n      this.plugins = plugins || [];\n    }\n  },\n\n  data() {\n    return {\n      catalog: undefined, busy: false, plugins: null, showModal: false,\n    };\n  },\n\n  computed: {\n    ...mapGetters({ allCharts: 'catalog/charts' }),\n\n    pluginsFromCatalogImage() {\n      return this.plugins.filter((p) => p.metadata?.labels?.[UI_PLUGIN_LABELS.CATALOG_IMAGE]);\n    }\n  },\n\n  methods: {\n    showDialog(catalog) {\n      this.catalog = catalog;\n      this.busy = false;\n      this.showModal = true;\n    },\n\n    closeDialog(result) {\n      this.showModal = false;\n      this.$emit('closed', result);\n\n      if ( result ) {\n        this.$emit('refresh');\n      }\n    },\n\n    async uninstall() {\n      this.busy = true;\n\n      const catalog = this.catalog;\n      const apps = await this.$store.dispatch('management/findAll', { type: CATALOG.APP });\n      const pluginApps = apps.filter((app) => {\n        if ( app.namespace === UI_PLUGIN_NAMESPACE ) {\n          // Find the related apps from the deployed helm repository\n          const charts = this.allCharts.filter((chart) => chart.repoName === catalog.repo?.metadata?.name);\n\n          return charts.some((chart) => chart.chartName === app.metadata.name);\n        }\n\n        return false;\n      });\n\n      await this.removeCatalogResources(catalog);\n\n      if ( pluginApps.length ) {\n        try {\n          pluginApps.forEach((app) => {\n            this.$emit('update', app.name, 'uninstall');\n            app.remove();\n          });\n        } catch (e) {\n          this.$store.dispatch('growl/error', {\n            title:   this.t('plugins.error.generic'),\n            message: e.message ? e.message : e,\n            timeout: 10000\n          }, { root: true });\n        }\n\n        await this.$store.dispatch('management/findAll', { type: CATALOG.OPERATION });\n      }\n\n      this.closeDialog(catalog);\n    },\n\n    async removeCatalogResources(catalog) {\n      const selector = `${ UI_PLUGIN_LABELS.CATALOG_IMAGE }=${ catalog.name }`;\n      const namespace = UI_PLUGIN_NAMESPACE;\n\n      if ( selector ) {\n        const hash = await allHash({\n          deployment: this.$store.dispatch('management/findMatching', {\n            type: WORKLOAD_TYPES.DEPLOYMENT, selector, namespace\n          }),\n          service: this.$store.dispatch('management/findMatching', {\n            type: SERVICE, selector, namespace\n          }),\n          repo: this.$store.dispatch('management/findMatching', { type: CATALOG.CLUSTER_REPO, selector })\n        });\n\n        for ( const resource of Object.keys(hash) ) {\n          if ( hash[resource] ) {\n            hash[resource].forEach((r) => r.remove());\n          }\n        }\n      }\n    }\n  }\n};\n</script>\n\n<template>\n  <app-modal\n    v-if=\"showModal\"\n    name=\"uninstallCatalogDialog\"\n    height=\"auto\"\n    :scrollable=\"true\"\n    @close=\"closeDialog(false)\"\n  >\n    <div\n      v-if=\"catalog\"\n      class=\"plugin-install-dialog\"\n    >\n      <h4 class=\"mt-10\">\n        {{ t('plugins.uninstall.title', { name: catalog.name }) }}\n      </h4>\n      <div class=\"mt-10 dialog-panel\">\n        <div class=\"dialog-info\">\n          <p>\n            {{ t('plugins.uninstall.catalog') }}\n          </p>\n        </div>\n        <div class=\"dialog-buttons\">\n          <button\n            :disabled=\"busy\"\n            class=\"btn role-secondary\"\n            data-testid=\"uninstall-ext-modal-cancel-btn\"\n            @click=\"closeDialog(false)\"\n          >\n            {{ t('generic.cancel') }}\n          </button>\n          <AsyncButton\n            mode=\"uninstall\"\n            data-testid=\"uninstall-ext-modal-uninstall-btn\"\n            @click=\"uninstall()\"\n          />\n        </div>\n      </div>\n    </div>\n  </app-modal>\n</template>\n\n<style lang=\"scss\" scoped>\n  .plugin-install-dialog {\n    padding: 10px;\n\n    h4 {\n      font-weight: bold;\n    }\n\n    .dialog-panel {\n      display: flex;\n      flex-direction: column;\n      min-height: 100px;\n\n      .dialog-info {\n        flex: 1;\n      }\n    }\n\n    .dialog-buttons {\n      display: flex;\n      justify-content: flex-end;\n      margin-top: 10px;\n\n      > *:not(:last-child) {\n        margin-right: 10px;\n      }\n    }\n  }\n</style>\n"]}]}