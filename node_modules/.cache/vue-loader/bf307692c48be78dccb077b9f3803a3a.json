{"remainingRequest":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ubuntu/suseconf/node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster/index.vue","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1725271300920}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBDcmVhdGVFZGl0VmlldyBmcm9tICdAc2hlbGwvbWl4aW5zL2NyZWF0ZS1lZGl0LXZpZXcnOwppbXBvcnQgTG9hZGluZyBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9Mb2FkaW5nJzsKaW1wb3J0IENydVJlc291cmNlIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL0NydVJlc291cmNlJzsKaW1wb3J0IFNlbGVjdEljb25HcmlkIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL1NlbGVjdEljb25HcmlkJzsKaW1wb3J0IEVtYmVyUGFnZSBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9FbWJlclBhZ2UnOwppbXBvcnQgeyBUb2dnbGVTd2l0Y2ggfSBmcm9tICdAY29tcG9uZW50cy9Gb3JtL1RvZ2dsZVN3aXRjaCc7CmltcG9ydCB7CiAgQ0hBUlQsIEZST01fQ0xVU1RFUiwgU1VCX1RZUEUsIFJLRV9UWVBFLCBfRURJVCwgX0lNUE9SVCwgX0NPTkZJRywgX1ZJRVcKfSBmcm9tICdAc2hlbGwvY29uZmlnL3F1ZXJ5LXBhcmFtcyc7CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JzsKaW1wb3J0IHsgc29ydEJ5IH0gZnJvbSAnQHNoZWxsL3V0aWxzL3NvcnQnOwppbXBvcnQgeyBzZXQgfSBmcm9tICdAc2hlbGwvdXRpbHMvb2JqZWN0JzsKaW1wb3J0IHsgUFJPVklTSU9ORVIsIF9SS0UxLCBfUktFMiB9IGZyb20gJ0BzaGVsbC9zdG9yZS9wcmVmcyc7CmltcG9ydCB7IGZpbHRlckFuZEFycmFuZ2VDaGFydHMgfSBmcm9tICdAc2hlbGwvc3RvcmUvY2F0YWxvZyc7CmltcG9ydCB7IENBVEFMT0cgfSBmcm9tICdAc2hlbGwvY29uZmlnL2xhYmVscy1hbm5vdGF0aW9ucyc7CmltcG9ydCB7IENBUEksIE1BTkFHRU1FTlQsIERFRkFVTFRfV09SS1NQQUNFIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy90eXBlcyc7CmltcG9ydCB7IG1hcEZlYXR1cmUsIFJLRTIgYXMgUktFMl9GRUFUVVJFLCBSS0UxX1VJIH0gZnJvbSAnQHNoZWxsL3N0b3JlL2ZlYXR1cmVzJzsKaW1wb3J0IHsgYWxsSGFzaCB9IGZyb20gJ0BzaGVsbC91dGlscy9wcm9taXNlJzsKaW1wb3J0IHsgQkxBTktfQ0xVU1RFUiB9IGZyb20gJ0BzaGVsbC9zdG9yZS9zdG9yZS10eXBlcy5qcyc7CmltcG9ydCB7IEVMRU1FTlRBTF9QUk9EVUNUX05BTUUsIEVMRU1FTlRBTF9DTFVTVEVSX1BST1ZJREVSIH0gZnJvbSAnLi4vLi4vY29uZmlnL2VsZW1lbnRhbC10eXBlcyc7CmltcG9ydCBSa2UyQ29uZmlnIGZyb20gJy4vcmtlMic7CmltcG9ydCBJbXBvcnQgZnJvbSAnLi9pbXBvcnQnOwppbXBvcnQgeyBEUklWRVJfVE9fSU1QT1JUIH0gZnJvbSAnQHNoZWxsL21vZGVscy9tYW5hZ2VtZW50LmNhdHRsZS5pby5rb250YWluZXJkcml2ZXInOwoKY29uc3QgU09SVF9HUk9VUFMgPSB7CiAgdGVtcGxhdGU6ICAxLAogIGtvbnRhaW5lcjogMiwKICBya2UxOiAgICAgIDMsCiAgcmtlMjogICAgICAzLAogIHJlZ2lzdGVyOiAgNCwKICBjdXN0b206ICAgIDUsCiAgY3VzdG9tMTogICA1LAogIGN1c3RvbTI6ICAgNSwKfTsKCi8vIHVTZWQgdG8gcHJveHkgc3R5bGVzaGVldHMgZm9yIGN1c3RvbSBkcml2ZXJzIHRoYXQgcHJvdmlkZSBjdXN0b20gVUkgKFJLRTEpCmNvbnN0IFBST1hZX0VORFBPSU5UID0gJy9tZXRhL3Byb3h5JzsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnQ3J1Q2x1c3RlcicsCgogIGNvbXBvbmVudHM6IHsKICAgIENydVJlc291cmNlLAogICAgRW1iZXJQYWdlLAogICAgSW1wb3J0LAogICAgTG9hZGluZywKICAgIFJrZTJDb25maWcsCiAgICBTZWxlY3RJY29uR3JpZCwKICAgIFRvZ2dsZVN3aXRjaAogIH0sCgogIG1peGluczogW0NyZWF0ZUVkaXRWaWV3XSwKCiAgcHJvcHM6IHsKICAgIHJlYWxNb2RlOiB7CiAgICAgIHR5cGU6ICAgICBTdHJpbmcsCiAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgfSwKCiAgICBtb2RlOiB7CiAgICAgIHR5cGU6ICAgICBTdHJpbmcsCiAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgfSwKCiAgICB2YWx1ZTogewogICAgICB0eXBlOiAgICBPYmplY3QsCiAgICAgIGRlZmF1bHQ6IG51bGwsCiAgICB9LAoKICAgIC8qKgogICAgICogSW5oZXJpdGVkIGdsb2JhbCBpZGVudGlmaWVyIHByZWZpeCBmb3IgdGVzdHMKICAgICAqIERlZmluZSBhIHRlcm0gYmFzZWQgb24gdGhlIHBhcmVudCBjb21wb25lbnQgdG8gYXZvaWQgY29uZmxpY3RzIG9uIG11bHRpcGxlIGNvbXBvbmVudHMKICAgICAqLwogICAgY29tcG9uZW50VGVzdGlkOiB7CiAgICAgIHR5cGU6ICAgIFN0cmluZywKICAgICAgZGVmYXVsdDogJ2NsdXN0ZXItbWFuYWdlci1jcmVhdGUnCiAgICB9CiAgfSwKCiAgYXN5bmMgZmV0Y2goKSB7CiAgICBjb25zdCBoYXNoID0gewogICAgICAvLyBUaGVzZSBhcmVuJ3QgZXhwbGljaXRseSB1c2VkLCBidXQgbmVlZCB0byBiZSBsaXN0ZW5pbmcgZm9yIGNoYW5nZSBldmVudHMKICAgICAgbWdtdENsdXN0ZXJzOiB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9maW5kQWxsJywgeyB0eXBlOiBNQU5BR0VNRU5ULkNMVVNURVIgfSksCiAgICAgIHByb3ZDbHVzdGVyczogdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZEFsbCcsIHsgdHlwZTogQ0FQSS5SQU5DSEVSX0NMVVNURVIgfSksCgogICAgICBjYXRhbG9nOiB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnY2F0YWxvZy9sb2FkJyksCiAgICB9OwoKICAgIGlmICh0aGlzLiRzdG9yZS5nZXR0ZXJzW2BtYW5hZ2VtZW50L2Nhbkxpc3RgXShNQU5BR0VNRU5ULk5PREVfRFJJVkVSKSkgewogICAgICBoYXNoLm5vZGVEcml2ZXJzID0gdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZEFsbCcsIHsgdHlwZTogTUFOQUdFTUVOVC5OT0RFX0RSSVZFUiB9KTsKICAgIH0KCiAgICBpZiAodGhpcy4kc3RvcmUuZ2V0dGVyc1tgbWFuYWdlbWVudC9jYW5MaXN0YF0oTUFOQUdFTUVOVC5LT05UQUlORVJfRFJJVkVSKSkgewogICAgICBoYXNoLmtvbnRhaW5lckRyaXZlcnMgPSB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9maW5kQWxsJywgeyB0eXBlOiBNQU5BR0VNRU5ULktPTlRBSU5FUl9EUklWRVIgfSk7CiAgICB9CgogICAgaWYgKCB0aGlzLnZhbHVlLmlkICYmICF0aGlzLnZhbHVlLmlzUmtlMiApIHsKICAgICAgLy8gVGhlc2UgYXJlIG5lZWRlZCB0byByZXNvbHZlIHJlZmVyZW5jZXMgaW4gdGhlIG1nbXQgY2x1c3RlciAtPiBub2RlIHBvb2wgLT4gbm9kZSB0ZW1wbGF0ZSB0byBmaWd1cmUgb3V0IHdoYXQgcHJvdmlkZXIgdGhlIGNsdXN0ZXIgaXMgdXNpbmcKICAgICAgLy8gc28gdGhhdCB0aGUgZWRpdCBpZnJhbWUgZm9yIGVtYmVyIHBhZ2VzIGNhbiBnbyB0byB0aGUgcmlnaHQgcGxhY2UuCiAgICAgIGlmICh0aGlzLiRzdG9yZS5nZXR0ZXJzW2BtYW5hZ2VtZW50L2Nhbkxpc3RgXShNQU5BR0VNRU5ULk5PREVfUE9PTCkpIHsKICAgICAgICBoYXNoLnJrZTFOb2RlUG9vbHMgPSB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9maW5kQWxsJywgeyB0eXBlOiBNQU5BR0VNRU5ULk5PREVfUE9PTCB9KTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuJHN0b3JlLmdldHRlcnNbYG1hbmFnZW1lbnQvY2FuTGlzdGBdKE1BTkFHRU1FTlQuTk9ERV9URU1QTEFURSkpIHsKICAgICAgICBoYXNoLnJrZTFOb2RlVGVtcGxhdGVzID0gdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZEFsbCcsIHsgdHlwZTogTUFOQUdFTUVOVC5OT0RFX1RFTVBMQVRFIH0pOwogICAgICB9CiAgICB9CgogICAgY29uc3QgcmVzID0gYXdhaXQgYWxsSGFzaChoYXNoKTsKCiAgICB0aGlzLm5vZGVEcml2ZXJzID0gcmVzLm5vZGVEcml2ZXJzIHx8IFtdOwogICAgdGhpcy5rb250YWluZXJEcml2ZXJzID0gcmVzLmtvbnRhaW5lckRyaXZlcnMgfHwgW107CgogICAgaWYgKCAhdGhpcy52YWx1ZS5zcGVjICkgewogICAgICBzZXQodGhpcy52YWx1ZSwgJ3NwZWMnLCB7fSk7CiAgICB9CgogICAgaWYgKCAhdGhpcy52YWx1ZS5pZCApIHsKICAgICAgaWYgKCAhdGhpcy52YWx1ZS5tZXRhZGF0YSApIHsKICAgICAgICBzZXQodGhpcy52YWx1ZSwgJ21ldGFkYXRhJywge30pOwogICAgICB9CgogICAgICBzZXQodGhpcy52YWx1ZS5tZXRhZGF0YSwgJ25hbWVzcGFjZScsIERFRkFVTFRfV09SS1NQQUNFKTsKICAgIH0KCiAgICAvLyBGb3IgdGhlIG5vZGUgZHJpdmVycywgbG9vayBmb3IgY3VzdG9tIFVJIHRoYXQgd2UgY2FuIHVzZSB0byBzaG93IGFuIGljb24gKGlmIG5vdCBidWlsdC1pbikKICAgIHRoaXMubm9kZURyaXZlcnMuZm9yRWFjaCgoZHJpdmVyKSA9PiB7CiAgICAgIGlmICghZHJpdmVyLnNwZWM/LmJ1aWx0aW4gJiYgZHJpdmVyLnNwZWM/LnVpVXJsICYmIGRyaXZlci5zcGVjPy5hY3RpdmUpIHsKICAgICAgICBjb25zdCBuYW1lID0gZHJpdmVyLnNwZWM/LmRpc3BsYXlOYW1lIHx8IGRyaXZlci5pZDsKICAgICAgICBsZXQgY3NzVXJsID0gZHJpdmVyLnNwZWMudWlVcmwucmVwbGFjZSgvXC5qcyQvLCAnLmNzcycpOwoKICAgICAgICBpZiAoY3NzVXJsLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBjc3NVcmwuc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkgewogICAgICAgICAgY3NzVXJsID0gYCR7IFBST1hZX0VORFBPSU5UIH0vJHsgY3NzVXJsIH1gOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5sb2FkU3R5bGVzaGVldChjc3NVcmwsIGBkcml2ZXItdWktY3NzLSR7IGRyaXZlci5pZCB9YCk7CgogICAgICAgIHRoaXMuaWNvbkNsYXNzZXNbbmFtZV0gPSBgbWFjaGluZS1kcml2ZXIgJHsgbmFtZSB9YDsKICAgICAgfQogICAgfSk7CgogICAgLy8gQ3VzdG9tIFByb3ZpZGVycyBmcm9tIGV4dGVuc2lvbnMgLSBpbml0aWFsaXplIGVhY2ggd2l0aCB0aGUgc3RvcmUgYW5kIHRoZSBpMThuIHNlcnZpY2UKICAgIC8vIFdyYXAgaW4gdHJ5IC4uLiBjYXRjaCwgdG8gcHJldmVudCBlcnJvcnMgaW4gYW4gZXh0ZW5zaW9uIGJyZWFraW5nIHRoZSBwYWdlCiAgICB0cnkgewogICAgICBjb25zdCBleHRlbnNpb25DbGFzc2VzID0gdGhpcy4kcGx1Z2luLmxpc3REeW5hbWljKCdwcm92aXNpb25lcicpLm1hcCgobmFtZSkgPT4gdGhpcy4kcGx1Z2luLmdldER5bmFtaWMoJ3Byb3Zpc2lvbmVyJywgbmFtZSkpOwoKICAgICAgLy8gV2UgY2FuJ3QgcGFzcyBpbiB0aGlzLiRzdG9yZSBhcyB0aGlzIGxlYWRzIHRvIGEgY2lyY3VsYXItcmVmZXJlbmNlIHRoYXQgY2F1c2VzIFZ1ZSB0byBmcmVlemUsCiAgICAgIC8vIHNvIHBhc3MgaW4gc3BlY2lmaWMgc2VydmljZXMgdGhhdCB0aGUgcHJvdmlzaW9uZXIgZXh0ZW5zaW9uIG1heSBuZWVkCiAgICAgIHRoaXMuZXh0ZW5zaW9ucyA9IGV4dGVuc2lvbkNsYXNzZXMubWFwKChjKSA9PiBuZXcgYyh7CiAgICAgICAgZGlzcGF0Y2g6IHRoaXMuJHN0b3JlLmRpc3BhdGNoLAogICAgICAgIGdldHRlcnM6ICB0aGlzLiRzdG9yZS5nZXR0ZXJzLAogICAgICAgIGF4aW9zOiAgICB0aGlzLiRzdG9yZS4kYXhpb3MsCiAgICAgICAgJHBsdWdpbjogIHRoaXMuJHN0b3JlLmFwcC4kcGx1Z2luLAogICAgICAgIHQ6ICAgICAgICAoLi4uYXJncykgPT4gdGhpcy50LmFwcGx5KHRoaXMsIGFyZ3MpLAogICAgICAgIGlzQ3JlYXRlOiB0aGlzLmlzQ3JlYXRlLAogICAgICAgIGlzRWRpdDogICB0aGlzLmlzRWRpdCwKICAgICAgICBpc1ZpZXc6ICAgdGhpcy5pc1ZpZXcsCiAgICAgIH0pKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgbG9hZGluZyBwcm92aXNpb25lcihzKSBmcm9tIGV4dGVuc2lvbnMnLCBlKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCiAgICB9CiAgfSwKCiAgZGF0YSgpIHsKICAgIGNvbnN0IHN1YlR5cGUgPSB0aGlzLiRyb3V0ZS5xdWVyeVtTVUJfVFlQRV0gfHwgbnVsbDsKICAgIGNvbnN0IHJrZVR5cGUgPSB0aGlzLiRyb3V0ZS5xdWVyeVtSS0VfVFlQRV0gfHwgbnVsbDsKICAgIGNvbnN0IGNoYXJ0ID0gdGhpcy4kcm91dGUucXVlcnlbQ0hBUlRdIHx8IG51bGw7CiAgICBjb25zdCBpc0ltcG9ydCA9IHRoaXMucmVhbE1vZGUgPT09IF9JTVBPUlQ7CgogICAgcmV0dXJuIHsKICAgICAgbm9kZURyaXZlcnM6ICAgICAgW10sCiAgICAgIGtvbnRhaW5lckRyaXZlcnM6IFtdLAogICAgICBleHRlbnNpb25zOiAgICAgICBbXSwKICAgICAgc3ViVHlwZSwKICAgICAgcmtlVHlwZSwKICAgICAgY2hhcnQsCiAgICAgIGlzSW1wb3J0LAogICAgICBwcm92aWRlckNsdXN0ZXI6ICBudWxsLAogICAgICBpY29uQ2xhc3NlczogICAgICB7fSwKICAgIH07CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcEdldHRlcnMoeyBhbGxDaGFydHM6ICdjYXRhbG9nL2NoYXJ0cycgfSksCiAgICAuLi5tYXBHZXR0ZXJzKCd0eXBlLW1hcCcsIFsnYWN0aXZlUHJvZHVjdHMnXSksCiAgICAvLyBuZWVkZWQgdG8gcmVjcmVhdGUgbG9naWMgb24gbWFwUHJlZiBpbiBvcmRlciB0byBpbmNvcnBvcmF0ZSB0aGUgbG9naWMgYXJvdW5kIHRoZSBya2VUeXBlIHF1ZXJ5IHBhcmFtCiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vcmFuY2hlci9kYXNoYm9hcmQvaXNzdWVzLzYyOTkKICAgIHByZWZlcnJlZFByb3Zpc2lvbmVyOiB7CiAgICAgIGdldCgpIHsKICAgICAgICBpZiAodGhpcy5ya2VUeXBlKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5ya2VUeXBlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLmdldHRlcnNbJ3ByZWZzL2dldCddKFBST1ZJU0lPTkVSKTsKICAgICAgfSwKICAgICAgc2V0KHZhbHVlKSB7CiAgICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3ByZWZzL3NldCcsIHsga2V5OiBQUk9WSVNJT05FUiwgdmFsdWUgfSk7CiAgICAgIH0KICAgIH0sCiAgICBfUktFMTogKCkgPT4gX1JLRTEsCiAgICBfUktFMjogKCkgPT4gX1JLRTIsCgogICAgZW1iZXJMaW5rKCkgewogICAgICBpZiAodGhpcy52YWx1ZSkgewogICAgICAgIGlmICh0aGlzLnZhbHVlLnByb3Zpc2lvbmVyKSB7CiAgICAgICAgICBjb25zdCBtYXRjaGluZ1N1YnR5cGUgPSB0aGlzLnN1YlR5cGVzLmZpbmQoKHN0KSA9PiBzdC5pZC50b0xvd2VyQ2FzZSgpID09PSB0aGlzLnZhbHVlLnByb3Zpc2lvbmVyLnRvTG93ZXJDYXNlKCkgfHwgRFJJVkVSX1RPX0lNUE9SVFtzdC5pZC50b0xvd2VyQ2FzZSgpXSA9PT0gdGhpcy52YWx1ZS5wcm92aXNpb25lci50b0xvd2VyQ2FzZSgpKTsKCiAgICAgICAgICBpZiAobWF0Y2hpbmdTdWJ0eXBlKSB7CiAgICAgICAgICAgIHRoaXMuc2VsZWN0VHlwZShtYXRjaGluZ1N1YnR5cGUuaWQsIGZhbHNlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gRm9yIGN1c3RvbSBSS0UyIGNsdXN0ZXJzLCBkb24ndCBsb2FkIGFuIEVtYmVyIHBhZ2UuCiAgICAgICAgLy8gSXQgc2hvdWxkIGJlIHRoZSBkYXNoYm9hcmQuCiAgICAgICAgaWYgKCB0aGlzLnZhbHVlLmlzUmtlMiAmJiAoKHRoaXMudmFsdWUuaXNDdXN0b20gJiYgdGhpcy5tb2RlID09PSBfRURJVCkgfHwgKHRoaXMudmFsdWUuaXNDdXN0b20gJiYgdGhpcy5hcyA9PT0gX0NPTkZJRyAmJiB0aGlzLm1vZGUgPT09IF9WSUVXKSB8fCAodGhpcy5zdWJUeXBlIHx8ICcnKS50b0xvd2VyQ2FzZSgpID09PSAnY3VzdG9tJykpIHsKICAgICAgICAgIC8vIEZvciBhZG1pbnMsIHRoaXMudmFsdWUuaXNDdXN0b20gaXMgdXNlZCB0byBjaGVjayBpZiBpdCBpcyBhIGN1c3RvbSBjbHVzdGVyLgogICAgICAgICAgLy8gRm9yIGNsdXN0ZXIgb3duZXJzLCB0aGlzLnN1YnR5cGUgaXMgdXNlZC4KICAgICAgICAgIHRoaXMuc2VsZWN0VHlwZSgnY3VzdG9tJywgZmFsc2UpOwoKICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9CiAgICAgICAgLy8gRm9yIFJLRTIvSzNzIGNsdXN0ZXJzIHByb3Zpc2lvbmVkIGluIFJhbmNoZXIgd2l0aCBub2RlIHBvb2xzLAogICAgICAgIC8vIGRvIG5vdCB1c2UgYW4gaUZyYW1lZCBFbWJlciBwYWdlLgogICAgICAgIGlmICggdGhpcy52YWx1ZS5pc1JrZTIgJiYgdGhpcy52YWx1ZS5tYWNoaW5lUHJvdmlkZXIgKSB7CiAgICAgICAgICAvLyBFZGl0IGV4aXN0aW5nIFJLRTIKICAgICAgICAgIHRoaXMuc2VsZWN0VHlwZSh0aGlzLnZhbHVlLm1hY2hpbmVQcm92aWRlciwgZmFsc2UpOwoKICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9CiAgICAgICAgaWYgKCB0aGlzLnN1YlR5cGUgKSB7CiAgICAgICAgICAvLyBpZiBkcml2ZXIgdHlwZSBoYXMgYSBjdXN0b20gZm9ybSBjb21wb25lbnQsIGRvbid0IGxvYWQgYW4gZW1iZXIgcGFnZQogICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRTdWJUeXBlLmNvbXBvbmVudCkgewogICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBGb3IgUktFMSBhbmQgaG9zdGVkIEt1YmVybmV0ZXMgQ2x1c3RlcnMsIHNldCB0aGUgZW1iZXIgbGluawogICAgICAgICAgLy8gc28gdGhhdCB3ZSBsb2FkIHRoZSBwYWdlIHJhdGhlciB0aGFuIHVzaW5nIFJLRTIgY3JlYXRlCiAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFN1YlR5cGU/LmVtYmVyTGluaykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZFN1YlR5cGUuZW1iZXJMaW5rOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuc2VsZWN0VHlwZSh0aGlzLnN1YlR5cGUsIGZhbHNlKTsKCiAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgfQoKICAgICAgICBpZiAoIHRoaXMudmFsdWUubWdtdD8uZW1iZXJFZGl0UGF0aCApIHsKICAgICAgICAgIC8vIElmcmFtZSBhbiBvbGQgcGFnZQogICAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUubWdtdC5lbWJlckVkaXRQYXRoOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuICcnOwogICAgfSwKCiAgICBya2UyRW5hYmxlZDogICBtYXBGZWF0dXJlKFJLRTJfRkVBVFVSRSksCiAgICBya2UxVWlFbmFibGVkOiBtYXBGZWF0dXJlKFJLRTFfVUkpLAoKICAgIC8vIHRvZG8gbmIgaXMgdGhpcyBpbmZvIHN0b3JlZCBhbnl3aGVyZSBlbHNlLi4/CiAgICBzZWxlY3RlZFN1YlR5cGUoKSB7CiAgICAgIHJldHVybiB0aGlzLnN1YlR5cGUgPyB0aGlzLnN1YlR5cGVzLmZpbmQoKHMpID0+IHMuaWQgPT09IHRoaXMuc3ViVHlwZSkgOiBudWxsOwogICAgfSwKCiAgICBwcm92aXNpb25lcjogewogICAgICBnZXQoKSB7CiAgICAgICAgLy8gVGhpcyBjYW4gaW5jb3JyZWN0bHkgcmV0dXJuIHJrZTEgaW5zdGVhZAogICAgICAgIC8vIG9mIHJrZTIgZm9yIGNsdXN0ZXIgb3duZXJzLgogICAgICAgIGlmICggIXRoaXMucmtlMkVuYWJsZWQgKSB7CiAgICAgICAgICByZXR1cm4gX1JLRTE7CiAgICAgICAgfQoKICAgICAgICBpZiAoICF0aGlzLnJrZTFVaUVuYWJsZWQgKSB7CiAgICAgICAgICByZXR1cm4gX1JLRTI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpcy5wcmVmZXJyZWRQcm92aXNpb25lcjsKICAgICAgfSwKCiAgICAgIHNldChuZXUpIHsKICAgICAgICB0aGlzLnByZWZlcnJlZFByb3Zpc2lvbmVyID0gbmV1OwogICAgICB9LAogICAgfSwKCiAgICBpc1JrZTEoKSB7CiAgICAgIHJldHVybiB0aGlzLnByb3Zpc2lvbmVyID09PSBfUktFMTsKICAgIH0sCgogICAgaXNSa2UyKCkgewogICAgICByZXR1cm4gdGhpcy52YWx1ZS5pc1JrZTIgfHwgIXRoaXMuaXNSa2UxOwogICAgfSwKCiAgICB0ZW1wbGF0ZU9wdGlvbnMoKSB7CiAgICAgIGlmICggIXRoaXMucmtlMkVuYWJsZWQgKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CgogICAgICBjb25zdCBvdXQgPSBmaWx0ZXJBbmRBcnJhbmdlQ2hhcnRzKHRoaXMuYWxsQ2hhcnRzLCB7IHNob3dUeXBlczogQ0FUQUxPRy5fQ0xVU1RFUl9UUEwgfSk7CgogICAgICByZXR1cm4gb3V0OwogICAgfSwKCiAgICBzdWJUeXBlcygpIHsKICAgICAgY29uc3QgZ2V0dGVycyA9IHRoaXMuJHN0b3JlLmdldHRlcnM7CiAgICAgIGNvbnN0IGlzSW1wb3J0ID0gdGhpcy5pc0ltcG9ydDsKICAgICAgY29uc3QgaXNFbGVtZW50YWxBY3RpdmUgPSAhIXRoaXMuYWN0aXZlUHJvZHVjdHMuZmluZCgoaXRlbSkgPT4gaXRlbS5uYW1lID09PSBFTEVNRU5UQUxfUFJPRFVDVF9OQU1FKTsKICAgICAgbGV0IG91dCA9IFtdOwoKICAgICAgY29uc3QgdGVtcGxhdGVzID0gdGhpcy50ZW1wbGF0ZU9wdGlvbnM7CiAgICAgIGNvbnN0IHZ1ZUtvbnRhaW5lclR5cGVzID0gZ2V0dGVyc1sncGx1Z2lucy9jbHVzdGVyRHJpdmVycyddOwogICAgICBjb25zdCBtYWNoaW5lVHlwZXMgPSB0aGlzLm5vZGVEcml2ZXJzLmZpbHRlcigoeCkgPT4geC5zcGVjLmFjdGl2ZSAmJiB4LnN0YXRlID09PSAnYWN0aXZlJyk7CgogICAgICB0aGlzLmtvbnRhaW5lckRyaXZlcnMuZmlsdGVyKCh4KSA9PiAoaXNJbXBvcnQgPyB4LnNob3dJbXBvcnQgOiB4LnNob3dDcmVhdGUpKS5mb3JFYWNoKChvYmopID0+IHsKICAgICAgICBpZiAoIHZ1ZUtvbnRhaW5lclR5cGVzLmluY2x1ZGVzKG9iai5kcml2ZXJOYW1lKSApIHsKICAgICAgICAgIGFkZFR5cGUodGhpcy4kcGx1Z2luLCBvYmouZHJpdmVyTmFtZSwgJ2tvbnRhaW5lcicsIGZhbHNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYWRkVHlwZSh0aGlzLiRwbHVnaW4sIG9iai5kcml2ZXJOYW1lLCAna29udGFpbmVyJywgZmFsc2UsIChpc0ltcG9ydCA/IG9iai5lbWJlckltcG9ydFBhdGggOiBvYmouZW1iZXJDcmVhdGVQYXRoKSk7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIGlmICggaXNJbXBvcnQgKSB7CiAgICAgICAgYWRkVHlwZSh0aGlzLiRwbHVnaW4sICdpbXBvcnQnLCAnY3VzdG9tJywgZmFsc2UpOwogICAgICB9IGVsc2UgewogICAgICAgIHRlbXBsYXRlcy5mb3JFYWNoKChjaGFydCkgPT4gewogICAgICAgICAgb3V0LnB1c2goewogICAgICAgICAgICBpZDogICAgICAgICAgYGNoYXJ0OiR7IGNoYXJ0LmlkIH1gLAogICAgICAgICAgICBsYWJlbDogICAgICAgY2hhcnQuY2hhcnROYW1lRGlzcGxheSwKICAgICAgICAgICAgZGVzY3JpcHRpb246IGNoYXJ0LmNoYXJ0RGVzY3JpcHRpb24sCiAgICAgICAgICAgIGljb246ICAgICAgICBjaGFydC5pY29uIHx8IHJlcXVpcmUoJ35zaGVsbC9hc3NldHMvaW1hZ2VzL2dlbmVyaWMtY2F0YWxvZy5zdmcnKSwKICAgICAgICAgICAgZ3JvdXA6ICAgICAgICd0ZW1wbGF0ZScsCiAgICAgICAgICAgIHRhZzogICAgICAgICBnZXR0ZXJzWydpMThuL3QnXSgnZ2VuZXJpYy50ZWNoUHJldmlldycpCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHRoaXMuaXNSa2UxICkgewogICAgICAgICAgbWFjaGluZVR5cGVzLmZvckVhY2goKHR5cGUpID0+IHsKICAgICAgICAgICAgY29uc3QgaWQgPSB0eXBlLnNwZWMuZGlzcGxheU5hbWUgfHwgdHlwZS5pZDsKCiAgICAgICAgICAgIGFkZFR5cGUodGhpcy4kcGx1Z2luLCBpZCwgX1JLRTEsIGZhbHNlLCBgL2cvY2x1c3RlcnMvYWRkL2xhdW5jaC8keyBpZCB9YCwgdGhpcy5pY29uQ2xhc3Nlc1tpZF0sIHR5cGUpOwogICAgICAgICAgfSk7CgogICAgICAgICAgYWRkVHlwZSh0aGlzLiRwbHVnaW4sICdjdXN0b20nLCAnY3VzdG9tMScsIGZhbHNlLCAnL2cvY2x1c3RlcnMvYWRkL2xhdW5jaC9jdXN0b20nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWFjaGluZVR5cGVzLmZvckVhY2goKHR5cGUpID0+IHsKICAgICAgICAgICAgY29uc3QgaWQgPSB0eXBlLnNwZWMuZGlzcGxheU5hbWUgfHwgdHlwZS5pZDsKCiAgICAgICAgICAgIGFkZFR5cGUodGhpcy4kcGx1Z2luLCBpZCwgX1JLRTIsIGZhbHNlLCBudWxsLCB1bmRlZmluZWQsIHR5cGUpOwogICAgICAgICAgfSk7CgogICAgICAgICAgYWRkVHlwZSh0aGlzLiRwbHVnaW4sICdjdXN0b20nLCAnY3VzdG9tMicsIGZhbHNlKTsKCiAgICAgICAgICBpZiAoaXNFbGVtZW50YWxBY3RpdmUpIHsKICAgICAgICAgICAgYWRkVHlwZSh0aGlzLiRwbHVnaW4sIEVMRU1FTlRBTF9DTFVTVEVSX1BST1ZJREVSLCAnY3VzdG9tMicsIGZhbHNlKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEFkZCBmcm9tIGV4dGVuc2lvbnMKICAgICAgICB0aGlzLmV4dGVuc2lvbnMuZm9yRWFjaCgoZXh0KSA9PiB7CiAgICAgICAgICAvLyBpZiB0aGUgcmtlIHRvZ2dsZSBpcyBzZXQgdG8gcmtlMSwgZG9uJ3QgYWRkIGV4dGVuc2lvbnMgdGhhdCBzcGVjaWZ5IHJrZTIgZ3JvdXAKICAgICAgICAgIC8vIGRlZmF1bHQgZ3JvdXAgaXMgcmtlMgogICAgICAgICAgaWYgKCF0aGlzLmlzUmtlMiAmJiAoZXh0Lmdyb3VwID09PSBfUktFMiB8fCAhZXh0Lmdyb3VwKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICAvLyBEbyBub3Qgc2hvdyB0aGUgZXh0ZW5zaW9uIHByb3Zpc2lvbmVyIG9uIHRoZSBpbXBvcnQgY2x1c3RlciBwYWdlIHVubGVzcyBpdHMgZXhwbGljaXRseSBzZXQgdG8gZG8gc28KICAgICAgICAgIGlmIChpc0ltcG9ydCAmJiAhZXh0LnNob3dJbXBvcnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgLy8gQWxsb3cgZXh0ZW5zaW9ucyB0byBvdmVyd3JpdGUgcHJvdmlzaW9uZXJzIHdpdGggdGhlIHNhbWUgaWQKICAgICAgICAgIG91dCA9IG91dC5maWx0ZXIoKHR5cGUpID0+IHR5cGUuaWQgIT09IGV4dC5pZCk7CiAgICAgICAgICBhZGRFeHRlbnNpb25UeXBlKGV4dCwgZ2V0dGVycyk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXQ7CgogICAgICBmdW5jdGlvbiBhZGRFeHRlbnNpb25UeXBlKGV4dCwgZ2V0dGVycykgewogICAgICAgIGxldCBpY29uQ2xhc3MgPSBleHQuaWNvbkNsYXNzOwogICAgICAgIGxldCBpY29uID0gZXh0Lmljb247CgogICAgICAgIGlmIChpY29uKSB7CiAgICAgICAgICBpY29uQ2xhc3MgPSB1bmRlZmluZWQ7CiAgICAgICAgfSBlbHNlIGlmICghaWNvbkNsYXNzKSB7CiAgICAgICAgICBpY29uID0gcmVxdWlyZSgnfnNoZWxsL2Fzc2V0cy9pbWFnZXMvZ2VuZXJpYy1kcml2ZXIuc3ZnJyk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBzdWJ0eXBlID0gewogICAgICAgICAgaWQ6ICAgICAgICAgIGV4dC5pZCwKICAgICAgICAgIGxhYmVsOiAgICAgICBleHQubGFiZWwgfHwgZ2V0dGVyc1snaTE4bi90J10oYGNsdXN0ZXIucHJvdmlkZXIuJHsgZXh0LmlkIH1gKSwKICAgICAgICAgIGRlc2NyaXB0aW9uOiBleHQuZGVzY3JpcHRpb24sCiAgICAgICAgICBpY29uLAogICAgICAgICAgaWNvbkNsYXNzLAogICAgICAgICAgZ3JvdXA6ICAgICAgIGV4dC5ncm91cCB8fCBfUktFMiwKICAgICAgICAgIGRpc2FibGVkOiAgICBleHQuZGlzYWJsZWQgfHwgZmFsc2UsCiAgICAgICAgICBsaW5rOiAgICAgICAgZXh0LmxpbmssCiAgICAgICAgICB0YWc6ICAgICAgICAgZXh0LnRhZywKICAgICAgICAgIGNvbXBvbmVudDogICBleHQuY29tcG9uZW50CiAgICAgICAgfTsKCiAgICAgICAgb3V0LnB1c2goc3VidHlwZSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGFkZFR5cGUocGx1Z2luLCBpZCwgZ3JvdXAsIGRpc2FibGVkID0gZmFsc2UsIGVtYmVyTGluayA9IG51bGwsIGljb25DbGFzcyA9IHVuZGVmaW5lZCwgcHJvdmlkZXJDb25maWcgPSB1bmRlZmluZWQpIHsKICAgICAgICBjb25zdCBsYWJlbCA9IGdldHRlcnNbJ2kxOG4vd2l0aEZhbGxiYWNrJ10oYGNsdXN0ZXIucHJvdmlkZXIuIiR7IGlkIH0iYCwgbnVsbCwgaWQpOwogICAgICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gZ2V0dGVyc1snaTE4bi93aXRoRmFsbGJhY2snXShgY2x1c3Rlci5wcm92aWRlckRlc2NyaXB0aW9uLiIkeyBpZCB9ImAsIG51bGwsICcnKTsKICAgICAgICBjb25zdCB0YWcgPSAnJzsKCiAgICAgICAgLy8gTG9vayBhdCBleHRlbnNpb25zIGZpcnN0CiAgICAgICAgLy8gQW4gZXh0ZW5zaW9uIGNhbiBvdmVycmlkZSB0aGUgaWNvbiBmb3IgYSBwcm92aWRlciB3aXRoCiAgICAgICAgLy8gcGx1Z2luLnJlZ2lzdGVyKCdpbWFnZScsICdwcm92aWRlcnMvb3BlbnN0YWNrLnN2ZycsIHJlcXVpcmUoJ35zaGVsbC9hc3NldHMvaW1hZ2VzL3Byb3ZpZGVycy9leG9zY2FsZS5zdmcnKSk7CiAgICAgICAgbGV0IGljb24gPSBwbHVnaW4uZ2V0RHluYW1pYygnaW1hZ2UnLCBgcHJvdmlkZXJzLyR7IGlkIH0uc3ZnYCk7CgogICAgICAgIGlmICghaWNvbikgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWNvbiA9IHJlcXVpcmUoYH5zaGVsbC9hc3NldHMvaW1hZ2VzL3Byb3ZpZGVycy8keyBpZCB9LnN2Z2ApOwogICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICB9CgogICAgICAgIGlmIChpY29uKSB7CiAgICAgICAgICBpY29uQ2xhc3MgPSB1bmRlZmluZWQ7CiAgICAgICAgfSBlbHNlIGlmICghaWNvbkNsYXNzKSB7CiAgICAgICAgICBpY29uID0gcmVxdWlyZSgnfnNoZWxsL2Fzc2V0cy9pbWFnZXMvZ2VuZXJpYy1kcml2ZXIuc3ZnJyk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBzdWJ0eXBlID0gewogICAgICAgICAgaWQsCiAgICAgICAgICBsYWJlbCwKICAgICAgICAgIGRlc2NyaXB0aW9uLAogICAgICAgICAgaWNvbiwKICAgICAgICAgIGljb25DbGFzcywKICAgICAgICAgIGdyb3VwLAogICAgICAgICAgZGlzYWJsZWQsCiAgICAgICAgICBlbWJlckxpbmssCiAgICAgICAgICB0YWcsCiAgICAgICAgICBwcm92aWRlckNvbmZpZwogICAgICAgIH07CgogICAgICAgIG91dC5wdXNoKHN1YnR5cGUpOwogICAgICB9CiAgICB9LAoKICAgIGdyb3VwZWRTdWJUeXBlcygpIHsKICAgICAgY29uc3Qgb3V0ID0ge307CgogICAgICBmb3IgKCBjb25zdCByb3cgb2YgdGhpcy5zdWJUeXBlcyApIHsKICAgICAgICBjb25zdCBuYW1lID0gcm93Lmdyb3VwOwogICAgICAgIGxldCBlbnRyeSA9IG91dFtuYW1lXTsKCiAgICAgICAgaWYgKCAhZW50cnkgKSB7CiAgICAgICAgICBlbnRyeSA9IHsKICAgICAgICAgICAgbmFtZSwKICAgICAgICAgICAgbGFiZWw6IHRoaXMuJHN0b3JlLmdldHRlcnNbJ2kxOG4vd2l0aEZhbGxiYWNrJ10oYGNsdXN0ZXIucHJvdmlkZXJHcm91cC4iJHsgdGhpcy5pc0ltcG9ydCA/ICdyZWdpc3Rlci0nIDogJ2NyZWF0ZS0nIH0keyBuYW1lIH0iYCwgbnVsbCwgbmFtZSksCiAgICAgICAgICAgIHR5cGVzOiBbXSwKICAgICAgICAgICAgc29ydDogIFNPUlRfR1JPVVBTW25hbWVdLAogICAgICAgICAgfTsKCiAgICAgICAgICBvdXRbbmFtZV0gPSBlbnRyeTsKICAgICAgICB9CgogICAgICAgIGVudHJ5LnR5cGVzLnB1c2gocm93KTsKICAgICAgfQoKICAgICAgZm9yICggY29uc3QgayBpbiBvdXQgKSB7CiAgICAgICAgb3V0W2tdLnR5cGVzID0gc29ydEJ5KG91dFtrXS50eXBlcywgJ2xhYmVsJyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBzb3J0QnkoT2JqZWN0LnZhbHVlcyhvdXQpLCAnc29ydCcpOwogICAgfSwKCiAgICBmaXJzdE5vZGVEcml2ZXJJdGVtKCkgewogICAgICByZXR1cm4gdGhpcy5ncm91cGVkU3ViVHlwZXMuZmluZEluZGV4KChvYmopID0+IFtfUktFMSwgX1JLRTJdLmluY2x1ZGVzKG9iai5uYW1lKSk7CiAgICB9LAoKICAgIGZpcnN0Q3VzdG9tQ2x1c3Rlckl0ZW0oKSB7CiAgICAgIHJldHVybiB0aGlzLmdyb3VwZWRTdWJUeXBlcy5maW5kSW5kZXgoKG9iaikgPT4gWydjdXN0b20nLCAnY3VzdG9tMScsICdjdXN0b20yJ10uaW5jbHVkZXMob2JqLm5hbWUpKTsKICAgIH0sCiAgfSwKCiAgbWV0aG9kczogewogICAgc2hvd1JrZVRvZ2dsZShpKSB7CiAgICAgIGlmICh0aGlzLmlzSW1wb3J0IHx8ICF0aGlzLnJrZTJFbmFibGVkKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBpZiAodGhpcy5maXJzdE5vZGVEcml2ZXJJdGVtID49IDApIHsKICAgICAgICByZXR1cm4gaSA9PT0gdGhpcy5maXJzdE5vZGVEcml2ZXJJdGVtOwogICAgICB9CgogICAgICByZXR1cm4gaSA9PT0gdGhpcy5maXJzdEN1c3RvbUNsdXN0ZXJJdGVtOwogICAgfSwKCiAgICBsb2FkU3R5bGVzaGVldCh1cmwsIGlkKSB7CiAgICAgIGlmICggIWlkICkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ2xvYWRTdHlsZXNoZWV0IGNhbGxlZCB3aXRob3V0IGFuIGlkJyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZQoKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIC8vIENoZWNrIGlmIHRoZSBzdHlsZXNoZWV0IGhhcyBhbHJlYWR5IGJlZW4gbG9hZGVkCiAgICAgIGlmICggJChgIyR7aWR9YCkubGVuZ3RoID4gMCApIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZQogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpbmsnKTsKCiAgICAgIGxpbmsub25lcnJvciA9ICgpID0+IHsKICAgICAgICBsaW5rLnJlbW92ZSgpOwogICAgICB9OwogICAgICBsaW5rLnJlbCA9ICdzdHlsZXNoZWV0JzsKICAgICAgbGluay5zcmMgPSB1cmw7CiAgICAgIGxpbmsuaHJlZiA9IHVybDsKICAgICAgbGluay5pZCA9IGlkOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnSEVBRCcpWzBdLmFwcGVuZENoaWxkKGxpbmspOwogICAgfSwKCiAgICBjYW5jZWwoKSB7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICBuYW1lOiAgICdjLWNsdXN0ZXItcHJvZHVjdC1yZXNvdXJjZScsCiAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICBjbHVzdGVyOiAgdGhpcy4kcm91dGUucGFyYW1zLmNsdXN0ZXIsCiAgICAgICAgICBwcm9kdWN0OiAgdGhpcy4kc3RvcmUuZ2V0dGVyc1sncHJvZHVjdElkJ10sCiAgICAgICAgICByZXNvdXJjZTogQ0FQSS5SQU5DSEVSX0NMVVNURVIsCiAgICAgICAgfSwKICAgICAgfSk7CiAgICB9LAoKICAgIGNvbG9yRm9yKG9iaikgewogICAgICByZXR1cm4gYGNvbG9yJHsgU09SVF9HUk9VUFNbb2JqLmdyb3VwXSB8fCAxIH1gOwogICAgfSwKCiAgICBjbGlja2VkVHlwZShvYmopIHsKICAgICAgY29uc3QgaWQgPSBvYmouaWQ7CiAgICAgIGNvbnN0IHBhcnRzID0gaWQuc3BsaXQoJzonLCAyKTsKCiAgICAgIGlmICggcGFydHNbMF0gPT09ICdjaGFydCcgKSB7CiAgICAgICAgY29uc3QgY2hhcnQgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzWydjYXRhbG9nL2NoYXJ0J10oeyBrZXk6IHBhcnRzWzFdIH0pOwogICAgICAgIGxldCBsb2NhbENsdXN0ZXI7CgogICAgICAgIGlmICh0aGlzLiRzdG9yZS5nZXR0ZXJzW2BtYW5hZ2VtZW50L2Nhbkxpc3RgXShNQU5BR0VNRU5ULkNMVVNURVIpKSB7CiAgICAgICAgICBsb2NhbENsdXN0ZXIgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzWydtYW5hZ2VtZW50L2FsbCddKE1BTkFHRU1FTlQuQ0xVU1RFUikuZmluZCgoeCkgPT4geC5pc0xvY2FsKTsKICAgICAgICB9CgogICAgICAgIGNoYXJ0LmdvVG9JbnN0YWxsKEZST01fQ0xVU1RFUiwgbG9jYWxDbHVzdGVyPy5pZCB8fCBCTEFOS19DTFVTVEVSLCB0cnVlKTsKCiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChvYmoubGluaykgewogICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKG9iai5saW5rKTsKCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLiRyb3V0ZXIuYXBwbHlRdWVyeSh7IFtTVUJfVFlQRV06IGlkLCBbUktFX1RZUEVdOiB0aGlzLnByZWZlcnJlZFByb3Zpc2lvbmVyIH0pOwogICAgICB0aGlzLnNlbGVjdFR5cGUoaWQpOwogICAgfSwKCiAgICBzZWxlY3RUeXBlKHR5cGUsIGZldGNoID0gdHJ1ZSkgewogICAgICBjb25zdCBwYXJ0cyA9IHR5cGUuc3BsaXQoJzonLCAyKTsKCiAgICAgIGlmICggcGFydHNbMF0gPT09ICdjaGFydCcgKSB7CiAgICAgICAgdGhpcy5zdWJUeXBlID0gJ2NoYXJ0JzsKICAgICAgICB0aGlzLiRlbWl0KCdzZXQtc3VidHlwZScsIHRoaXMuJHN0b3JlLmdldHRlcnNbJ2kxOG4vd2l0aEZhbGxiYWNrJ10oYGNsdXN0ZXIucHJvdmlkZXIuY2hhcnRgKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zdWJUeXBlID0gdHlwZTsKICAgICAgICB0aGlzLiRlbWl0KCdzZXQtc3VidHlwZScsIHRoaXMuJHN0b3JlLmdldHRlcnNbJ2kxOG4vd2l0aEZhbGxiYWNrJ10oYGNsdXN0ZXIucHJvdmlkZXIuIiR7IHR5cGUgfSJgLCBudWxsLCB0eXBlKSk7CiAgICAgIH0KCiAgICAgIGlmICggZmV0Y2ggKSB7CiAgICAgICAgdGhpcy4kZmV0Y2goKTsKICAgICAgfQogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster","sourcesContent":["<script>\nimport CreateEditView from '@shell/mixins/create-edit-view';\nimport Loading from '@shell/components/Loading';\nimport CruResource from '@shell/components/CruResource';\nimport SelectIconGrid from '@shell/components/SelectIconGrid';\nimport EmberPage from '@shell/components/EmberPage';\nimport { ToggleSwitch } from '@components/Form/ToggleSwitch';\nimport {\n  CHART, FROM_CLUSTER, SUB_TYPE, RKE_TYPE, _EDIT, _IMPORT, _CONFIG, _VIEW\n} from '@shell/config/query-params';\nimport { mapGetters } from 'vuex';\nimport { sortBy } from '@shell/utils/sort';\nimport { set } from '@shell/utils/object';\nimport { PROVISIONER, _RKE1, _RKE2 } from '@shell/store/prefs';\nimport { filterAndArrangeCharts } from '@shell/store/catalog';\nimport { CATALOG } from '@shell/config/labels-annotations';\nimport { CAPI, MANAGEMENT, DEFAULT_WORKSPACE } from '@shell/config/types';\nimport { mapFeature, RKE2 as RKE2_FEATURE, RKE1_UI } from '@shell/store/features';\nimport { allHash } from '@shell/utils/promise';\nimport { BLANK_CLUSTER } from '@shell/store/store-types.js';\nimport { ELEMENTAL_PRODUCT_NAME, ELEMENTAL_CLUSTER_PROVIDER } from '../../config/elemental-types';\nimport Rke2Config from './rke2';\nimport Import from './import';\nimport { DRIVER_TO_IMPORT } from '@shell/models/management.cattle.io.kontainerdriver';\n\nconst SORT_GROUPS = {\n  template:  1,\n  kontainer: 2,\n  rke1:      3,\n  rke2:      3,\n  register:  4,\n  custom:    5,\n  custom1:   5,\n  custom2:   5,\n};\n\n// uSed to proxy stylesheets for custom drivers that provide custom UI (RKE1)\nconst PROXY_ENDPOINT = '/meta/proxy';\n\nexport default {\n  name: 'CruCluster',\n\n  components: {\n    CruResource,\n    EmberPage,\n    Import,\n    Loading,\n    Rke2Config,\n    SelectIconGrid,\n    ToggleSwitch\n  },\n\n  mixins: [CreateEditView],\n\n  props: {\n    realMode: {\n      type:     String,\n      required: true,\n    },\n\n    mode: {\n      type:     String,\n      required: true,\n    },\n\n    value: {\n      type:    Object,\n      default: null,\n    },\n\n    /**\n     * Inherited global identifier prefix for tests\n     * Define a term based on the parent component to avoid conflicts on multiple components\n     */\n    componentTestid: {\n      type:    String,\n      default: 'cluster-manager-create'\n    }\n  },\n\n  async fetch() {\n    const hash = {\n      // These aren't explicitly used, but need to be listening for change events\n      mgmtClusters: this.$store.dispatch('management/findAll', { type: MANAGEMENT.CLUSTER }),\n      provClusters: this.$store.dispatch('management/findAll', { type: CAPI.RANCHER_CLUSTER }),\n\n      catalog: this.$store.dispatch('catalog/load'),\n    };\n\n    if (this.$store.getters[`management/canList`](MANAGEMENT.NODE_DRIVER)) {\n      hash.nodeDrivers = this.$store.dispatch('management/findAll', { type: MANAGEMENT.NODE_DRIVER });\n    }\n\n    if (this.$store.getters[`management/canList`](MANAGEMENT.KONTAINER_DRIVER)) {\n      hash.kontainerDrivers = this.$store.dispatch('management/findAll', { type: MANAGEMENT.KONTAINER_DRIVER });\n    }\n\n    if ( this.value.id && !this.value.isRke2 ) {\n      // These are needed to resolve references in the mgmt cluster -> node pool -> node template to figure out what provider the cluster is using\n      // so that the edit iframe for ember pages can go to the right place.\n      if (this.$store.getters[`management/canList`](MANAGEMENT.NODE_POOL)) {\n        hash.rke1NodePools = this.$store.dispatch('management/findAll', { type: MANAGEMENT.NODE_POOL });\n      }\n\n      if (this.$store.getters[`management/canList`](MANAGEMENT.NODE_TEMPLATE)) {\n        hash.rke1NodeTemplates = this.$store.dispatch('management/findAll', { type: MANAGEMENT.NODE_TEMPLATE });\n      }\n    }\n\n    const res = await allHash(hash);\n\n    this.nodeDrivers = res.nodeDrivers || [];\n    this.kontainerDrivers = res.kontainerDrivers || [];\n\n    if ( !this.value.spec ) {\n      set(this.value, 'spec', {});\n    }\n\n    if ( !this.value.id ) {\n      if ( !this.value.metadata ) {\n        set(this.value, 'metadata', {});\n      }\n\n      set(this.value.metadata, 'namespace', DEFAULT_WORKSPACE);\n    }\n\n    // For the node drivers, look for custom UI that we can use to show an icon (if not built-in)\n    this.nodeDrivers.forEach((driver) => {\n      if (!driver.spec?.builtin && driver.spec?.uiUrl && driver.spec?.active) {\n        const name = driver.spec?.displayName || driver.id;\n        let cssUrl = driver.spec.uiUrl.replace(/\\.js$/, '.css');\n\n        if (cssUrl.startsWith('http://') || cssUrl.startsWith('https://')) {\n          cssUrl = `${ PROXY_ENDPOINT }/${ cssUrl }`;\n        }\n\n        this.loadStylesheet(cssUrl, `driver-ui-css-${ driver.id }`);\n\n        this.iconClasses[name] = `machine-driver ${ name }`;\n      }\n    });\n\n    // Custom Providers from extensions - initialize each with the store and the i18n service\n    // Wrap in try ... catch, to prevent errors in an extension breaking the page\n    try {\n      const extensionClasses = this.$plugin.listDynamic('provisioner').map((name) => this.$plugin.getDynamic('provisioner', name));\n\n      // We can't pass in this.$store as this leads to a circular-reference that causes Vue to freeze,\n      // so pass in specific services that the provisioner extension may need\n      this.extensions = extensionClasses.map((c) => new c({\n        dispatch: this.$store.dispatch,\n        getters:  this.$store.getters,\n        axios:    this.$store.$axios,\n        $plugin:  this.$store.app.$plugin,\n        t:        (...args) => this.t.apply(this, args),\n        isCreate: this.isCreate,\n        isEdit:   this.isEdit,\n        isView:   this.isView,\n      }));\n    } catch (e) {\n      console.error('Error loading provisioner(s) from extensions', e); // eslint-disable-line no-console\n    }\n  },\n\n  data() {\n    const subType = this.$route.query[SUB_TYPE] || null;\n    const rkeType = this.$route.query[RKE_TYPE] || null;\n    const chart = this.$route.query[CHART] || null;\n    const isImport = this.realMode === _IMPORT;\n\n    return {\n      nodeDrivers:      [],\n      kontainerDrivers: [],\n      extensions:       [],\n      subType,\n      rkeType,\n      chart,\n      isImport,\n      providerCluster:  null,\n      iconClasses:      {},\n    };\n  },\n\n  computed: {\n    ...mapGetters({ allCharts: 'catalog/charts' }),\n    ...mapGetters('type-map', ['activeProducts']),\n    // needed to recreate logic on mapPref in order to incorporate the logic around the rkeType query param\n    // https://github.com/rancher/dashboard/issues/6299\n    preferredProvisioner: {\n      get() {\n        if (this.rkeType) {\n          return this.rkeType;\n        }\n\n        return this.$store.getters['prefs/get'](PROVISIONER);\n      },\n      set(value) {\n        this.$store.dispatch('prefs/set', { key: PROVISIONER, value });\n      }\n    },\n    _RKE1: () => _RKE1,\n    _RKE2: () => _RKE2,\n\n    emberLink() {\n      if (this.value) {\n        if (this.value.provisioner) {\n          const matchingSubtype = this.subTypes.find((st) => st.id.toLowerCase() === this.value.provisioner.toLowerCase() || DRIVER_TO_IMPORT[st.id.toLowerCase()] === this.value.provisioner.toLowerCase());\n\n          if (matchingSubtype) {\n            this.selectType(matchingSubtype.id, false);\n          }\n        }\n        // For custom RKE2 clusters, don't load an Ember page.\n        // It should be the dashboard.\n        if ( this.value.isRke2 && ((this.value.isCustom && this.mode === _EDIT) || (this.value.isCustom && this.as === _CONFIG && this.mode === _VIEW) || (this.subType || '').toLowerCase() === 'custom')) {\n          // For admins, this.value.isCustom is used to check if it is a custom cluster.\n          // For cluster owners, this.subtype is used.\n          this.selectType('custom', false);\n\n          return '';\n        }\n        // For RKE2/K3s clusters provisioned in Rancher with node pools,\n        // do not use an iFramed Ember page.\n        if ( this.value.isRke2 && this.value.machineProvider ) {\n          // Edit existing RKE2\n          this.selectType(this.value.machineProvider, false);\n\n          return '';\n        }\n        if ( this.subType ) {\n          // if driver type has a custom form component, don't load an ember page\n          if (this.selectedSubType.component) {\n            return '';\n          }\n          // For RKE1 and hosted Kubernetes Clusters, set the ember link\n          // so that we load the page rather than using RKE2 create\n          if (this.selectedSubType?.emberLink) {\n            return this.selectedSubType.emberLink;\n          }\n\n          this.selectType(this.subType, false);\n\n          return '';\n        }\n\n        if ( this.value.mgmt?.emberEditPath ) {\n          // Iframe an old page\n          return this.value.mgmt.emberEditPath;\n        }\n      }\n\n      return '';\n    },\n\n    rke2Enabled:   mapFeature(RKE2_FEATURE),\n    rke1UiEnabled: mapFeature(RKE1_UI),\n\n    // todo nb is this info stored anywhere else..?\n    selectedSubType() {\n      return this.subType ? this.subTypes.find((s) => s.id === this.subType) : null;\n    },\n\n    provisioner: {\n      get() {\n        // This can incorrectly return rke1 instead\n        // of rke2 for cluster owners.\n        if ( !this.rke2Enabled ) {\n          return _RKE1;\n        }\n\n        if ( !this.rke1UiEnabled ) {\n          return _RKE2;\n        }\n\n        return this.preferredProvisioner;\n      },\n\n      set(neu) {\n        this.preferredProvisioner = neu;\n      },\n    },\n\n    isRke1() {\n      return this.provisioner === _RKE1;\n    },\n\n    isRke2() {\n      return this.value.isRke2 || !this.isRke1;\n    },\n\n    templateOptions() {\n      if ( !this.rke2Enabled ) {\n        return [];\n      }\n\n      const out = filterAndArrangeCharts(this.allCharts, { showTypes: CATALOG._CLUSTER_TPL });\n\n      return out;\n    },\n\n    subTypes() {\n      const getters = this.$store.getters;\n      const isImport = this.isImport;\n      const isElementalActive = !!this.activeProducts.find((item) => item.name === ELEMENTAL_PRODUCT_NAME);\n      let out = [];\n\n      const templates = this.templateOptions;\n      const vueKontainerTypes = getters['plugins/clusterDrivers'];\n      const machineTypes = this.nodeDrivers.filter((x) => x.spec.active && x.state === 'active');\n\n      this.kontainerDrivers.filter((x) => (isImport ? x.showImport : x.showCreate)).forEach((obj) => {\n        if ( vueKontainerTypes.includes(obj.driverName) ) {\n          addType(this.$plugin, obj.driverName, 'kontainer', false);\n        } else {\n          addType(this.$plugin, obj.driverName, 'kontainer', false, (isImport ? obj.emberImportPath : obj.emberCreatePath));\n        }\n      });\n\n      if ( isImport ) {\n        addType(this.$plugin, 'import', 'custom', false);\n      } else {\n        templates.forEach((chart) => {\n          out.push({\n            id:          `chart:${ chart.id }`,\n            label:       chart.chartNameDisplay,\n            description: chart.chartDescription,\n            icon:        chart.icon || require('~shell/assets/images/generic-catalog.svg'),\n            group:       'template',\n            tag:         getters['i18n/t']('generic.techPreview')\n          });\n        });\n\n        if (this.isRke1 ) {\n          machineTypes.forEach((type) => {\n            const id = type.spec.displayName || type.id;\n\n            addType(this.$plugin, id, _RKE1, false, `/g/clusters/add/launch/${ id }`, this.iconClasses[id], type);\n          });\n\n          addType(this.$plugin, 'custom', 'custom1', false, '/g/clusters/add/launch/custom');\n        } else {\n          machineTypes.forEach((type) => {\n            const id = type.spec.displayName || type.id;\n\n            addType(this.$plugin, id, _RKE2, false, null, undefined, type);\n          });\n\n          addType(this.$plugin, 'custom', 'custom2', false);\n\n          if (isElementalActive) {\n            addType(this.$plugin, ELEMENTAL_CLUSTER_PROVIDER, 'custom2', false);\n          }\n        }\n\n        // Add from extensions\n        this.extensions.forEach((ext) => {\n          // if the rke toggle is set to rke1, don't add extensions that specify rke2 group\n          // default group is rke2\n          if (!this.isRke2 && (ext.group === _RKE2 || !ext.group)) {\n            return;\n          }\n          // Do not show the extension provisioner on the import cluster page unless its explicitly set to do so\n          if (isImport && !ext.showImport) {\n            return;\n          }\n          // Allow extensions to overwrite provisioners with the same id\n          out = out.filter((type) => type.id !== ext.id);\n          addExtensionType(ext, getters);\n        });\n      }\n\n      return out;\n\n      function addExtensionType(ext, getters) {\n        let iconClass = ext.iconClass;\n        let icon = ext.icon;\n\n        if (icon) {\n          iconClass = undefined;\n        } else if (!iconClass) {\n          icon = require('~shell/assets/images/generic-driver.svg');\n        }\n\n        const subtype = {\n          id:          ext.id,\n          label:       ext.label || getters['i18n/t'](`cluster.provider.${ ext.id }`),\n          description: ext.description,\n          icon,\n          iconClass,\n          group:       ext.group || _RKE2,\n          disabled:    ext.disabled || false,\n          link:        ext.link,\n          tag:         ext.tag,\n          component:   ext.component\n        };\n\n        out.push(subtype);\n      }\n\n      function addType(plugin, id, group, disabled = false, emberLink = null, iconClass = undefined, providerConfig = undefined) {\n        const label = getters['i18n/withFallback'](`cluster.provider.\"${ id }\"`, null, id);\n        const description = getters['i18n/withFallback'](`cluster.providerDescription.\"${ id }\"`, null, '');\n        const tag = '';\n\n        // Look at extensions first\n        // An extension can override the icon for a provider with\n        // plugin.register('image', 'providers/openstack.svg', require('~shell/assets/images/providers/exoscale.svg'));\n        let icon = plugin.getDynamic('image', `providers/${ id }.svg`);\n\n        if (!icon) {\n          try {\n            icon = require(`~shell/assets/images/providers/${ id }.svg`);\n          } catch (e) {}\n        }\n\n        if (icon) {\n          iconClass = undefined;\n        } else if (!iconClass) {\n          icon = require('~shell/assets/images/generic-driver.svg');\n        }\n\n        const subtype = {\n          id,\n          label,\n          description,\n          icon,\n          iconClass,\n          group,\n          disabled,\n          emberLink,\n          tag,\n          providerConfig\n        };\n\n        out.push(subtype);\n      }\n    },\n\n    groupedSubTypes() {\n      const out = {};\n\n      for ( const row of this.subTypes ) {\n        const name = row.group;\n        let entry = out[name];\n\n        if ( !entry ) {\n          entry = {\n            name,\n            label: this.$store.getters['i18n/withFallback'](`cluster.providerGroup.\"${ this.isImport ? 'register-' : 'create-' }${ name }\"`, null, name),\n            types: [],\n            sort:  SORT_GROUPS[name],\n          };\n\n          out[name] = entry;\n        }\n\n        entry.types.push(row);\n      }\n\n      for ( const k in out ) {\n        out[k].types = sortBy(out[k].types, 'label');\n      }\n\n      return sortBy(Object.values(out), 'sort');\n    },\n\n    firstNodeDriverItem() {\n      return this.groupedSubTypes.findIndex((obj) => [_RKE1, _RKE2].includes(obj.name));\n    },\n\n    firstCustomClusterItem() {\n      return this.groupedSubTypes.findIndex((obj) => ['custom', 'custom1', 'custom2'].includes(obj.name));\n    },\n  },\n\n  methods: {\n    showRkeToggle(i) {\n      if (this.isImport || !this.rke2Enabled) {\n        return false;\n      }\n\n      if (this.firstNodeDriverItem >= 0) {\n        return i === this.firstNodeDriverItem;\n      }\n\n      return i === this.firstCustomClusterItem;\n    },\n\n    loadStylesheet(url, id) {\n      if ( !id ) {\n        console.error('loadStylesheet called without an id'); // eslint-disable-line no-console\n\n        return;\n      }\n\n      // Check if the stylesheet has already been loaded\n      if ( $(`#${id}`).length > 0 ) { // eslint-disable-line\n        return;\n      }\n\n      const link = document.createElement('link');\n\n      link.onerror = () => {\n        link.remove();\n      };\n      link.rel = 'stylesheet';\n      link.src = url;\n      link.href = url;\n      link.id = id;\n      document.getElementsByTagName('HEAD')[0].appendChild(link);\n    },\n\n    cancel() {\n      this.$router.push({\n        name:   'c-cluster-product-resource',\n        params: {\n          cluster:  this.$route.params.cluster,\n          product:  this.$store.getters['productId'],\n          resource: CAPI.RANCHER_CLUSTER,\n        },\n      });\n    },\n\n    colorFor(obj) {\n      return `color${ SORT_GROUPS[obj.group] || 1 }`;\n    },\n\n    clickedType(obj) {\n      const id = obj.id;\n      const parts = id.split(':', 2);\n\n      if ( parts[0] === 'chart' ) {\n        const chart = this.$store.getters['catalog/chart']({ key: parts[1] });\n        let localCluster;\n\n        if (this.$store.getters[`management/canList`](MANAGEMENT.CLUSTER)) {\n          localCluster = this.$store.getters['management/all'](MANAGEMENT.CLUSTER).find((x) => x.isLocal);\n        }\n\n        chart.goToInstall(FROM_CLUSTER, localCluster?.id || BLANK_CLUSTER, true);\n\n        return;\n      }\n      if (obj.link) {\n        this.$router.push(obj.link);\n\n        return;\n      }\n\n      this.$router.applyQuery({ [SUB_TYPE]: id, [RKE_TYPE]: this.preferredProvisioner });\n      this.selectType(id);\n    },\n\n    selectType(type, fetch = true) {\n      const parts = type.split(':', 2);\n\n      if ( parts[0] === 'chart' ) {\n        this.subType = 'chart';\n        this.$emit('set-subtype', this.$store.getters['i18n/withFallback'](`cluster.provider.chart`));\n      } else {\n        this.subType = type;\n        this.$emit('set-subtype', this.$store.getters['i18n/withFallback'](`cluster.provider.\"${ type }\"`, null, type));\n      }\n\n      if ( fetch ) {\n        this.$fetch();\n      }\n    },\n  },\n};\n</script>\n\n<template>\n  <Loading v-if=\"$fetchState.pending\" />\n  <div\n    v-else-if=\"emberLink\"\n    class=\"embed\"\n  >\n    <EmberPage\n      :force-new=\"true\"\n      :src=\"emberLink\"\n    />\n  </div>\n  <CruResource\n    v-else\n    :mode=\"mode\"\n    :validation-passed=\"true\"\n    :selected-subtype=\"subType\"\n    :resource=\"value\"\n    :errors=\"errors\"\n    :subtypes=\"subTypes\"\n    :cancel-event=\"true\"\n    :prevent-enter-submit=\"true\"\n    class=\"create-cluster\"\n    @finish=\"save\"\n    @cancel=\"cancel\"\n    @select-type=\"selectType\"\n    @error=\"e=>errors = e\"\n  >\n    <template #subtypes>\n      <div\n        v-for=\"(obj, i) in groupedSubTypes\"\n        :key=\"obj.id\"\n        class=\"mb-20\"\n        style=\"width: 100%;\"\n      >\n        <h4>\n          <div\n            v-if=\"showRkeToggle(i) && rke1UiEnabled\"\n            class=\"grouped-type\"\n          >\n            <ToggleSwitch\n              v-model=\"provisioner\"\n              data-testid=\"cluster-manager-create-rke-switch\"\n              class=\"rke-switch\"\n              :off-value=\"_RKE1\"\n              :off-label=\"t('cluster.toggle.v1')\"\n              :on-value=\"_RKE2\"\n              :on-label=\"t('cluster.toggle.v2')\"\n            />\n          </div>\n          {{ obj.label }}\n        </h4>\n        <SelectIconGrid\n          :rows=\"obj.types\"\n          key-field=\"id\"\n          name-field=\"label\"\n          side-label-field=\"tag\"\n          :color-for=\"colorFor\"\n          component-testid=\"cluster-manager-create-grid\"\n          @clicked=\"clickedType\"\n        />\n      </div>\n    </template>\n\n    <Import\n      v-if=\"isImport\"\n      v-model=\"value\"\n      :mode=\"mode\"\n      :provider=\"subType\"\n    />\n    <template v-else-if=\"subType\">\n      <!-- allow extensions to provide their own cluster provisioning form -->\n      <component\n        :is=\"selectedSubType.component\"\n        v-if=\"selectedSubType && selectedSubType.component\"\n        v-model=\"value\"\n        :initial-value=\"initialValue\"\n        :live-value=\"liveValue\"\n        :mode=\"mode\"\n        :provider=\"subType\"\n        :provider-config=\"selectedSubType.providerConfig\"\n      />\n      <Rke2Config\n        v-else\n        v-model=\"value\"\n        :initial-value=\"initialValue\"\n        :live-value=\"liveValue\"\n        :mode=\"mode\"\n        :provider=\"subType\"\n        :provider-config=\"selectedSubType.providerConfig\"\n      />\n    </template>\n\n    <template\n      v-if=\"subType\"\n      #form-footer\n    >\n      <div><!-- Hide the outer footer --></div>\n    </template>\n  </CruResource>\n</template>\n\n<style lang='scss'>\n  .grouped-type {\n    position: relative;\n  }\n\n  .rke-switch {\n    margin-top: -10px;\n    position: absolute;\n    right: 0;\n  }\n</style>\n"]}]}