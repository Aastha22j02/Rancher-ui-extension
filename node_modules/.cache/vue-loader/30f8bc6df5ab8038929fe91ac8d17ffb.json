{"remainingRequest":"/home/ubuntu/susecon-2024-ext-demo/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ubuntu/susecon-2024-ext-demo/node_modules/@rancher/shell/pages/c/_cluster/uiplugins/AddExtensionRepos.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/@rancher/shell/pages/c/_cluster/uiplugins/AddExtensionRepos.vue","mtime":1725271280091},{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/babel-loader/lib/index.js","mtime":1725271298942},{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1725271300920}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IENBVEFMT0cgfSBmcm9tICdAc2hlbGwvY29uZmlnL3R5cGVzJzsKaW1wb3J0IERpYWxvZyBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9EaWFsb2cudnVlJzsKaW1wb3J0IENoZWNrYm94IGZyb20gJ0Bjb21wb25lbnRzL0Zvcm0vQ2hlY2tib3gvQ2hlY2tib3gudnVlJzsKaW1wb3J0IHsKICBVSV9QTFVHSU5TX1JFUE9fTkFNRSwKICBVSV9QTFVHSU5TX1JFUE9fVVJMLAogIFVJX1BMVUdJTlNfUkVQT19CUkFOQ0gsCiAgVUlfUExVR0lOU19QQVJUTkVSU19SRVBPX05BTUUsCiAgVUlfUExVR0lOU19QQVJUTkVSU19SRVBPX1VSTCwKICBVSV9QTFVHSU5TX1BBUlRORVJTX1JFUE9fQlJBTkNILAp9IGZyb20gJ0BzaGVsbC9jb25maWcvdWlwbHVnaW5zJzsKaW1wb3J0IHsgaXNSYW5jaGVyUHJpbWUgfSBmcm9tICdAc2hlbGwvY29uZmlnL3ZlcnNpb24nOwoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIENoZWNrYm94LAogICAgRGlhbG9nLAogIH0sCgogIGFzeW5jIGZldGNoKCkgewogICAgaWYgKHRoaXMuJHN0b3JlLmdldHRlcnNbJ21hbmFnZW1lbnQvc2NoZW1hRm9yJ10oQ0FUQUxPRy5DTFVTVEVSX1JFUE8pKSB7CiAgICAgIHRoaXMucmVwb3MgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9maW5kQWxsJywgeyB0eXBlOiBDQVRBTE9HLkNMVVNURVJfUkVQTywgb3B0OiB7IGZvcmNlOiB0cnVlIH0gfSk7CiAgICB9CiAgfSwKCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGVycm9yczogICBbXSwKICAgICAgcmVwb3M6ICAgIFtdLAogICAgICBwcmltZTogICAgaXNSYW5jaGVyUHJpbWUoKSwKICAgICAgYWRkUmVwb3M6IHsKICAgICAgICBvZmZpY2lhbDogdHJ1ZSwKICAgICAgICBwYXJ0bmVyczogdHJ1ZQogICAgICB9LAogICAgICByZXBvc0luZm86IHsKICAgICAgICBvZmZpY2lhbDogewogICAgICAgICAgcmVwbzogICB1bmRlZmluZWQsCiAgICAgICAgICBuYW1lOiAgIFVJX1BMVUdJTlNfUkVQT19OQU1FLAogICAgICAgICAgdXJsOiAgICBVSV9QTFVHSU5TX1JFUE9fVVJMLAogICAgICAgICAgYnJhbmNoOiBVSV9QTFVHSU5TX1JFUE9fQlJBTkNILAogICAgICAgIH0sCiAgICAgICAgcGFydG5lcnM6IHsKICAgICAgICAgIHJlcG86ICAgdW5kZWZpbmVkLAogICAgICAgICAgbmFtZTogICBVSV9QTFVHSU5TX1BBUlRORVJTX1JFUE9fTkFNRSwKICAgICAgICAgIHVybDogICAgVUlfUExVR0lOU19QQVJUTkVSU19SRVBPX1VSTCwKICAgICAgICAgIGJyYW5jaDogVUlfUExVR0lOU19QQVJUTkVSU19SRVBPX0JSQU5DSCwKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIGhhc1JhbmNoZXJVSVBsdWdpbnNSZXBvKCkgewogICAgICByZXR1cm4gISF0aGlzLnJlcG9zLmZpbmQoKHIpID0+IHIudXJsRGlzcGxheSA9PT0gVUlfUExVR0lOU19SRVBPX1VSTCk7CiAgICB9LAogICAgaGFzUmFuY2hlclVJUGFydG5lcnNQbHVnaW5zUmVwbygpIHsKICAgICAgcmV0dXJuICEhdGhpcy5yZXBvcy5maW5kKChyKSA9PiByLnVybERpc3BsYXkgPT09IFVJX1BMVUdJTlNfUEFSVE5FUlNfUkVQT19VUkwpOwogICAgfQogIH0sCgogIG1ldGhvZHM6IHsKICAgIHNob3dEaWFsb2coKSB7CiAgICAgIHRoaXMuYWRkUmVwb3MgPSB7CiAgICAgICAgb2ZmaWNpYWw6IGlzUmFuY2hlclByaW1lKCkgJiYgIXRoaXMuaGFzUmFuY2hlclVJUGx1Z2luc1JlcG8sCiAgICAgICAgcGFydG5lcnM6ICF0aGlzLmhhc1JhbmNoZXJVSVBhcnRuZXJzUGx1Z2luc1JlcG8sCiAgICAgIH07CiAgICAgIHRoaXMuJG1vZGFsLnNob3coJ2FkZC1leHRlbnNpb25zLXJlcG9zJyk7CiAgICB9LAoKICAgIGFzeW5jIGRvQWRkUmVwb3MoYnRuQ2IpIHsKICAgICAgdGhpcy5lcnJvcnMgPSBbXTsKICAgICAgY29uc3QgcHJvbWlzZXMgPSBbXTsKCiAgICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMuYWRkUmVwb3MpIHsKICAgICAgICBpZiAodGhpcy5hZGRSZXBvc1trZXldKSB7CiAgICAgICAgICBjb25zdCBwbHVnaW5DUiA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtYW5hZ2VtZW50L2NyZWF0ZScsIHsKICAgICAgICAgICAgdHlwZTogICAgIENBVEFMT0cuQ0xVU1RFUl9SRVBPLAogICAgICAgICAgICBtZXRhZGF0YTogeyBuYW1lOiB0aGlzLnJlcG9zSW5mb1trZXldLm5hbWUgfSwKICAgICAgICAgICAgc3BlYzogICAgIHsKICAgICAgICAgICAgICBnaXRCcmFuY2g6IHRoaXMucmVwb3NJbmZvW2tleV0uYnJhbmNoLAogICAgICAgICAgICAgIGdpdFJlcG86ICAgdGhpcy5yZXBvc0luZm9ba2V5XS51cmwsCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwoKICAgICAgICAgIHByb21pc2VzLnB1c2gocGx1Z2luQ1Iuc2F2ZSgpKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChwcm9taXNlcy5sZW5ndGgpIHsKICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBQcm9taXNlLmFsbFNldHRsZWQocHJvbWlzZXMpOwoKICAgICAgICByZXMuZm9yRWFjaCgocmVzdWx0KSA9PiB7CiAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1cyA9PT0gJ3JlamVjdGVkJykgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKHJlc3VsdC5yZWFzb24pOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKCiAgICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2gocmVzdWx0LnJlYXNvbik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRoaXMuJGVtaXQoJ2RvbmUnKTsKCiAgICAgIGJ0bkNiKHRydWUpOwogICAgfSwKICB9Cn07Cg=="},{"version":3,"sources":["AddExtensionRepos.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA","file":"AddExtensionRepos.vue","sourceRoot":"node_modules/@rancher/shell/pages/c/_cluster/uiplugins","sourcesContent":["<script>\nimport { CATALOG } from '@shell/config/types';\nimport Dialog from '@shell/components/Dialog.vue';\nimport Checkbox from '@components/Form/Checkbox/Checkbox.vue';\nimport {\n  UI_PLUGINS_REPO_NAME,\n  UI_PLUGINS_REPO_URL,\n  UI_PLUGINS_REPO_BRANCH,\n  UI_PLUGINS_PARTNERS_REPO_NAME,\n  UI_PLUGINS_PARTNERS_REPO_URL,\n  UI_PLUGINS_PARTNERS_REPO_BRANCH,\n} from '@shell/config/uiplugins';\nimport { isRancherPrime } from '@shell/config/version';\n\nexport default {\n  components: {\n    Checkbox,\n    Dialog,\n  },\n\n  async fetch() {\n    if (this.$store.getters['management/schemaFor'](CATALOG.CLUSTER_REPO)) {\n      this.repos = await this.$store.dispatch('management/findAll', { type: CATALOG.CLUSTER_REPO, opt: { force: true } });\n    }\n  },\n\n  data() {\n    return {\n      errors:   [],\n      repos:    [],\n      prime:    isRancherPrime(),\n      addRepos: {\n        official: true,\n        partners: true\n      },\n      reposInfo: {\n        official: {\n          repo:   undefined,\n          name:   UI_PLUGINS_REPO_NAME,\n          url:    UI_PLUGINS_REPO_URL,\n          branch: UI_PLUGINS_REPO_BRANCH,\n        },\n        partners: {\n          repo:   undefined,\n          name:   UI_PLUGINS_PARTNERS_REPO_NAME,\n          url:    UI_PLUGINS_PARTNERS_REPO_URL,\n          branch: UI_PLUGINS_PARTNERS_REPO_BRANCH,\n        }\n      }\n    };\n  },\n\n  computed: {\n    hasRancherUIPluginsRepo() {\n      return !!this.repos.find((r) => r.urlDisplay === UI_PLUGINS_REPO_URL);\n    },\n    hasRancherUIPartnersPluginsRepo() {\n      return !!this.repos.find((r) => r.urlDisplay === UI_PLUGINS_PARTNERS_REPO_URL);\n    }\n  },\n\n  methods: {\n    showDialog() {\n      this.addRepos = {\n        official: isRancherPrime() && !this.hasRancherUIPluginsRepo,\n        partners: !this.hasRancherUIPartnersPluginsRepo,\n      };\n      this.$modal.show('add-extensions-repos');\n    },\n\n    async doAddRepos(btnCb) {\n      this.errors = [];\n      const promises = [];\n\n      for (const key in this.addRepos) {\n        if (this.addRepos[key]) {\n          const pluginCR = await this.$store.dispatch('management/create', {\n            type:     CATALOG.CLUSTER_REPO,\n            metadata: { name: this.reposInfo[key].name },\n            spec:     {\n              gitBranch: this.reposInfo[key].branch,\n              gitRepo:   this.reposInfo[key].url,\n            }\n          });\n\n          promises.push(pluginCR.save());\n        }\n      }\n\n      if (promises.length) {\n        const res = await Promise.allSettled(promises);\n\n        res.forEach((result) => {\n          if (result.status === 'rejected') {\n            console.error(result.reason); // eslint-disable-line no-console\n\n            this.errors.push(result.reason);\n          }\n        });\n      }\n\n      this.$emit('done');\n\n      btnCb(true);\n    },\n  }\n};\n</script>\n<template>\n  <Dialog\n    name=\"add-extensions-repos\"\n    :title=\"t('plugins.addRepos.title')\"\n    mode=\"add\"\n    data-testid=\"add-extensions-repos-modal\"\n    @okay=\"doAddRepos\"\n  >\n    <template>\n      <p class=\"mb-20\">\n        {{ t('plugins.addRepos.prompt', {}, true) }}\n      </p>\n      <!-- Official repo -->\n      <div\n        v-if=\"prime\"\n        class=\"mb-15\"\n      >\n        <Checkbox\n          v-model=\"addRepos.official\"\n          :disabled=\"hasRancherUIPluginsRepo\"\n          :primary=\"true\"\n          label-key=\"plugins.setup.install.addRancherRepo\"\n          data-testid=\"add-extensions-repos-modal-add-official-repo\"\n        />\n        <div\n          v-if=\"hasRancherUIPluginsRepo\"\n          class=\"checkbox-info\"\n        >\n          ({{ t('plugins.setup.installed') }})\n        </div>\n      </div>\n      <!-- Partners repo -->\n      <div\n        class=\"mb-15\"\n      >\n        <Checkbox\n          v-model=\"addRepos.partners\"\n          :disabled=\"hasRancherUIPartnersPluginsRepo\"\n          :primary=\"true\"\n          label-key=\"plugins.setup.install.addPartnersRancherRepo\"\n          data-testid=\"add-extensions-repos-modal-add-partners-repo\"\n        />\n        <div\n          v-if=\"hasRancherUIPartnersPluginsRepo\"\n          class=\"checkbox-info\"\n        >\n          ({{ t('plugins.setup.installed') }})\n        </div>\n      </div>\n    </template>\n  </Dialog>\n</template>\n<style lang=\"scss\" scoped>\n  .enable-plugin-support {\n    font-size: 14px;\n    margin-top: 20px;\n  }\n\n  .plugin-setup-error {\n    font-size: 14px;\n    color: var(--error);\n    margin: 10px 0 0 0;\n  }\n\n  .checkbox-info {\n    margin-left: 20px;\n    opacity: 0.7;\n  }\n</style>\n"]}]}