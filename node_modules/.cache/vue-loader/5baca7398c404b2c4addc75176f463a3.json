{"remainingRequest":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ubuntu/suseconf/node_modules/@rancher/shell/components/GlobalRoleBindings.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/components/GlobalRoleBindings.vue","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1725271300920}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JzsKaW1wb3J0IHsgTUFOQUdFTUVOVCB9IGZyb20gJ0BzaGVsbC9jb25maWcvdHlwZXMnOwppbXBvcnQgeyBDaGVja2JveCB9IGZyb20gJ0Bjb21wb25lbnRzL0Zvcm0vQ2hlY2tib3gnOwppbXBvcnQgeyBfQ1JFQVRFLCBfVklFVyB9IGZyb20gJ0BzaGVsbC9jb25maWcvcXVlcnktcGFyYW1zJzsKaW1wb3J0IExvYWRpbmcgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvTG9hZGluZyc7CmltcG9ydCB7IGFkZE9iamVjdHMsIGlzQXJyYXkgfSBmcm9tICdAc2hlbGwvdXRpbHMvYXJyYXknOwppbXBvcnQgeyBDYXJkIH0gZnJvbSAnQGNvbXBvbmVudHMvQ2FyZCc7CgovLyBpMThuLXVzZXMgcmJhYy5nbG9iYWxSb2xlcy50eXBlcy4qLmxhYmVsCi8vIGkxOG4tdXNlcyByYmFjLmdsb2JhbFJvbGVzLnR5cGVzLiouZGVzY3JpcHRpb24KCi8qKgogKiBEaXNwbGF5IGNoZWNrYm94ZXMgZm9yIGVhY2ggZ2xvYmFsIHJvbGUsIGNoZWNrZWQgZm9yIGdpdmVuIHVzZXIgb3IgcHJpbmNpcGFsIChncm91cCkuIENhbiBzYXZlIGNoYW5nZXMuCiAqLwpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgQ2hlY2tib3gsCiAgICBMb2FkaW5nLAogICAgQ2FyZAogIH0sCiAgcHJvcHM6IHsKICAgIG1vZGU6IHsKICAgICAgdHlwZTogICAgU3RyaW5nLAogICAgICBkZWZhdWx0OiBfVklFVywKICAgIH0sCiAgICByZWFsTW9kZTogewogICAgICB0eXBlOiAgICBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6IF9WSUVXLAogICAgfSwKICAgIGFzc2lnbk9ubHk6IHsKICAgICAgdHlwZTogICAgQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UsCiAgICB9LAogICAgdHlwZTogewogICAgICB0eXBlOiAgICBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICdncm91cCcsCiAgICAgIHZhbGlkYXRvcih2YWwpIHsKICAgICAgICByZXR1cm4gdmFsID09PSAnZ3JvdXAnIHx8IHZhbCA9PT0gJ3VzZXInOwogICAgICB9CiAgICB9LAogICAgZ3JvdXBQcmluY2lwYWxJZDogewogICAgICB0eXBlOiAgICBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICcnCiAgICB9LAogICAgdXNlcklkOiB7CiAgICAgIHR5cGU6ICAgIFN0cmluZywKICAgICAgZGVmYXVsdDogJycKICAgIH0KICB9LAogIGFzeW5jIGZldGNoKCkgewogICAgdHJ5IHsKICAgICAgdGhpcy5hbGxSb2xlcyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtYW5hZ2VtZW50L2ZpbmRBbGwnLCB7IHR5cGU6IE1BTkFHRU1FTlQuR0xPQkFMX1JPTEUgfSk7CiAgICAgIGlmICghdGhpcy5zb3J0ZWRSb2xlcykgewogICAgICAgIHRoaXMuc29ydGVkUm9sZXMgPSB7CiAgICAgICAgICBnbG9iYWw6ICBbXSwKICAgICAgICAgIGJ1aWx0aW46IFtdLAogICAgICAgICAgY3VzdG9tOiAgW10KICAgICAgICB9OwoKICAgICAgICB0aGlzLmFsbFJvbGVzLmZvckVhY2goKHJvbGUpID0+IHsKICAgICAgICAgIGNvbnN0IHJvbGVUeXBlID0gdGhpcy5nZXRSb2xlVHlwZShyb2xlKTsKCiAgICAgICAgICBpZiAocm9sZVR5cGUpIHsKICAgICAgICAgICAgdGhpcy5zb3J0ZWRSb2xlc1tyb2xlVHlwZV0ucHVzaChyb2xlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgY29uc3Qgc29ydCA9IChhLCBiKSA9PiBhLm5hbWVEaXNwbGF5LmxvY2FsZUNvbXBhcmUoYi5uYW1lRGlzcGxheSk7CgogICAgICAgIC8vIGdsb2JhbCByb2xlcyBhcmUgbm90IHNvcnRlZAogICAgICAgIHRoaXMuc29ydGVkUm9sZXMuYnVpbHRpbiA9IHRoaXMuc29ydGVkUm9sZXMuYnVpbHRpbi5zb3J0KHNvcnQpOwogICAgICAgIHRoaXMuc29ydGVkUm9sZXMuY3VzdG9tID0gdGhpcy5zb3J0ZWRSb2xlcy5jdXN0b20uc29ydChzb3J0KTsKCiAgICAgICAgaWYgKCF0aGlzLmlzQ3JlYXRlKSB7CiAgICAgICAgICB0aGlzLmdsb2JhbFJvbGVCaW5kaW5ncyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtYW5hZ2VtZW50L2ZpbmRBbGwnLCB7IHR5cGU6IE1BTkFHRU1FTlQuR0xPQkFMX1JPTEVfQklORElORywgb3B0OiB7IGZvcmNlOiB0cnVlIH0gfSk7CiAgICAgICAgfQoKICAgICAgICAvLyBTb3J0IHRoZSBnbG9iYWwgcm9sZXMgLSB1c2UgdGhlIG9yZGVyIGRlZmluZWQgaW4gJ2dsb2JhbFBlcm1pc3Npb25zJyBhbmQgdGhlbiBhZGQgdGhlIHJlbWFpbmluZyByb2xlcyBhZnRlcgogICAgICAgIGNvbnN0IGdsb2JhbFJvbGVzID0gW107CiAgICAgICAgY29uc3QgZ2xvYmFsUm9sZXNBZGRlZCA9IHt9OwoKICAgICAgICB0aGlzLmdsb2JhbFBlcm1pc3Npb25zLmZvckVhY2goKGlkKSA9PiB7CiAgICAgICAgICBjb25zdCByb2xlID0gdGhpcy5zb3J0ZWRSb2xlcy5nbG9iYWwuZmluZCgocikgPT4gci5pZCA9PT0gaWQpOwoKICAgICAgICAgIGlmIChyb2xlKSB7CiAgICAgICAgICAgIGdsb2JhbFJvbGVzLnB1c2gocm9sZSk7CiAgICAgICAgICAgIGdsb2JhbFJvbGVzQWRkZWRbaWRdID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy8gUmVtYWluaW5nIGdsb2JhbCByb2xlcwogICAgICAgIGNvbnN0IHJlbWFpbmluZ0dsb2JhbFJvbGVzID0gdGhpcy5zb3J0ZWRSb2xlcy5nbG9iYWwuZmlsdGVyKChyKSA9PiAhZ2xvYmFsUm9sZXNBZGRlZFtyLmlkXSk7CgogICAgICAgIHRoaXMuc29ydGVkUm9sZXMuZ2xvYmFsID0gZ2xvYmFsUm9sZXM7CiAgICAgICAgdGhpcy5zb3J0ZWRSb2xlcy5nbG9iYWwucHVzaCguLi5yZW1haW5pbmdHbG9iYWxSb2xlcyk7CiAgICAgICAgLy8gRW5kIHNvcnQgb2YgZ2xvYmFsIHJvbGVzCgogICAgICAgIHRoaXMudXBkYXRlKCk7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsgfQogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIC8vIFRoaXMgbm90IG9ubHkgaWRlbnRpZmllcyBnbG9iYWwgcm9sZXMgYnV0IHRoZSBvcmRlciBoZXJlIGlzIHRoZSBvcmRlciB3ZSB3YW50IHRvIGRpc3BsYXkgdGhlbSBpbiB0aGUgVUkKICAgICAgZ2xvYmFsUGVybWlzc2lvbnM6IFsKICAgICAgICAnYWRtaW4nLAogICAgICAgICdyZXN0cmljdGVkLWFkbWluJywKICAgICAgICAndXNlcicsCiAgICAgICAgJ3VzZXItYmFzZScsCiAgICAgIF0sCiAgICAgIGdsb2JhbFJvbGVCaW5kaW5nczogICAgbnVsbCwKICAgICAgc29ydGVkUm9sZXM6ICAgICAgICAgICBudWxsLAogICAgICBzZWxlY3RlZFJvbGVzOiAgICAgICAgIFtdLAogICAgICBzdGFydGluZ1NlbGVjdGVkUm9sZXM6IFtdLAogICAgICBhc3NpZ25Pbmx5Um9sZXM6ICAgICAgIHt9LAogICAgICByb2xlQ2hhbmdlczogICAgICAgICAgIHt9CiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcEdldHRlcnMoWydyZWxlYXNlTm90ZXNVcmwnXSksCiAgICAuLi5tYXBHZXR0ZXJzKHsgdDogJ2kxOG4vdCcgfSksCgogICAgaXNDcmVhdGUoKSB7CiAgICAgIHJldHVybiB0aGlzLnJlYWxNb2RlID09PSBfQ1JFQVRFOwogICAgfSwKCiAgICBpc1VzZXIoKSB7CiAgICAgIHJldHVybiB0aGlzLnR5cGUgPT09ICd1c2VyJzsKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICBncm91cFByaW5jaXBhbElkKGdyb3VwUHJpbmNpcGFsSWQsIG9sZEdyb3VwUHJpbmNpcGFsSWQpIHsKICAgICAgaWYgKGdyb3VwUHJpbmNpcGFsSWQgPT09IG9sZEdyb3VwUHJpbmNpcGFsSWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy51cGRhdGUoKTsKICAgIH0sCiAgICB1c2VySWQodXNlcklkLCBvbGRVc2VySWQpIHsKICAgICAgaWYgKHVzZXJJZCA9PT0gb2xkVXNlcklkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBnZXRSb2xlVHlwZShyb2xlKSB7CiAgICAgIGlmICh0aGlzLmdsb2JhbFBlcm1pc3Npb25zLmZpbmQoKHApID0+IHAgPT09IHJvbGUuaWQpKSB7CiAgICAgICAgcmV0dXJuICdnbG9iYWwnOwogICAgICB9IGVsc2UgaWYgKHJvbGUuYnVpbHRpbikgewogICAgICAgIHJldHVybiAnYnVpbHRpbic7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICdjdXN0b20nOwogICAgICB9CiAgICB9LAogICAgZ2V0VW5pcXVlKC4uLmlkcykgewogICAgICByZXR1cm4gYCR7IHRoaXMuZ3JvdXBQcmluY2lwYWxJZCB8fCB0aGlzLnVzZXJJZCB9LSR7IGlkcy5qb2luKCctJykgfWA7CiAgICB9LAogICAgc2VsZWN0RGVmYXVsdHMoKSB7CiAgICAgIE9iamVjdC52YWx1ZXModGhpcy5zb3J0ZWRSb2xlcykuZm9yRWFjaCgocm9sZXMpID0+IHsKICAgICAgICByb2xlcy5mb3JFYWNoKChtYXBwZWRSb2xlKSA9PiB7CiAgICAgICAgICBpZiAobWFwcGVkUm9sZS5uZXdVc2VyRGVmYXVsdCkgewogICAgICAgICAgICB0aGlzLnNlbGVjdGVkUm9sZXMucHVzaChtYXBwZWRSb2xlLmlkKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgdXBkYXRlKCkgewogICAgICB0aGlzLnNlbGVjdGVkUm9sZXMgPSBbXTsKICAgICAgdGhpcy5zdGFydGluZ1NlbGVjdGVkUm9sZXMgPSBbXTsKICAgICAgdGhpcy5hc3NpZ25Pbmx5Um9sZXMgPSB7fTsKICAgICAgaWYgKHRoaXMuaXNDcmVhdGUpIHsKICAgICAgICAvLyBTdGFydCB3aXRoIHRoZSBuZXcgdXNlciBkZWZhdWx0IGZvciBlYWNoIHJvbGUKICAgICAgICB0aGlzLnNlbGVjdERlZmF1bHRzKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gU3RhcnQgd2l0aCB0aGUgcHJpbmNpcGFsL3VzZXIncyByb2xlcwogICAgICAgIGlmICghdGhpcy5ncm91cFByaW5jaXBhbElkICYmICF0aGlzLnVzZXJJZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgYm91bmRSb2xlcyA9IHRoaXMuZ2xvYmFsUm9sZUJpbmRpbmdzLmZpbHRlcigoZ3JiKSA9PiB7CiAgICAgICAgICByZXR1cm4gdGhpcy5ncm91cFByaW5jaXBhbElkID8gZ3JiLmdyb3VwUHJpbmNpcGFsTmFtZSA9PT0gdGhpcy5ncm91cFByaW5jaXBhbElkIDogZ3JiLnVzZXJOYW1lID09PSB0aGlzLnVzZXJJZDsKICAgICAgICB9KTsKCiAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnNvcnRlZFJvbGVzKS5mb3JFYWNoKChyb2xlcykgPT4gewogICAgICAgICAgcm9sZXMuZm9yRWFjaCgobWFwcGVkUm9sZSkgPT4gewogICAgICAgICAgICBjb25zdCBib3VuZFJvbGUgPSBib3VuZFJvbGVzLmZpbmQoKGJvdW5kUm9sZSkgPT4gYm91bmRSb2xlLmdsb2JhbFJvbGVOYW1lID09PSBtYXBwZWRSb2xlLmlkKTsKCiAgICAgICAgICAgIGlmICghIWJvdW5kUm9sZSkgewogICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRSb2xlcy5wdXNoKG1hcHBlZFJvbGUuaWQpOwogICAgICAgICAgICAgIHRoaXMuc3RhcnRpbmdTZWxlY3RlZFJvbGVzLnB1c2goewogICAgICAgICAgICAgICAgcm9sZUlkOiAgICBtYXBwZWRSb2xlLmlkLAogICAgICAgICAgICAgICAgYmluZGluZ0lkOiBib3VuZFJvbGUuaWQKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAvLyBDaGVja2JveGVzIHNob3VsZCBiZSBkaXNhYmxlZCwgYmVzaWRlcyBub3JtYWwgJ21vZGUnIHdheXMsIGlmIHdlJ3JlIG9ubHkgYXNzaWduaW5nIGFuZCBub3QgcmVtb3ZpbmcgZXhpc3Rpbmcgcm9sZXMKICAgICAgICAgICAgICB0aGlzLmFzc2lnbk9ubHlSb2xlc1ttYXBwZWRSb2xlLmlkXSA9IHRoaXMuYXNzaWduT25seTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIGlmICh0aGlzLmFzc2lnbk9ubHkgJiYgIXRoaXMuc2VsZWN0ZWRSb2xlcy5sZW5ndGgpIHsKICAgICAgICAgIC8vIElmIHdlJ3JlIGFzc2lnbmluZyByb2xlcyB0byBhIGdyb3VwIHRoYXQgaGFzIG5vIGV4aXN0aW5nIHJvbGVzIHN0YXJ0IHdpdGggdGhlIGRlZmF1bHQgcm9sZXMgc2VsZWN0ZWQKICAgICAgICAgIHRoaXMuc2VsZWN0RGVmYXVsdHMoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIEZvcmNlIGFuIHVwZGF0ZSB0byBwdW1wIG91dCB0aGUgaW5pdGlhbCBzdGF0ZQogICAgICB0aGlzLmNoZWNrYm94Q2hhbmdlZCgpOwogICAgfSwKICAgIGNoZWNrYm94Q2hhbmdlZCgpIHsKICAgICAgY29uc3QgYWRkUm9sZXMgPSB0aGlzLnNlbGVjdGVkUm9sZXMKICAgICAgICAuZmlsdGVyKChzZWxlY3RlZCkgPT4gIXRoaXMuc3RhcnRpbmdTZWxlY3RlZFJvbGVzLmZpbmQoKHN0YXJ0aW5nUm9sZSkgPT4gc3RhcnRpbmdSb2xlLnJvbGVJZCA9PT0gc2VsZWN0ZWQpKTsKICAgICAgY29uc3QgcmVtb3ZlQmluZGluZ3MgPSB0aGlzLnN0YXJ0aW5nU2VsZWN0ZWRSb2xlcwogICAgICAgIC5maWx0ZXIoKHN0YXJ0aW5nUm9sZSkgPT4gIXRoaXMuc2VsZWN0ZWRSb2xlcy5maW5kKChzZWxlY3RlZCkgPT4gc2VsZWN0ZWQgPT09IHN0YXJ0aW5nUm9sZS5yb2xlSWQpKQogICAgICAgIC5tYXAoKHN0YXJ0aW5nUm9sZSkgPT4gc3RhcnRpbmdSb2xlLmJpbmRpbmdJZCk7CgogICAgICB0aGlzLnJvbGVDaGFuZ2VzID0gewogICAgICAgIGluaXRpYWxSb2xlczogdGhpcy5zdGFydGluZ1NlbGVjdGVkUm9sZXMsCiAgICAgICAgYWRkUm9sZXMsCiAgICAgICAgcmVtb3ZlQmluZGluZ3MKICAgICAgfTsKCiAgICAgIHRoaXMuJGVtaXQoJ2hhc0NoYW5nZXMnLCAhIXRoaXMucm9sZUNoYW5nZXMuYWRkUm9sZXMubGVuZ3RoIHx8ICEhdGhpcy5yb2xlQ2hhbmdlcy5yZW1vdmVCaW5kaW5ncy5sZW5ndGgpOwogICAgICB0aGlzLiRlbWl0KCdjYW5Mb2dJbicsIHRoaXMuY29uZmlybVVzZXJDYW5Mb2dJbigpKTsKICAgICAgdGhpcy4kZW1pdCgnY2hhbmdlZCcsIHRoaXMucm9sZUNoYW5nZXMpOwogICAgfSwKICAgIGFzeW5jIHNhdmVBZGRlZFJvbGVzKHVzZXJJZCkgewogICAgICBjb25zdCByZXF1ZXN0T3B0aW9ucyA9IHsKICAgICAgICB0eXBlOiAgICAgTUFOQUdFTUVOVC5HTE9CQUxfUk9MRV9CSU5ESU5HLAogICAgICAgIG1ldGFkYXRhOiB7IGdlbmVyYXRlTmFtZTogYGdyYi1gIH0sCiAgICAgIH07CgogICAgICBpZiAodGhpcy5ncm91cFByaW5jaXBhbElkKSB7CiAgICAgICAgcmVxdWVzdE9wdGlvbnMuZ3JvdXBQcmluY2lwYWxOYW1lID0gdGhpcy5ncm91cFByaW5jaXBhbElkOwogICAgICB9IGVsc2UgewogICAgICAgIHJlcXVlc3RPcHRpb25zLnVzZXJOYW1lID0gdXNlcklkIHx8IHRoaXMudXNlcklkOwogICAgICB9CiAgICAgIGNvbnN0IG5ld0JpbmRpbmdzID0gYXdhaXQgUHJvbWlzZS5hbGwodGhpcy5yb2xlQ2hhbmdlcy5hZGRSb2xlcy5tYXAoKHJvbGUpID0+IHRoaXMuJHN0b3JlLmRpc3BhdGNoKGBtYW5hZ2VtZW50L2NyZWF0ZWAsIHsKICAgICAgICAuLi5yZXF1ZXN0T3B0aW9ucywKICAgICAgICBnbG9iYWxSb2xlTmFtZTogcm9sZSwKICAgICAgfSkpKTsKCiAgICAgIC8vIFNhdmUgYWxsIGNoYW5nZXMgKGFuZCBlbnN1cmUgdXNlciBpc24ndCBsb2dnZWQgb3V0IGlmIHRoZXkgZG9uJ3QgaGF2ZSBwZXJtaXNzaW9ucyB0byBtYWtlIGEgY2hhbmdlKQogICAgICBhd2FpdCBQcm9taXNlLmFsbChuZXdCaW5kaW5ncy5tYXAoKG5ld0JpbmRpbmcpID0+IG5ld0JpbmRpbmcuc2F2ZSh7IHJlZGlyZWN0VW5hdXRob3JpemVkOiBmYWxzZSB9KSkpOwogICAgfSwKICAgIGFzeW5jIHNhdmVSZW1vdmVkUm9sZXMoKSB7CiAgICAgIGNvbnN0IGV4aXN0aW5nQmluZGluZ3MgPSBhd2FpdCBQcm9taXNlLmFsbCh0aGlzLnJvbGVDaGFuZ2VzLnJlbW92ZUJpbmRpbmdzLm1hcCgoYmluZGluZ0lkKSA9PiB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9maW5kJywgewogICAgICAgIHR5cGU6IE1BTkFHRU1FTlQuR0xPQkFMX1JPTEVfQklORElORywKICAgICAgICBpZDogICBiaW5kaW5nSWQKICAgICAgfSkpKTsKCiAgICAgIC8vIFNhdmUgYWxsIGNoYW5nZXMgKGFuZCBlbnN1cmUgdXNlciBpc24ndCBsb2dnZWQgb3V0IGlmIHRoZXkgZG9uJ3QgaGF2ZSBwZXJtaXNzaW9ucyB0byBtYWtlIGEgY2hhbmdlKQogICAgICBhd2FpdCBQcm9taXNlLmFsbChleGlzdGluZ0JpbmRpbmdzLm1hcCgoZXhpc3RpbmdCaW5kaW5nKSA9PiBleGlzdGluZ0JpbmRpbmcucmVtb3ZlKHsgcmVkaXJlY3RVbmF1dGhvcml6ZWQ6IGZhbHNlIH0pKSk7CiAgICB9LAogICAgLyoqCiAgICAgKiB1c2VySWQgaXMgb3B0aW9uYWwsIHVzZWQgd2hlbiBhIHVzZXIgaGFzIGp1c3QgYmVlbiBjcmVhdGVkCiAgICAgKi8KICAgIGFzeW5jIHNhdmUodXNlcklkKSB7CiAgICAgIC8vIEVuc3VyZSByb2xlcyBhcmUgYWRkZWQgYmVmb3JlIHJlbW92ZWQgKGluIGNhc2UgYnkgcmVtb3Zpbmcgb25lIHVzZXIgaXMgdW5hYmxlIHRvIGFkZCBhbm90aGVyKQogICAgICBhd2FpdCB0aGlzLnNhdmVBZGRlZFJvbGVzKHVzZXJJZCk7CiAgICAgIGF3YWl0IHRoaXMuc2F2ZVJlbW92ZWRSb2xlcygpOwogICAgICBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9maW5kQWxsJywgewogICAgICAgIHR5cGU6IE1BTkFHRU1FTlQuR0xPQkFMX1JPTEVfQklORElORywKICAgICAgICBvcHQ6ICB7IGZvcmNlOiB0cnVlIH0KICAgICAgfSwgeyBmb3JjZTogdHJ1ZSB9KTsKICAgIH0sCiAgICBjb25maXJtVXNlckNhbkxvZ0luKCkgewogICAgICBjb25zdCBhbGxSb2xlc1J1bGVzID0gW107CgogICAgICBPYmplY3QudmFsdWVzKHRoaXMuc29ydGVkUm9sZXMpLmZvckVhY2goKHJvbGVzKSA9PiB7CiAgICAgICAgcm9sZXMuZm9yRWFjaCgobWFwcGVkUm9sZSkgPT4gewogICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRSb2xlcy5pbmNsdWRlcyhtYXBwZWRSb2xlLmlkKSkgewogICAgICAgICAgICBhZGRPYmplY3RzKGFsbFJvbGVzUnVsZXMsIG1hcHBlZFJvbGUucnVsZXMgfHwgW10pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKCiAgICAgIHJldHVybiBhbGxSb2xlc1J1bGVzLnNvbWUoKHJ1bGUpID0+IHRoaXMuaXNSdWxlVmFsaWQocnVsZSkpOwogICAgfSwKICAgIGlzUnVsZVZhbGlkKHJ1bGUpIHsKICAgICAgLy8gQnJvdWdodCBvdmVyIGZyb20gRW1iZXIKCiAgICAgIGlmICgoIHJ1bGUucmVzb3VyY2VzIHx8IFtdICkuc29tZShyZXNvdXJjZVZhbGlkYXRvcikgJiYgKCBydWxlLmFwaUdyb3VwcyB8fCBbXSApLnNvbWUoYXBpR3JvdXBWYWxpZGF0b3IpICYmIHZlcmJzVmFsaWRhdG9yKCggcnVsZS52ZXJicyB8fCBbXSApKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CgogICAgICBmdW5jdGlvbiByZXNvdXJjZVZhbGlkYXRvcihyZXNvdXJjZSkgewogICAgICAgIGNvbnN0IHJlc291cmNlc1JlcXVpcmVkRm9yTG9naW4gPSBbJyonLCAncHJlZmVyZW5jZXMnLCAnc2V0dGluZ3MnLCAnZmVhdHVyZXMnXTsKCiAgICAgICAgLy8gY29uc29sZS5sb2coYHJlc291cmNlVmFsaWRhdG9yIHN0YXR1czogYCwgcmVzb3VyY2VzUmVxdWlyZWRGb3JMb2dpbi5pbmNsdWRlcyhyZXNvdXJjZSksIHJlc291cmNlKTsKICAgICAgICByZXR1cm4gcmVzb3VyY2VzUmVxdWlyZWRGb3JMb2dpbi5pbmNsdWRlcyhyZXNvdXJjZSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGFwaUdyb3VwVmFsaWRhdG9yKGFwaUdyb3VwKSB7CiAgICAgICAgY29uc3QgYXBpR3JvdXBzUmVxdWlyZWRGb3JMb2dpbiA9IFsnKicsICdtYW5hZ2VtZW50LmNhdHRsZS5pbyddOwoKICAgICAgICAvLyBjb25zb2xlLmxvZyhgYXBpR3JvdXBzUmVxdWlyZWRGb3JMb2dpbiBzdGF0dXM6IGAsIGFwaUdyb3Vwc1JlcXVpcmVkRm9yTG9naW4uaW5jbHVkZXMoYXBpR3JvdXApLCBhcGlHcm91cCk7CiAgICAgICAgcmV0dXJuIGFwaUdyb3Vwc1JlcXVpcmVkRm9yTG9naW4uaW5jbHVkZXMoYXBpR3JvdXApOwogICAgICB9CgogICAgICBmdW5jdGlvbiB2ZXJic1ZhbGlkYXRvcih2ZXJicykgewogICAgICAgIGNvbnN0IHJlc3RyaWN0ZWRUYXJnZXQgPSBbJ2dldCcsICdsaXN0JywgJ3dhdGNoJ107CiAgICAgICAgY29uc3QgdmVyYnNSZXF1aXJlZEZvckxvZ2luID0gWycqJywgLi4ucmVzdHJpY3RlZFRhcmdldF07CgogICAgICAgIGlmIChpc0FycmF5KHZlcmJzKSAmJiB2ZXJicy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhgdmVyYnNSZXF1aXJlZEZvckxvZ2luIHN0YXR1cyAxOiBgLCByZXN0cmljdGVkVGFyZ2V0LmV2ZXJ5KHJ0ID0+IHZlcmJzLmluY2x1ZGVzKHJ0KSksIHZlcmJzKTsKICAgICAgICAgIHJldHVybiByZXN0cmljdGVkVGFyZ2V0LmV2ZXJ5KChydCkgPT4gdmVyYnMuaW5jbHVkZXMocnQpKTsKICAgICAgICB9CgogICAgICAgIC8vIGNvbnNvbGUubG9nKGB2ZXJic1JlcXVpcmVkRm9yTG9naW4gc3RhdHVzIDI6IGAsIHZlcmJzUmVxdWlyZWRGb3JMb2dpbi5pbmNsdWRlcyh2ZXJic1swXSksIHZlcmJzUmVxdWlyZWRGb3JMb2dpbiwgdmVyYnMpOwogICAgICAgIHJldHVybiB2ZXJic1JlcXVpcmVkRm9yTG9naW4uaW5jbHVkZXModmVyYnNbMF0pOwogICAgICB9CiAgICB9LAoKICB9Cn07Cg=="},{"version":3,"sources":["GlobalRoleBindings.vue"],"names":[],"mappings":";AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA","file":"GlobalRoleBindings.vue","sourceRoot":"node_modules/@rancher/shell/components","sourcesContent":["\n<script>\nimport { mapGetters } from 'vuex';\nimport { MANAGEMENT } from '@shell/config/types';\nimport { Checkbox } from '@components/Form/Checkbox';\nimport { _CREATE, _VIEW } from '@shell/config/query-params';\nimport Loading from '@shell/components/Loading';\nimport { addObjects, isArray } from '@shell/utils/array';\nimport { Card } from '@components/Card';\n\n// i18n-uses rbac.globalRoles.types.*.label\n// i18n-uses rbac.globalRoles.types.*.description\n\n/**\n * Display checkboxes for each global role, checked for given user or principal (group). Can save changes.\n */\nexport default {\n  components: {\n    Checkbox,\n    Loading,\n    Card\n  },\n  props: {\n    mode: {\n      type:    String,\n      default: _VIEW,\n    },\n    realMode: {\n      type:    String,\n      default: _VIEW,\n    },\n    assignOnly: {\n      type:    Boolean,\n      default: false,\n    },\n    type: {\n      type:    String,\n      default: 'group',\n      validator(val) {\n        return val === 'group' || val === 'user';\n      }\n    },\n    groupPrincipalId: {\n      type:    String,\n      default: ''\n    },\n    userId: {\n      type:    String,\n      default: ''\n    }\n  },\n  async fetch() {\n    try {\n      this.allRoles = await this.$store.dispatch('management/findAll', { type: MANAGEMENT.GLOBAL_ROLE });\n      if (!this.sortedRoles) {\n        this.sortedRoles = {\n          global:  [],\n          builtin: [],\n          custom:  []\n        };\n\n        this.allRoles.forEach((role) => {\n          const roleType = this.getRoleType(role);\n\n          if (roleType) {\n            this.sortedRoles[roleType].push(role);\n          }\n        });\n\n        const sort = (a, b) => a.nameDisplay.localeCompare(b.nameDisplay);\n\n        // global roles are not sorted\n        this.sortedRoles.builtin = this.sortedRoles.builtin.sort(sort);\n        this.sortedRoles.custom = this.sortedRoles.custom.sort(sort);\n\n        if (!this.isCreate) {\n          this.globalRoleBindings = await this.$store.dispatch('management/findAll', { type: MANAGEMENT.GLOBAL_ROLE_BINDING, opt: { force: true } });\n        }\n\n        // Sort the global roles - use the order defined in 'globalPermissions' and then add the remaining roles after\n        const globalRoles = [];\n        const globalRolesAdded = {};\n\n        this.globalPermissions.forEach((id) => {\n          const role = this.sortedRoles.global.find((r) => r.id === id);\n\n          if (role) {\n            globalRoles.push(role);\n            globalRolesAdded[id] = true;\n          }\n        });\n\n        // Remaining global roles\n        const remainingGlobalRoles = this.sortedRoles.global.filter((r) => !globalRolesAdded[r.id]);\n\n        this.sortedRoles.global = globalRoles;\n        this.sortedRoles.global.push(...remainingGlobalRoles);\n        // End sort of global roles\n\n        this.update();\n      }\n    } catch (e) { }\n  },\n  data() {\n    return {\n      // This not only identifies global roles but the order here is the order we want to display them in the UI\n      globalPermissions: [\n        'admin',\n        'restricted-admin',\n        'user',\n        'user-base',\n      ],\n      globalRoleBindings:    null,\n      sortedRoles:           null,\n      selectedRoles:         [],\n      startingSelectedRoles: [],\n      assignOnlyRoles:       {},\n      roleChanges:           {}\n    };\n  },\n  computed: {\n    ...mapGetters(['releaseNotesUrl']),\n    ...mapGetters({ t: 'i18n/t' }),\n\n    isCreate() {\n      return this.realMode === _CREATE;\n    },\n\n    isUser() {\n      return this.type === 'user';\n    }\n  },\n  watch: {\n    groupPrincipalId(groupPrincipalId, oldGroupPrincipalId) {\n      if (groupPrincipalId === oldGroupPrincipalId) {\n        return;\n      }\n      this.update();\n    },\n    userId(userId, oldUserId) {\n      if (userId === oldUserId) {\n        return;\n      }\n      this.update();\n    }\n  },\n  methods: {\n    getRoleType(role) {\n      if (this.globalPermissions.find((p) => p === role.id)) {\n        return 'global';\n      } else if (role.builtin) {\n        return 'builtin';\n      } else {\n        return 'custom';\n      }\n    },\n    getUnique(...ids) {\n      return `${ this.groupPrincipalId || this.userId }-${ ids.join('-') }`;\n    },\n    selectDefaults() {\n      Object.values(this.sortedRoles).forEach((roles) => {\n        roles.forEach((mappedRole) => {\n          if (mappedRole.newUserDefault) {\n            this.selectedRoles.push(mappedRole.id);\n          }\n        });\n      });\n    },\n    update() {\n      this.selectedRoles = [];\n      this.startingSelectedRoles = [];\n      this.assignOnlyRoles = {};\n      if (this.isCreate) {\n        // Start with the new user default for each role\n        this.selectDefaults();\n      } else {\n        // Start with the principal/user's roles\n        if (!this.groupPrincipalId && !this.userId) {\n          return;\n        }\n\n        const boundRoles = this.globalRoleBindings.filter((grb) => {\n          return this.groupPrincipalId ? grb.groupPrincipalName === this.groupPrincipalId : grb.userName === this.userId;\n        });\n\n        Object.values(this.sortedRoles).forEach((roles) => {\n          roles.forEach((mappedRole) => {\n            const boundRole = boundRoles.find((boundRole) => boundRole.globalRoleName === mappedRole.id);\n\n            if (!!boundRole) {\n              this.selectedRoles.push(mappedRole.id);\n              this.startingSelectedRoles.push({\n                roleId:    mappedRole.id,\n                bindingId: boundRole.id\n              });\n              // Checkboxes should be disabled, besides normal 'mode' ways, if we're only assigning and not removing existing roles\n              this.assignOnlyRoles[mappedRole.id] = this.assignOnly;\n            }\n          });\n        });\n\n        if (this.assignOnly && !this.selectedRoles.length) {\n          // If we're assigning roles to a group that has no existing roles start with the default roles selected\n          this.selectDefaults();\n        }\n      }\n\n      // Force an update to pump out the initial state\n      this.checkboxChanged();\n    },\n    checkboxChanged() {\n      const addRoles = this.selectedRoles\n        .filter((selected) => !this.startingSelectedRoles.find((startingRole) => startingRole.roleId === selected));\n      const removeBindings = this.startingSelectedRoles\n        .filter((startingRole) => !this.selectedRoles.find((selected) => selected === startingRole.roleId))\n        .map((startingRole) => startingRole.bindingId);\n\n      this.roleChanges = {\n        initialRoles: this.startingSelectedRoles,\n        addRoles,\n        removeBindings\n      };\n\n      this.$emit('hasChanges', !!this.roleChanges.addRoles.length || !!this.roleChanges.removeBindings.length);\n      this.$emit('canLogIn', this.confirmUserCanLogIn());\n      this.$emit('changed', this.roleChanges);\n    },\n    async saveAddedRoles(userId) {\n      const requestOptions = {\n        type:     MANAGEMENT.GLOBAL_ROLE_BINDING,\n        metadata: { generateName: `grb-` },\n      };\n\n      if (this.groupPrincipalId) {\n        requestOptions.groupPrincipalName = this.groupPrincipalId;\n      } else {\n        requestOptions.userName = userId || this.userId;\n      }\n      const newBindings = await Promise.all(this.roleChanges.addRoles.map((role) => this.$store.dispatch(`management/create`, {\n        ...requestOptions,\n        globalRoleName: role,\n      })));\n\n      // Save all changes (and ensure user isn't logged out if they don't have permissions to make a change)\n      await Promise.all(newBindings.map((newBinding) => newBinding.save({ redirectUnauthorized: false })));\n    },\n    async saveRemovedRoles() {\n      const existingBindings = await Promise.all(this.roleChanges.removeBindings.map((bindingId) => this.$store.dispatch('management/find', {\n        type: MANAGEMENT.GLOBAL_ROLE_BINDING,\n        id:   bindingId\n      })));\n\n      // Save all changes (and ensure user isn't logged out if they don't have permissions to make a change)\n      await Promise.all(existingBindings.map((existingBinding) => existingBinding.remove({ redirectUnauthorized: false })));\n    },\n    /**\n     * userId is optional, used when a user has just been created\n     */\n    async save(userId) {\n      // Ensure roles are added before removed (in case by removing one user is unable to add another)\n      await this.saveAddedRoles(userId);\n      await this.saveRemovedRoles();\n      await this.$store.dispatch('management/findAll', {\n        type: MANAGEMENT.GLOBAL_ROLE_BINDING,\n        opt:  { force: true }\n      }, { force: true });\n    },\n    confirmUserCanLogIn() {\n      const allRolesRules = [];\n\n      Object.values(this.sortedRoles).forEach((roles) => {\n        roles.forEach((mappedRole) => {\n          if (this.selectedRoles.includes(mappedRole.id)) {\n            addObjects(allRolesRules, mappedRole.rules || []);\n          }\n        });\n      });\n\n      return allRolesRules.some((rule) => this.isRuleValid(rule));\n    },\n    isRuleValid(rule) {\n      // Brought over from Ember\n\n      if (( rule.resources || [] ).some(resourceValidator) && ( rule.apiGroups || [] ).some(apiGroupValidator) && verbsValidator(( rule.verbs || [] ))) {\n        return true;\n      }\n\n      return false;\n\n      function resourceValidator(resource) {\n        const resourcesRequiredForLogin = ['*', 'preferences', 'settings', 'features'];\n\n        // console.log(`resourceValidator status: `, resourcesRequiredForLogin.includes(resource), resource);\n        return resourcesRequiredForLogin.includes(resource);\n      }\n\n      function apiGroupValidator(apiGroup) {\n        const apiGroupsRequiredForLogin = ['*', 'management.cattle.io'];\n\n        // console.log(`apiGroupsRequiredForLogin status: `, apiGroupsRequiredForLogin.includes(apiGroup), apiGroup);\n        return apiGroupsRequiredForLogin.includes(apiGroup);\n      }\n\n      function verbsValidator(verbs) {\n        const restrictedTarget = ['get', 'list', 'watch'];\n        const verbsRequiredForLogin = ['*', ...restrictedTarget];\n\n        if (isArray(verbs) && verbs.length > 1) {\n          // console.log(`verbsRequiredForLogin status 1: `, restrictedTarget.every(rt => verbs.includes(rt)), verbs);\n          return restrictedTarget.every((rt) => verbs.includes(rt));\n        }\n\n        // console.log(`verbsRequiredForLogin status 2: `, verbsRequiredForLogin.includes(verbs[0]), verbsRequiredForLogin, verbs);\n        return verbsRequiredForLogin.includes(verbs[0]);\n      }\n    },\n\n  }\n};\n</script>\n\n<template>\n  <Loading v-if=\"$fetchState.pending\" />\n\n  <div v-else>\n    <form v-if=\"selectedRoles\">\n      <div\n        v-for=\"(sortedRole, roleType) in sortedRoles\"\n        :key=\"getUnique(roleType)\"\n        class=\"role-group mb-10\"\n      >\n        <Card\n          v-if=\"Object.keys(sortedRole).length\"\n          :show-highlight-border=\"false\"\n          :show-actions=\"false\"\n        >\n          <template v-slot:title>\n            <div class=\"type-title\">\n              <h3>{{ t(`rbac.globalRoles.types.${roleType}.label`) }}</h3>\n              <div class=\"type-description\">\n                {{ t(`rbac.globalRoles.types.${roleType}.description`, { isUser }) }}\n              </div>\n            </div>\n          </template>\n          <template v-slot:body>\n            <div\n              class=\"checkbox-section\"\n              :class=\"'checkbox-section--' + roleType\"\n            >\n              <div\n                v-for=\"role in sortedRoles[roleType]\"\n                :key=\"getUnique(roleType, role.id)\"\n                class=\"checkbox mb-10 mr-10\"\n              >\n                <Checkbox\n                  :key=\"getUnique(roleType, role.id, 'checkbox')\"\n                  v-model=\"selectedRoles\"\n                  :value-when-true=\"role.id\"\n                  :disabled=\"!!assignOnlyRoles[role.id]\"\n                  :label=\"role.nameDisplay\"\n                  :description=\"role.descriptionDisplay\"\n                  :mode=\"mode\"\n                  :data-testId=\"'grb-checkbox-' + role.id\"\n                  @input=\"checkboxChanged\"\n                >\n                  <template #label>\n                    <div class=\"checkbox-label-slot\">\n                      <span class=\"checkbox-label\">{{ role.nameDisplay }}</span>\n                      <i\n                        v-if=\"!!assignOnlyRoles[role.id]\"\n                        v-clean-tooltip=\"t('rbac.globalRoles.assignOnlyRole')\"\n                        class=\"checkbox-info icon icon-info icon-lg\"\n                      />\n                    </div>\n                  </template>\n                </Checkbox>\n                <p\n                  v-if=\"role.id === 'restricted-admin'\"\n                  v-clean-html=\"t('rbac.globalRoles.role.restricted-admin.deprecation', { releaseNotesUrl }, true)\"\n                  class=\"deprecation-notice\"\n                />\n              </div>\n            </div>\n          </template>\n        </Card>\n      </div>\n    </form>\n  </div>\n</template>\n<style lang='scss'>\n.role-group {\n  .card-container {\n    margin: 0;\n  }\n}\n</style>\n<style lang='scss' scoped>\n  $detailSize: 11px;\n\n  .deprecation-notice {\n    margin: 8px 0 8px 20px;\n  }\n  .role-group {\n    .type-title {\n      display: flex;\n      flex-direction: column;\n      .type-description {\n        font-size: $detailSize;\n      }\n    }\n\n    .checkbox-section {\n      display: grid;\n\n      grid-template-columns: repeat(3, 1fr);\n\n      &--global {\n        grid-template-columns: 100%;\n      }\n\n      .checkbox-label {\n        &-slot {\n          display: inline-flex;\n          align-items: center;\n        }\n        color: var(--body-text);\n        margin: 0;\n      }\n    }\n  }\n</style>\n"]}]}