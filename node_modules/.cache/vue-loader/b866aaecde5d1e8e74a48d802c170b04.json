{"remainingRequest":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ubuntu/suseconf/node_modules/@rancher/shell/pages/account/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/pages/account/index.vue","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1725271300920}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBCYWNrTGluayBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9CYWNrTGluayc7CmltcG9ydCBQcm9tcHRDaGFuZ2VQYXNzd29yZCBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9Qcm9tcHRDaGFuZ2VQYXNzd29yZCc7CmltcG9ydCB7IE1BTkFHRU1FTlQsIE5PUk1BTiB9IGZyb20gJ0BzaGVsbC9jb25maWcvdHlwZXMnOwppbXBvcnQgeyBTRVRUSU5HIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy9zZXR0aW5ncyc7CmltcG9ydCBMb2FkaW5nIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL0xvYWRpbmcnOwppbXBvcnQgUHJpbmNpcGFsIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2F1dGgvUHJpbmNpcGFsJzsKaW1wb3J0IEJhY2tSb3V0ZSBmcm9tICdAc2hlbGwvbWl4aW5zL2JhY2stbGluayc7CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JzsKCmltcG9ydCB7IEJhbm5lciB9IGZyb20gJ0Bjb21wb25lbnRzL0Jhbm5lcic7CmltcG9ydCBSZXNvdXJjZVRhYmxlIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL1Jlc291cmNlVGFibGUnOwppbXBvcnQgQ29weVRvQ2xpcGJvYXJkVGV4dCBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9Db3B5VG9DbGlwYm9hcmRUZXh0JzsKaW1wb3J0IFRhYlRpdGxlIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL1RhYlRpdGxlJzsKCmNvbnN0IEFQSV9FTkRQT0lOVCA9ICcvdjMnOwoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIENvcHlUb0NsaXBib2FyZFRleHQsIEJhY2tMaW5rLCBCYW5uZXIsIFByb21wdENoYW5nZVBhc3N3b3JkLCBMb2FkaW5nLCBSZXNvdXJjZVRhYmxlLCBQcmluY2lwYWwsIFRhYlRpdGxlCiAgfSwKICBtaXhpbnM6IFtCYWNrUm91dGVdLAogIGFzeW5jIGZldGNoKCkgewogICAgdGhpcy5jYW5DaGFuZ2VQYXNzd29yZCA9IGF3YWl0IHRoaXMuY2FsY0NhbkNoYW5nZVBhc3N3b3JkKCk7CgogICAgaWYgKHRoaXMuYXBpS2V5U2NoZW1hKSB7CiAgICAgIHRoaXMucm93cyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdyYW5jaGVyL2ZpbmRBbGwnLCB7IHR5cGU6IE5PUk1BTi5UT0tFTiB9KTsKICAgIH0KCiAgICAvLyBHZXQgYWxsIHNldHRpbmdzIC0gdGhlIEFQSSBob3N0IHNldHRpbmcgbWF5IG5vdCBiZSBzZXQsIHNvIHRoaXMgYXZvaWRzIGEgNDA0IHJlcXVlc3QgaWYgd2UgbG9vayBmb3IgdGhlIHNwZWNpZmljIHNldHRpbmcKICAgIGNvbnN0IGFsbFNldHRpbmdzID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZEFsbCcsIHsgdHlwZTogTUFOQUdFTUVOVC5TRVRUSU5HIH0pOwogICAgY29uc3QgYXBpSG9zdFNldHRpbmcgPSBhbGxTZXR0aW5ncy5maW5kKChpKSA9PiBpLmlkID09PSBTRVRUSU5HLkFQSV9IT1NUKTsKICAgIGNvbnN0IHNlcnZlclVybFNldHRpbmcgPSBhbGxTZXR0aW5ncy5maW5kKChpKSA9PiBpLmlkID09PSBTRVRUSU5HLlNFUlZFUl9VUkwpOwoKICAgIHRoaXMuYXBpSG9zdFNldHRpbmcgPSBhcGlIb3N0U2V0dGluZz8udmFsdWU7CiAgICB0aGlzLnNlcnZlclVybFNldHRpbmcgPSBzZXJ2ZXJVcmxTZXR0aW5nPy52YWx1ZTsKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBhcGlIb3N0U2V0dGluZzogICAgbnVsbCwKICAgICAgc2VydmVyVXJsU2V0dGluZzogIG51bGwsCiAgICAgIHJvd3M6ICAgICAgICAgICAgICBudWxsLAogICAgICBjYW5DaGFuZ2VQYXNzd29yZDogZmFsc2UKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgLi4ubWFwR2V0dGVycyh7IHQ6ICdpMThuL3QnIH0pLAoKICAgIGFwaUtleWhlYWRlcnMoKSB7CiAgICAgIHJldHVybiB0aGlzLmFwaUtleVNjaGVtYSA/IHRoaXMuJHN0b3JlLmdldHRlcnNbJ3R5cGUtbWFwL2hlYWRlcnNGb3InXSh0aGlzLmFwaUtleVNjaGVtYSkgOiBbXTsKICAgIH0sCgogICAgLy8gUG9ydCBvZiBFbWJlciBjb2RlIGZvciBBUEkgVXJsIC0gc2VlOiBodHRwczovL2dpdGh1Yi5jb20vcmFuY2hlci91aS9ibG9iLzhlMDdjNDkyNjczMTcxNzMxZjNiMjZhZjE0Yzk3OGJjMTAzZDE4MjgvbGliL3NoYXJlZC9hZGRvbi9lbmRwb2ludC9zZXJ2aWNlLmpzI0w1OAogICAgYXBpVXJsQmFzZSgpIHsKICAgICAgbGV0IHNldHRpbmcgPSB0aGlzLmFwaUhvc3RTZXR0aW5nOwoKICAgICAgaWYgKHNldHRpbmcgJiYgc2V0dGluZy5pbmRleE9mKCdodHRwJykgIT09IDApIHsKICAgICAgICBzZXR0aW5nID0gYGh0dHA6Ly8keyBzZXR0aW5nIH1gOwogICAgICB9CgogICAgICAvLyBVc2UgU2VydmVyIFNldHRpbmcgVVJMIGlmIHRoZSBhcGkgaG9zdCBzZXR0aW5nIGlzIG5vdCBzZXQKICAgICAgbGV0IHVybCA9IHNldHRpbmcgfHwgdGhpcy5zZXJ2ZXJVcmxTZXR0aW5nOwoKICAgICAgLy8gSWYgdGhlIFVSTCBpcyByZWxhdGl2ZSwgYWRkIG9uIHRoZSBjdXJyZW50IGJhc2UgVVJMIGZyb20gdGhlIGJyb3dzZXIKICAgICAgaWYgKCB1cmwuaW5kZXhPZignaHR0cCcpICE9PSAwICkgewogICAgICAgIHVybCA9IGAkeyB3aW5kb3cubG9jYXRpb24ub3JpZ2luIH0vJHsgdXJsLnJlcGxhY2UoL15cLysvLCAnJykgfWA7CiAgICAgIH0KCiAgICAgIC8vIFVSTCBtdXN0IGVuZCBpbiBhIHNpbmdsZSBzbGFzaAogICAgICB1cmwgPSBgJHsgdXJsLnJlcGxhY2UoL1wvKyQvLCAnJykgfS9gOwoKICAgICAgcmV0dXJuIHVybDsKICAgIH0sCgogICAgYXBpVXJsKCkgewogICAgICBjb25zdCBiYXNlID0gdGhpcy5hcGlVcmxCYXNlOwogICAgICBjb25zdCBwYXRoID0gQVBJX0VORFBPSU5ULnJlcGxhY2UoL15cLysvLCAnJyk7CgogICAgICByZXR1cm4gYCR7IGJhc2UgfSR7IHBhdGggfWA7CiAgICB9LAoKICAgIGFwaUtleVNjaGVtYSgpIHsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gdGhpcy4kc3RvcmUuZ2V0dGVyc1tgcmFuY2hlci9zY2hlbWFGb3JgXShOT1JNQU4uVE9LRU4pOwogICAgICB9IGNhdGNoIChlKSB7fQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAoKICAgIHByaW5jaXBhbCgpIHsKICAgICAgY29uc3QgcHJpbmNpcGFsSWQgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzWydhdXRoL3ByaW5jaXBhbElkJ107CiAgICAgIGNvbnN0IHByaW5jaXBhbCA9IHRoaXMuJHN0b3JlLmdldHRlcnNbJ3JhbmNoZXIvYnlJZCddKE5PUk1BTi5QUklOQ0lQQUwsIHByaW5jaXBhbElkKTsKCiAgICAgIGlmICghcHJpbmNpcGFsKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGZpbmQgcHJpbmNpcGFsIHdpdGggaWQ6ICcsIHByaW5jaXBhbElkKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCiAgICAgIH0KCiAgICAgIHJldHVybiBwcmluY2lwYWwgfHwge307CiAgICB9LAoKICAgIGFwaUtleXMoKSB7CiAgICAgIC8vIEZpbHRlciBvdXQgdG9rZW5zIHRoYXQgYXJlIG5vdCBBUEkgS2V5cyBhbmQgYXJlIG5vdCBleHBpcmVkIFVJIFNlc3Npb25zCiAgICAgIGNvbnN0IGlzQXBpS2V5ID0gKGtleSkgPT4gewogICAgICAgIGNvbnN0IGxhYmVscyA9IGtleS5sYWJlbHM7CiAgICAgICAgY29uc3QgZXhwaXJlZCA9IGtleS5leHBpcmVkOwogICAgICAgIGNvbnN0IGN1cnJlbnQgPSBrZXkuY3VycmVudDsKCiAgICAgICAgcmV0dXJuICggIWV4cGlyZWQgfHwgIWxhYmVscyB8fCAhbGFiZWxzWyd1aS1zZXNzaW9uJ10gKSAmJiAhY3VycmVudDsKICAgICAgfTsKCiAgICAgIHJldHVybiAhdGhpcy5yb3dzID8gW10gOiB0aGlzLnJvd3MuZmlsdGVyKGlzQXBpS2V5KTsKICAgIH0KICB9LAoKICBtZXRob2RzOiB7CiAgICBhZGRLZXkoKSB7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsgcGF0aDogJ2FjY291bnQvY3JlYXRlLWtleScgfSk7CiAgICB9LAogICAgYXN5bmMgY2FsY0NhbkNoYW5nZVBhc3N3b3JkKCkgewogICAgICBpZiAoIXRoaXMuJHN0b3JlLmdldHRlcnNbJ2F1dGgvZW5hYmxlZCddKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBpZiAodGhpcy5wcmluY2lwYWwucHJvdmlkZXIgPT09ICdsb2NhbCcpIHsKICAgICAgICByZXR1cm4gISF0aGlzLnByaW5jaXBhbC5sb2dpbk5hbWU7CiAgICAgIH0KCiAgICAgIGNvbnN0IHVzZXJzID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3JhbmNoZXIvZmluZEFsbCcsIHsKICAgICAgICB0eXBlOiBOT1JNQU4uVVNFUiwKICAgICAgICBvcHQ6ICB7IHVybDogJy92My91c2VycycsIGZpbHRlcjogeyBtZTogdHJ1ZSB9IH0KICAgICAgfSk7CgogICAgICBpZiAodXNlcnMgJiYgdXNlcnMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgcmV0dXJuICEhdXNlcnNbMF0udXNlcm5hbWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgfQp9Owo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"node_modules/@rancher/shell/pages/account","sourcesContent":["<script>\nimport BackLink from '@shell/components/BackLink';\nimport PromptChangePassword from '@shell/components/PromptChangePassword';\nimport { MANAGEMENT, NORMAN } from '@shell/config/types';\nimport { SETTING } from '@shell/config/settings';\nimport Loading from '@shell/components/Loading';\nimport Principal from '@shell/components/auth/Principal';\nimport BackRoute from '@shell/mixins/back-link';\nimport { mapGetters } from 'vuex';\n\nimport { Banner } from '@components/Banner';\nimport ResourceTable from '@shell/components/ResourceTable';\nimport CopyToClipboardText from '@shell/components/CopyToClipboardText';\nimport TabTitle from '@shell/components/TabTitle';\n\nconst API_ENDPOINT = '/v3';\n\nexport default {\n  components: {\n    CopyToClipboardText, BackLink, Banner, PromptChangePassword, Loading, ResourceTable, Principal, TabTitle\n  },\n  mixins: [BackRoute],\n  async fetch() {\n    this.canChangePassword = await this.calcCanChangePassword();\n\n    if (this.apiKeySchema) {\n      this.rows = await this.$store.dispatch('rancher/findAll', { type: NORMAN.TOKEN });\n    }\n\n    // Get all settings - the API host setting may not be set, so this avoids a 404 request if we look for the specific setting\n    const allSettings = await this.$store.dispatch('management/findAll', { type: MANAGEMENT.SETTING });\n    const apiHostSetting = allSettings.find((i) => i.id === SETTING.API_HOST);\n    const serverUrlSetting = allSettings.find((i) => i.id === SETTING.SERVER_URL);\n\n    this.apiHostSetting = apiHostSetting?.value;\n    this.serverUrlSetting = serverUrlSetting?.value;\n  },\n  data() {\n    return {\n      apiHostSetting:    null,\n      serverUrlSetting:  null,\n      rows:              null,\n      canChangePassword: false\n    };\n  },\n  computed: {\n    ...mapGetters({ t: 'i18n/t' }),\n\n    apiKeyheaders() {\n      return this.apiKeySchema ? this.$store.getters['type-map/headersFor'](this.apiKeySchema) : [];\n    },\n\n    // Port of Ember code for API Url - see: https://github.com/rancher/ui/blob/8e07c492673171731f3b26af14c978bc103d1828/lib/shared/addon/endpoint/service.js#L58\n    apiUrlBase() {\n      let setting = this.apiHostSetting;\n\n      if (setting && setting.indexOf('http') !== 0) {\n        setting = `http://${ setting }`;\n      }\n\n      // Use Server Setting URL if the api host setting is not set\n      let url = setting || this.serverUrlSetting;\n\n      // If the URL is relative, add on the current base URL from the browser\n      if ( url.indexOf('http') !== 0 ) {\n        url = `${ window.location.origin }/${ url.replace(/^\\/+/, '') }`;\n      }\n\n      // URL must end in a single slash\n      url = `${ url.replace(/\\/+$/, '') }/`;\n\n      return url;\n    },\n\n    apiUrl() {\n      const base = this.apiUrlBase;\n      const path = API_ENDPOINT.replace(/^\\/+/, '');\n\n      return `${ base }${ path }`;\n    },\n\n    apiKeySchema() {\n      try {\n        return this.$store.getters[`rancher/schemaFor`](NORMAN.TOKEN);\n      } catch (e) {}\n\n      return null;\n    },\n\n    principal() {\n      const principalId = this.$store.getters['auth/principalId'];\n      const principal = this.$store.getters['rancher/byId'](NORMAN.PRINCIPAL, principalId);\n\n      if (!principal) {\n        console.error('Failed to find principal with id: ', principalId); // eslint-disable-line no-console\n      }\n\n      return principal || {};\n    },\n\n    apiKeys() {\n      // Filter out tokens that are not API Keys and are not expired UI Sessions\n      const isApiKey = (key) => {\n        const labels = key.labels;\n        const expired = key.expired;\n        const current = key.current;\n\n        return ( !expired || !labels || !labels['ui-session'] ) && !current;\n      };\n\n      return !this.rows ? [] : this.rows.filter(isApiKey);\n    }\n  },\n\n  methods: {\n    addKey() {\n      this.$router.push({ path: 'account/create-key' });\n    },\n    async calcCanChangePassword() {\n      if (!this.$store.getters['auth/enabled']) {\n        return false;\n      }\n\n      if (this.principal.provider === 'local') {\n        return !!this.principal.loginName;\n      }\n\n      const users = await this.$store.dispatch('rancher/findAll', {\n        type: NORMAN.USER,\n        opt:  { url: '/v3/users', filter: { me: true } }\n      });\n\n      if (users && users.length === 1) {\n        return !!users[0].username;\n      }\n\n      return false;\n    },\n  }\n};\n</script>\n\n<template>\n  <Loading v-if=\"$fetchState.pending\" />\n  <div v-else>\n    <BackLink :link=\"backLink\" />\n    <h1>\n      <TabTitle breadcrumb=\"vendor-only\">\n        {{ t('accountAndKeys.title') }}\n      </TabTitle>\n    </h1>\n\n    <h2 v-t=\"'accountAndKeys.account.title'\" />\n    <div class=\"account\">\n      <Principal\n        :key=\"principal.id\"\n        :value=\"principal.id\"\n        :use-muted=\"false\"\n        :show-labels=\"true\"\n      />\n      <div>\n        <button\n          v-if=\"canChangePassword\"\n          type=\"button\"\n          class=\"btn role-primary\"\n          data-testid=\"account_change_password\"\n          @click=\"$refs.promptChangePassword.show(true)\"\n        >\n          {{ t(\"accountAndKeys.account.change\") }}\n        </button>\n      </div>\n    </div>\n    <PromptChangePassword ref=\"promptChangePassword\" />\n\n    <hr>\n    <div class=\"keys-header\">\n      <div>\n        <h2 v-t=\"'accountAndKeys.apiKeys.title'\" />\n        <div class=\"api-url\">\n          <span>{{ t(\"accountAndKeys.apiKeys.apiEndpoint\") }}</span>\n          <CopyToClipboardText :text=\"apiUrl\" />\n        </div>\n      </div>\n      <button\n        v-if=\"apiKeySchema\"\n        class=\"btn role-primary add mb-20\"\n        data-testid=\"account_create_api_keys\"\n        @click=\"addKey\"\n      >\n        {{ t('accountAndKeys.apiKeys.add.label') }}\n      </button>\n    </div>\n    <div\n      v-if=\"apiKeySchema\"\n      class=\"keys\"\n    >\n      <ResourceTable\n        :schema=\"apiKeySchema\"\n        :rows=\"apiKeys\"\n        :headers=\"apiKeyheaders\"\n        key-field=\"id\"\n        data-testid=\"api_keys_list\"\n        :search=\"true\"\n        :row-actions=\"true\"\n        :table-actions=\"true\"\n      />\n    </div>\n    <div v-else>\n      <Banner\n        color=\"warning\"\n        :label=\"t('accountAndKeys.apiKeys.notAllowed')\"\n      />\n    </div>\n  </div>\n</template>\n\n<style lang='scss' scoped>\n  hr {\n    margin: 20px 0;\n  }\n\n  .account {\n    display: flex;\n    justify-content: space-between\n  }\n\n  .keys-header {\n    display: flex;\n    div {\n      flex: 1;\n    }\n  }\n\n  .keys {\n    display: flex;\n    flex-direction: column;\n    .add {\n      align-self: flex-end;\n    }\n  }\n\n  .api-url {\n    display: flex;\n\n    > span {\n      margin-right: 6px;\n    }\n  }\n</style>\n"]}]}