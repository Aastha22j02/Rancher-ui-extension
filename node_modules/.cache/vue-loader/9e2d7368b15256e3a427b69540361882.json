{"remainingRequest":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ubuntu/suseconf/node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster/rke2.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster/rke2.vue","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1725271300920}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBkaWZmZXJlbmNlIGZyb20gJ2xvZGFzaC9kaWZmZXJlbmNlJzsKaW1wb3J0IHRocm90dGxlIGZyb20gJ2xvZGFzaC90aHJvdHRsZSc7CmltcG9ydCBpc0FycmF5IGZyb20gJ2xvZGFzaC9pc0FycmF5JzsKaW1wb3J0IG1lcmdlIGZyb20gJ2xvZGFzaC9tZXJnZSc7CmltcG9ydCBDcmVhdGVFZGl0VmlldyBmcm9tICdAc2hlbGwvbWl4aW5zL2NyZWF0ZS1lZGl0LXZpZXcnOwppbXBvcnQgRm9ybVZhbGlkYXRpb24gZnJvbSAnQHNoZWxsL21peGlucy9mb3JtLXZhbGlkYXRpb24nOwppbXBvcnQgeyBub3JtYWxpemVOYW1lIH0gZnJvbSAnQHNoZWxsL3V0aWxzL2t1YmUnOwoKaW1wb3J0IHsKICBDQVBJLAogIE1BTkFHRU1FTlQsCiAgTkFNRVNQQUNFLAogIE5PUk1BTiwKICBTQ0hFTUEsCiAgREVGQVVMVF9XT1JLU1BBQ0UsCiAgU0VDUkVULAogIEhDSSwKfSBmcm9tICdAc2hlbGwvY29uZmlnL3R5cGVzJzsKaW1wb3J0IHsgX0NSRUFURSwgX0VESVQsIF9WSUVXIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy9xdWVyeS1wYXJhbXMnOwoKaW1wb3J0IHsgZmluZEJ5LCByZW1vdmVPYmplY3QsIGNsZWFyIH0gZnJvbSAnQHNoZWxsL3V0aWxzL2FycmF5JzsKaW1wb3J0IHsgY3JlYXRlWWFtbCB9IGZyb20gJ0BzaGVsbC91dGlscy9jcmVhdGUteWFtbCc7CmltcG9ydCB7CiAgY2xvbmUsIGRpZmYsIHNldCwgZ2V0LCBpc0VtcHR5Cn0gZnJvbSAnQHNoZWxsL3V0aWxzL29iamVjdCc7CmltcG9ydCB7IGFsbEhhc2ggfSBmcm9tICdAc2hlbGwvdXRpbHMvcHJvbWlzZSc7CmltcG9ydCB7IHNvcnRCeSB9IGZyb20gJ0BzaGVsbC91dGlscy9zb3J0JzsKaW1wb3J0IHsgdnNwaGVyZVBvb2xDb25maWdNZXJnZSB9IGZyb20gJ0BzaGVsbC9tYWNoaW5lLWNvbmZpZy92bXdhcmV2c3BoZXJlLXBvb2wtY29uZmlnLW1lcmdlJzsKCmltcG9ydCB7IGNvbXBhcmUsIHNvcnRhYmxlIH0gZnJvbSAnQHNoZWxsL3V0aWxzL3ZlcnNpb24nOwppbXBvcnQgeyBpc0hhcnZlc3RlclNhdGlzZmllc1ZlcnNpb24gfSBmcm9tICdAc2hlbGwvdXRpbHMvY2x1c3Rlcic7CgppbXBvcnQgeyBCYWRnZVN0YXRlIH0gZnJvbSAnQGNvbXBvbmVudHMvQmFkZ2VTdGF0ZSc7CmltcG9ydCB7IEJhbm5lciB9IGZyb20gJ0Bjb21wb25lbnRzL0Jhbm5lcic7CmltcG9ydCBDcnVSZXNvdXJjZSwgeyBDT05URVhUX0hPT0tfRURJVF9ZQU1MIH0gZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvQ3J1UmVzb3VyY2UnOwppbXBvcnQgTG9hZGluZyBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9Mb2FkaW5nJzsKaW1wb3J0IE5hbWVOc0Rlc2NyaXB0aW9uIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vTmFtZU5zRGVzY3JpcHRpb24nOwppbXBvcnQgVGFiIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL1RhYmJlZC9UYWInOwppbXBvcnQgVGFiYmVkIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL1RhYmJlZCc7CgppbXBvcnQgeyBjYW5WaWV3Q2x1c3Rlck1lbWJlcnNoaXBFZGl0b3IgfSBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtL01lbWJlcnMvQ2x1c3Rlck1lbWJlcnNoaXBFZGl0b3InOwppbXBvcnQgc2VtdmVyIGZyb20gJ3NlbXZlcic7CgppbXBvcnQgeyBTRVRUSU5HIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy9zZXR0aW5ncyc7CmltcG9ydCB7IGJhc2U2NEVuY29kZSB9IGZyb20gJ0BzaGVsbC91dGlscy9jcnlwdG8nOwppbXBvcnQgeyBDQVBJIGFzIENBUElfQU5OT1RBVElPTlMsIENMVVNURVJfQkFER0UgfSBmcm9tICdAc2hlbGwvY29uZmlnL2xhYmVscy1hbm5vdGF0aW9ucyc7CmltcG9ydCBBZ2VudEVudiBmcm9tICdAc2hlbGwvZWRpdC9wcm92aXNpb25pbmcuY2F0dGxlLmlvLmNsdXN0ZXIvQWdlbnRFbnYnOwppbXBvcnQgTGFiZWxzIGZyb20gJ0BzaGVsbC9lZGl0L3Byb3Zpc2lvbmluZy5jYXR0bGUuaW8uY2x1c3Rlci9MYWJlbHMnOwppbXBvcnQgTWFjaGluZVBvb2wgZnJvbSAnQHNoZWxsL2VkaXQvcHJvdmlzaW9uaW5nLmNhdHRsZS5pby5jbHVzdGVyL3RhYnMvTWFjaGluZVBvb2wnOwppbXBvcnQgU2VsZWN0Q3JlZGVudGlhbCBmcm9tICcuL1NlbGVjdENyZWRlbnRpYWwnOwppbXBvcnQgeyBFTEVNRU5UQUxfU0NIRU1BX0lEUywgS0lORCwgRUxFTUVOVEFMX0NMVVNURVJfUFJPVklERVIgfSBmcm9tICcuLi8uLi9jb25maWcvZWxlbWVudGFsLXR5cGVzJzsKaW1wb3J0IEFnZW50Q29uZmlndXJhdGlvbiBmcm9tICdAc2hlbGwvZWRpdC9wcm92aXNpb25pbmcuY2F0dGxlLmlvLmNsdXN0ZXIvdGFicy9BZ2VudENvbmZpZ3VyYXRpb24nOwppbXBvcnQgeyBnZXRBcHBsaWNhYmxlRXh0ZW5zaW9uRW5oYW5jZW1lbnRzIH0gZnJvbSAnQHNoZWxsL2NvcmUvcGx1Z2luLWhlbHBlcnMnOwppbXBvcnQgeyBFeHRlbnNpb25Qb2ludCwgVGFiTG9jYXRpb24gfSBmcm9tICdAc2hlbGwvY29yZS90eXBlcyc7CmltcG9ydCBNZW1iZXJSb2xlcyBmcm9tICdAc2hlbGwvZWRpdC9wcm92aXNpb25pbmcuY2F0dGxlLmlvLmNsdXN0ZXIvdGFicy9NZW1iZXJSb2xlcyc7CmltcG9ydCBCYXNpY3MgZnJvbSAnQHNoZWxsL2VkaXQvcHJvdmlzaW9uaW5nLmNhdHRsZS5pby5jbHVzdGVyL3RhYnMvQmFzaWNzJzsKaW1wb3J0IEV0Y2QgZnJvbSAnQHNoZWxsL2VkaXQvcHJvdmlzaW9uaW5nLmNhdHRsZS5pby5jbHVzdGVyL3RhYnMvZXRjZCc7CmltcG9ydCBOZXR3b3JraW5nIGZyb20gJ0BzaGVsbC9lZGl0L3Byb3Zpc2lvbmluZy5jYXR0bGUuaW8uY2x1c3Rlci90YWJzL25ldHdvcmtpbmcnOwppbXBvcnQgVXBncmFkZSBmcm9tICdAc2hlbGwvZWRpdC9wcm92aXNpb25pbmcuY2F0dGxlLmlvLmNsdXN0ZXIvdGFicy91cGdyYWRlJzsKaW1wb3J0IFJlZ2lzdHJpZXMgZnJvbSAnQHNoZWxsL2VkaXQvcHJvdmlzaW9uaW5nLmNhdHRsZS5pby5jbHVzdGVyL3RhYnMvcmVnaXN0cmllcyc7CmltcG9ydCBBZGRPbkNvbmZpZyBmcm9tICdAc2hlbGwvZWRpdC9wcm92aXNpb25pbmcuY2F0dGxlLmlvLmNsdXN0ZXIvdGFicy9BZGRPbkNvbmZpZyc7CmltcG9ydCBBZHZhbmNlZCBmcm9tICdAc2hlbGwvZWRpdC9wcm92aXNpb25pbmcuY2F0dGxlLmlvLmNsdXN0ZXIvdGFicy9BZHZhbmNlZCc7CmltcG9ydCBDbHVzdGVyQXBwZWFyYW5jZSBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9mb3JtL0NsdXN0ZXJBcHBlYXJhbmNlJzsKCmNvbnN0IEhBUlZFU1RFUiA9ICdoYXJ2ZXN0ZXInOwpjb25zdCBIQVJWRVNURVJfQ0xPVURfUFJPVklERVIgPSAnaGFydmVzdGVyLWNsb3VkLXByb3ZpZGVyJzsKY29uc3QgTkVUQklPU19UUlVOQ0FUSU9OX0xFTkdUSCA9IDE1OwoKY29uc3QgVk1XQVJFX1ZTUEhFUkUgPSAndm13YXJldnNwaGVyZSc7CgovKioKICogQ2xhc3NlcyB0byBiZSBhZG9wdGVkIGJ5IHRoZSBub2RlIGJhZGdlcyBpbiBNYWNoaW5lIHBvb2xzCiAqLwpjb25zdCBOT0RFX1RPVEFMID0gewogIGVycm9yOiB7CiAgICBjb2xvcjogJ2JnLWVycm9yJywKICAgIGljb246ICAnaWNvbi14JywKICB9LAogIHdhcm5pbmc6IHsKICAgIGNvbG9yOiAnYmctd2FybmluZycsCiAgICBpY29uOiAgJ2ljb24td2FybmluZycsCiAgfSwKICBzdWNjZXNzOiB7CiAgICBjb2xvcjogJ2JnLXN1Y2Nlc3MnLAogICAgaWNvbjogICdpY29uLWNoZWNrbWFyaycKICB9Cn07CmNvbnN0IENMVVNURVJfQUdFTlRfQ1VTVE9NSVpBVElPTiA9ICdjbHVzdGVyQWdlbnREZXBsb3ltZW50Q3VzdG9taXphdGlvbic7CmNvbnN0IEZMRUVUX0FHRU5UX0NVU1RPTUlaQVRJT04gPSAnZmxlZXRBZ2VudERlcGxveW1lbnRDdXN0b21pemF0aW9uJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBBZ2VudEVudiwKICAgIEJhZGdlU3RhdGUsCiAgICBCYW5uZXIsCiAgICBBZ2VudENvbmZpZ3VyYXRpb24sCiAgICBDcnVSZXNvdXJjZSwKICAgIExhYmVscywKICAgIExvYWRpbmcsCiAgICBNYWNoaW5lUG9vbCwKICAgIE5hbWVOc0Rlc2NyaXB0aW9uLAogICAgU2VsZWN0Q3JlZGVudGlhbCwKICAgIFRhYiwKICAgIFRhYmJlZCwKICAgIE1lbWJlclJvbGVzLAogICAgQmFzaWNzLAogICAgRXRjZCwKICAgIE5ldHdvcmtpbmcsCiAgICBVcGdyYWRlLAogICAgUmVnaXN0cmllcywKICAgIEFkZE9uQ29uZmlnLAogICAgQWR2YW5jZWQsCiAgICBDbHVzdGVyQXBwZWFyYW5jZQogIH0sCgogIG1peGluczogW0NyZWF0ZUVkaXRWaWV3LCBGb3JtVmFsaWRhdGlvbl0sCgogIHByb3BzOiB7CiAgICBtb2RlOiB7CiAgICAgIHR5cGU6ICAgICBTdHJpbmcsCiAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgfSwKCiAgICB2YWx1ZTogewogICAgICB0eXBlOiAgICAgT2JqZWN0LAogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgIH0sCgogICAgcHJvdmlkZXI6IHsKICAgICAgdHlwZTogICAgIFN0cmluZywKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICB9LAoKICAgIHByb3ZpZGVyQ29uZmlnOiB7CiAgICAgIHR5cGU6ICAgIE9iamVjdCwKICAgICAgZGVmYXVsdDogKCkgPT4gbnVsbAogICAgfQogIH0sCgogIGFzeW5jIGZldGNoKCkgewogICAgYXdhaXQgdGhpcy5mZXRjaFJrZTJWZXJzaW9ucygpOwogICAgYXdhaXQgdGhpcy5pbml0U3BlY3MoKTsKICAgIGF3YWl0IHRoaXMuaW5pdEFkZG9ucygpOwogICAgYXdhaXQgdGhpcy5pbml0UmVnaXN0cnkoKTsKCiAgICBPYmplY3QuZW50cmllcyh0aGlzLmNoYXJ0VmFsdWVzKS5mb3JFYWNoKChbbmFtZSwgdmFsdWVdKSA9PiB7CiAgICAgIGNvbnN0IGtleSA9IHRoaXMuY2hhcnRWZXJzaW9uS2V5KG5hbWUpOwoKICAgICAgdGhpcy51c2VyQ2hhcnRWYWx1ZXNba2V5XSA9IHZhbHVlOwogICAgfSk7CgogICAgdGhpcy5zZXRBZ2VudENvbmZpZ3VyYXRpb24oKTsKICB9LAoKICBkYXRhKCkgewogICAgaWYgKCF0aGlzLnZhbHVlLnNwZWMucmtlQ29uZmlnKSB7CiAgICAgIHNldCh0aGlzLnZhbHVlLnNwZWMsICdya2VDb25maWcnLCB7fSk7CiAgICB9CgogICAgaWYgKCF0aGlzLnZhbHVlLnNwZWMucmtlQ29uZmlnLmNoYXJ0VmFsdWVzKSB7CiAgICAgIHNldCh0aGlzLnZhbHVlLnNwZWMucmtlQ29uZmlnLCAnY2hhcnRWYWx1ZXMnLCB7fSk7CiAgICB9CgogICAgaWYgKCF0aGlzLnZhbHVlLnNwZWMucmtlQ29uZmlnLnVwZ3JhZGVTdHJhdGVneSkgewogICAgICBzZXQodGhpcy52YWx1ZS5zcGVjLnJrZUNvbmZpZywgJ3VwZ3JhZGVTdHJhdGVneScsIHsKICAgICAgICBjb250cm9sUGxhbmVDb25jdXJyZW5jeTogICcxJywKICAgICAgICBjb250cm9sUGxhbmVEcmFpbk9wdGlvbnM6IHt9LAogICAgICAgIHdvcmtlckNvbmN1cnJlbmN5OiAgICAgICAgJzEnLAogICAgICAgIHdvcmtlckRyYWluT3B0aW9uczogICAgICAge30sCiAgICAgIH0pOwogICAgfQoKICAgIGlmICghdGhpcy52YWx1ZS5zcGVjLnJrZUNvbmZpZy5kYXRhRGlyZWN0b3JpZXMpIHsKICAgICAgc2V0KHRoaXMudmFsdWUuc3BlYy5ya2VDb25maWcsICdkYXRhRGlyZWN0b3JpZXMnLCB7CiAgICAgICAgc3lzdGVtQWdlbnQ6ICAnJywKICAgICAgICBwcm92aXNpb25pbmc6ICcnLAogICAgICAgIGs4c0Rpc3RybzogICAgJycsCiAgICAgIH0pOwogICAgfQoKICAgIGlmICghdGhpcy52YWx1ZS5zcGVjLnJrZUNvbmZpZy5tYWNoaW5lR2xvYmFsQ29uZmlnKSB7CiAgICAgIHNldCh0aGlzLnZhbHVlLnNwZWMsICdya2VDb25maWcubWFjaGluZUdsb2JhbENvbmZpZycsIHt9KTsKICAgIH0KCiAgICBpZiAoIXRoaXMudmFsdWUuc3BlYy5ya2VDb25maWcubWFjaGluZVNlbGVjdG9yQ29uZmlnPy5sZW5ndGgpIHsKICAgICAgc2V0KHRoaXMudmFsdWUuc3BlYywgJ3JrZUNvbmZpZy5tYWNoaW5lU2VsZWN0b3JDb25maWcnLCBbeyBjb25maWc6IHt9IH1dKTsKICAgIH0KCiAgICBjb25zdCB0cnVuY2F0ZUxpbWl0ID0gdGhpcy52YWx1ZS5kZWZhdWx0SG9zdG5hbWVMZW5ndGhMaW1pdCB8fCAwOwoKICAgIHJldHVybiB7CiAgICAgIGxvYWRlZE9uY2U6ICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLAogICAgICBsYXN0SWR4OiAgICAgICAgICAgICAgICAgICAgICAgICAwLAogICAgICBhbGxQU0FzOiAgICAgICAgICAgICAgICAgICAgICAgICBbXSwKICAgICAgY3JlZGVudGlhbElkOiAgICAgICAgICAgICAgICAgICAgJycsCiAgICAgIGNyZWRlbnRpYWw6ICAgICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgIG1hY2hpbmVQb29sczogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgIHJrZTJWZXJzaW9uczogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgIGszc1ZlcnNpb25zOiAgICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgIGRlZmF1bHRSa2UyOiAgICAgICAgICAgICAgICAgICAgICcnLAogICAgICBkZWZhdWx0SzNzOiAgICAgICAgICAgICAgICAgICAgICAnJywKICAgICAgczNCYWNrdXA6ICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UsCiAgICAgIC8qKgogICAgICAgKiBBbGwgaW5mbyByZWxhdGVkIHRvIGEgc3BlY2lmaWMgdmVyc2lvbiBvZiB0aGUgY2hhcnQKICAgICAgICoKICAgICAgICogVGhpcyBpbmNsdWRlcyBjaGFydCBpdHNlbGYsIFJFQURNRSBhbmQgdmFsdWVzCiAgICAgICAqCiAgICAgICAqIHsgW2NoYXJ0TmFtZTpzdHJpbmddOiB7IGNoYXJ0OiBqc29uLCByZWFkbWU6IHN0cmluZywgdmFsdWVzOiBqc29uIH0gfQogICAgICAgKi8KICAgICAgdmVyc2lvbkluZm86ICAgICAgICAgICAgICAgICAgICAge30sCiAgICAgIG1lbWJlcnNoaXBVcGRhdGU6ICAgICAgICAgICAgICAgIHt9LAogICAgICBzaG93RGVwcmVjYXRlZFBhdGNoVmVyc2lvbnM6ICAgICBmYWxzZSwKICAgICAgc3lzdGVtUmVnaXN0cnk6ICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgcmVnaXN0cnlIb3N0OiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgc2hvd0N1c3RvbVJlZ2lzdHJ5SW5wdXQ6ICAgICAgICAgZmFsc2UsCiAgICAgIHNob3dDdXN0b21SZWdpc3RyeUFkdmFuY2VkSW5wdXQ6IGZhbHNlLAogICAgICByZWdpc3RyeVNlY3JldDogICAgICAgICAgICAgICAgICBudWxsLAogICAgICB1c2VyQ2hhcnRWYWx1ZXM6ICAgICAgICAgICAgICAgICB7fSwKICAgICAgdXNlckNoYXJ0VmFsdWVzVGVtcDogICAgICAgICAgICAge30sCiAgICAgIGFkZG9uc1JldjogICAgICAgICAgICAgICAgICAgICAgIDAsCiAgICAgIGZ2Rm9ybVJ1bGVTZXRzOiAgICAgICAgICAgICAgICAgIFt7CiAgICAgICAgcGF0aDogJ21ldGFkYXRhLm5hbWUnLCBydWxlczogWydzdWJEb21haW4nXSwgdHJhbnNsYXRpb25LZXk6ICduYW1lTnNEZXNjcmlwdGlvbi5uYW1lLmxhYmVsJwogICAgICB9XSwKICAgICAgaGFydmVzdGVyVmVyc2lvblJhbmdlOiB7fSwKICAgICAgY2lzT3ZlcnJpZGU6ICAgICAgICAgICBmYWxzZSwKICAgICAgdHJ1bmNhdGVMaW1pdCwKICAgICAgYnVzeTogICAgICAgICAgICAgICAgICBmYWxzZSwKICAgICAgbWFjaGluZVBvb2xWYWxpZGF0aW9uOiB7fSwgLy8gbWFwIG9mIHZhbGlkYXRpb24gc3RhdGVzIGZvciBlYWNoIG1hY2hpbmUgcG9vbAogICAgICBtYWNoaW5lUG9vbEVycm9yczogICAgIHt9LAogICAgICBhbGxOYW1lc3BhY2VzOiAgICAgICAgIFtdLAogICAgICBleHRlbnNpb25UYWJzOiAgICAgICAgIGdldEFwcGxpY2FibGVFeHRlbnNpb25FbmhhbmNlbWVudHModGhpcywgRXh0ZW5zaW9uUG9pbnQuVEFCLCBUYWJMb2NhdGlvbi5DTFVTVEVSX0NSRUFURV9SS0UyLCB0aGlzLiRyb3V0ZSwgdGhpcyksCiAgICB9OwogIH0sCgogIGNvbXB1dGVkOiB7CiAgICBjbHVzdGVyTmFtZSgpIHsKICAgICAgcmV0dXJuIHRoaXMudmFsdWUubWV0YWRhdGE/Lm5hbWUgfHwgJyc7CiAgICB9LAogICAgc2hvd0NsdXN0ZXJBcHBlYXJhbmNlKCkgewogICAgICByZXR1cm4gdGhpcy5tb2RlID09PSBfQ1JFQVRFOwogICAgfSwKICAgIGNsdXN0ZXJCYWRnZUFiYnJldmlhdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLmdldHRlcnNbJ2N1c3RvbWlzYXRpb24vZ2V0UHJldmlld0NsdXN0ZXInXTsKICAgIH0sCiAgICBya2VDb25maWcoKSB7CiAgICAgIHJldHVybiB0aGlzLnZhbHVlLnNwZWMucmtlQ29uZmlnOwogICAgfSwKCiAgICBpc0VsZW1lbnRhbENsdXN0ZXIoKSB7CiAgICAgIHJldHVybiB0aGlzLnByb3ZpZGVyID09PSBFTEVNRU5UQUxfQ0xVU1RFUl9QUk9WSURFUiB8fCB0aGlzLnZhbHVlPy5tYWNoaW5lUHJvdmlkZXI/LnRvTG93ZXJDYXNlKCkgPT09IEtJTkQuTUFDSElORV9JTlZfU0VMRUNUT1JfVEVNUExBVEVTLnRvTG93ZXJDYXNlKCk7CiAgICB9LAoKICAgIGNoYXJ0VmFsdWVzKCkgewogICAgICByZXR1cm4gdGhpcy52YWx1ZS5zcGVjLnJrZUNvbmZpZy5jaGFydFZhbHVlczsKICAgIH0sCgogICAgc2VydmVyQ29uZmlnKCkgewogICAgICByZXR1cm4gdGhpcy52YWx1ZS5zcGVjLnJrZUNvbmZpZy5tYWNoaW5lR2xvYmFsQ29uZmlnOwogICAgfSwKCiAgICBhZ2VudENvbmZpZygpIHsKICAgICAgcmV0dXJuIHRoaXMudmFsdWUuYWdlbnRDb25maWc7CiAgICB9LAoKICAgIHVuc3VwcG9ydGVkU2VsZWN0b3JDb25maWcoKSB7CiAgICAgIGxldCBnbG9iYWwgPSAwOwogICAgICBsZXQga3ViZWxldE9ubHkgPSAwOwogICAgICBsZXQgb3RoZXIgPSAwOwoKICAgICAgLy8gVGhlIGZvcm0gc3VwcG9ydHMgb25lIGNvbmZpZyB0aGF0IGhhcyBubyBzZWxlY3RvciBmb3IgYWxsIHRoZSBtYWluIHBhcnRzCiAgICAgIC8vIEFuZCBvbmUgb3IgbW9yZSBjb25maWdzIHRoYXQgaGF2ZSBhIHNlbGVjdG9yIGFuZCBleGFjdGx5IG9ubHkga3ViZWxldC1hcmdzLgogICAgICAvLyBJZiB0aGVyZSBhcmUgYW55IG90aGVyIHByb3BlcnRpZXMgc2V0LCBvciBtdWx0aXBsZSBjb25maWdzIHdpdGggbm8gc2VsZWN0b3IKICAgICAgLy8gc2hvdyBhIHdhcm5pbmcgdGhhdCB5b3UncmUgZWRpdGluZyBvbmx5IHBhcnQgb2YgdGhlIGNvbmZpZyBpbiB0aGUgVUkuCgogICAgICBmb3IgKGNvbnN0IGNvbmYgb2YgdGhpcy52YWx1ZS5zcGVjPy5ya2VDb25maWc/Lm1hY2hpbmVTZWxlY3RvckNvbmZpZykgewogICAgICAgIGlmIChjb25mLm1hY2hpbmVMYWJlbFNlbGVjdG9yKSB7CiAgICAgICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoY29uZi5jb25maWcgfHwge30pOwoKICAgICAgICAgIGlmIChrZXlzLmxlbmd0aCA9PT0gMCB8fCAoa2V5cy5sZW5ndGggPT09IDEgJiYga2V5c1swXSA9PT0gJ2t1YmVsZXQtYXJnJykpIHsKICAgICAgICAgICAga3ViZWxldE9ubHkrKzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG90aGVyKys7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGdsb2JhbCsrOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGUKICAgICAgY29uc29sZS5sb2coYEdsb2JhbDogJHsgZ2xvYmFsIH0sIEt1YmVsZXQgT25seTogJHsga3ViZWxldE9ubHkgfSwgT3RoZXI6ICR7IG90aGVyIH1gKTsKCiAgICAgIHJldHVybiAoZ2xvYmFsID4gMSB8fCBvdGhlciA+IDApOwogICAgfSwKCiAgICB2ZXJzaW9uT3B0aW9ucygpIHsKICAgICAgY29uc3QgY3VyID0gdGhpcy5saXZlVmFsdWU/LnNwZWM/Lmt1YmVybmV0ZXNWZXJzaW9uIHx8ICcnOwogICAgICBjb25zdCBleGlzdGluZ1JrZTIgPSB0aGlzLm1vZGUgPT09IF9FRElUICYmIGN1ci5pbmNsdWRlcygncmtlMicpOwogICAgICBjb25zdCBleGlzdGluZ0szcyA9IHRoaXMubW9kZSA9PT0gX0VESVQgJiYgY3VyLmluY2x1ZGVzKCdrM3MnKTsKCiAgICAgIGxldCBhbGxWYWxpZFJrZTJWZXJzaW9ucyA9IHRoaXMuZ2V0QWxsT3B0aW9uc0FmdGVyQ3VycmVudFZlcnNpb24odGhpcy5ya2UyVmVyc2lvbnMsIChleGlzdGluZ1JrZTIgPyBjdXIgOiBudWxsKSwgdGhpcy5kZWZhdWx0UmtlMik7CiAgICAgIGxldCBhbGxWYWxpZEszc1ZlcnNpb25zID0gdGhpcy5nZXRBbGxPcHRpb25zQWZ0ZXJDdXJyZW50VmVyc2lvbih0aGlzLmszc1ZlcnNpb25zLCAoZXhpc3RpbmdLM3MgPyBjdXIgOiBudWxsKSwgdGhpcy5kZWZhdWx0SzNzKTsKCiAgICAgIGlmICghdGhpcy5zaG93RGVwcmVjYXRlZFBhdGNoVmVyc2lvbnMpIHsKICAgICAgICAvLyBOb3JtYWxseSwgd2Ugb25seSB3YW50IHRvIHNob3cgdGhlIG1vc3QgcmVjZW50IHBhdGNoIHZlcnNpb24KICAgICAgICAvLyBmb3IgZWFjaCBLdWJlcm5ldGVzIG1pbm9yIHZlcnNpb24uIEhvd2V2ZXIsIGlmIHRoZSB1c2VyCiAgICAgICAgLy8gb3B0cyBpbiB0byBzaG93aW5nIGRlcHJlY2F0ZWQgdmVyc2lvbnMsIHdlIGRvbid0IGZpbHRlciB0aGVtLgogICAgICAgIGFsbFZhbGlkUmtlMlZlcnNpb25zID0gdGhpcy5maWx0ZXJPdXREZXByZWNhdGVkUGF0Y2hWZXJzaW9ucyhhbGxWYWxpZFJrZTJWZXJzaW9ucywgY3VyKTsKICAgICAgICBhbGxWYWxpZEszc1ZlcnNpb25zID0gdGhpcy5maWx0ZXJPdXREZXByZWNhdGVkUGF0Y2hWZXJzaW9ucyhhbGxWYWxpZEszc1ZlcnNpb25zLCBjdXIpOwogICAgICB9CgogICAgICBjb25zdCBzaG93UmtlMiA9IGFsbFZhbGlkUmtlMlZlcnNpb25zLmxlbmd0aCAmJiAhZXhpc3RpbmdLM3M7CiAgICAgIGNvbnN0IHNob3dLM3MgPSBhbGxWYWxpZEszc1ZlcnNpb25zLmxlbmd0aCAmJiAhZXhpc3RpbmdSa2UyOwogICAgICBjb25zdCBvdXQgPSBbXTsKCiAgICAgIGlmIChzaG93UmtlMikgewogICAgICAgIGlmIChzaG93SzNzKSB7CiAgICAgICAgICBvdXQucHVzaCh7IGtpbmQ6ICdncm91cCcsIGxhYmVsOiB0aGlzLnQoJ2NsdXN0ZXIucHJvdmlkZXIucmtlMicpIH0pOwogICAgICAgIH0KCiAgICAgICAgb3V0LnB1c2goLi4uYWxsVmFsaWRSa2UyVmVyc2lvbnMpOwogICAgICB9CgogICAgICBpZiAoc2hvd0szcykgewogICAgICAgIGlmIChzaG93UmtlMikgewogICAgICAgICAgb3V0LnB1c2goeyBraW5kOiAnZ3JvdXAnLCBsYWJlbDogdGhpcy50KCdjbHVzdGVyLnByb3ZpZGVyLmszcycpIH0pOwogICAgICAgIH0KCiAgICAgICAgb3V0LnB1c2goLi4uYWxsVmFsaWRLM3NWZXJzaW9ucyk7CiAgICAgIH0KCiAgICAgIGlmIChjdXIpIHsKICAgICAgICBjb25zdCBleGlzdGluZyA9IG91dC5maW5kKCh4KSA9PiB4LnZhbHVlID09PSBjdXIpOwoKICAgICAgICBpZiAoZXhpc3RpbmcpIHsKICAgICAgICAgIGV4aXN0aW5nLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gb3V0OwogICAgfSwKCiAgICAvKioKICAgICAqIEt1YmUgVmVyc2lvbgogICAgICovCiAgICBzZWxlY3RlZFZlcnNpb24oKSB7CiAgICAgIGNvbnN0IHN0ciA9IHRoaXMudmFsdWUuc3BlYy5rdWJlcm5ldGVzVmVyc2lvbjsKCiAgICAgIGlmICghc3RyKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBvdXQgPSBmaW5kQnkodGhpcy52ZXJzaW9uT3B0aW9ucywgJ3ZhbHVlJywgc3RyKTsKCiAgICAgIC8vIEFkZGluZyB0aGUgb3B0aW9uICdub25lJyB0byBDb250YWluZXIgTmV0d29yayBzZWxlY3QgKHVzZWQgaW4gQmFzaWNzIGNvbXBvbmVudCkKICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3JhbmNoZXIvZGFzaGJvYXJkL2lzc3Vlcy8xMDMzOAogICAgICAvLyB0aGVyZSdzIGFuIHVwZGF0ZSBsb29wIG9uIHJlZnJlc2ggdGhhdCBtaWdodCBpbmNsdWRlICdub25lJwogICAgICAvLyBtdWx0aXBsZSB0aW1lcy4uLiBQcmV2ZW50IHRoYXQKICAgICAgaWYgKG91dC5zZXJ2ZXJBcmdzPy5jbmk/Lm9wdGlvbnMgJiYgIW91dC5zZXJ2ZXJBcmdzPy5jbmk/Lm9wdGlvbnMuaW5jbHVkZXMoJ25vbmUnKSkgewogICAgICAgIG91dC5zZXJ2ZXJBcmdzLmNuaS5vcHRpb25zLnB1c2goJ25vbmUnKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG91dDsKICAgIH0sCgogICAgaGF2ZUFyZ0luZm8oKSB7CiAgICAgIHJldHVybiBCb29sZWFuKHRoaXMuc2VsZWN0ZWRWZXJzaW9uPy5zZXJ2ZXJBcmdzICYmIHRoaXMuc2VsZWN0ZWRWZXJzaW9uPy5hZ2VudEFyZ3MpOwogICAgfSwKCiAgICBzZXJ2ZXJBcmdzKCkgewogICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZFZlcnNpb24/LnNlcnZlckFyZ3MgfHwge307CiAgICB9LAoKICAgIGFnZW50QXJncygpIHsKICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRWZXJzaW9uPy5hZ2VudEFyZ3MgfHwge307CiAgICB9LAoKICAgIC8qKgogICAgICogVGhlIGFkZG9ucyAoa3ViZSBjaGFydHMpIGFwcGxpY2FibGUgZm9yIHRoZSBzZWxlY3RlZCBrdWJlIHZlcnNpb24KICAgICAqCiAgICAgKiB7IFtjaGFydE5hbWU6c3RyaW5nXTogeyByZXBvOiBzdHJpbmcsIHZlcnNpb246IHN0cmluZyB9IH0KICAgICAqLwogICAgY2hhcnRWZXJzaW9ucygpIHsKICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRWZXJzaW9uPy5jaGFydHMgfHwge307CiAgICB9LAoKICAgIG5lZWRDcmVkZW50aWFsKCkgewogICAgICBpZiAodGhpcy5wcm92aWRlciA9PT0gJ2N1c3RvbScgfHwgdGhpcy5wcm92aWRlciA9PT0gJ2ltcG9ydCcgfHwgdGhpcy5pc0VsZW1lbnRhbENsdXN0ZXIgfHwgdGhpcy5tb2RlID09PSBfVklFVyB8fCAodGhpcy5wcm92aWRlckNvbmZpZz8uc3BlYz8uYnVpbHRpbiA9PT0gZmFsc2UgJiYgdGhpcy5wcm92aWRlckNvbmZpZz8uc3BlYz8uYWRkQ2xvdWRDcmVkZW50aWFsID09PSBmYWxzZSkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmN1c3RvbUNyZWRlbnRpYWxDb21wb25lbnRSZXF1aXJlZCA9PT0gZmFsc2UpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfSwKCiAgICAvKioKICAgICAqIE9ubHkgZm9yIGV4dGVuc2lvbnMgLSBleHRlbnNpb24gY2FuIHJlZ2lzdGVyIGEgJ2ZhbHNlJyBjbG91ZCBjcmVkZW50aWFsIHRvIGluZGljYXRlIHRoYXQgYSBjbG91ZCBjcmVkZW50aWFsIGlzIG5vdCBuZWVkZWQKICAgICAqLwogICAgY3VzdG9tQ3JlZGVudGlhbENvbXBvbmVudFJlcXVpcmVkKCkgewogICAgICByZXR1cm4gdGhpcy4kcGx1Z2luLmdldER5bmFtaWMoJ2Nsb3VkLWNyZWRlbnRpYWwnLCB0aGlzLnByb3ZpZGVyKTsKICAgIH0sCgogICAgaGFzTWFjaGluZVBvb2xzKCkgewogICAgICBpZiAodGhpcy5wcm92aWRlciA9PT0gJ2N1c3RvbScgfHwgdGhpcy5wcm92aWRlciA9PT0gJ2ltcG9ydCcpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfSwKCiAgICB1bnJlbW92ZWRNYWNoaW5lUG9vbHMoKSB7CiAgICAgIHJldHVybiAodGhpcy5tYWNoaW5lUG9vbHMgfHwgW10pLmZpbHRlcigoeCkgPT4gIXgucmVtb3ZlKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBFeHRlbnNpb24gcHJvdmlkZXIgd2hlcmUgYmVpbmcgcHJvdmlzaW9uZWQgYnkgYW4gZXh0ZW5zaW9uCiAgICAgKi8KICAgIGV4dGVuc2lvblByb3ZpZGVyKCkgewogICAgICBjb25zdCBleHRDbGFzcyA9IHRoaXMuJHBsdWdpbi5nZXREeW5hbWljKCdwcm92aXNpb25lcicsIHRoaXMucHJvdmlkZXIpOwoKICAgICAgaWYgKGV4dENsYXNzKSB7CiAgICAgICAgcmV0dXJuIG5ldyBleHRDbGFzcyh7CiAgICAgICAgICBkaXNwYXRjaDogdGhpcy4kc3RvcmUuZGlzcGF0Y2gsCiAgICAgICAgICBnZXR0ZXJzOiAgdGhpcy4kc3RvcmUuZ2V0dGVycywKICAgICAgICAgIGF4aW9zOiAgICB0aGlzLiRzdG9yZS4kYXhpb3MsCiAgICAgICAgICAkcGx1Z2luOiAgdGhpcy4kc3RvcmUuYXBwLiRwbHVnaW4sCiAgICAgICAgICAkdDogICAgICAgdGhpcy50LAogICAgICAgICAgaXNDcmVhdGU6IHRoaXMuaXNDcmVhdGUKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBJcyBhIG5hbWVzcGFjZSBuZWVkZWQ/IE9ubHkgc3VwcG9ydGVkIGZvciBwcm92aWRlcnMgZnJvbSBleHRlbnNpb25zLCBvdGhlcndpc2UgZGVmYXVsdCBpcyBubwogICAgICovCiAgICBuZWVkc05hbWVzcGFjZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuZXh0ZW5zaW9uUHJvdmlkZXIgPyAhIXRoaXMuZXh0ZW5zaW9uUHJvdmlkZXIubmFtZXNwYWNlZCA6IGZhbHNlOwogICAgfSwKCiAgICBtYWNoaW5lQ29uZmlnU2NoZW1hKCkgewogICAgICBsZXQgc2NoZW1hOwoKICAgICAgaWYgKCF0aGlzLmhhc01hY2hpbmVQb29scykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9IGVsc2UgaWYgKHRoaXMuaXNFbGVtZW50YWxDbHVzdGVyKSB7CiAgICAgICAgc2NoZW1hID0gRUxFTUVOVEFMX1NDSEVNQV9JRFMuTUFDSElORV9JTlZfU0VMRUNUT1JfVEVNUExBVEVTOwogICAgICB9IGVsc2UgewogICAgICAgIHNjaGVtYSA9IGAkeyBDQVBJLk1BQ0hJTkVfQ09ORklHX0dST1VQIH0uJHsgdGhpcy5wcm92aWRlciB9Y29uZmlnYDsKICAgICAgfQoKICAgICAgLy8gSWYgdGhpcyBpcyBhbiBleHRlbnNpb24gcHJvdmlkZXIgdGhlbiB0aGUgZXh0ZW5zaW9uIGNhbiBwcm92aWRlIHRoZSBzY2hlbWEKICAgICAgY29uc3QgZXh0ZW5zaW9uU2NoZW1hID0gdGhpcy5leHRlbnNpb25Qcm92aWRlcj8ubWFjaGluZUNvbmZpZ1NjaGVtYTsKCiAgICAgIGlmIChleHRlbnNpb25TY2hlbWEpIHsKICAgICAgICAvLyBtYWNoaW5lQ29uZmlnU2NoZW1hIGNhbiBlaXRoZXIgYmUgdGhlIHNjaGVtYSBuYW1lIChzdHJpbmcpIG9yIHRoZSBzY2hlbWEgaXRzZWxmIChvYmplY3QpCiAgICAgICAgaWYgKHR5cGVvZiBleHRlbnNpb25TY2hlbWEgPT09ICdvYmplY3QnKSB7CiAgICAgICAgICByZXR1cm4gZXh0ZW5zaW9uU2NoZW1hOwogICAgICAgIH0KCiAgICAgICAgLy8gTmFtZSBvZiBzY2hlbWEgdG8gdXNlCiAgICAgICAgc2NoZW1hID0gZXh0ZW5zaW9uU2NoZW1hOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuZ2V0dGVyc1snbWFuYWdlbWVudC9zY2hlbWFGb3InXShzY2hlbWEpOwogICAgfSwKCiAgICBub2RlVG90YWxzKCkgewogICAgICBjb25zdCByb2xlcyA9IFsnZXRjZCcsICdjb250cm9sUGxhbmUnLCAnd29ya2VyJ107CiAgICAgIGNvbnN0IGNvdW50cyA9IHt9OwogICAgICBjb25zdCBvdXQgPSB7CiAgICAgICAgY29sb3I6ICAge30sCiAgICAgICAgbGFiZWw6ICAge30sCiAgICAgICAgaWNvbjogICAge30sCiAgICAgICAgdG9vbHRpcDoge30sCiAgICAgIH07CgogICAgICBmb3IgKGNvbnN0IHJvbGUgb2Ygcm9sZXMpIHsKICAgICAgICBjb3VudHNbcm9sZV0gPSAwOwogICAgICAgIG91dC5jb2xvcltyb2xlXSA9IE5PREVfVE9UQUwuc3VjY2Vzcy5jb2xvcjsKICAgICAgICBvdXQuaWNvbltyb2xlXSA9IE5PREVfVE9UQUwuc3VjY2Vzcy5pY29uOwogICAgICB9CgogICAgICBmb3IgKGNvbnN0IHJvdyBvZiB0aGlzLm1hY2hpbmVQb29scyB8fCBbXSkgewogICAgICAgIGlmIChyb3cucmVtb3ZlKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHF0eSA9IHBhcnNlSW50KHJvdy5wb29sLnF1YW50aXR5LCAxMCk7CgogICAgICAgIGlmIChpc05hTihxdHkpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGZvciAoY29uc3Qgcm9sZSBvZiByb2xlcykgewogICAgICAgICAgY291bnRzW3JvbGVdID0gY291bnRzW3JvbGVdICsgKHJvdy5wb29sW2AkeyByb2xlIH1Sb2xlYF0gPyBxdHkgOiAwKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAoY29uc3Qgcm9sZSBvZiByb2xlcykgewogICAgICAgIG91dC5sYWJlbFtyb2xlXSA9IHRoaXMudChgY2x1c3Rlci5tYWNoaW5lUG9vbC5ub2RlVG90YWxzLmxhYmVsLiR7IHJvbGUgfWAsIHsgY291bnQ6IGNvdW50c1tyb2xlXSB9KTsKICAgICAgICBvdXQudG9vbHRpcFtyb2xlXSA9IHRoaXMudChgY2x1c3Rlci5tYWNoaW5lUG9vbC5ub2RlVG90YWxzLnRvb2x0aXAuJHsgcm9sZSB9YCwgeyBjb3VudDogY291bnRzW3JvbGVdIH0pOwogICAgICB9CgogICAgICBpZiAoY291bnRzLmV0Y2QgPT09IDApIHsKICAgICAgICBvdXQuY29sb3IuZXRjZCA9IE5PREVfVE9UQUwuZXJyb3IuY29sb3I7CiAgICAgICAgb3V0Lmljb24uZXRjZCA9IE5PREVfVE9UQUwuZXJyb3IuaWNvbjsKICAgICAgfSBlbHNlIGlmIChjb3VudHMuZXRjZCA9PT0gMSB8fCBjb3VudHMuZXRjZCAlIDIgPT09IDAgfHwgY291bnRzLmV0Y2QgPiA3KSB7CiAgICAgICAgb3V0LmNvbG9yLmV0Y2QgPSBOT0RFX1RPVEFMLndhcm5pbmcuY29sb3I7CiAgICAgICAgb3V0Lmljb24uZXRjZCA9IE5PREVfVE9UQUwud2FybmluZy5pY29uOwogICAgICB9CgogICAgICBpZiAoY291bnRzLmNvbnRyb2xQbGFuZSA9PT0gMCkgewogICAgICAgIG91dC5jb2xvci5jb250cm9sUGxhbmUgPSBOT0RFX1RPVEFMLmVycm9yLmNvbG9yOwogICAgICAgIG91dC5pY29uLmNvbnRyb2xQbGFuZSA9IE5PREVfVE9UQUwuZXJyb3IuaWNvbjsKICAgICAgfSBlbHNlIGlmIChjb3VudHMuY29udHJvbFBsYW5lID09PSAxKSB7CiAgICAgICAgb3V0LmNvbG9yLmNvbnRyb2xQbGFuZSA9IE5PREVfVE9UQUwud2FybmluZy5jb2xvcjsKICAgICAgICBvdXQuaWNvbi5jb250cm9sUGxhbmUgPSBOT0RFX1RPVEFMLndhcm5pbmcuaWNvbjsKICAgICAgfQoKICAgICAgaWYgKGNvdW50cy53b3JrZXIgPT09IDApIHsKICAgICAgICBvdXQuY29sb3Iud29ya2VyID0gTk9ERV9UT1RBTC5lcnJvci5jb2xvcjsKICAgICAgICBvdXQuaWNvbi53b3JrZXIgPSBOT0RFX1RPVEFMLmVycm9yLmljb247CiAgICAgIH0gZWxzZSBpZiAoY291bnRzLndvcmtlciA9PT0gMSkgewogICAgICAgIG91dC5jb2xvci53b3JrZXIgPSBOT0RFX1RPVEFMLndhcm5pbmcuY29sb3I7CiAgICAgICAgb3V0Lmljb24ud29ya2VyID0gTk9ERV9UT1RBTC53YXJuaW5nLmljb247CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXQ7CiAgICB9LAoKICAgIHNob3dDbmkoKSB7CiAgICAgIHJldHVybiAhIXRoaXMuc2VydmVyQXJncy5jbmk7CiAgICB9LAoKICAgIHNob3dDbG91ZFByb3ZpZGVyKCkgewogICAgICByZXR1cm4gISF0aGlzLmFnZW50QXJnc1snY2xvdWQtcHJvdmlkZXItbmFtZSddOwogICAgfSwKCiAgICAvKioKICAgICAqIFRoZSBjaGFydCBuYW1lcyBvZiB0aGUgYWRkb25zIGFwcGxpY2FibGUgdG8gdGhlIGN1cnJlbnQga3ViZSB2ZXJzaW9uIGFuZCBzZWxlY3RlZCBjbG91ZCBwcm92aWRlcgogICAgICovCiAgICBhZGRvbk5hbWVzKCkgewogICAgICBjb25zdCBuYW1lcyA9IFtdOwogICAgICBjb25zdCBjbmkgPSB0aGlzLnNlcnZlckNvbmZpZy5jbmk7CgogICAgICBpZiAodHlwZW9mIGNuaSA9PT0gJ3N0cmluZycpIHsKICAgICAgICBuYW1lcy5wdXNoKC4uLmNuaS5zcGxpdCgnLCcpLm1hcCgoeCkgPT4gYHJrZTItJHsgeCB9YCkpOwogICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoY25pKSkgewogICAgICAgIG5hbWVzLnB1c2goLi4uY25pLm1hcCgoeCkgPT4gYHJrZTItJHsgeCB9YCkpOwogICAgICB9CgogICAgICBpZiAodGhpcy5zaG93Q2xvdWRQcm92aWRlcikgeyAvLyBTaG91bGRuJ3QgYmUgcmVtb3ZlZCBzdWNoIHRoYXQgY2hhbmdlcyB0byBpdCB3aWxsIHJlLXRyaWdnZXIgdGhpcyB3YXRjaAogICAgICAgIGlmICh0aGlzLmFnZW50Q29uZmlnPy5bJ2Nsb3VkLXByb3ZpZGVyLW5hbWUnXSA9PT0gJ3JhbmNoZXItdnNwaGVyZScpIHsKICAgICAgICAgIG5hbWVzLnB1c2goJ3JhbmNoZXItdnNwaGVyZS1jcGknLCAncmFuY2hlci12c3BoZXJlLWNzaScpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuYWdlbnRDb25maWc/LlsnY2xvdWQtcHJvdmlkZXItbmFtZSddID09PSBIQVJWRVNURVIpIHsKICAgICAgICAgIG5hbWVzLnB1c2goSEFSVkVTVEVSX0NMT1VEX1BST1ZJREVSKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBuYW1lczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBUaGUgY2hhcnRzIG9mIHRoZSBhZGRvbnMgYXBwbGljYWJsZSB0byB0aGUgY3VycmVudCBrdWJlIHZlcnNpb24gYW5kIHNlbGVjdGVkIGNsb3VkIHByb3ZpZGVyCiAgICAgKgogICAgICogVGhlc2UgYXJlIHRoZSBjaGFydHMgdGhlbXNlbHZlcyBhbmQgZG8gbm90IGluY2x1ZGUgY2hhcnQgcmVhZG1lIG9yIHZhbHVlcwogICAgICovCiAgICBhZGRvblZlcnNpb25zKCkgewogICAgICBjb25zdCB2ZXJzaW9ucyA9IHRoaXMuYWRkb25OYW1lcy5tYXAoKG5hbWUpID0+IHRoaXMudmVyc2lvbkluZm9bbmFtZV0/LmNoYXJ0KTsKCiAgICAgIHJldHVybiB2ZXJzaW9ucy5maWx0ZXIoKHgpID0+ICEheCk7CiAgICB9LAoKICAgIGNsb3VkUHJvdmlkZXJPcHRpb25zKCkgewogICAgICBjb25zdCBvdXQgPSBbewogICAgICAgIGxhYmVsOiB0aGlzLiRzdG9yZS5nZXR0ZXJzWydpMThuL3QnXSgnY2x1c3Rlci5ya2UyLmNsb3VkUHJvdmlkZXIuZGVmYXVsdFZhbHVlLmxhYmVsJyksCiAgICAgICAgdmFsdWU6ICcnLAogICAgICB9XTsKCiAgICAgIGlmICghIXRoaXMuYWdlbnRBcmdzWydjbG91ZC1wcm92aWRlci1uYW1lJ10/Lm9wdGlvbnMpIHsKICAgICAgICBjb25zdCBwcmVmZXJyZWQgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzWydwbHVnaW5zL2Nsb3VkUHJvdmlkZXJGb3JEcml2ZXInXSh0aGlzLnByb3ZpZGVyKTsKCiAgICAgICAgZm9yIChjb25zdCBvcHQgb2YgdGhpcy5hZ2VudEFyZ3NbJ2Nsb3VkLXByb3ZpZGVyLW5hbWUnXT8ub3B0aW9ucykgewogICAgICAgICAgLy8gSWYgd2UgZG9uJ3QgaGF2ZSBhIHByZWZlcnJlZCBwcm92aWRlci4uLiBzaG93IGFsbCBvcHRpb25zCiAgICAgICAgICBjb25zdCBzaG93QWxsT3B0aW9ucyA9IHByZWZlcnJlZCA9PT0gdW5kZWZpbmVkOwogICAgICAgICAgLy8gSWYgd2UgaGF2ZSBhIHByZWZlcnJlZCBwcm92aWRlci4uLiBvbmx5IHNob3cgZGVmYXVsdCwgcHJlZmVycmVkIGFuZCBleHRlcm5hbAogICAgICAgICAgY29uc3QgaXNQcmVmZXJyZWQgPSBvcHQgPT09IHByZWZlcnJlZDsKICAgICAgICAgIGNvbnN0IGlzRXh0ZXJuYWwgPSBvcHQgPT09ICdleHRlcm5hbCc7CiAgICAgICAgICBsZXQgZGlzYWJsZWQgPSBmYWxzZTsKCiAgICAgICAgICBpZiAoKHRoaXMuaXNIYXJ2ZXN0ZXJFeHRlcm5hbENyZWRlbnRpYWwgfHwgdGhpcy5pc0hhcnZlc3RlckluY29tcGF0aWJsZSkgJiYgaXNQcmVmZXJyZWQpIHsKICAgICAgICAgICAgZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChzaG93QWxsT3B0aW9ucyB8fCBpc1ByZWZlcnJlZCB8fCBpc0V4dGVybmFsKSB7CiAgICAgICAgICAgIG91dC5wdXNoKHsKICAgICAgICAgICAgICBsYWJlbDogdGhpcy4kc3RvcmUuZ2V0dGVyc1snaTE4bi93aXRoRmFsbGJhY2snXShgY2x1c3Rlci5jbG91ZFByb3ZpZGVyLiIkeyBvcHQgfSIubGFiZWxgLCBudWxsLCBvcHQpLAogICAgICAgICAgICAgIHZhbHVlOiBvcHQsCiAgICAgICAgICAgICAgZGlzYWJsZWQsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgY3VyID0gdGhpcy5hZ2VudENvbmZpZz8uWydjbG91ZC1wcm92aWRlci1uYW1lJ107CgogICAgICBpZiAoY3VyICYmICFvdXQuZmluZCgoeCkgPT4geC52YWx1ZSA9PT0gY3VyKSkgewogICAgICAgIG91dC51bnNoaWZ0KHsgbGFiZWw6IGAkeyBjdXIgfSAoQ3VycmVudClgLCB2YWx1ZTogY3VyIH0pOwogICAgICB9CgogICAgICByZXR1cm4gb3V0OwogICAgfSwKCiAgICBjYW5NYW5hZ2VNZW1iZXJzKCkgewogICAgICByZXR1cm4gY2FuVmlld0NsdXN0ZXJNZW1iZXJzaGlwRWRpdG9yKHRoaXMuJHN0b3JlKTsKICAgIH0sCgogICAgaXNIYXJ2ZXN0ZXJEcml2ZXIoKSB7CiAgICAgIHJldHVybiB0aGlzLiRyb3V0ZS5xdWVyeS50eXBlID09PSBIQVJWRVNURVI7CiAgICB9LAoKICAgIGRlZmF1bHRWZXJzaW9uKCkgewogICAgICBjb25zdCBhbGwgPSB0aGlzLnZlcnNpb25PcHRpb25zLmZpbHRlcigoeCkgPT4gISF4LnZhbHVlKTsKICAgICAgY29uc3QgZmlyc3QgPSBhbGxbMF0/LnZhbHVlOwogICAgICBjb25zdCBwcmVmZXJyZWQgPSBhbGwuZmluZCgoeCkgPT4geC52YWx1ZSA9PT0gdGhpcy5kZWZhdWx0UmtlMik/LnZhbHVlOwoKICAgICAgY29uc3QgcmtlMiA9IHRoaXMuZ2V0QWxsT3B0aW9uc0FmdGVyQ3VycmVudFZlcnNpb24odGhpcy5ya2UyVmVyc2lvbnMsIG51bGwpOwogICAgICBjb25zdCBzaG93UmtlMiA9IHJrZTIubGVuZ3RoOwogICAgICBsZXQgb3V0OwoKICAgICAgaWYgKHRoaXMuaXNIYXJ2ZXN0ZXJEcml2ZXIgJiYgc2hvd1JrZTIpIHsKICAgICAgICBjb25zdCBzYXRpc2ZpZXNWZXJzaW9uID0gcmtlMi5maWx0ZXIoKHYpID0+IHsKICAgICAgICAgIHJldHVybiBpc0hhcnZlc3RlclNhdGlzZmllc1ZlcnNpb24odi52YWx1ZSk7CiAgICAgICAgfSkgfHwgW107CgogICAgICAgIGlmIChzYXRpc2ZpZXNWZXJzaW9uLmxlbmd0aCA+IDApIHsKICAgICAgICAgIG91dCA9IHNhdGlzZmllc1ZlcnNpb25bMF0/LnZhbHVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCFvdXQpIHsKICAgICAgICBvdXQgPSBwcmVmZXJyZWQgfHwgZmlyc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXQ7CiAgICB9LAoKICAgIGFwcHNPU1dhcm5pbmcoKSB7CiAgICAgIGlmICh0aGlzLm1vZGUgIT09IF9FRElUKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3QgeyBsaW51eFdvcmtlckNvdW50LCB3aW5kb3dzV29ya2VyQ291bnQgfSA9IHRoaXMudmFsdWU/Lm1nbXQ/LnN0YXR1cyB8fCB7fTsKCiAgICAgIGlmICghd2luZG93c1dvcmtlckNvdW50KSB7CiAgICAgICAgaWYgKCEhdGhpcy5tYWNoaW5lUG9vbHMuZmluZCgocG9vbCkgPT4gewogICAgICAgICAgcmV0dXJuIHBvb2w/LmNvbmZpZz8ub3MgPT09ICd3aW5kb3dzJzsKICAgICAgICB9KSkgewogICAgICAgICAgcmV0dXJuIHRoaXMudCgnY2x1c3Rlci5iYW5uZXIub3MnLCB7IG5ld09TOiAnV2luZG93cycsIGV4aXN0aW5nT1M6ICdMaW51eCcgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKCFsaW51eFdvcmtlckNvdW50KSB7CiAgICAgICAgaWYgKHRoaXMubWFjaGluZVBvb2xzLmZpbmQoKHBvb2wpID0+IHsKICAgICAgICAgIHJldHVybiBwb29sPy5jb25maWc/Lm9zID09PSAnbGludXgnOwogICAgICAgIH0pKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy50KCdjbHVzdGVyLmJhbm5lci5vcycsIHsgbmV3T1M6ICdMaW51eCcsIGV4aXN0aW5nT1M6ICdXaW5kb3dzJyB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfSwKCiAgICBzaG93Rm9ybSgpIHsKICAgICAgcmV0dXJuICEhdGhpcy5jcmVkZW50aWFsSWQgfHwgIXRoaXMubmVlZENyZWRlbnRpYWw7CiAgICB9LAoKICAgIGlzSGFydmVzdGVyRXh0ZXJuYWxDcmVkZW50aWFsKCkgewogICAgICByZXR1cm4gdGhpcy5jcmVkZW50aWFsPy5oYXJ2ZXN0ZXJjcmVkZW50aWFsQ29uZmlnPy5jbHVzdGVyVHlwZSA9PT0gJ2V4dGVybmFsJzsKICAgIH0sCgogICAgaXNIYXJ2ZXN0ZXJJbmNvbXBhdGlibGUoKSB7CiAgICAgIGxldCBjY21Sa2UyVmVyc2lvbiA9ICh0aGlzLmNoYXJ0VmVyc2lvbnNbJ2hhcnZlc3Rlci1jbG91ZC1wcm92aWRlciddIHx8IHt9KVsndmVyc2lvbiddOwogICAgICBsZXQgY3NpUmtlMlZlcnNpb24gPSAodGhpcy5jaGFydFZlcnNpb25zWydoYXJ2ZXN0ZXItY3NpLWRyaXZlciddIHx8IHt9KVsndmVyc2lvbiddOwoKICAgICAgY29uc3QgY2NtVmVyc2lvbiA9IHRoaXMuaGFydmVzdGVyVmVyc2lvblJhbmdlPy5bJ2hhcnZlc3Rlci1jbG91ZC1wcm92aWRlciddOwogICAgICBjb25zdCBjc2lWZXJzaW9uID0gdGhpcy5oYXJ2ZXN0ZXJWZXJzaW9uUmFuZ2U/LlsnaGFydmVzdGVyLWNzaS1wcm92aWRlciddOwoKICAgICAgaWYgKChjY21Sa2UyVmVyc2lvbiB8fCAnJykuZW5kc1dpdGgoJzAwJykpIHsKICAgICAgICBjY21Sa2UyVmVyc2lvbiA9IGNjbVJrZTJWZXJzaW9uLnNsaWNlKDAsIC0yKTsKICAgICAgfQoKICAgICAgaWYgKChjc2lSa2UyVmVyc2lvbiB8fCAnJykuZW5kc1dpdGgoJzAwJykpIHsKICAgICAgICBjc2lSa2UyVmVyc2lvbiA9IGNzaVJrZTJWZXJzaW9uLnNsaWNlKDAsIC0yKTsKICAgICAgfQoKICAgICAgaWYgKGNjbVZlcnNpb24gJiYgY3NpVmVyc2lvbikgewogICAgICAgIGlmIChzZW12ZXIuc2F0aXNmaWVzKGNjbVJrZTJWZXJzaW9uLCBjY21WZXJzaW9uKSAmJgogICAgICAgICAgc2VtdmVyLnNhdGlzZmllcyhjc2lSa2UyVmVyc2lvbiwgY3NpVmVyc2lvbikpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSwKCiAgICB2YWxpZGF0aW9uUGFzc2VkKCkgewogICAgICBjb25zdCB2YWxpZFJlcXVpcmVkUG9vbHMgPSB0aGlzLmhhc01hY2hpbmVQb29scyA/IHRoaXMuaGFzUmVxdWlyZWROb2RlcygpIDogdHJ1ZTsKCiAgICAgIGxldCBiYXNlID0gKHRoaXMucHJvdmlkZXIgPT09ICdjdXN0b20nIHx8IHRoaXMuaXNFbGVtZW50YWxDbHVzdGVyIHx8ICEhdGhpcy5jcmVkZW50aWFsSWQgfHwgIXRoaXMubmVlZENyZWRlbnRpYWwpOwoKICAgICAgLy8gYW5kIGluIGFsbCBvZiB0aGUgdmFsaWRhdGlvbiBzdGF0dXNlcyBmb3IgZWFjaCBtYWNoaW5lIHBvb2wKICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLm1hY2hpbmVQb29sVmFsaWRhdGlvbikuZm9yRWFjaCgodikgPT4gKGJhc2UgPSBiYXNlICYmIHYpKTsKCiAgICAgIHJldHVybiB2YWxpZFJlcXVpcmVkUG9vbHMgJiYgYmFzZTsKICAgIH0sCiAgICBjdXJyZW50Q2x1c3RlcigpIHsKICAgICAgaWYgKHRoaXMubW9kZSA9PT0gX0VESVQpIHsKICAgICAgICByZXR1cm4geyAuLi50aGlzLnZhbHVlIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLmdldHRlcnNbJ2N1c3RvbWlzYXRpb24vZ2V0UHJldmlld0NsdXN0ZXInXTsKICAgICAgfQogICAgfQogIH0sCgogIHdhdGNoOiB7CiAgICBjbHVzdGVyQmFkZ2VBYmJyZXZpYXRpb246IHsKICAgICAgaW1tZWRpYXRlOiB0cnVlLAogICAgICBoYW5kbGVyKG5ldSkgewogICAgICAgIGlmICghbmV1KSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoT2JqZWN0LmtleXMobmV1LmJhZGdlKS5sZW5ndGggPD0gMCkgewogICAgICAgICAgcmV0dXJuIHsgLi4udGhpcy52YWx1ZSB9OwogICAgICAgIH0KCiAgICAgICAgY29uc3Qgb2JqID0gewogICAgICAgICAgW0NMVVNURVJfQkFER0UuSUNPTl9URVhUXTogbmV1LmJhZGdlLmljb25UZXh0LCBbQ0xVU1RFUl9CQURHRS5DT0xPUl06IG5ldS5iYWRnZS5jb2xvciwgW0NMVVNURVJfQkFER0UuVEVYVF06IG5ldS5iYWRnZS50ZXh0CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy52YWx1ZS5tZXRhZGF0YS5hbm5vdGF0aW9ucyA9IHsKICAgICAgICAgIC4uLnRoaXMudmFsdWUubWV0YWRhdGEuYW5ub3RhdGlvbnMsCiAgICAgICAgICAuLi5vYmoKICAgICAgICB9OwogICAgICB9CiAgICB9LAoKICAgIGNyZWRlbnRpYWxJZCh2YWwpIHsKICAgICAgaWYgKHZhbCkgewogICAgICAgIHRoaXMuY3JlZGVudGlhbCA9IHRoaXMuJHN0b3JlLmdldHRlcnNbJ3JhbmNoZXIvYnlJZCddKE5PUk1BTi5DTE9VRF9DUkVERU5USUFMLCB0aGlzLmNyZWRlbnRpYWxJZCk7CgogICAgICAgIGlmICh0aGlzLmlzSGFydmVzdGVyRHJpdmVyKSB7CiAgICAgICAgICB0aGlzLnNldEhhcnZlc3RlclZlcnNpb25SYW5nZSgpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNyZWRlbnRpYWwgPSBudWxsOwogICAgICB9CgogICAgICB0aGlzLnZhbHVlLnNwZWMuY2xvdWRDcmVkZW50aWFsU2VjcmV0TmFtZSA9IHZhbDsKICAgIH0sCgogICAgYWRkb25OYW1lcyhuZXUsIG9sZCkgewogICAgICAvLyBUbyBjYXRjaCB0aGUgJ3NvbWUgYWRkb25zJyAtLT4gJ25vIGFkZG9ucycgY2FzZSBhbHNvIGNoZWNrIGFycmF5IGxlbmd0aCAoYGRpZmZlcmVuY2UoW10sIFsxLDIsM10pID09PSBbXWApCiAgICAgIGNvbnN0IGRpZmYgPSBvbGQubGVuZ3RoICE9PSBuZXUubGVuZ3RoIHx8IGRpZmZlcmVuY2UobmV1LCBvbGQpLmxlbmd0aDsKCiAgICAgIGlmIChkaWZmKSB7CiAgICAgICAgLy8gQWxsb3cgdGltZSBmb3IgYWRkb25OYW1lcyB0byB1cGRhdGUuLi4gdGhlbiBmZXRjaCBhbnkgbWlzc2luZyBhZGRvbnMKICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB0aGlzLmluaXRBZGRvbnMoKSk7CiAgICAgIH0KICAgIH0sCgogICAgc2VsZWN0ZWRWZXJzaW9uKCkgewogICAgICB0aGlzLnZlcnNpb25JbmZvID0ge307IC8vIEludmFsaWRhdGUgY2FjaGUgc3VjaCB0aGF0IHZlcnNpb24gaW5mbyByZWxldmVudCB0byBzZWxlY3RlZCBrdWJlIHZlcnNpb24gaXMgdXBkYXRlZAoKICAgICAgLy8gQWxsb3cgdGltZSBmb3IgYWRkb25OYW1lcyB0byB1cGRhdGUuLi4gdGhlbiBmZXRjaCBhbnkgbWlzc2luZyBhZGRvbnMKICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gdGhpcy5pbml0QWRkb25zKCkpOwogICAgICBpZiAodGhpcy5tb2RlID09PSBfQ1JFQVRFKSB7CiAgICAgICAgdGhpcy5pbml0U2VydmVyQWdlbnRBcmdzKCk7CiAgICAgIH0KICAgIH0sCgogICAgc2hvd0NuaShuZXUpIHsKICAgICAgLy8gVXBkYXRlIGBzZXJ2ZXJDb25maWcuY25pIHRvIHJlY2FsY3VsYXRlIGFkZG9uTmFtZXMuLi4KICAgICAgLy8gLi4uIHdoaWNoIHdpbGwgZXZlbnR1YWxseSB1cGRhdGUgYHZhbHVlLnNwZWMucmtlQ29uZmlnLmNoYXJ0VmFsdWVzYAogICAgICBpZiAobmV1KSB7CiAgICAgICAgLy8gVHlwZSBzdXBwb3J0cyBDTkksIGFzc2lnbiBkZWZhdWx0IGlmIHdlIGNhbgogICAgICAgIGlmICghdGhpcy5zZXJ2ZXJDb25maWcuY25pKSB7CiAgICAgICAgICBjb25zdCBkZWYgPSB0aGlzLnNlcnZlckFyZ3MuY25pLmRlZmF1bHQ7CgogICAgICAgICAgc2V0KHRoaXMuc2VydmVyQ29uZmlnLCAnY25pJywgZGVmKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVHlwZSBkb2Vzbid0IHN1cHBvcnQgY25pLCBjbGVhciBgY25pYAogICAgICAgIHNldCh0aGlzLnNlcnZlckNvbmZpZywgJ2NuaScsIHVuZGVmaW5lZCk7CiAgICAgIH0KICAgIH0sCgogICAgc2hvd0Nsb3VkUHJvdmlkZXIobmV1KSB7CiAgICAgIGlmICghbmV1KSB7CiAgICAgICAgLy8gTm8gY2xvdWQgcHJvdmlkZXIgYXZhaWxhYmxlPyBUaGVuIGNsZWFyIGNsb3VkIHByb3ZpZGVyIHNldHRpbmcuIFRoaXMgd2lsbCByZWNhbGN1bGF0ZSBhZGRvbk5hbWVzLi4uCiAgICAgICAgLy8gLi4uIHdoaWNoIHdpbGwgZXZlbnR1YWxseSB1cGRhdGUgYHZhbHVlLnNwZWMucmtlQ29uZmlnLmNoYXJ0VmFsdWVzYAogICAgICAgIHNldCh0aGlzLmFnZW50Q29uZmlnLCAnY2xvdWQtcHJvdmlkZXItbmFtZScsIHVuZGVmaW5lZCk7CiAgICAgIH0KICAgIH0sCiAgfSwKCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMucmVnaXN0ZXJCZWZvcmVIb29rKHRoaXMuc2F2ZU1hY2hpbmVQb29scywgJ3NhdmUtbWFjaGluZS1wb29scycsIDEpOwogICAgdGhpcy5yZWdpc3RlckJlZm9yZUhvb2sodGhpcy5zZXRSZWdpc3RyeUNvbmZpZywgJ3NldC1yZWdpc3RyeS1jb25maWcnKTsKICAgIHRoaXMucmVnaXN0ZXJBZnRlckhvb2sodGhpcy5jbGVhbnVwTWFjaGluZVBvb2xzLCAnY2xlYW51cC1tYWNoaW5lLXBvb2xzJyk7CiAgICB0aGlzLnJlZ2lzdGVyQWZ0ZXJIb29rKHRoaXMuc2F2ZVJvbGVCaW5kaW5ncywgJ3NhdmUtcm9sZS1iaW5kaW5ncycpOwoKICAgIC8vIFJlZ2lzdGVyIGFueSBob29rcyBmb3IgdGhpcyBleHRlbnNpb24gcHJvdmlkZXIKICAgIGlmICh0aGlzLmV4dGVuc2lvblByb3ZpZGVyPy5yZWdpc3RlclNhdmVIb29rcykgewogICAgICB0aGlzLmV4dGVuc2lvblByb3ZpZGVyLnJlZ2lzdGVyU2F2ZUhvb2tzKHRoaXMucmVnaXN0ZXJCZWZvcmVIb29rLCB0aGlzLnJlZ2lzdGVyQWZ0ZXJIb29rLCB0aGlzLnZhbHVlKTsKICAgIH0KICB9LAoKICBtZXRob2RzOiB7CiAgICBzZXQsCgogICAgLyoqCiAgICAgKiBJbml0aWFsaXplIGFsbCB0aGUgY2x1c3RlciBzcGVjcwogICAgICovCiAgICBhc3luYyBpbml0U3BlY3MoKSB7CiAgICAgIGlmICghdGhpcy52YWx1ZS5zcGVjKSB7CiAgICAgICAgc2V0KHRoaXMudmFsdWUsICdzcGVjJywge30pOwogICAgICB9CgogICAgICBpZiAoIXRoaXMudmFsdWUuc3BlYy5tYWNoaW5lU2VsZWN0b3JDb25maWcpIHsKICAgICAgICBzZXQodGhpcy52YWx1ZS5zcGVjLCAnbWFjaGluZVNlbGVjdG9yQ29uZmlnJywgW10pOwogICAgICB9CgogICAgICBpZiAoIXRoaXMudmFsdWUuc3BlYy5tYWNoaW5lU2VsZWN0b3JDb25maWcuZmluZCgoeCkgPT4gIXgubWFjaGluZUxhYmVsU2VsZWN0b3IpKSB7CiAgICAgICAgdGhpcy52YWx1ZS5zcGVjLm1hY2hpbmVTZWxlY3RvckNvbmZpZy51bnNoaWZ0KHsgY29uZmlnOiB7fSB9KTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMudmFsdWUuc3BlYy5jbG91ZENyZWRlbnRpYWxTZWNyZXROYW1lKSB7CiAgICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3JhbmNoZXIvZmluZEFsbCcsIHsgdHlwZTogTk9STUFOLkNMT1VEX0NSRURFTlRJQUwgfSk7CiAgICAgICAgdGhpcy5jcmVkZW50aWFsSWQgPSBgJHsgdGhpcy52YWx1ZS5zcGVjLmNsb3VkQ3JlZGVudGlhbFNlY3JldE5hbWUgfWA7CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy52YWx1ZS5zcGVjLmt1YmVybmV0ZXNWZXJzaW9uKSB7CiAgICAgICAgc2V0KHRoaXMudmFsdWUuc3BlYywgJ2t1YmVybmV0ZXNWZXJzaW9uJywgdGhpcy5kZWZhdWx0VmVyc2lvbik7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnJrZUNvbmZpZy5ldGNkPy5zMz8uYnVja2V0KSB7CiAgICAgICAgdGhpcy5zM0JhY2t1cCA9IHRydWU7CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5ya2VDb25maWcuZXRjZCkgewogICAgICAgIHNldCh0aGlzLnJrZUNvbmZpZywgJ2V0Y2QnLCB7CiAgICAgICAgICBkaXNhYmxlU25hcHNob3RzOiAgICAgZmFsc2UsCiAgICAgICAgICBzMzogICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgIHNuYXBzaG90UmV0ZW50aW9uOiAgICA1LAogICAgICAgICAgc25hcHNob3RTY2hlZHVsZUNyb246ICcwICovNSAqICogKicsCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHRoaXMucmtlQ29uZmlnLmV0Y2QuZGlzYWJsZVNuYXBzaG90cyA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBjb25zdCBkaXNhYmxlU25hcHNob3RzID0gIXRoaXMucmtlQ29uZmlnLmV0Y2Quc25hcHNob3RSZXRlbnRpb24gJiYgIXRoaXMucmtlQ29uZmlnLmV0Y2Quc25hcHNob3RTY2hlZHVsZUNyb247CgogICAgICAgIHNldCh0aGlzLnJrZUNvbmZpZy5ldGNkLCAnZGlzYWJsZVNuYXBzaG90cycsIGRpc2FibGVTbmFwc2hvdHMpOwogICAgICB9CgogICAgICAvLyBOYW1lc3BhY2VzIGlmIHJlcXVpcmVkIC0gdGhpcyBpcyBtYWlubHkgZm9yIGN1c3RvbSBwcm92aXNpb25lcnMgdmlhIGV4dGVuc2lvbnMgdGhhdCB3YW50CiAgICAgIC8vIHRvIGFsbG93IGNyZWF0aW5nIHRoZWlyIHJlc291cmNlcyBpbiBhIGRpZmZlcmVudCBuYW1lc3BhY2UKICAgICAgaWYgKHRoaXMubmVlZHNOYW1lc3BhY2UpIHsKICAgICAgICB0aGlzLmFsbE5hbWVzcGFjZXMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9maW5kQWxsJywgeyB0eXBlOiBOQU1FU1BBQ0UgfSk7CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5tYWNoaW5lUG9vbHMpIHsKICAgICAgICBhd2FpdCB0aGlzLmluaXRNYWNoaW5lUG9vbHModGhpcy52YWx1ZS5zcGVjLnJrZUNvbmZpZy5tYWNoaW5lUG9vbHMpOwogICAgICAgIGlmICh0aGlzLm1vZGUgPT09IF9DUkVBVEUgJiYgIXRoaXMubWFjaGluZVBvb2xzLmxlbmd0aCkgewogICAgICAgICAgYXdhaXQgdGhpcy5hZGRNYWNoaW5lUG9vbCgpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMudmFsdWUuc3BlYy5kZWZhdWx0UG9kU2VjdXJpdHlBZG1pc3Npb25Db25maWd1cmF0aW9uVGVtcGxhdGVOYW1lID09PSB1bmRlZmluZWQpIHsKICAgICAgICBzZXQodGhpcy52YWx1ZS5zcGVjLCAnZGVmYXVsdFBvZFNlY3VyaXR5QWRtaXNzaW9uQ29uZmlndXJhdGlvblRlbXBsYXRlTmFtZScsICcnKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEZldGNoIFJLRSB2ZXJzaW9ucyBhbmQgdGhlaXIgY29uZmlndXJhdGlvbnMgdG8gYmUgbWFwcGVkIHRvIHRoZSBmb3JtCiAgICAgKi8KICAgIGFzeW5jIGZldGNoUmtlMlZlcnNpb25zKCkgewogICAgICBpZiAoIXRoaXMucmtlMlZlcnNpb25zKSB7CiAgICAgICAgY29uc3QgaGFzaCA9IHsKICAgICAgICAgIHJrZTJWZXJzaW9uczogdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvcmVxdWVzdCcsIHsgdXJsOiAnL3YxLXJrZTItcmVsZWFzZS9yZWxlYXNlcycgfSksCiAgICAgICAgICBrM3NWZXJzaW9uczogIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtYW5hZ2VtZW50L3JlcXVlc3QnLCB7IHVybDogJy92MS1rM3MtcmVsZWFzZS9yZWxlYXNlcycgfSksCiAgICAgICAgfTsKCiAgICAgICAgaWYgKHRoaXMuJHN0b3JlLmdldHRlcnNbJ21hbmFnZW1lbnQvY2FuTGlzdCddKE1BTkFHRU1FTlQuUFNBKSkgewogICAgICAgICAgaGFzaC5hbGxQU0FzID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZEFsbCcsIHsgdHlwZTogTUFOQUdFTUVOVC5QU0EgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyBHZXQgdGhlIGxhdGVzdCB2ZXJzaW9ucyBmcm9tIHRoZSBnbG9iYWwgc2V0dGluZ3MgaWYgcG9zc2libGUKICAgICAgICBjb25zdCBnbG9iYWxTZXR0aW5ncyA9IGF3YWl0IHRoaXMuJHN0b3JlLmdldHRlcnNbJ21hbmFnZW1lbnQvYWxsJ10oTUFOQUdFTUVOVC5TRVRUSU5HKSB8fCBbXTsKICAgICAgICBjb25zdCBkZWZhdWx0UmtlMlNldHRpbmcgPSBnbG9iYWxTZXR0aW5ncy5maW5kKChzZXR0aW5nKSA9PiBzZXR0aW5nLmlkID09PSAncmtlMi1kZWZhdWx0LXZlcnNpb24nKSB8fCB7fTsKICAgICAgICBjb25zdCBkZWZhdWx0SzNzU2V0dGluZyA9IGdsb2JhbFNldHRpbmdzLmZpbmQoKHNldHRpbmcpID0+IHNldHRpbmcuaWQgPT09ICdrM3MtZGVmYXVsdC12ZXJzaW9uJykgfHwge307CgogICAgICAgIGxldCBkZWZhdWx0UmtlMiA9IGRlZmF1bHRSa2UyU2V0dGluZz8udmFsdWUgfHwgZGVmYXVsdFJrZTJTZXR0aW5nPy5kZWZhdWx0OwogICAgICAgIGxldCBkZWZhdWx0SzNzID0gZGVmYXVsdEszc1NldHRpbmc/LnZhbHVlIHx8IGRlZmF1bHRLM3NTZXR0aW5nPy5kZWZhdWx0OwoKICAgICAgICAvLyBSS0UyOiBVc2UgdGhlIGNoYW5uZWwgaWYgd2UgY2FuIG5vdCBnZXQgdGhlIHZlcnNpb24gZnJvbSB0aGUgc2V0dGluZ3MKICAgICAgICBpZiAoIWRlZmF1bHRSa2UyKSB7CiAgICAgICAgICBoYXNoLnJrZTJDaGFubmVscyA9IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtYW5hZ2VtZW50L3JlcXVlc3QnLCB7IHVybDogJy92MS1ya2UyLXJlbGVhc2UvY2hhbm5lbHMnIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gSzNTOiBVc2UgdGhlIGNoYW5uZWwgaWYgd2UgY2FuIG5vdCBnZXQgdGhlIHZlcnNpb24gZnJvbSB0aGUgc2V0dGluZ3MKICAgICAgICBpZiAoIWRlZmF1bHRLM3MpIHsKICAgICAgICAgIGhhc2guazNzQ2hhbm5lbHMgPSB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9yZXF1ZXN0JywgeyB1cmw6ICcvdjEtazNzLXJlbGVhc2UvY2hhbm5lbHMnIH0pOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgYWxsSGFzaChoYXNoKTsKCiAgICAgICAgdGhpcy5hbGxQU0FzID0gcmVzLmFsbFBTQXMgfHwgW107CiAgICAgICAgdGhpcy5ya2UyVmVyc2lvbnMgPSByZXMucmtlMlZlcnNpb25zLmRhdGEgfHwgW107CiAgICAgICAgdGhpcy5rM3NWZXJzaW9ucyA9IHJlcy5rM3NWZXJzaW9ucy5kYXRhIHx8IFtdOwoKICAgICAgICBpZiAoIWRlZmF1bHRSa2UyKSB7CiAgICAgICAgICBjb25zdCBya2UyQ2hhbm5lbHMgPSByZXMucmtlMkNoYW5uZWxzLmRhdGEgfHwgW107CgogICAgICAgICAgZGVmYXVsdFJrZTIgPSBya2UyQ2hhbm5lbHMuZmluZCgoeCkgPT4geC5pZCA9PT0gJ2RlZmF1bHQnKT8ubGF0ZXN0OwogICAgICAgIH0KCiAgICAgICAgaWYgKCFkZWZhdWx0SzNzKSB7CiAgICAgICAgICBjb25zdCBrM3NDaGFubmVscyA9IHJlcy5rM3NDaGFubmVscy5kYXRhIHx8IFtdOwoKICAgICAgICAgIGRlZmF1bHRLM3MgPSBrM3NDaGFubmVscy5maW5kKCh4KSA9PiB4LmlkID09PSAnZGVmYXVsdCcpPy5sYXRlc3Q7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXRoaXMucmtlMlZlcnNpb25zLmxlbmd0aCAmJiAhdGhpcy5rM3NWZXJzaW9ucy5sZW5ndGgpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gdmVyc2lvbiBpbmZvIGZvdW5kIGluIEtETScpOwogICAgICAgIH0KCiAgICAgICAgLy8gU3RvcmUgZGVmYXVsdCB2ZXJzaW9ucwogICAgICAgIHRoaXMuZGVmYXVsdFJrZTIgPSBkZWZhdWx0UmtlMjsKICAgICAgICB0aGlzLmRlZmF1bHRLM3MgPSBkZWZhdWx0SzNzOwogICAgICB9CiAgICB9LAoKICAgIGNsZWFuQWdlbnRDb25maWd1cmF0aW9uKG1vZGVsLCBrZXkpIHsKICAgICAgaWYgKCFtb2RlbCB8fCAhbW9kZWxba2V5XSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgdiA9IG1vZGVsW2tleV07CgogICAgICBpZiAoQXJyYXkuaXNBcnJheSh2KSAmJiB2Lmxlbmd0aCA9PT0gMCkgewogICAgICAgIGRlbGV0ZSBtb2RlbFtrZXldOwogICAgICB9IGVsc2UgaWYgKHYgJiYgdHlwZW9mIHYgPT09ICdvYmplY3QnKSB7CiAgICAgICAgT2JqZWN0LmtleXModikuZm9yRWFjaCgoaykgPT4gewogICAgICAgICAgLy8gZGVsZXRlIHRoZXNlIGF1eGlsaWFyeSBwcm9wcyB1c2VkIGluIHBvZEFmZmluaXR5IGFuZCBub2RlQWZmaW5pdHkgdGhhdCBzaG91bGRuJ3QgYmUgc2VudCB0byB0aGUgc2VydmVyCiAgICAgICAgICBpZiAoayA9PT0gJ19uYW1lc3BhY2VPcHRpb24nIHx8IGsgPT09ICdfbmFtZXNwYWNlcycgfHwgayA9PT0gJ19hbnRpJyB8fCBrID09PSAnX2lkJykgewogICAgICAgICAgICBkZWxldGUgdltrXTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBwcmV2ZW50IGNsZWFudXAgb2YgIm5hbWVzcGFjZVNlbGVjdG9yIiB3aGVuIGFuIGVtcHR5IG9iamVjdCBiZWNhdXNlIGl0IHJlcHJlc2VudHMgYWxsIG5hbWVzcGFjZXMgaW4gcG9kL25vZGUgYWZmaW5pdHkKICAgICAgICAgIC8vIGh0dHBzOi8va3ViZXJuZXRlcy5pby9kb2NzL3JlZmVyZW5jZS9nZW5lcmF0ZWQva3ViZXJuZXRlcy1hcGkvdjEuMjUvI3BvZGFmZmluaXR5dGVybS12MS1jb3JlCiAgICAgICAgICBpZiAoayAhPT0gJ25hbWVzcGFjZVNlbGVjdG9yJykgewogICAgICAgICAgICB0aGlzLmNsZWFuQWdlbnRDb25maWd1cmF0aW9uKHYsIGspOwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBpZiAoT2JqZWN0LmtleXModikubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICBkZWxldGUgbW9kZWxba2V5XTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBDbGVhbiBhZ2VudCBjb25maWd1cmF0aW9uIG9iamVjdHMsIHNvIHdlIG9ubHkgc2VuZCB2YWx1ZXMgd2hlbiB0aGUgdXNlciBoYXMgY29uZmlndXJlZCBzb21ldGhpbmcKICAgICAqLwogICAgYWdlbnRDb25maWd1cmF0aW9uQ2xlYW51cCgpIHsKICAgICAgdGhpcy5jbGVhbkFnZW50Q29uZmlndXJhdGlvbih0aGlzLnZhbHVlLnNwZWMsIENMVVNURVJfQUdFTlRfQ1VTVE9NSVpBVElPTik7CiAgICAgIHRoaXMuY2xlYW5BZ2VudENvbmZpZ3VyYXRpb24odGhpcy52YWx1ZS5zcGVjLCBGTEVFVF9BR0VOVF9DVVNUT01JWkFUSU9OKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBFbnN1cmUgd2UgaGF2ZSBlbXB0eSBtb2RlbHMgZm9yIHRoZSB0d28gYWdlbnQgY29uZmlndXJhdGlvbnMKICAgICAqLwogICAgc2V0QWdlbnRDb25maWd1cmF0aW9uKCkgewogICAgICAvLyBDbHVzdGVyIEFnZW50IENvbmZpZ3VyYXRpb24KICAgICAgaWYgKCF0aGlzLnZhbHVlLnNwZWNbQ0xVU1RFUl9BR0VOVF9DVVNUT01JWkFUSU9OXSkgewogICAgICAgIHNldCh0aGlzLnZhbHVlLnNwZWMsIENMVVNURVJfQUdFTlRfQ1VTVE9NSVpBVElPTiwge30pOwogICAgICB9CgogICAgICAvLyBGbGVldCBBZ2VudCBDb25maWd1cmF0aW9uCiAgICAgIGlmICghdGhpcy52YWx1ZS5zcGVjW0ZMRUVUX0FHRU5UX0NVU1RPTUlaQVRJT05dKSB7CiAgICAgICAgc2V0KHRoaXMudmFsdWUuc3BlYywgRkxFRVRfQUdFTlRfQ1VTVE9NSVpBVElPTiwge30pOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogc2V0IGluc3RhbmNlTmFtZUxpbWl0IHRvIDE1IHRvIGFsbCBwb29sIG1hY2hpbmUgaWYgdHJ1bmNhdGVIb3N0bmFtZXMgY2hlY2tib3ggaXMgY2xpY2tlZAogICAgICovCiAgICB0cnVuY2F0ZUhvc3RuYW1lKG5ldSkgewogICAgICBpZiAobmV1KSB7CiAgICAgICAgdGhpcy52YWx1ZS5kZWZhdWx0SG9zdG5hbWVMZW5ndGhMaW1pdCA9IE5FVEJJT1NfVFJVTkNBVElPTl9MRU5HVEg7CiAgICAgICAgdGhpcy50cnVuY2F0ZUxpbWl0ID0gTkVUQklPU19UUlVOQ0FUSU9OX0xFTkdUSDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnRydW5jYXRlTGltaXQgPSAwOwogICAgICAgIHRoaXMudmFsdWUucmVtb3ZlRGVmYXVsdEhvc3RuYW1lTGVuZ3RoTGltaXQoKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEdldCBtYWNoaW5lIHBvb2xzIGZyb20gdGhlIGNsdXN0ZXIgY29uZmlndXJhdGlvbgogICAgICogdGhpcy52YWx1ZS5zcGVjLnJrZUNvbmZpZy5tYWNoaW5lUG9vbHMKICAgICAqLwogICAgYXN5bmMgaW5pdE1hY2hpbmVQb29scyhleGlzdGluZykgewogICAgICBjb25zdCBvdXQgPSBbXTsKCiAgICAgIGlmIChleGlzdGluZz8ubGVuZ3RoKSB7CiAgICAgICAgZm9yIChjb25zdCBwb29sIG9mIGV4aXN0aW5nKSB7CiAgICAgICAgICBsZXQgdHlwZTsKCiAgICAgICAgICBpZiAodGhpcy5pc0VsZW1lbnRhbENsdXN0ZXIpIHsKICAgICAgICAgICAgdHlwZSA9IEVMRU1FTlRBTF9TQ0hFTUFfSURTLk1BQ0hJTkVfSU5WX1NFTEVDVE9SX1RFTVBMQVRFUzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHR5cGUgPSBgJHsgQ0FQSS5NQUNISU5FX0NPTkZJR19HUk9VUCB9LiR7IHBvb2wubWFjaGluZUNvbmZpZ1JlZi5raW5kLnRvTG93ZXJDYXNlKCkgfWA7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IGNvbmZpZzsKICAgICAgICAgIGxldCBjb25maWdNaXNzaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKHRoaXMuJHN0b3JlLmdldHRlcnNbJ21hbmFnZW1lbnQvY2FuTGlzdCddKHR5cGUpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgY29uZmlnID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZCcsIHsKICAgICAgICAgICAgICAgIHR5cGUsCiAgICAgICAgICAgICAgICBpZDogYCR7IHRoaXMudmFsdWUubWV0YWRhdGEubmFtZXNwYWNlIH0vJHsgcG9vbC5tYWNoaW5lQ29uZmlnUmVmLm5hbWUgfWAsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAvLyBTb21lIHVzZXJzIGNhbid0IHNlZSB0aGUgY29uZmlnLCB0aGF0J3Mgb2suCiAgICAgICAgICAgICAgLy8gd2Ugd2lsbCBkaXNwbGF5IGEgYmFubmVyIGZvciBhIDQwNCBvbmx5IGZvciBlbGVtZW50YWwKICAgICAgICAgICAgICBpZiAoZT8uc3RhdHVzID09PSA0MDQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzRWxlbWVudGFsQ2x1c3RlcikgewogICAgICAgICAgICAgICAgICBjb25maWdNaXNzaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvLyBAVE9ETyB3aGF0IGlmIHRoZSBwb29sIGlzIG1pc3Npbmc/CiAgICAgICAgICBjb25zdCBpZCA9IGBwb29sJHsgKyt0aGlzLmxhc3RJZHggfWA7CgogICAgICAgICAgb3V0LnB1c2goewogICAgICAgICAgICBpZCwKICAgICAgICAgICAgcmVtb3ZlOiBmYWxzZSwKICAgICAgICAgICAgY3JlYXRlOiBmYWxzZSwKICAgICAgICAgICAgdXBkYXRlOiB0cnVlLAogICAgICAgICAgICBwb29sOiAgIGNsb25lKHBvb2wpLAogICAgICAgICAgICBjb25maWc6IGNvbmZpZyA/IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtYW5hZ2VtZW50L2Nsb25lJywgeyByZXNvdXJjZTogY29uZmlnIH0pIDogbnVsbCwKICAgICAgICAgICAgY29uZmlnTWlzc2luZwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLm1hY2hpbmVQb29scyA9IG91dDsKICAgIH0sCgogICAgYXN5bmMgYWRkTWFjaGluZVBvb2woaWR4KSB7CiAgICAgIC8vIHRoaXMubWFjaGluZUNvbmZpZ1NjaGVtYSBpcyB0aGUgc2NoZW1hIGZvciB0aGUgTWFjaGluZSBQb29sJ3MgbWFjaGluZSBjb25maWd1cmF0aW9uIGZvciB0aGUgZ2l2ZW4gcHJvdmlkZXIKICAgICAgaWYgKCF0aGlzLm1hY2hpbmVDb25maWdTY2hlbWEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IG51bUN1cnJlbnRQb29scyA9IHRoaXMubWFjaGluZVBvb2xzLmxlbmd0aCB8fCAwOwoKICAgICAgbGV0IGNvbmZpZzsKCiAgICAgIGlmICh0aGlzLmV4dGVuc2lvblByb3ZpZGVyPy5jcmVhdGVNYWNoaW5lUG9vbE1hY2hpbmVDb25maWcpIHsKICAgICAgICBjb25maWcgPSBhd2FpdCB0aGlzLmV4dGVuc2lvblByb3ZpZGVyLmNyZWF0ZU1hY2hpbmVQb29sTWFjaGluZUNvbmZpZyhpZHgsIHRoaXMubWFjaGluZVBvb2xzLCB0aGlzLnZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEZWZhdWx0IC0gdXNlIHRoZSBzY2hlbWEKICAgICAgICBjb25maWcgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9jcmVhdGVQb3B1bGF0ZWQnLCB7CiAgICAgICAgICB0eXBlOiAgICAgdGhpcy5tYWNoaW5lQ29uZmlnU2NoZW1hLmlkLAogICAgICAgICAgbWV0YWRhdGE6IHsgbmFtZXNwYWNlOiBERUZBVUxUX1dPUktTUEFDRSB9CiAgICAgICAgfSk7CgogICAgICAgIC8vIElmIHRoZXJlIGlzIG5vIHNwZWNpZmljIG1vZGVsLCB0aGUgYXBwbHlEZWZhdWx0cyBkb2VzIG5vdGhpbmcgYnkgZGVmYXVsdAogICAgICAgIGNvbmZpZy5hcHBseURlZmF1bHRzKGlkeCwgdGhpcy5tYWNoaW5lUG9vbHMpOwogICAgICB9CgogICAgICBjb25zdCBuYW1lID0gYHBvb2wkeyArK3RoaXMubGFzdElkeCB9YDsKCiAgICAgIGNvbnN0IHBvb2wgPSB7CiAgICAgICAgaWQ6ICAgICBuYW1lLAogICAgICAgIGNvbmZpZywKICAgICAgICByZW1vdmU6IGZhbHNlLAogICAgICAgIGNyZWF0ZTogdHJ1ZSwKICAgICAgICB1cGRhdGU6IGZhbHNlLAogICAgICAgIHVpZDogICAgbmFtZSwKICAgICAgICBwb29sOiAgIHsKICAgICAgICAgIG5hbWUsCiAgICAgICAgICBldGNkUm9sZTogICAgICAgICAgICAgbnVtQ3VycmVudFBvb2xzID09PSAwLAogICAgICAgICAgY29udHJvbFBsYW5lUm9sZTogICAgIG51bUN1cnJlbnRQb29scyA9PT0gMCwKICAgICAgICAgIHdvcmtlclJvbGU6ICAgICAgICAgICB0cnVlLAogICAgICAgICAgaG9zdG5hbWVQcmVmaXg6ICAgICAgICcnLAogICAgICAgICAgbGFiZWxzOiAgICAgICAgICAgICAgIHt9LAogICAgICAgICAgcXVhbnRpdHk6ICAgICAgICAgICAgIDEsCiAgICAgICAgICB1bmhlYWx0aHlOb2RlVGltZW91dDogJzBtJywKICAgICAgICAgIG1hY2hpbmVDb25maWdSZWY6ICAgICB7CiAgICAgICAgICAgIGtpbmQ6IHRoaXMubWFjaGluZUNvbmZpZ1NjaGVtYS5hdHRyaWJ1dGVzPy5raW5kLAogICAgICAgICAgICBuYW1lOiBudWxsLAogICAgICAgICAgfSwKICAgICAgICAgIGRyYWluQmVmb3JlRGVsZXRlOiB0cnVlCiAgICAgICAgfSwKICAgICAgfTsKCiAgICAgIGlmICh0aGlzLnByb3ZpZGVyID09PSBWTVdBUkVfVlNQSEVSRSkgewogICAgICAgIHBvb2wucG9vbC5tYWNoaW5lT1MgPSAnbGludXgnOwogICAgICB9CgogICAgICBpZiAodGhpcy5pc0VsZW1lbnRhbENsdXN0ZXIpIHsKICAgICAgICBwb29sLnBvb2wubWFjaGluZUNvbmZpZ1JlZi5hcGlWZXJzaW9uID0gYCR7IHRoaXMubWFjaGluZUNvbmZpZ1NjaGVtYS5hdHRyaWJ1dGVzLmdyb3VwIH0vJHsgdGhpcy5tYWNoaW5lQ29uZmlnU2NoZW1hLmF0dHJpYnV0ZXMudmVyc2lvbiB9YDsKICAgICAgfQoKICAgICAgdGhpcy5tYWNoaW5lUG9vbHMucHVzaChwb29sKTsKCiAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICBpZiAodGhpcy4kcmVmcy5wb29scz8uc2VsZWN0KSB7CiAgICAgICAgICB0aGlzLiRyZWZzLnBvb2xzLnNlbGVjdChuYW1lKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICByZW1vdmVNYWNoaW5lUG9vbChpZHgpIHsKICAgICAgY29uc3QgZW50cnkgPSB0aGlzLm1hY2hpbmVQb29sc1tpZHhdOwoKICAgICAgaWYgKCFlbnRyeSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGVudHJ5LmNyZWF0ZSkgewogICAgICAgIC8vIElmIHRoaXMgaXMgYSBuZXcgcG9vbCB0aGF0IGlzbid0IHNhdmVkIHlldCwgaXQgY2FuIGp1c3QgYmUgZHJvcHBlZAogICAgICAgIHJlbW92ZU9iamVjdCh0aGlzLm1hY2hpbmVQb29scywgZW50cnkpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIE1hcmsgZm9yIHJlbW92YWwgb24gc2F2ZQogICAgICAgIGVudHJ5LnJlbW92ZSA9IHRydWU7CiAgICAgIH0KICAgIH0sCgogICAgYXN5bmMgc3luY01hY2hpbmVDb25maWdXaXRoTGF0ZXN0KG1hY2hpbmVQb29sKSB7CiAgICAgIGlmIChtYWNoaW5lUG9vbD8uY29uZmlnPy5pZCkgewogICAgICAgIC8vIFVzZSBtYW5hZ2VtZW50L3JlcXVlc3QgaW5zdGVhZCBvZiBtYW5hZ2VtZW50L2ZpbmQgdG8gYXZvaWQgb3ZlcndyaXRpbmcgdGhlIGN1cnJlbnQgbWFjaGluZSBwb29sIGluIHRoZSBzdG9yZQogICAgICAgIGNvbnN0IF9sYXRlc3RDb25maWcgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9yZXF1ZXN0JywgeyB1cmw6IGAvdjEvJHsgbWFjaGluZVBvb2wuY29uZmlnLnR5cGUgfXMvJHsgbWFjaGluZVBvb2wuY29uZmlnLmlkIH1gIH0pOwogICAgICAgIGNvbnN0IGxhdGVzdENvbmZpZyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtYW5hZ2VtZW50L2NyZWF0ZScsIF9sYXRlc3RDb25maWcpOwoKICAgICAgICBjb25zdCBjbG9uZWRDdXJyZW50Q29uZmlnID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvY2xvbmUnLCB7IHJlc291cmNlOiBtYWNoaW5lUG9vbC5jb25maWcgfSk7CiAgICAgICAgY29uc3QgY2xvbmVkTGF0ZXN0Q29uZmlnID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvY2xvbmUnLCB7IHJlc291cmNlOiBsYXRlc3RDb25maWcgfSk7CgogICAgICAgIC8vIFdlIGRvbid0IGFsbG93IHRoZSB1c2VyIHRvIGVkaXQgYW55IG9mIHRoZSBmaWVsZHMgaW4gbWV0YWRhdGEgZnJvbSB0aGUgVUkgc28gaXQncyBzYWZlIHRvIG92ZXJyaWRlIGl0IHdpdGggdGhlCiAgICAgICAgLy8gbWV0YWRhdGEgZGVmaW5lZCBieSB0aGUgbGF0ZXN0IGJhY2tlbmQgdmFsdWUuIFRoaXMgaXMgcHJpbWFyaWx5IHVzZWQgdG8gZW5zdXJlIHRoZSByZXNvdXJjZVZlcnNpb24gaXMgdXAgdG8gZGF0ZS4KICAgICAgICBkZWxldGUgY2xvbmVkQ3VycmVudENvbmZpZy5tZXRhZGF0YTsKCiAgICAgICAgaWYgKHRoaXMucHJvdmlkZXIgPT09IFZNV0FSRV9WU1BIRVJFKSB7CiAgICAgICAgICBtYWNoaW5lUG9vbC5jb25maWcgPSB2c3BoZXJlUG9vbENvbmZpZ01lcmdlKGNsb25lZExhdGVzdENvbmZpZywgY2xvbmVkQ3VycmVudENvbmZpZyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1hY2hpbmVQb29sLmNvbmZpZyA9IG1lcmdlKGNsb25lZExhdGVzdENvbmZpZywgY2xvbmVkQ3VycmVudENvbmZpZyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIGFzeW5jIHNhdmVNYWNoaW5lUG9vbHMoaG9va0NvbnRleHQpIHsKICAgICAgaWYgKGhvb2tDb250ZXh0ID09PSBDT05URVhUX0hPT0tfRURJVF9ZQU1MKSB7CiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2NsdXN0ZXIvcHJvbXB0TW9kYWwnLCB7CiAgICAgICAgICAgIGNvbXBvbmVudDogICAgICAnR2VuZXJpY1Byb21wdCcsCiAgICAgICAgICAgIGNvbXBvbmVudFByb3BzOiB7CiAgICAgICAgICAgICAgdGl0bGU6ICAgICB0aGlzLnQoJ2NsdXN0ZXIucmtlMi5tb2RhbC5lZGl0WWFtbE1hY2hpbmVQb29sLnRpdGxlJyksCiAgICAgICAgICAgICAgYm9keTogICAgICB0aGlzLnQoJ2NsdXN0ZXIucmtlMi5tb2RhbC5lZGl0WWFtbE1hY2hpbmVQb29sLmJvZHknKSwKICAgICAgICAgICAgICBhcHBseU1vZGU6ICdlZGl0QW5kQ29udGludWUnLAogICAgICAgICAgICAgIGNvbmZpcm06ICAgYXN5bmMoY29uZmlybWVkKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoY29uZmlybWVkKSB7CiAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMudmFsaWRhdGVNYWNoaW5lUG9vbCgpOwoKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZXJyb3JzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ01hY2hpbmUgUG9vbCB2YWxpZGF0aW9uIGVycm9ycycpKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignVXNlciBDYW5jZWxsZWQnKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGZpbmFsUG9vbHMgPSBbXTsKCiAgICAgIC8vIElmIHRoZSBleHRlbnNpb24gcHJvdmlkZXIgd2FudHMgdG8gZG8gdGhpcywgbGV0IHRoZW0KICAgICAgaWYgKHRoaXMuZXh0ZW5zaW9uUHJvdmlkZXI/LnNhdmVNYWNoaW5lUG9vbENvbmZpZ3MpIHsKICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5leHRlbnNpb25Qcm92aWRlci5zYXZlTWFjaGluZVBvb2xDb25maWdzKHRoaXMubWFjaGluZVBvb2xzLCB0aGlzLnZhbHVlKTsKICAgICAgfQoKICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiB0aGlzLm1hY2hpbmVQb29scykgewogICAgICAgIGlmIChlbnRyeS5yZW1vdmUpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgYXdhaXQgdGhpcy5zeW5jTWFjaGluZUNvbmZpZ1dpdGhMYXRlc3QoZW50cnkpOwoKICAgICAgICAvLyBDYXBpdGFscyBhbmQgc3VjaCBhcmVuJ3QgYWxsb3dlZDsKICAgICAgICBzZXQoZW50cnkucG9vbCwgJ25hbWUnLCBub3JtYWxpemVOYW1lKGVudHJ5LnBvb2wubmFtZSkgfHwgJ3Bvb2wnKTsKCiAgICAgICAgY29uc3QgcHJlZml4ID0gYCR7IHRoaXMudmFsdWUubWV0YWRhdGEubmFtZSB9LSR7IGVudHJ5LnBvb2wubmFtZSB9YC5zdWJzdHIoMCwgNTApLnRvTG93ZXJDYXNlKCk7CgogICAgICAgIGlmIChlbnRyeS5jcmVhdGUpIHsKICAgICAgICAgIGlmICghZW50cnkuY29uZmlnLm1ldGFkYXRhPy5uYW1lKSB7CiAgICAgICAgICAgIGVudHJ5LmNvbmZpZy5tZXRhZGF0YS5nZW5lcmF0ZU5hbWUgPSBgbmMtJHsgcHJlZml4IH0tYDsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBuZXUgPSBhd2FpdCBlbnRyeS5jb25maWcuc2F2ZSgpOwoKICAgICAgICAgIGVudHJ5LmNvbmZpZyA9IG5ldTsKICAgICAgICAgIGVudHJ5LnBvb2wubWFjaGluZUNvbmZpZ1JlZi5uYW1lID0gbmV1Lm1ldGFkYXRhLm5hbWU7CiAgICAgICAgICBlbnRyeS5jcmVhdGUgPSBmYWxzZTsKICAgICAgICAgIGVudHJ5LnVwZGF0ZSA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChlbnRyeS51cGRhdGUpIHsKICAgICAgICAgIGVudHJ5LmNvbmZpZyA9IGF3YWl0IGVudHJ5LmNvbmZpZy5zYXZlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBFbnN1cmUgRWxlbWVudGFsIGNsdXN0ZXJzIGhhdmUgYSBob3N0bmFtZSBwcmVmaXgKICAgICAgICBpZiAodGhpcy5pc0VsZW1lbnRhbENsdXN0ZXIgJiYgIWVudHJ5LnBvb2wuaG9zdG5hbWVQcmVmaXgpIHsKICAgICAgICAgIGVudHJ5LnBvb2wuaG9zdG5hbWVQcmVmaXggPSBgJHsgcHJlZml4IH0tYDsKICAgICAgICB9CgogICAgICAgIGZpbmFsUG9vbHMucHVzaChlbnRyeS5wb29sKTsKICAgICAgfQoKICAgICAgdGhpcy52YWx1ZS5zcGVjLnJrZUNvbmZpZy5tYWNoaW5lUG9vbHMgPSBmaW5hbFBvb2xzOwogICAgfSwKCiAgICBhc3luYyBjbGVhbnVwTWFjaGluZVBvb2xzKCkgewogICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIHRoaXMubWFjaGluZVBvb2xzKSB7CiAgICAgICAgaWYgKGVudHJ5LnJlbW92ZSAmJiBlbnRyeS5jb25maWcpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGF3YWl0IGVudHJ5LmNvbmZpZy5yZW1vdmUoKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICBhc3luYyBzYXZlUm9sZUJpbmRpbmdzKCkgewogICAgICBhd2FpdCB0aGlzLnZhbHVlLndhaXRGb3JNZ210KCk7CgogICAgICBpZiAodGhpcy5tZW1iZXJzaGlwVXBkYXRlLnNhdmUpIHsKICAgICAgICBhd2FpdCB0aGlzLm1lbWJlcnNoaXBVcGRhdGUuc2F2ZSh0aGlzLnZhbHVlLm1nbXQuaWQpOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogRW5zdXJlIHRoYXQgYWxsIHRoZSBleGlzdGluZyBub2RlIHJvbGVzIHBvb2wgYXJlIGF0IGxlYXN0IDEgZWFjaAogICAgICovCiAgICBoYXNSZXF1aXJlZE5vZGVzKCkgewogICAgICByZXR1cm4gdGhpcy5ub2RlVG90YWxzPy5jb2xvciAmJiBPYmplY3QudmFsdWVzKHRoaXMubm9kZVRvdGFscy5jb2xvcikuZXZlcnkoKGNvbG9yKSA9PiBjb2xvciAhPT0gTk9ERV9UT1RBTC5lcnJvci5jb2xvcik7CiAgICB9LAoKICAgIGNhbmNlbENyZWRlbnRpYWwoKSB7CiAgICAgIGlmICh0aGlzLiRyZWZzLmNydXJlc291cmNlKSB7CiAgICAgICAgdGhpcy4kcmVmcy5jcnVyZXNvdXJjZS5lbWl0T3JSb3V0ZSgpOwogICAgICB9CiAgICB9LAoKICAgIGRvbmUoKSB7CiAgICAgIGxldCByb3V0ZU5hbWUgPSAnYy1jbHVzdGVyLXByb2R1Y3QtcmVzb3VyY2UnOwoKICAgICAgaWYgKHRoaXMubW9kZSA9PT0gX0NSRUFURSAmJiAodGhpcy5wcm92aWRlciA9PT0gJ2ltcG9ydCcgfHwgdGhpcy5wcm92aWRlciA9PT0gJ2N1c3RvbScpKSB7CiAgICAgICAgLy8gR28gc2hvdyB0aGUgcmVnaXN0cmF0aW9uIGNvbW1hbmQKICAgICAgICByb3V0ZU5hbWUgPSAnYy1jbHVzdGVyLXByb2R1Y3QtcmVzb3VyY2UtbmFtZXNwYWNlLWlkJzsKICAgICAgfQoKICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgIG5hbWU6ICAgcm91dGVOYW1lLAogICAgICAgIHBhcmFtczogewogICAgICAgICAgY2x1c3RlcjogICB0aGlzLiRyb3V0ZS5wYXJhbXMuY2x1c3RlciwKICAgICAgICAgIHByb2R1Y3Q6ICAgdGhpcy4kc3RvcmUuZ2V0dGVyc1sncHJvZHVjdElkJ10sCiAgICAgICAgICByZXNvdXJjZTogIENBUEkuUkFOQ0hFUl9DTFVTVEVSLAogICAgICAgICAgbmFtZXNwYWNlOiB0aGlzLnZhbHVlLm1ldGFkYXRhLm5hbWVzcGFjZSwKICAgICAgICAgIGlkOiAgICAgICAgdGhpcy52YWx1ZS5tZXRhZGF0YS5uYW1lLAogICAgICAgIH0sCiAgICAgIH0pOwogICAgfSwKCiAgICBzaG93QWRkb25Db25maXJtYXRpb24oKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2NsdXN0ZXIvcHJvbXB0TW9kYWwnLCB7CiAgICAgICAgICBjb21wb25lbnQ6ICdBZGRvbkNvbmZpZ0NvbmZpcm1hdGlvbkRpYWxvZycsCiAgICAgICAgICByZXNvdXJjZXM6IFsodmFsdWUpID0+IHJlc29sdmUodmFsdWUpXQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCgogICAgLy8gU2V0IGJ1c3kgYmVmb3JlIHNhdmUgYW5kIGNsZWFyIGFmdGVyIHNhdmUKICAgIGFzeW5jIHNhdmVPdmVycmlkZShidG5DYikgewogICAgICB0aGlzLiRzZXQodGhpcywgJ2J1c3knLCB0cnVlKTsKCiAgICAgIC8vIElmIHRoZSBwcm92aWRlciBpcyBmcm9tIGFuIGV4dGVuc2lvbiwgbGV0IGl0IGRvIHRoZSBwcm92aXNpb24gc3RlcAogICAgICBpZiAodGhpcy5leHRlbnNpb25Qcm92aWRlcj8ucHJvdmlzaW9uKSB7CiAgICAgICAgY29uc3QgZXJyb3JzID0gYXdhaXQgdGhpcy5leHRlbnNpb25Qcm92aWRlcj8ucHJvdmlzaW9uKHRoaXMudmFsdWUsIHRoaXMubWFjaGluZVBvb2xzKTsKICAgICAgICBjb25zdCBva2F5ID0gKGVycm9ycyB8fCBbXSkubGVuZ3RoID09PSAwOwoKICAgICAgICB0aGlzLmVycm9ycyA9IGVycm9yczsKICAgICAgICB0aGlzLiRzZXQodGhpcywgJ2J1c3knLCBmYWxzZSk7CgogICAgICAgIGJ0bkNiKG9rYXkpOwoKICAgICAgICBpZiAob2theSkgewogICAgICAgICAgLy8gSWYgc2F2ZWQgb2theSwgZ28gdG8gdGhlIGRvbmUgcm91dGUKICAgICAgICAgIHJldHVybiB0aGlzLmRvbmUoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIERlZmF1bHQgc2F2ZQogICAgICByZXR1cm4gdGhpcy5fZG9TYXZlT3ZlcnJpZGUoKGRvbmUpID0+IHsKICAgICAgICB0aGlzLiRzZXQodGhpcywgJ2J1c3knLCBmYWxzZSk7CgogICAgICAgIHJldHVybiBidG5DYihkb25lKTsKICAgICAgfSk7CiAgICB9LAoKICAgIGFzeW5jIF9kb1NhdmVPdmVycmlkZShidG5DYikgewogICAgICAvLyBXZSBjYW5ub3QgdXNlIHRoZSBob29rLCBiZWNhdXNlIGl0IGlzIHRyaWdnZXJlZCBvbiBZQU1MIHRvZ2dsZSB3aXRob3V0IHJlc3RvcmUgaW5pdGlhbGl6ZWQgZGF0YQogICAgICB0aGlzLmFnZW50Q29uZmlndXJhdGlvbkNsZWFudXAoKTsKCiAgICAgIGNvbnN0IGlzRWRpdFZlcnNpb24gPSB0aGlzLmlzRWRpdCAmJiB0aGlzLmxpdmVWYWx1ZT8uc3BlYz8ua3ViZXJuZXRlc1ZlcnNpb24gIT09IHRoaXMudmFsdWU/LnNwZWM/Lmt1YmVybmV0ZXNWZXJzaW9uOwoKICAgICAgaWYgKGlzRWRpdFZlcnNpb24pIHsKICAgICAgICBjb25zdCBzaG91bGRDb250aW51ZSA9IGF3YWl0IHRoaXMuc2hvd0FkZG9uQ29uZmlybWF0aW9uKCk7CgogICAgICAgIGlmICghc2hvdWxkQ29udGludWUpIHsKICAgICAgICAgIHJldHVybiBidG5DYignY2FuY2VsbGVkJyk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnZhbGlkYXRlQ2x1c3Rlck5hbWUoKTsKCiAgICAgIGF3YWl0IHRoaXMudmFsaWRhdGVNYWNoaW5lUG9vbCgpOwoKICAgICAgaWYgKHRoaXMuZXJyb3JzLmxlbmd0aCkgewogICAgICAgIGJ0bkNiKGZhbHNlKTsKCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0cnkgewogICAgICAgIGNvbnN0IGNsdXN0ZXJJZCA9IGdldCh0aGlzLmNyZWRlbnRpYWwsICdkZWNvZGVkRGF0YS5jbHVzdGVySWQnKSB8fCAnJzsKCiAgICAgICAgdGhpcy5hcHBseUNoYXJ0VmFsdWVzKHRoaXMudmFsdWUuc3BlYy5ya2VDb25maWcpOwoKICAgICAgICBjb25zdCBpc1VwZ3JhZGUgPSB0aGlzLmlzRWRpdCAmJiB0aGlzLmxpdmVWYWx1ZT8uc3BlYz8ua3ViZXJuZXRlc1ZlcnNpb24gIT09IHRoaXMudmFsdWU/LnNwZWM/Lmt1YmVybmV0ZXNWZXJzaW9uOwoKICAgICAgICBpZiAodGhpcy5hZ2VudENvbmZpZz8uWydjbG91ZC1wcm92aWRlci1uYW1lJ10gPT09IEhBUlZFU1RFUiAmJiBjbHVzdGVySWQgJiYgKHRoaXMuaXNDcmVhdGUgfHwgaXNVcGdyYWRlKSkgewogICAgICAgICAgY29uc3QgbmFtZXNwYWNlID0gdGhpcy5tYWNoaW5lUG9vbHM/LlswXT8uY29uZmlnPy52bU5hbWVzcGFjZTsKCiAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9yZXF1ZXN0JywgewogICAgICAgICAgICB1cmw6ICAgIGAvazhzL2NsdXN0ZXJzLyR7IGNsdXN0ZXJJZCB9L3YxL2hhcnZlc3Rlci9rdWJlY29uZmlnYCwKICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgIGRhdGE6ICAgewogICAgICAgICAgICAgIGNzaUNsdXN0ZXJSb2xlTmFtZTogJ2hhcnZlc3RlcmhjaS5pbzpjc2ktZHJpdmVyJywKICAgICAgICAgICAgICBjbHVzdGVyUm9sZU5hbWU6ICAgICdoYXJ2ZXN0ZXJoY2kuaW86Y2xvdWRwcm92aWRlcicsCiAgICAgICAgICAgICAgbmFtZXNwYWNlLAogICAgICAgICAgICAgIHNlcnZpY2VBY2NvdW50TmFtZTogdGhpcy52YWx1ZS5tZXRhZGF0YS5uYW1lLAogICAgICAgICAgICB9LAogICAgICAgICAgfSk7CgogICAgICAgICAgY29uc3Qga3ViZWNvbmZpZyA9IHJlcy5kYXRhOwoKICAgICAgICAgIGNvbnN0IGhhcnZlc3Rlckt1YmVjb25maWdTZWNyZXQgPSBhd2FpdCB0aGlzLmNyZWF0ZUt1YmVjb25maWdTZWNyZXQoa3ViZWNvbmZpZyk7CgogICAgICAgICAgc2V0KHRoaXMuYWdlbnRDb25maWcsICdjbG91ZC1wcm92aWRlci1jb25maWcnLCBgc2VjcmV0Oi8vZmxlZXQtZGVmYXVsdDokeyBoYXJ2ZXN0ZXJLdWJlY29uZmlnU2VjcmV0Py5tZXRhZGF0YT8ubmFtZSB9YCk7CgogICAgICAgICAgaWYgKHRoaXMuaXNDcmVhdGUpIHsKICAgICAgICAgICAgc2V0KHRoaXMuY2hhcnRWYWx1ZXMsIGAkeyBIQVJWRVNURVJfQ0xPVURfUFJPVklERVIgfS5nbG9iYWwuY2F0dGxlLmNsdXN0ZXJOYW1lYCwgdGhpcy52YWx1ZS5tZXRhZGF0YS5uYW1lKTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBkaXN0cm9Sb290ID0gdGhpcy52YWx1ZT8uc3BlYz8ucmtlQ29uZmlnPy5kYXRhRGlyZWN0b3JpZXM/Lms4c0Rpc3Rybz8ubGVuZ3RoID8gdGhpcy52YWx1ZT8uc3BlYz8ucmtlQ29uZmlnPy5kYXRhRGlyZWN0b3JpZXM/Lms4c0Rpc3RybyA6ICcvdmFyL2xpYi9yYW5jaGVyL3JrZTInOwoKICAgICAgICAgIHNldCh0aGlzLmNoYXJ0VmFsdWVzLCBgJHsgSEFSVkVTVEVSX0NMT1VEX1BST1ZJREVSIH0uY2xvdWRDb25maWdQYXRoYCwgYCR7IGRpc3Ryb1Jvb3QgfS9ldGMvY29uZmlnLWZpbGVzL2Nsb3VkLXByb3ZpZGVyLWNvbmZpZ2ApOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgdGhpcy5lcnJvcnMucHVzaChlcnIpOwoKICAgICAgICBidG5DYihmYWxzZSk7CgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8gUmVtb3ZlIG51bGwgcHJvZmlsZSBvbiBtYWNoaW5lR2xvYmFsQ29uZmlnIC0gaHR0cHM6Ly9naXRodWIuY29tL3JhbmNoZXIvZGFzaGJvYXJkL2lzc3Vlcy84NDgwCiAgICAgIGlmICh0aGlzLnZhbHVlLnNwZWM/LnJrZUNvbmZpZz8ubWFjaGluZUdsb2JhbENvbmZpZz8ucHJvZmlsZSA9PT0gbnVsbCkgewogICAgICAgIGRlbGV0ZSB0aGlzLnZhbHVlLnNwZWMucmtlQ29uZmlnLm1hY2hpbmVHbG9iYWxDb25maWcucHJvZmlsZTsKICAgICAgfQoKICAgICAgLy8gU3RvcmUgdGhlIGN1cnJlbnQgZGF0YSBmb3IgZmxlZXQgYW5kIGNsdXN0ZXIgYWdlbnQgc28gdGhhdCB3ZSBjYW4gcmUtYXBwbHkgaXQgbGF0ZXIgaWYgdGhlIHNhdmUgZmFpbHMKICAgICAgLy8gVGhlIGNsZWFudXAgb2NjdXJzIGJlZm9yZSBzYXZlIHdpdGggYWdlbnRDb25maWd1cmF0aW9uQ2xlYW51cCgpCiAgICAgIGNvbnN0IGNsdXN0ZXJBZ2VudERlcGxveW1lbnRDdXN0b21pemF0aW9uID0gdGhpcy52YWx1ZS5zcGVjW0NMVVNURVJfQUdFTlRfQ1VTVE9NSVpBVElPTl0gPyBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMudmFsdWUuc3BlY1tDTFVTVEVSX0FHRU5UX0NVU1RPTUlaQVRJT05dKSkgOiBudWxsOwogICAgICBjb25zdCBmbGVldEFnZW50RGVwbG95bWVudEN1c3RvbWl6YXRpb24gPSB0aGlzLnZhbHVlLnNwZWNbRkxFRVRfQUdFTlRfQ1VTVE9NSVpBVElPTl0gPyBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMudmFsdWUuc3BlY1tGTEVFVF9BR0VOVF9DVVNUT01JWkFUSU9OXSkpIDogbnVsbDsKCiAgICAgIGF3YWl0IHRoaXMuc2F2ZShidG5DYik7CgogICAgICAvLyBjb21lcyBmcm9tIGNyZWF0ZUVkaXRWaWV3IG1peGluCiAgICAgIC8vIGlmIHRoZXJlIGFyZSBhbnkgZXJyb3JzIHNhdmluZywgcmVzdG9yZSB0aGUgYWdlbnQgY29uZmlnIGRhdGEKICAgICAgaWYgKHRoaXMuZXJyb3JzPy5sZW5ndGgpIHsKICAgICAgICAvLyBFbnN1cmUgdGhlIGFnZW50IGNvbmZpZ3VyYXRpb24gaXMgc2V0IGJhY2sgdG8gdGhlIHZhbHVlcyBiZWZvcmUgd2UgY2hhbmdlZCAoY2xlYW5lZCkgaXQKICAgICAgICBzZXQodGhpcy52YWx1ZS5zcGVjLCBDTFVTVEVSX0FHRU5UX0NVU1RPTUlaQVRJT04sIGNsdXN0ZXJBZ2VudERlcGxveW1lbnRDdXN0b21pemF0aW9uKTsKICAgICAgICBzZXQodGhpcy52YWx1ZS5zcGVjLCBGTEVFVF9BR0VOVF9DVVNUT01JWkFUSU9OLCBmbGVldEFnZW50RGVwbG95bWVudEN1c3RvbWl6YXRpb24pOwogICAgICB9CiAgICB9LAoKICAgIGFzeW5jIGFjdHVhbGx5U2F2ZSh1cmwpIHsKICAgICAgaWYgKHRoaXMuZXh0ZW5zaW9uUHJvdmlkZXI/LnNhdmVDbHVzdGVyKSB7CiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZXh0ZW5zaW9uUHJvdmlkZXI/LnNhdmVDbHVzdGVyKHRoaXMudmFsdWUsIHRoaXMuc2NoZW1hKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuaXNDcmVhdGUpIHsKICAgICAgICB1cmwgPSB1cmwgfHwgdGhpcy5zY2hlbWEubGlua0ZvcignY29sbGVjdGlvbicpOwogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMudmFsdWUuc2F2ZSh7IHVybCB9KTsKCiAgICAgICAgaWYgKHJlcykgewogICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLnZhbHVlLCByZXMpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBhd2FpdCB0aGlzLnZhbHVlLnNhdmUoKTsKICAgICAgfQogICAgfSwKCiAgICAvLyBjcmVhdGUgYSBzZWNyZXQgdG8gcmVmZXJlbmNlIHRoZSBoYXJ2ZXN0ZXIgY2x1c3RlciBrdWJlY29uZmlnIGluIHJrZUNvbmZpZwogICAgYXN5bmMgY3JlYXRlS3ViZWNvbmZpZ1NlY3JldChrdWJlY29uZmlnID0gJycpIHsKICAgICAgY29uc3QgY2x1c3Rlck5hbWUgPSB0aGlzLnZhbHVlLm1ldGFkYXRhLm5hbWU7CiAgICAgIGNvbnN0IHNlY3JldCA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtYW5hZ2VtZW50L2NyZWF0ZScsIHsKICAgICAgICB0eXBlOiAgICAgU0VDUkVULAogICAgICAgIG1ldGFkYXRhOiB7CiAgICAgICAgICBuYW1lc3BhY2U6ICdmbGVldC1kZWZhdWx0JywgZ2VuZXJhdGVOYW1lOiAnaGFydmVzdGVyY29uZmlnJywgYW5ub3RhdGlvbnM6IHsgW0NBUElfQU5OT1RBVElPTlMuU0VDUkVUX0FVVEhdOiBjbHVzdGVyTmFtZSwgW0NBUElfQU5OT1RBVElPTlMuU0VDUkVUX1dJTExfREVMRVRFXTogJ3RydWUnIH0KICAgICAgICB9LAogICAgICAgIGRhdGE6IHsgY3JlZGVudGlhbDogYmFzZTY0RW5jb2RlKGt1YmVjb25maWcpIH0KICAgICAgfSk7CgogICAgICByZXR1cm4gc2VjcmV0LnNhdmUoeyB1cmw6ICcvdjEvc2VjcmV0cycsIG1ldGhvZDogJ1BPU1QnIH0pOwogICAgfSwKCiAgICBjYW5jZWwoKSB7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICBuYW1lOiAgICdjLWNsdXN0ZXItcHJvZHVjdC1yZXNvdXJjZScsCiAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICBjbHVzdGVyOiAgdGhpcy4kcm91dGUucGFyYW1zLmNsdXN0ZXIsCiAgICAgICAgICBwcm9kdWN0OiAgdGhpcy4kc3RvcmUuZ2V0dGVyc1sncHJvZHVjdElkJ10sCiAgICAgICAgICByZXNvdXJjZTogQ0FQSS5SQU5DSEVSX0NMVVNURVIsCiAgICAgICAgfSwKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKgogICAgICogRW5zdXJlIGFsbCBjaGFydCBpbmZvcm1hdGlvbiByZXF1aXJlZCB0byBzaG93IGFkZG9ucyBpcyBhdmFpbGFibGUKICAgICAqCiAgICAgKiBUaGlzIGJhc2ljYWxseSBtZWFucwogICAgICogMSkgVGhhdCB0aGUgZnVsbCBjaGFydCByZWxhdGluZyB0byB0aGUgYWRkb24gaXMgZmV0Y2hlZCAod2hpY2ggaW5jbHVkZXMgY29yZSBjaGFydCwgcmVhZG1lIGFuZCB2YWx1ZXMpCiAgICAgKiAyKSBXZSdyZSByZWFkeSB0byBjYWNoZSBhbnkgdmFsdWVzIHRoZSB1c2VyIHByb3ZpZGVzIGZvciBlYWNoIGFkZG9uCiAgICAgKi8KICAgIGFzeW5jIGluaXRBZGRvbnMoKSB7CiAgICAgIGZvciAoY29uc3QgY2hhcnROYW1lIG9mIHRoaXMuYWRkb25OYW1lcykgewogICAgICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5jaGFydFZlcnNpb25zW2NoYXJ0TmFtZV07CgogICAgICAgIC8vIHByZXZlbnQgZmV0Y2hpbmcgb2YgYWRkb24gY29uZmlnIGZvciAnbm9uZScgQ05JIG9wdGlvbgogICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9yYW5jaGVyL2Rhc2hib2FyZC9pc3N1ZXMvMTAzMzgKICAgICAgICBpZiAodGhpcy52ZXJzaW9uSW5mb1tjaGFydE5hbWVdIHx8IGNoYXJ0TmFtZS5pbmNsdWRlcygnbm9uZScpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnY2F0YWxvZy9nZXRWZXJzaW9uSW5mbycsIHsKICAgICAgICAgICAgcmVwb1R5cGU6ICAgICdjbHVzdGVyJywKICAgICAgICAgICAgcmVwb05hbWU6ICAgIGVudHJ5LnJlcG8sCiAgICAgICAgICAgIGNoYXJ0TmFtZSwKICAgICAgICAgICAgdmVyc2lvbk5hbWU6IGVudHJ5LnZlcnNpb24sCiAgICAgICAgICB9KTsKCiAgICAgICAgICBzZXQodGhpcy52ZXJzaW9uSW5mbywgY2hhcnROYW1lLCByZXMpOwogICAgICAgICAgY29uc3Qga2V5ID0gdGhpcy5jaGFydFZlcnNpb25LZXkoY2hhcnROYW1lKTsKCiAgICAgICAgICBpZiAoIXRoaXMudXNlckNoYXJ0VmFsdWVzW2tleV0pIHsKICAgICAgICAgICAgdGhpcy51c2VyQ2hhcnRWYWx1ZXNba2V5XSA9IHt9OwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBmZXRjaCBvciBwcm9jZXNzIGNoYXJ0IGluZm8gZm9yICR7IGNoYXJ0TmFtZSB9YCk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZQogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICBzaG93QWRkb25zKGtleSkgewogICAgICB0aGlzLmFkZG9uc1JldisrOwogICAgICB0aGlzLmFkZG9uTmFtZXMuZm9yRWFjaCgobmFtZSkgPT4gewogICAgICAgIGNvbnN0IGNoYXJ0VmFsdWVzID0gdGhpcy52ZXJzaW9uSW5mb1tuYW1lXT8ucXVlc3Rpb25zID8gdGhpcy5pbml0WWFtbEVkaXRvcihuYW1lKSA6IHt9OwoKICAgICAgICBzZXQodGhpcy51c2VyQ2hhcnRWYWx1ZXNUZW1wLCBuYW1lLCBjaGFydFZhbHVlcyk7CiAgICAgIH0pOwogICAgICB0aGlzLnJlZnJlc2hDb21wb25lbnRXaXRoWWFtbHMoa2V5KTsKICAgIH0sCiAgICByZWZyZXNoQ29tcG9uZW50V2l0aFlhbWxzKGtleSkgewogICAgICBjb25zdCBjb21wb25lbnQgPSB0aGlzLiRyZWZzW2tleV07CgogICAgICBpZiAoY29tcG9uZW50KSB7CiAgICAgICAgdGhpcy5yZWZyZXNoWWFtbHMoY29tcG9uZW50LiRyZWZzKTsKICAgICAgfQogICAgfSwKCiAgICByZWZyZXNoWWFtbHMocmVmcykgewogICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMocmVmcykuZmlsdGVyKCh4KSA9PiB4LnN0YXJ0c1dpdGgoJ3lhbWwnKSk7CgogICAgICBmb3IgKGNvbnN0IGsgb2Yga2V5cykgewogICAgICAgIGNvbnN0IGVudHJ5ID0gcmVmc1trXTsKICAgICAgICBjb25zdCBsaXN0ID0gaXNBcnJheShlbnRyeSkgPyBlbnRyeSA6IFtlbnRyeV07CgogICAgICAgIGZvciAoY29uc3QgY29tcG9uZW50IG9mIGxpc3QpIHsKICAgICAgICAgIGNvbXBvbmVudD8ucmVmcmVzaCgpOyAvLyBgeWFtbGAgcmVmIGNhbiBiZSB1bmRlZmluZWQgb24gc3dpdGNoaW5nIGZyb20gQmFzaWMgdG8gQWRkb24gdGFiIChBenVyZSAtLT4gQW1hem9uIC0tPiBhZGRvbikKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgdXBkYXRlVmFsdWVzKG5hbWUsIHZhbHVlcykgewogICAgICBzZXQodGhpcy51c2VyQ2hhcnRWYWx1ZXNUZW1wLCBuYW1lLCB2YWx1ZXMpOwogICAgICB0aGlzLnN5bmNDaGFydFZhbHVlcyhuYW1lKTsKICAgIH0sCgogICAgc3luY0NoYXJ0VmFsdWVzOiB0aHJvdHRsZShmdW5jdGlvbihuYW1lKSB7CiAgICAgIGNvbnN0IGZyb21DaGFydCA9IHRoaXMudmVyc2lvbkluZm9bbmFtZV0/LnZhbHVlczsKICAgICAgY29uc3QgZnJvbVVzZXIgPSB0aGlzLnVzZXJDaGFydFZhbHVlc1RlbXBbbmFtZV07CiAgICAgIGNvbnN0IGRpZmZlcmVudCA9IGRpZmYoZnJvbUNoYXJ0LCBmcm9tVXNlcik7CgogICAgICB0aGlzLnVzZXJDaGFydFZhbHVlc1t0aGlzLmNoYXJ0VmVyc2lvbktleShuYW1lKV0gPSBkaWZmZXJlbnQ7CiAgICB9LCAyNTAsIHsgbGVhZGluZzogdHJ1ZSB9KSwKCiAgICBpbml0WWFtbEVkaXRvcihuYW1lKSB7CiAgICAgIGNvbnN0IGRlZmF1bHRDaGFydFZhbHVlID0gdGhpcy52ZXJzaW9uSW5mb1tuYW1lXTsKICAgICAgY29uc3Qga2V5ID0gdGhpcy5jaGFydFZlcnNpb25LZXkobmFtZSk7CgogICAgICByZXR1cm4gbWVyZ2Uoe30sIGRlZmF1bHRDaGFydFZhbHVlPy52YWx1ZXMgfHwge30sIHRoaXMudXNlckNoYXJ0VmFsdWVzW2tleV0gfHwge30pOwogICAgfSwKCiAgICBpbml0U2VydmVyQWdlbnRBcmdzKCkgewogICAgICBmb3IgKGNvbnN0IGsgaW4gdGhpcy5zZXJ2ZXJBcmdzKSB7CiAgICAgICAgaWYgKHRoaXMuc2VydmVyQ29uZmlnW2tdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGNvbnN0IGRlZiA9IHRoaXMuc2VydmVyQXJnc1trXS5kZWZhdWx0OwoKICAgICAgICAgIHNldCh0aGlzLnNlcnZlckNvbmZpZywgaywgKGRlZiAhPT0gdW5kZWZpbmVkID8gZGVmIDogdW5kZWZpbmVkKSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGNvbnN0IGsgaW4gdGhpcy5hZ2VudEFyZ3MpIHsKICAgICAgICBpZiAodGhpcy5hZ2VudENvbmZpZz8uW2tdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGNvbnN0IGRlZiA9IHRoaXMuYWdlbnRBcmdzW2tdLmRlZmF1bHQ7CgogICAgICAgICAgc2V0KHRoaXMuYWdlbnRDb25maWcsIGssIChkZWYgIT09IHVuZGVmaW5lZCA/IGRlZiA6IHVuZGVmaW5lZCkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCF0aGlzLnNlcnZlckNvbmZpZz8ucHJvZmlsZSkgewogICAgICAgIHNldCh0aGlzLnNlcnZlckNvbmZpZywgJ3Byb2ZpbGUnLCBudWxsKTsKICAgICAgfQogICAgfSwKCiAgICBjaGFydFZlcnNpb25LZXkobmFtZSkgewogICAgICBjb25zdCBhZGRvblZlcnNpb24gPSB0aGlzLmFkZG9uVmVyc2lvbnMuZmluZCgoYXYpID0+IGF2Lm5hbWUgPT09IG5hbWUpOwoKICAgICAgcmV0dXJuIGFkZG9uVmVyc2lvbiA/IGAkeyBuYW1lIH0tJHsgYWRkb25WZXJzaW9uLnZlcnNpb24gfWAgOiBuYW1lOwogICAgfSwKCiAgICBvbk1lbWJlcnNoaXBVcGRhdGUodXBkYXRlKSB7CiAgICAgIHRoaXMuJHNldCh0aGlzLCAnbWVtYmVyc2hpcFVwZGF0ZScsIHVwZGF0ZSk7CiAgICB9LAoKICAgIGFzeW5jIGluaXRSZWdpc3RyeSgpIHsKICAgICAgLy8gQ2hlY2sgZm9yIGFuIGV4aXN0aW5nIGNsdXN0ZXIgc2NvcGVkIHJlZ2lzdHJ5CiAgICAgIGNvbnN0IGNsdXN0ZXJSZWdpc3RyeSA9IHRoaXMuYWdlbnRDb25maWc/Llsnc3lzdGVtLWRlZmF1bHQtcmVnaXN0cnknXSB8fCAnJzsKCiAgICAgIC8vIENoZWNrIGZvciB0aGUgZ2xvYmFsIHJlZ2lzdHJ5CiAgICAgIHRoaXMuc3lzdGVtUmVnaXN0cnkgPSAoYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZCcsIHsgdHlwZTogTUFOQUdFTUVOVC5TRVRUSU5HLCBpZDogU0VUVElORy5TWVNURU1fREVGQVVMVF9SRUdJU1RSWSB9KSkudmFsdWUgfHwgJyc7CgogICAgICAvLyBUaGUgb3JkZXIgb2YgcHJlY2VkZW5jZSBpcyB0byB1c2UgdGhlIGNsdXN0ZXIgc2NvcGVkIHJlZ2lzdHJ5CiAgICAgIC8vIGlmIGl0IGV4aXN0cywgdGhlbiB1c2UgdGhlIGdsb2JhbCBzY29wZWQgcmVnaXN0cnkgYXMgYSBmYWxsYmFjawogICAgICBpZiAoY2x1c3RlclJlZ2lzdHJ5KSB7CiAgICAgICAgdGhpcy5yZWdpc3RyeUhvc3QgPSBjbHVzdGVyUmVnaXN0cnk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5yZWdpc3RyeUhvc3QgPSB0aGlzLnN5c3RlbVJlZ2lzdHJ5OwogICAgICB9CgogICAgICBsZXQgcmVnaXN0cnlTZWNyZXQgPSBudWxsOwogICAgICBsZXQgcmVncyA9IHRoaXMucmtlQ29uZmlnLnJlZ2lzdHJpZXM7CgogICAgICBpZiAoIXJlZ3MpIHsKICAgICAgICByZWdzID0ge307CiAgICAgICAgc2V0KHRoaXMucmtlQ29uZmlnLCAncmVnaXN0cmllcycsIHJlZ3MpOwogICAgICB9CgogICAgICBpZiAoIXJlZ3MuY29uZmlncykgewogICAgICAgIHNldChyZWdzLCAnY29uZmlncycsIHt9KTsKICAgICAgfQoKICAgICAgaWYgKCFyZWdzLm1pcnJvcnMpIHsKICAgICAgICBzZXQocmVncywgJ21pcnJvcnMnLCB7fSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGNvbmZpZyA9IHJlZ3MuY29uZmlnc1t0aGlzLnJlZ2lzdHJ5SG9zdF07CgogICAgICBpZiAoY29uZmlnKSB7CiAgICAgICAgcmVnaXN0cnlTZWNyZXQgPSBjb25maWcuYXV0aENvbmZpZ1NlY3JldE5hbWU7CiAgICAgIH0KCiAgICAgIHRoaXMucmVnaXN0cnlTZWNyZXQgPSByZWdpc3RyeVNlY3JldDsKCiAgICAgIGNvbnN0IGhhc01pcnJvcnNPckF1dGhDb25maWcgPSBPYmplY3Qua2V5cyhyZWdzLmNvbmZpZ3MpLmxlbmd0aCA+IDAgfHwgT2JqZWN0LmtleXMocmVncy5taXJyb3JzKS5sZW5ndGggPiAwOwoKICAgICAgaWYgKHRoaXMucmVnaXN0cnlIb3N0IHx8IHJlZ2lzdHJ5U2VjcmV0IHx8IGhhc01pcnJvcnNPckF1dGhDb25maWcpIHsKICAgICAgICB0aGlzLnNob3dDdXN0b21SZWdpc3RyeUlucHV0ID0gdHJ1ZTsKCiAgICAgICAgaWYgKGhhc01pcnJvcnNPckF1dGhDb25maWcpIHsKICAgICAgICAgIHRoaXMuc2hvd0N1c3RvbVJlZ2lzdHJ5QWR2YW5jZWRJbnB1dCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIHNldFJlZ2lzdHJ5Q29uZmlnKCkgewogICAgICBjb25zdCBob3N0bmFtZSA9ICh0aGlzLnJlZ2lzdHJ5SG9zdCB8fCAnJykudHJpbSgpOwoKICAgICAgaWYgKHRoaXMuc3lzdGVtUmVnaXN0cnkpIHsKICAgICAgICAvLyBFbXB0eSBzdHJpbmcgb3ZlcnJpZGVzIHRoZSBzeXN0ZW0gZGVmYXVsdCB0byBub3RoaW5nCiAgICAgICAgc2V0KHRoaXMuYWdlbnRDb25maWcsICdzeXN0ZW0tZGVmYXVsdC1yZWdpc3RyeScsICcnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBObyBuZWVkIHRvIHNldCBhbnl0aGluZwogICAgICAgIHNldCh0aGlzLmFnZW50Q29uZmlnLCAnc3lzdGVtLWRlZmF1bHQtcmVnaXN0cnknLCB1bmRlZmluZWQpOwogICAgICB9CiAgICAgIGlmICghaG9zdG5hbWUgfHwgaG9zdG5hbWUgPT09IHRoaXMuc3lzdGVtUmVnaXN0cnkpIHsKICAgICAgICAvLyBVbmRlZmluZWQgcmVtb3ZlcyB0aGUga2V5IHdoaWNoIHVzZXMgdGhlIGdsb2JhbCBzZXR0aW5nIHdpdGhvdXQgaGFyZGNvZGluZyBpdCBpbnRvIHRoZSBjb25maWcKICAgICAgICBzZXQodGhpcy5hZ2VudENvbmZpZywgJ3N5c3RlbS1kZWZhdWx0LXJlZ2lzdHJ5JywgdW5kZWZpbmVkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZXQodGhpcy5hZ2VudENvbmZpZywgJ3N5c3RlbS1kZWZhdWx0LXJlZ2lzdHJ5JywgaG9zdG5hbWUpOwogICAgICB9CgogICAgICBpZiAoaG9zdG5hbWUgJiYgdGhpcy5yZWdpc3RyeVNlY3JldCkgewogICAgICAgIC8vIEZvciBhIHJlZ2lzdHJ5IHdpdGggYmFzaWMgYXV0aCwgYnV0IG5vIG1pcnJvcnMsCiAgICAgICAgLy8gYWRkIGEgc2luZ2xlIHJlZ2lzdHJ5IGNvbmZpZyB3aXRoIHRoZSBiYXNpYyBhdXRoIHNlY3JldC4KICAgICAgICBjb25zdCBiYXNpY0F1dGhDb25maWcgPSB7CiAgICAgICAgICBbaG9zdG5hbWVdOiB7CiAgICAgICAgICAgIGF1dGhDb25maWdTZWNyZXROYW1lOiB0aGlzLnJlZ2lzdHJ5U2VjcmV0LAogICAgICAgICAgICBjYUJ1bmRsZTogICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgaW5zZWN1cmVTa2lwVmVyaWZ5OiAgIGZhbHNlLAogICAgICAgICAgICB0bHNTZWNyZXROYW1lOiAgICAgICAgbnVsbCwKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBjb25zdCBya2VDb25maWcgPSB0aGlzLnZhbHVlLnNwZWMucmtlQ29uZmlnOwoKICAgICAgICBpZiAoIXJrZUNvbmZpZykgewogICAgICAgICAgdGhpcy52YWx1ZS5zcGVjLnJrZUNvbmZpZyA9IHsgcmVnaXN0cmllczogeyBjb25maWdzOiBiYXNpY0F1dGhDb25maWcgfSB9OwogICAgICAgIH0gZWxzZSBpZiAocmtlQ29uZmlnLnJlZ2lzdHJpZXMuY29uZmlncyAmJiBPYmplY3Qua2V5cyhya2VDb25maWcucmVnaXN0cmllcy5jb25maWdzKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAvLyBJZiBzb21lIGV4aXN0aW5nIGF1dGhlbnRpY2F0aW9uIHNlY3JldHMgYXJlIGFscmVhZHkgY29uZmlndXJlZAogICAgICAgICAgLy8gZm9yIHJlZ2lzdHJ5IG1pcnJvcnMsIHRoZSBiYXNpYyBhdXRoIGlzIGFkZGVkIHRvIHRoZSBleGlzdGluZyBvbmVzLgogICAgICAgICAgY29uc3QgZXhpc3RpbmdDb25maWdzID0gcmtlQ29uZmlnLnJlZ2lzdHJpZXMuY29uZmlnczsKCiAgICAgICAgICB0aGlzLnZhbHVlLnNwZWMucmtlQ29uZmlnLnJlZ2lzdHJpZXMuY29uZmlncyA9IHsgLi4uYmFzaWNBdXRoQ29uZmlnLCAuLi5leGlzdGluZ0NvbmZpZ3MgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3QgZXhpc3RpbmdNaXJyb3JBbmRBdXRoQ29uZmlnID0gdGhpcy52YWx1ZS5zcGVjLnJrZUNvbmZpZy5yZWdpc3RyaWVzOwoKICAgICAgICAgIHRoaXMudmFsdWUuc3BlYy5ya2VDb25maWcucmVnaXN0cmllcyA9IHsKICAgICAgICAgICAgLi4uZXhpc3RpbmdNaXJyb3JBbmRBdXRoQ29uZmlnLAogICAgICAgICAgICBjb25maWdzOiBiYXNpY0F1dGhDb25maWcKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIHVwZGF0ZUNvbmZpZ3MoY29uZmlncykgewogICAgICAvLyBVcGRhdGUgYXV0aGVudGljYXRpb24gY29uZmlndXJhdGlvbgogICAgICAvLyBmb3IgZWFjaCBtaXJyb3IKICAgICAgaWYgKCF0aGlzLnZhbHVlLnNwZWM/LnJrZUNvbmZpZykgewogICAgICAgIHRoaXMudmFsdWUuc3BlYy5ya2VDb25maWcgPSB7IHJlZ2lzdHJpZXM6IHt9IH07CiAgICAgIH0KICAgICAgc2V0KHRoaXMudmFsdWUuc3BlYy5ya2VDb25maWcucmVnaXN0cmllcywgJ2NvbmZpZ3MnLCBjb25maWdzKTsKICAgIH0sCgogICAgZ2V0QWxsT3B0aW9uc0FmdGVyQ3VycmVudFZlcnNpb24odmVyc2lvbnMsIGN1cnJlbnRWZXJzaW9uLCBkZWZhdWx0VmVyc2lvbikgewogICAgICBjb25zdCBvdXQgPSAodmVyc2lvbnMgfHwgW10pLmZpbHRlcigob2JqKSA9PiAhIW9iai5zZXJ2ZXJBcmdzKS5tYXAoKG9iaikgPT4gewogICAgICAgIGxldCBkaXNhYmxlZCA9IGZhbHNlOwogICAgICAgIGxldCBleHBlcmltZW50YWwgPSBmYWxzZTsKICAgICAgICBsZXQgaXNDdXJyZW50VmVyc2lvbiA9IGZhbHNlOwogICAgICAgIGxldCBsYWJlbCA9IG9iai5pZDsKCiAgICAgICAgaWYgKGN1cnJlbnRWZXJzaW9uKSB7CiAgICAgICAgICBkaXNhYmxlZCA9IGNvbXBhcmUob2JqLmlkLCBjdXJyZW50VmVyc2lvbikgPCAwOwogICAgICAgICAgaXNDdXJyZW50VmVyc2lvbiA9IGNvbXBhcmUob2JqLmlkLCBjdXJyZW50VmVyc2lvbikgPT09IDA7CiAgICAgICAgfQoKICAgICAgICBpZiAoZGVmYXVsdFZlcnNpb24pIHsKICAgICAgICAgIGV4cGVyaW1lbnRhbCA9IGNvbXBhcmUoZGVmYXVsdFZlcnNpb24sIG9iai5pZCkgPCAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzQ3VycmVudFZlcnNpb24pIHsKICAgICAgICAgIGxhYmVsID0gYCR7IGxhYmVsIH0gJHsgdGhpcy50KCdjbHVzdGVyLmt1YmVybmV0ZXNWZXJzaW9uLmN1cnJlbnQnKSB9YDsKICAgICAgICB9CgogICAgICAgIGlmIChleHBlcmltZW50YWwpIHsKICAgICAgICAgIGxhYmVsID0gYCR7IGxhYmVsIH0gJHsgdGhpcy50KCdjbHVzdGVyLmt1YmVybmV0ZXNWZXJzaW9uLmV4cGVyaW1lbnRhbCcpIH1gOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGxhYmVsLAogICAgICAgICAgdmFsdWU6ICAgICAgb2JqLmlkLAogICAgICAgICAgc29ydDogICAgICAgc29ydGFibGUob2JqLmlkKSwKICAgICAgICAgIHNlcnZlckFyZ3M6IG9iai5zZXJ2ZXJBcmdzLAogICAgICAgICAgYWdlbnRBcmdzOiAgb2JqLmFnZW50QXJncywKICAgICAgICAgIGNoYXJ0czogICAgIG9iai5jaGFydHMsCiAgICAgICAgICBkaXNhYmxlZCwKICAgICAgICB9OwogICAgICB9KTsKCiAgICAgIGlmIChjdXJyZW50VmVyc2lvbiAmJiAhb3V0LmZpbmQoKG9iaikgPT4gb2JqLnZhbHVlID09PSBjdXJyZW50VmVyc2lvbikpIHsKICAgICAgICBvdXQucHVzaCh7CiAgICAgICAgICBsYWJlbDogYCR7IGN1cnJlbnRWZXJzaW9uIH0gJHsgdGhpcy50KCdjbHVzdGVyLmt1YmVybmV0ZXNWZXJzaW9uLmN1cnJlbnQnKSB9YCwKICAgICAgICAgIHZhbHVlOiBjdXJyZW50VmVyc2lvbiwKICAgICAgICAgIHNvcnQ6ICBzb3J0YWJsZShjdXJyZW50VmVyc2lvbiksCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHNvcnRlZCA9IHNvcnRCeShvdXQsICdzb3J0OmRlc2MnKTsKCiAgICAgIGNvbnN0IG1vc3RSZWNlbnRQYXRjaFZlcnNpb25zID0gdGhpcy5nZXRNb3N0UmVjZW50UGF0Y2hWZXJzaW9ucyhzb3J0ZWQpOwoKICAgICAgY29uc3Qgc29ydGVkV2l0aERlcHJlY2F0ZWRMYWJlbCA9IHNvcnRlZC5tYXAoKG9wdGlvbkRhdGEpID0+IHsKICAgICAgICBjb25zdCBtYWpvck1pbm9yID0gYCR7IHNlbXZlci5tYWpvcihvcHRpb25EYXRhLnZhbHVlKSB9LiR7IHNlbXZlci5taW5vcihvcHRpb25EYXRhLnZhbHVlKSB9YDsKCiAgICAgICAgaWYgKG1vc3RSZWNlbnRQYXRjaFZlcnNpb25zW21ham9yTWlub3JdID09PSBvcHRpb25EYXRhLnZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gb3B0aW9uRGF0YTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAuLi5vcHRpb25EYXRhLAogICAgICAgICAgbGFiZWw6IGAkeyBvcHRpb25EYXRhLmxhYmVsIH0gJHsgdGhpcy50KCdjbHVzdGVyLmt1YmVybmV0ZXNWZXJzaW9uLmRlcHJlY2F0ZWQnKSB9YAogICAgICAgIH07CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHNvcnRlZFdpdGhEZXByZWNhdGVkTGFiZWw7CiAgICB9LAoKICAgIGdldE1vc3RSZWNlbnRQYXRjaFZlcnNpb25zKHNvcnRlZFZlcnNpb25zKSB7CiAgICAgIC8vIEdldCB0aGUgbW9zdCByZWNlbnQgcGF0Y2ggdmVyc2lvbiBmb3IgZWFjaCBLdWJlcm5ldGVzIG1pbm9yIHZlcnNpb24uCiAgICAgIGNvbnN0IHZlcnNpb25NYXAgPSB7fTsKCiAgICAgIHNvcnRlZFZlcnNpb25zLmZvckVhY2goKHZlcnNpb24pID0+IHsKICAgICAgICBjb25zdCBtYWpvck1pbm9yID0gYCR7IHNlbXZlci5tYWpvcih2ZXJzaW9uLnZhbHVlKSB9LiR7IHNlbXZlci5taW5vcih2ZXJzaW9uLnZhbHVlKSB9YDsKCiAgICAgICAgaWYgKCF2ZXJzaW9uTWFwW21ham9yTWlub3JdKSB7CiAgICAgICAgICAvLyBCZWNhdXNlIHdlIHN0YXJ0IHdpdGggYSBzb3J0ZWQgbGlzdCBvZiB2ZXJzaW9ucywgd2Uga25vdyB0aGUKICAgICAgICAgIC8vIGhpZ2hlc3QgcGF0Y2ggdmVyc2lvbiBpcyBmaXJzdCBpbiB0aGUgbGlzdCwgc28gd2Ugb25seSBrZWVwIHRoZQogICAgICAgICAgLy8gZmlyc3Qgb2YgZWFjaCBtaW5vciB2ZXJzaW9uIGluIHRoZSBsaXN0LgogICAgICAgICAgdmVyc2lvbk1hcFttYWpvck1pbm9yXSA9IHZlcnNpb24udmFsdWU7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIHJldHVybiB2ZXJzaW9uTWFwOwogICAgfSwKCiAgICBmaWx0ZXJPdXREZXByZWNhdGVkUGF0Y2hWZXJzaW9ucyhhbGxWZXJzaW9ucywgY3VycmVudFZlcnNpb24pIHsKICAgICAgLy8gR2V0IHRoZSBtb3N0IHJlY2VudCBwYXRjaCB2ZXJzaW9uIGZvciBlYWNoIEt1YmVybmV0ZXMgbWlub3IgdmVyc2lvbi4KICAgICAgY29uc3QgbW9zdFJlY2VudFBhdGNoVmVyc2lvbnMgPSB0aGlzLmdldE1vc3RSZWNlbnRQYXRjaFZlcnNpb25zKGFsbFZlcnNpb25zKTsKCiAgICAgIGNvbnN0IGZpbHRlcmVkVmVyc2lvbnMgPSBhbGxWZXJzaW9ucy5maWx0ZXIoKHZlcnNpb24pID0+IHsKICAgICAgICAvLyBBbHdheXMgc2hvdyBwcmUtcmVsZWFzZXMKICAgICAgICBpZiAoc2VtdmVyLnByZXJlbGVhc2UodmVyc2lvbi52YWx1ZSkpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgbWFqb3JNaW5vciA9IGAkeyBzZW12ZXIubWFqb3IodmVyc2lvbi52YWx1ZSkgfS4keyBzZW12ZXIubWlub3IodmVyc2lvbi52YWx1ZSkgfWA7CgogICAgICAgIC8vIEFsd2F5cyBzaG93IGN1cnJlbnQgdmVyc2lvbiwgZWxzZSBzaG93IGlmIHdlIGhhdmVuJ3Qgc2hvd24gYW55dGhpbmcgZm9yIHRoaXMgbWFqb3IubWlub3IgdmVyc2lvbiB5ZXQKICAgICAgICBpZiAodmVyc2lvbi52YWx1ZSA9PT0gY3VycmVudFZlcnNpb24gfHwgbW9zdFJlY2VudFBhdGNoVmVyc2lvbnNbbWFqb3JNaW5vcl0gPT09IHZlcnNpb24udmFsdWUpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9KTsKCiAgICAgIHJldHVybiBmaWx0ZXJlZFZlcnNpb25zOwogICAgfSwKCiAgICBnZW5lcmF0ZVlhbWwoKSB7CiAgICAgIGNvbnN0IHJlc291cmNlID0gdGhpcy52YWx1ZTsKICAgICAgY29uc3QgaW5TdG9yZSA9IHRoaXMuJHN0b3JlLmdldHRlcnNbJ2N1cnJlbnRTdG9yZSddKHJlc291cmNlKTsKICAgICAgY29uc3Qgc2NoZW1hcyA9IHRoaXMuJHN0b3JlLmdldHRlcnNbYCR7IGluU3RvcmUgfS9hbGxgXShTQ0hFTUEpOwogICAgICBjb25zdCBjbG9uZWRSZXNvdXJjZSA9IGNsb25lKHJlc291cmNlKTsKCiAgICAgIHRoaXMuYXBwbHlDaGFydFZhbHVlcyhjbG9uZWRSZXNvdXJjZS5zcGVjLnJrZUNvbmZpZyk7CgogICAgICBjb25zdCBvdXQgPSBjcmVhdGVZYW1sKHNjaGVtYXMsIHJlc291cmNlLnR5cGUsIGNsb25lZFJlc291cmNlKTsKCiAgICAgIHJldHVybiBvdXQ7CiAgICB9LAoKICAgIGFwcGx5Q2hhcnRWYWx1ZXMocmtlQ29uZmlnKSB7CiAgICAgIHJrZUNvbmZpZy5jaGFydFZhbHVlcyA9IHt9OwogICAgICB0aGlzLmFkZG9uTmFtZXMuZm9yRWFjaCgobmFtZSkgPT4gewogICAgICAgIGNvbnN0IGtleSA9IHRoaXMuY2hhcnRWZXJzaW9uS2V5KG5hbWUpOwogICAgICAgIGNvbnN0IHVzZXJWYWx1ZXMgPSB0aGlzLnVzZXJDaGFydFZhbHVlc1trZXldOwoKICAgICAgICBpZiAodXNlclZhbHVlcykgewogICAgICAgICAgc2V0KHJrZUNvbmZpZy5jaGFydFZhbHVlcywgbmFtZSwgdXNlclZhbHVlcyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBnZXQsCgogICAgc2V0SGFydmVzdGVyRGVmYXVsdENsb3VkUHJvdmlkZXIoKSB7CiAgICAgIGlmICh0aGlzLmlzSGFydmVzdGVyRHJpdmVyICYmCiAgICAgICAgdGhpcy5tb2RlID09PSBfQ1JFQVRFICYmCiAgICAgICAgdGhpcy5hZ2VudENvbmZpZyAmJgogICAgICAgICF0aGlzLmFnZW50Q29uZmlnWydjbG91ZC1wcm92aWRlci1uYW1lJ10gJiYKICAgICAgICAhdGhpcy5pc0hhcnZlc3RlckV4dGVybmFsQ3JlZGVudGlhbCAmJgogICAgICAgICF0aGlzLmlzSGFydmVzdGVySW5jb21wYXRpYmxlCiAgICAgICkgewogICAgICAgIHRoaXMuYWdlbnRDb25maWdbJ2Nsb3VkLXByb3ZpZGVyLW5hbWUnXSA9IEhBUlZFU1RFUjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFnZW50Q29uZmlnWydjbG91ZC1wcm92aWRlci1uYW1lJ10gPSAnJzsKICAgICAgfQogICAgfSwKCiAgICBhc3luYyBzZXRIYXJ2ZXN0ZXJWZXJzaW9uUmFuZ2UoKSB7CiAgICAgIGNvbnN0IGNsdXN0ZXJJZCA9IHRoaXMuY3JlZGVudGlhbD8uZGVjb2RlZERhdGE/LmNsdXN0ZXJJZDsKICAgICAgY29uc3QgY2x1c3RlclR5cGUgPSB0aGlzLmNyZWRlbnRpYWw/LmRlY29kZWREYXRhPy5jbHVzdGVyVHlwZTsKCiAgICAgIGlmIChjbHVzdGVySWQgJiYgY2x1c3RlclR5cGUgPT09ICdpbXBvcnRlZCcpIHsKICAgICAgICBjb25zdCB1cmwgPSBgL2s4cy9jbHVzdGVycy8keyBjbHVzdGVySWQgfS92MWA7CiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2NsdXN0ZXIvcmVxdWVzdCcsIHsgdXJsOiBgJHsgdXJsIH0vJHsgSENJLlNFVFRJTkcgfXNgIH0pOwoKICAgICAgICBjb25zdCB2ZXJzaW9uID0gKHJlcz8uZGF0YSB8fCBbXSkuZmluZCgocykgPT4gcy5pZCA9PT0gJ2hhcnZlc3Rlci1jc2ktY2NtLXZlcnNpb25zJyk7CgogICAgICAgIGlmICh2ZXJzaW9uKSB7CiAgICAgICAgICB0aGlzLmhhcnZlc3RlclZlcnNpb25SYW5nZSA9IEpTT04ucGFyc2UodmVyc2lvbi52YWx1ZSB8fCB2ZXJzaW9uLmRlZmF1bHQgfHwgJ3t9Jyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuaGFydmVzdGVyVmVyc2lvblJhbmdlID0ge307CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuc2V0SGFydmVzdGVyRGVmYXVsdENsb3VkUHJvdmlkZXIoKTsKICAgIH0sCiAgICB0b2dnbGVDdXN0b21SZWdpc3RyeShuZXUpIHsKICAgICAgdGhpcy5zaG93Q3VzdG9tUmVnaXN0cnlJbnB1dCA9IG5ldTsKICAgICAgaWYgKHRoaXMucmVnaXN0cnlIb3N0KSB7CiAgICAgICAgdGhpcy5yZWdpc3RyeUhvc3QgPSBudWxsOwogICAgICAgIHRoaXMucmVnaXN0cnlTZWNyZXQgPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW5pdFJlZ2lzdHJ5KCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXNldCBQU0Egb24gc2V2ZXJhbCBpbnB1dCBjaGFuZ2VzIGZvciBnaXZlbiBjb25kaXRpb25zCiAgICAgKi8KICAgIHRvZ2dsZVBzYURlZmF1bHQoKSB7CiAgICAgIC8vIFRoaXMgb3B0aW9uIGlzIGNyZWF0ZWQgZnJvbSB0aGUgc2VydmVyIGFuZCBpcyBndWFyYW50ZWVkIHRvIGV4aXN0ICM4MDMyCiAgICAgIGNvbnN0IGhhcmRjb2RlZFRlbXBsYXRlID0gJ3JhbmNoZXItcmVzdHJpY3RlZCc7CiAgICAgIGNvbnN0IGNpc1ZhbHVlID0gdGhpcy5hZ2VudENvbmZpZz8ucHJvZmlsZSB8fCB0aGlzLnNlcnZlckNvbmZpZz8ucHJvZmlsZTsKCiAgICAgIGlmICghdGhpcy5jaXNPdmVycmlkZSkgewogICAgICAgIGlmIChjaXNWYWx1ZSkgewogICAgICAgICAgc2V0KHRoaXMudmFsdWUuc3BlYywgJ2RlZmF1bHRQb2RTZWN1cml0eUFkbWlzc2lvbkNvbmZpZ3VyYXRpb25UZW1wbGF0ZU5hbWUnLCBoYXJkY29kZWRUZW1wbGF0ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIGhhbmRsZUNpc0NoYW5nZSgpIHsKICAgICAgdGhpcy50b2dnbGVQc2FEZWZhdWx0KCk7CiAgICAgIHRoaXMudXBkYXRlQ2lzUHJvZmlsZSgpOwogICAgfSwKCiAgICB1cGRhdGVDaXNQcm9maWxlKCkgewogICAgICAvLyBJZiB0aGUgdXNlciBzZWxlY3RzIGFueSBXb3JrZXIgQ0lTIFByb2ZpbGUsCiAgICAgIC8vIHByb3RlY3Qta2VybmVsLWRlZmF1bHRzIHNob3VsZCBiZSBzZXQgdG8gZmFsc2UKICAgICAgLy8gaW4gdGhlIFJLRTIgd29ya2VyL2FnZW50IGNvbmZpZy4KICAgICAgY29uc3Qgc2VsZWN0ZWRDaXNQcm9maWxlID0gdGhpcy5hZ2VudENvbmZpZz8ucHJvZmlsZTsKCiAgICAgIGlmIChzZWxlY3RlZENpc1Byb2ZpbGUpIHsKICAgICAgICBzZXQodGhpcy5hZ2VudENvbmZpZywgJ3Byb3RlY3Qta2VybmVsLWRlZmF1bHRzJywgdHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2V0KHRoaXMuYWdlbnRDb25maWcsICdwcm90ZWN0LWtlcm5lbC1kZWZhdWx0cycsIGZhbHNlKTsKICAgICAgfQogICAgfSwKICAgIHVwZGF0ZUFkZGl0aW9uYWxNYW5pZmVzdChuZXUpIHsKICAgICAgdGhpcy52YWx1ZS5zcGVjLnJrZUNvbmZpZy5hZGRpdGlvbmFsTWFuaWZlc3QgPSBuZXU7CiAgICB9LAoKICAgIC8qKgogICAgICogSGFuZGxlIGs4cyBjaGFuZ2VzIHNpZGUgZWZmZWN0cywgbGlrZSBQU0EgcmVzZXRzCiAgICAgKi8KICAgIGhhbmRsZUt1YmVybmV0ZXNDaGFuZ2UodmFsdWUsIG9sZCkgewogICAgICBpZiAodmFsdWUpIHsKICAgICAgICB0aGlzLnRvZ2dsZVBzYURlZmF1bHQoKTsKCiAgICAgICAgLy8gSWYgSGFydmVzdGVyIGRyaXZlciwgcmVzZXQgY2xvdWQgcHJvdmlkZXIgaWYgbm90IGNvbXBhdGlibGUKICAgICAgICBpZiAodGhpcy5pc0hhcnZlc3RlckRyaXZlciAmJiB0aGlzLm1vZGUgPT09IF9DUkVBVEUgJiYgdGhpcy5pc0hhcnZlc3RlckluY29tcGF0aWJsZSkgewogICAgICAgICAgdGhpcy5zZXRIYXJ2ZXN0ZXJEZWZhdWx0Q2xvdWRQcm92aWRlcigpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICBoYW5kbGVTaG93RGVwcmVjYXRlZFBhdGNoVmVyc2lvbnNDaGFuZ2VkKHZhbHVlKSB7CiAgICAgIHRoaXMuc2hvd0RlcHJlY2F0ZWRQYXRjaFZlcnNpb25zID0gdmFsdWU7CiAgICB9LAogICAgLyoqCiAgICAgKiBUcmFjayBNYWNoaW5lIFBvb2wgdmFsaWRhdGlvbiBzdGF0dXMKICAgICAqLwogICAgbWFjaGluZVBvb2xWYWxpZGF0aW9uQ2hhbmdlZChpZCwgdmFsdWUpIHsKICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLiRkZWxldGUodGhpcy5tYWNoaW5lUG9vbFZhbGlkYXRpb24sIGlkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRzZXQodGhpcy5tYWNoaW5lUG9vbFZhbGlkYXRpb24sIGlkLCB2YWx1ZSk7CiAgICAgIH0KICAgIH0sCiAgICBoYW5kbGVFbmFibGVkU3lzdGVtU2VydmljZXNDaGFuZ2VkKHZhbCkgewogICAgICBzZXQodGhpcy5zZXJ2ZXJDb25maWcsICdkaXNhYmxlJywgdmFsKTsKICAgIH0sCgogICAgaGFuZGxlQ2lsaXVtVmFsdWVzQ2hhbmdlZChuZXUpIHsKICAgICAgaWYgKG5ldSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBuYW1lID0gdGhpcy5jaGFydFZlcnNpb25LZXkoJ3JrZTItY2lsaXVtJyk7CgogICAgICBzZXQodGhpcywgJ3VzZXJDaGFydFZhbHVlcycsIHsKICAgICAgICAuLi50aGlzLnVzZXJDaGFydFZhbHVlcywKICAgICAgICBbbmFtZV06IHsgLi4ubmV1IH0KICAgICAgfSk7CiAgICB9LAoKICAgIGhhbmRsZUNpc0NoYW5nZWQoKSB7CiAgICAgIHRoaXMuaGFuZGxlQ2lzQ2hhbmdlKCk7CiAgICB9LAogICAgaGFuZGxlUHNhRGVmYXVsdENoYW5nZWQoKSB7CiAgICAgIHRoaXMudG9nZ2xlUHNhRGVmYXVsdCgpOwogICAgfSwKICAgIGhhbmRsZU1hY2hpbmVQb29sRXJyb3IoZXJyb3IpIHsKICAgICAgdGhpcy5tYWNoaW5lUG9vbEVycm9ycyA9IG1lcmdlKHRoaXMubWFjaGluZVBvb2xFcnJvcnMsIGVycm9yKTsKCiAgICAgIGNvbnN0IGVycm9ycyA9IE9iamVjdC5lbnRyaWVzKHRoaXMubWFjaGluZVBvb2xFcnJvcnMpCiAgICAgICAgLm1hcCgoeCkgPT4gewogICAgICAgICAgaWYgKCF4WzFdLmxlbmd0aCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgZm9ybWF0dGVkRmllbGRzID0gKCgpID0+IHsKICAgICAgICAgICAgc3dpdGNoICh4WzFdLmxlbmd0aCkgewogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgcmV0dXJuIHhbMV1bMF07CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICByZXR1cm4gYCR7IHhbMV1bMF0gfSBhbmQgJHsgeFsxXVsxXSB9YDsKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgIGNvbnN0IFtoZWFkLCAuLi5yZXN0XSA9IHhbMV07CgogICAgICAgICAgICAgIHJldHVybiBgJHsgcmVzdC5qb2luKCcsICcpIH0sIGFuZCAkeyBoZWFkIH1gOwogICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pKCk7CgogICAgICAgICAgcmV0dXJuIHRoaXMudCgnY2x1c3Rlci5iYW5uZXIubWFjaGluZVBvb2xFcnJvcicsIHsKICAgICAgICAgICAgY291bnQ6IHhbMV0ubGVuZ3RoLCBwb29sX25hbWU6IHhbMF0sIGZpZWxkczogZm9ybWF0dGVkRmllbGRzCiAgICAgICAgICB9LCB0cnVlKTsKICAgICAgICB9KQogICAgICAgIC5maWx0ZXIoKHgpID0+IHgpOwoKICAgICAgaWYgKCFlcnJvcnMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuZXJyb3JzID0gZXJyb3JzOwogICAgfSwKICAgIGhhbmRsZVMzQmFja3VwQ2hhbmdlZChuZXUpIHsKICAgICAgdGhpcy5zM0JhY2t1cCA9IG5ldTsKICAgICAgaWYgKG5ldSkgewogICAgICAgIC8vIFdlIG5lZWQgdG8gbWFrZSBzdXJlIHRoYXQgczMgZG9lc24ndCBhbHJlYWR5IGhhdmUgYW4gZXhpc3RpbmcgdmFsdWUgb3RoZXJ3aXNlIHdoZW4gZWRpdGluZyBhIGNsdXN0ZXIgd2l0aCBzMyBkZWZpbmVkIHRoaXMgd2lsbCBjbGVhciBzMy4KICAgICAgICBpZiAoaXNFbXB0eSh0aGlzLnJrZUNvbmZpZy5ldGNkPy5zMykpIHsKICAgICAgICAgIHNldCh0aGlzLnJrZUNvbmZpZy5ldGNkLCAnczMnLCB7fSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHNldCh0aGlzLnJrZUNvbmZpZy5ldGNkLCAnczMnLCBudWxsKTsKICAgICAgfQogICAgfSwKICAgIGhhbmRsZUNvbmZpZ0V0Y2RFeHBvc2VNZXRyaWNzQ2hhbmdlZChuZXUpIHsKICAgICAgc2V0KHRoaXMuc2VydmVyQ29uZmlnLCAnZXRjZC1leHBvc2UtbWV0cmljcycsIG5ldSk7CiAgICB9LAogICAgaGFuZGxlUmVnaXN0cnlIb3N0Q2hhbmdlZChuZXUpIHsKICAgICAgdGhpcy5yZWdpc3RyeUhvc3QgPSBuZXU7CiAgICB9LAogICAgaGFuZGxlUmVnaXN0cnlTZWNyZXRDaGFuZ2VkKG5ldSkgewogICAgICB0aGlzLnJlZ2lzdHJ5U2VjcmV0ID0gbmV1OwogICAgfSwKICAgIHZhbGlkYXRlQ2x1c3Rlck5hbWUoKSB7CiAgICAgIGlmICghdGhpcy52YWx1ZS5tZXRhZGF0YS5uYW1lICYmIHRoaXMuYWdlbnRDb25maWc/LlsnY2xvdWQtcHJvdmlkZXItbmFtZSddID09PSBIQVJWRVNURVIpIHsKICAgICAgICB0aGlzLmVycm9ycy5wdXNoKHRoaXMudCgndmFsaWRhdGlvbi5yZXF1aXJlZCcsIHsga2V5OiB0aGlzLnQoJ2NsdXN0ZXIubmFtZS5sYWJlbCcpIH0sIHRydWUpKTsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIHZhbGlkYXRlTWFjaGluZVBvb2woKSB7CiAgICAgIGlmICh0aGlzLmVycm9ycykgewogICAgICAgIGNsZWFyKHRoaXMuZXJyb3JzKTsKICAgICAgfQogICAgICBpZiAodGhpcy52YWx1ZS5jbG91ZFByb3ZpZGVyID09PSAnYXdzJykgewogICAgICAgIGNvbnN0IG1pc3NpbmdQcm9maWxlTmFtZSA9IHRoaXMubWFjaGluZVBvb2xzLnNvbWUoKG1wKSA9PiAhbXAuY29uZmlnLmlhbUluc3RhbmNlUHJvZmlsZSk7CgogICAgICAgIGlmIChtaXNzaW5nUHJvZmlsZU5hbWUpIHsKICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2godGhpcy50KCdjbHVzdGVyLnZhbGlkYXRpb24uaWFtSW5zdGFuY2VQcm9maWxlTmFtZScsIHt9LCB0cnVlKSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGNvbnN0IFtpbmRleF0gb2YgdGhpcy5tYWNoaW5lUG9vbHMuZW50cmllcygpKSB7IC8vIHZhbGlkYXRvciBtYWNoaW5lIGNvbmZpZwogICAgICAgIGlmICh0eXBlb2YgdGhpcy4kcmVmcy5wb29sW2luZGV4XT8udGVzdCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy4kcmVmcy5wb29sW2luZGV4XS50ZXN0KCk7CgogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXMpICYmIHJlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaCguLi5yZXMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2goZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9Owo="},{"version":3,"sources":["rke2.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"rke2.vue","sourceRoot":"node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster","sourcesContent":["<script>\nimport difference from 'lodash/difference';\nimport throttle from 'lodash/throttle';\nimport isArray from 'lodash/isArray';\nimport merge from 'lodash/merge';\nimport CreateEditView from '@shell/mixins/create-edit-view';\nimport FormValidation from '@shell/mixins/form-validation';\nimport { normalizeName } from '@shell/utils/kube';\n\nimport {\n  CAPI,\n  MANAGEMENT,\n  NAMESPACE,\n  NORMAN,\n  SCHEMA,\n  DEFAULT_WORKSPACE,\n  SECRET,\n  HCI,\n} from '@shell/config/types';\nimport { _CREATE, _EDIT, _VIEW } from '@shell/config/query-params';\n\nimport { findBy, removeObject, clear } from '@shell/utils/array';\nimport { createYaml } from '@shell/utils/create-yaml';\nimport {\n  clone, diff, set, get, isEmpty\n} from '@shell/utils/object';\nimport { allHash } from '@shell/utils/promise';\nimport { sortBy } from '@shell/utils/sort';\nimport { vspherePoolConfigMerge } from '@shell/machine-config/vmwarevsphere-pool-config-merge';\n\nimport { compare, sortable } from '@shell/utils/version';\nimport { isHarvesterSatisfiesVersion } from '@shell/utils/cluster';\n\nimport { BadgeState } from '@components/BadgeState';\nimport { Banner } from '@components/Banner';\nimport CruResource, { CONTEXT_HOOK_EDIT_YAML } from '@shell/components/CruResource';\nimport Loading from '@shell/components/Loading';\nimport NameNsDescription from '@shell/components/form/NameNsDescription';\nimport Tab from '@shell/components/Tabbed/Tab';\nimport Tabbed from '@shell/components/Tabbed';\n\nimport { canViewClusterMembershipEditor } from '@shell/components/form/Members/ClusterMembershipEditor';\nimport semver from 'semver';\n\nimport { SETTING } from '@shell/config/settings';\nimport { base64Encode } from '@shell/utils/crypto';\nimport { CAPI as CAPI_ANNOTATIONS, CLUSTER_BADGE } from '@shell/config/labels-annotations';\nimport AgentEnv from '@shell/edit/provisioning.cattle.io.cluster/AgentEnv';\nimport Labels from '@shell/edit/provisioning.cattle.io.cluster/Labels';\nimport MachinePool from '@shell/edit/provisioning.cattle.io.cluster/tabs/MachinePool';\nimport SelectCredential from './SelectCredential';\nimport { ELEMENTAL_SCHEMA_IDS, KIND, ELEMENTAL_CLUSTER_PROVIDER } from '../../config/elemental-types';\nimport AgentConfiguration from '@shell/edit/provisioning.cattle.io.cluster/tabs/AgentConfiguration';\nimport { getApplicableExtensionEnhancements } from '@shell/core/plugin-helpers';\nimport { ExtensionPoint, TabLocation } from '@shell/core/types';\nimport MemberRoles from '@shell/edit/provisioning.cattle.io.cluster/tabs/MemberRoles';\nimport Basics from '@shell/edit/provisioning.cattle.io.cluster/tabs/Basics';\nimport Etcd from '@shell/edit/provisioning.cattle.io.cluster/tabs/etcd';\nimport Networking from '@shell/edit/provisioning.cattle.io.cluster/tabs/networking';\nimport Upgrade from '@shell/edit/provisioning.cattle.io.cluster/tabs/upgrade';\nimport Registries from '@shell/edit/provisioning.cattle.io.cluster/tabs/registries';\nimport AddOnConfig from '@shell/edit/provisioning.cattle.io.cluster/tabs/AddOnConfig';\nimport Advanced from '@shell/edit/provisioning.cattle.io.cluster/tabs/Advanced';\nimport ClusterAppearance from '@shell/components/form/ClusterAppearance';\n\nconst HARVESTER = 'harvester';\nconst HARVESTER_CLOUD_PROVIDER = 'harvester-cloud-provider';\nconst NETBIOS_TRUNCATION_LENGTH = 15;\n\nconst VMWARE_VSPHERE = 'vmwarevsphere';\n\n/**\n * Classes to be adopted by the node badges in Machine pools\n */\nconst NODE_TOTAL = {\n  error: {\n    color: 'bg-error',\n    icon:  'icon-x',\n  },\n  warning: {\n    color: 'bg-warning',\n    icon:  'icon-warning',\n  },\n  success: {\n    color: 'bg-success',\n    icon:  'icon-checkmark'\n  }\n};\nconst CLUSTER_AGENT_CUSTOMIZATION = 'clusterAgentDeploymentCustomization';\nconst FLEET_AGENT_CUSTOMIZATION = 'fleetAgentDeploymentCustomization';\n\nexport default {\n  components: {\n    AgentEnv,\n    BadgeState,\n    Banner,\n    AgentConfiguration,\n    CruResource,\n    Labels,\n    Loading,\n    MachinePool,\n    NameNsDescription,\n    SelectCredential,\n    Tab,\n    Tabbed,\n    MemberRoles,\n    Basics,\n    Etcd,\n    Networking,\n    Upgrade,\n    Registries,\n    AddOnConfig,\n    Advanced,\n    ClusterAppearance\n  },\n\n  mixins: [CreateEditView, FormValidation],\n\n  props: {\n    mode: {\n      type:     String,\n      required: true,\n    },\n\n    value: {\n      type:     Object,\n      required: true,\n    },\n\n    provider: {\n      type:     String,\n      required: true,\n    },\n\n    providerConfig: {\n      type:    Object,\n      default: () => null\n    }\n  },\n\n  async fetch() {\n    await this.fetchRke2Versions();\n    await this.initSpecs();\n    await this.initAddons();\n    await this.initRegistry();\n\n    Object.entries(this.chartValues).forEach(([name, value]) => {\n      const key = this.chartVersionKey(name);\n\n      this.userChartValues[key] = value;\n    });\n\n    this.setAgentConfiguration();\n  },\n\n  data() {\n    if (!this.value.spec.rkeConfig) {\n      set(this.value.spec, 'rkeConfig', {});\n    }\n\n    if (!this.value.spec.rkeConfig.chartValues) {\n      set(this.value.spec.rkeConfig, 'chartValues', {});\n    }\n\n    if (!this.value.spec.rkeConfig.upgradeStrategy) {\n      set(this.value.spec.rkeConfig, 'upgradeStrategy', {\n        controlPlaneConcurrency:  '1',\n        controlPlaneDrainOptions: {},\n        workerConcurrency:        '1',\n        workerDrainOptions:       {},\n      });\n    }\n\n    if (!this.value.spec.rkeConfig.dataDirectories) {\n      set(this.value.spec.rkeConfig, 'dataDirectories', {\n        systemAgent:  '',\n        provisioning: '',\n        k8sDistro:    '',\n      });\n    }\n\n    if (!this.value.spec.rkeConfig.machineGlobalConfig) {\n      set(this.value.spec, 'rkeConfig.machineGlobalConfig', {});\n    }\n\n    if (!this.value.spec.rkeConfig.machineSelectorConfig?.length) {\n      set(this.value.spec, 'rkeConfig.machineSelectorConfig', [{ config: {} }]);\n    }\n\n    const truncateLimit = this.value.defaultHostnameLengthLimit || 0;\n\n    return {\n      loadedOnce:                      false,\n      lastIdx:                         0,\n      allPSAs:                         [],\n      credentialId:                    '',\n      credential:                      null,\n      machinePools:                    null,\n      rke2Versions:                    null,\n      k3sVersions:                     null,\n      defaultRke2:                     '',\n      defaultK3s:                      '',\n      s3Backup:                        false,\n      /**\n       * All info related to a specific version of the chart\n       *\n       * This includes chart itself, README and values\n       *\n       * { [chartName:string]: { chart: json, readme: string, values: json } }\n       */\n      versionInfo:                     {},\n      membershipUpdate:                {},\n      showDeprecatedPatchVersions:     false,\n      systemRegistry:                  null,\n      registryHost:                    null,\n      showCustomRegistryInput:         false,\n      showCustomRegistryAdvancedInput: false,\n      registrySecret:                  null,\n      userChartValues:                 {},\n      userChartValuesTemp:             {},\n      addonsRev:                       0,\n      fvFormRuleSets:                  [{\n        path: 'metadata.name', rules: ['subDomain'], translationKey: 'nameNsDescription.name.label'\n      }],\n      harvesterVersionRange: {},\n      cisOverride:           false,\n      truncateLimit,\n      busy:                  false,\n      machinePoolValidation: {}, // map of validation states for each machine pool\n      machinePoolErrors:     {},\n      allNamespaces:         [],\n      extensionTabs:         getApplicableExtensionEnhancements(this, ExtensionPoint.TAB, TabLocation.CLUSTER_CREATE_RKE2, this.$route, this),\n    };\n  },\n\n  computed: {\n    clusterName() {\n      return this.value.metadata?.name || '';\n    },\n    showClusterAppearance() {\n      return this.mode === _CREATE;\n    },\n    clusterBadgeAbbreviation() {\n      return this.$store.getters['customisation/getPreviewCluster'];\n    },\n    rkeConfig() {\n      return this.value.spec.rkeConfig;\n    },\n\n    isElementalCluster() {\n      return this.provider === ELEMENTAL_CLUSTER_PROVIDER || this.value?.machineProvider?.toLowerCase() === KIND.MACHINE_INV_SELECTOR_TEMPLATES.toLowerCase();\n    },\n\n    chartValues() {\n      return this.value.spec.rkeConfig.chartValues;\n    },\n\n    serverConfig() {\n      return this.value.spec.rkeConfig.machineGlobalConfig;\n    },\n\n    agentConfig() {\n      return this.value.agentConfig;\n    },\n\n    unsupportedSelectorConfig() {\n      let global = 0;\n      let kubeletOnly = 0;\n      let other = 0;\n\n      // The form supports one config that has no selector for all the main parts\n      // And one or more configs that have a selector and exactly only kubelet-args.\n      // If there are any other properties set, or multiple configs with no selector\n      // show a warning that you're editing only part of the config in the UI.\n\n      for (const conf of this.value.spec?.rkeConfig?.machineSelectorConfig) {\n        if (conf.machineLabelSelector) {\n          const keys = Object.keys(conf.config || {});\n\n          if (keys.length === 0 || (keys.length === 1 && keys[0] === 'kubelet-arg')) {\n            kubeletOnly++;\n          } else {\n            other++;\n          }\n        } else {\n          global++;\n        }\n      }\n\n      // eslint-disable-next-line no-console\n      console.log(`Global: ${ global }, Kubelet Only: ${ kubeletOnly }, Other: ${ other }`);\n\n      return (global > 1 || other > 0);\n    },\n\n    versionOptions() {\n      const cur = this.liveValue?.spec?.kubernetesVersion || '';\n      const existingRke2 = this.mode === _EDIT && cur.includes('rke2');\n      const existingK3s = this.mode === _EDIT && cur.includes('k3s');\n\n      let allValidRke2Versions = this.getAllOptionsAfterCurrentVersion(this.rke2Versions, (existingRke2 ? cur : null), this.defaultRke2);\n      let allValidK3sVersions = this.getAllOptionsAfterCurrentVersion(this.k3sVersions, (existingK3s ? cur : null), this.defaultK3s);\n\n      if (!this.showDeprecatedPatchVersions) {\n        // Normally, we only want to show the most recent patch version\n        // for each Kubernetes minor version. However, if the user\n        // opts in to showing deprecated versions, we don't filter them.\n        allValidRke2Versions = this.filterOutDeprecatedPatchVersions(allValidRke2Versions, cur);\n        allValidK3sVersions = this.filterOutDeprecatedPatchVersions(allValidK3sVersions, cur);\n      }\n\n      const showRke2 = allValidRke2Versions.length && !existingK3s;\n      const showK3s = allValidK3sVersions.length && !existingRke2;\n      const out = [];\n\n      if (showRke2) {\n        if (showK3s) {\n          out.push({ kind: 'group', label: this.t('cluster.provider.rke2') });\n        }\n\n        out.push(...allValidRke2Versions);\n      }\n\n      if (showK3s) {\n        if (showRke2) {\n          out.push({ kind: 'group', label: this.t('cluster.provider.k3s') });\n        }\n\n        out.push(...allValidK3sVersions);\n      }\n\n      if (cur) {\n        const existing = out.find((x) => x.value === cur);\n\n        if (existing) {\n          existing.disabled = false;\n        }\n      }\n\n      return out;\n    },\n\n    /**\n     * Kube Version\n     */\n    selectedVersion() {\n      const str = this.value.spec.kubernetesVersion;\n\n      if (!str) {\n        return;\n      }\n\n      const out = findBy(this.versionOptions, 'value', str);\n\n      // Adding the option 'none' to Container Network select (used in Basics component)\n      // https://github.com/rancher/dashboard/issues/10338\n      // there's an update loop on refresh that might include 'none'\n      // multiple times... Prevent that\n      if (out.serverArgs?.cni?.options && !out.serverArgs?.cni?.options.includes('none')) {\n        out.serverArgs.cni.options.push('none');\n      }\n\n      return out;\n    },\n\n    haveArgInfo() {\n      return Boolean(this.selectedVersion?.serverArgs && this.selectedVersion?.agentArgs);\n    },\n\n    serverArgs() {\n      return this.selectedVersion?.serverArgs || {};\n    },\n\n    agentArgs() {\n      return this.selectedVersion?.agentArgs || {};\n    },\n\n    /**\n     * The addons (kube charts) applicable for the selected kube version\n     *\n     * { [chartName:string]: { repo: string, version: string } }\n     */\n    chartVersions() {\n      return this.selectedVersion?.charts || {};\n    },\n\n    needCredential() {\n      if (this.provider === 'custom' || this.provider === 'import' || this.isElementalCluster || this.mode === _VIEW || (this.providerConfig?.spec?.builtin === false && this.providerConfig?.spec?.addCloudCredential === false)) {\n        return false;\n      }\n\n      if (this.customCredentialComponentRequired === false) {\n        return false;\n      }\n\n      return true;\n    },\n\n    /**\n     * Only for extensions - extension can register a 'false' cloud credential to indicate that a cloud credential is not needed\n     */\n    customCredentialComponentRequired() {\n      return this.$plugin.getDynamic('cloud-credential', this.provider);\n    },\n\n    hasMachinePools() {\n      if (this.provider === 'custom' || this.provider === 'import') {\n        return false;\n      }\n\n      return true;\n    },\n\n    unremovedMachinePools() {\n      return (this.machinePools || []).filter((x) => !x.remove);\n    },\n\n    /**\n     * Extension provider where being provisioned by an extension\n     */\n    extensionProvider() {\n      const extClass = this.$plugin.getDynamic('provisioner', this.provider);\n\n      if (extClass) {\n        return new extClass({\n          dispatch: this.$store.dispatch,\n          getters:  this.$store.getters,\n          axios:    this.$store.$axios,\n          $plugin:  this.$store.app.$plugin,\n          $t:       this.t,\n          isCreate: this.isCreate\n        });\n      }\n\n      return undefined;\n    },\n\n    /**\n     * Is a namespace needed? Only supported for providers from extensions, otherwise default is no\n     */\n    needsNamespace() {\n      return this.extensionProvider ? !!this.extensionProvider.namespaced : false;\n    },\n\n    machineConfigSchema() {\n      let schema;\n\n      if (!this.hasMachinePools) {\n        return null;\n      } else if (this.isElementalCluster) {\n        schema = ELEMENTAL_SCHEMA_IDS.MACHINE_INV_SELECTOR_TEMPLATES;\n      } else {\n        schema = `${ CAPI.MACHINE_CONFIG_GROUP }.${ this.provider }config`;\n      }\n\n      // If this is an extension provider then the extension can provide the schema\n      const extensionSchema = this.extensionProvider?.machineConfigSchema;\n\n      if (extensionSchema) {\n        // machineConfigSchema can either be the schema name (string) or the schema itself (object)\n        if (typeof extensionSchema === 'object') {\n          return extensionSchema;\n        }\n\n        // Name of schema to use\n        schema = extensionSchema;\n      }\n\n      return this.$store.getters['management/schemaFor'](schema);\n    },\n\n    nodeTotals() {\n      const roles = ['etcd', 'controlPlane', 'worker'];\n      const counts = {};\n      const out = {\n        color:   {},\n        label:   {},\n        icon:    {},\n        tooltip: {},\n      };\n\n      for (const role of roles) {\n        counts[role] = 0;\n        out.color[role] = NODE_TOTAL.success.color;\n        out.icon[role] = NODE_TOTAL.success.icon;\n      }\n\n      for (const row of this.machinePools || []) {\n        if (row.remove) {\n          continue;\n        }\n\n        const qty = parseInt(row.pool.quantity, 10);\n\n        if (isNaN(qty)) {\n          continue;\n        }\n\n        for (const role of roles) {\n          counts[role] = counts[role] + (row.pool[`${ role }Role`] ? qty : 0);\n        }\n      }\n\n      for (const role of roles) {\n        out.label[role] = this.t(`cluster.machinePool.nodeTotals.label.${ role }`, { count: counts[role] });\n        out.tooltip[role] = this.t(`cluster.machinePool.nodeTotals.tooltip.${ role }`, { count: counts[role] });\n      }\n\n      if (counts.etcd === 0) {\n        out.color.etcd = NODE_TOTAL.error.color;\n        out.icon.etcd = NODE_TOTAL.error.icon;\n      } else if (counts.etcd === 1 || counts.etcd % 2 === 0 || counts.etcd > 7) {\n        out.color.etcd = NODE_TOTAL.warning.color;\n        out.icon.etcd = NODE_TOTAL.warning.icon;\n      }\n\n      if (counts.controlPlane === 0) {\n        out.color.controlPlane = NODE_TOTAL.error.color;\n        out.icon.controlPlane = NODE_TOTAL.error.icon;\n      } else if (counts.controlPlane === 1) {\n        out.color.controlPlane = NODE_TOTAL.warning.color;\n        out.icon.controlPlane = NODE_TOTAL.warning.icon;\n      }\n\n      if (counts.worker === 0) {\n        out.color.worker = NODE_TOTAL.error.color;\n        out.icon.worker = NODE_TOTAL.error.icon;\n      } else if (counts.worker === 1) {\n        out.color.worker = NODE_TOTAL.warning.color;\n        out.icon.worker = NODE_TOTAL.warning.icon;\n      }\n\n      return out;\n    },\n\n    showCni() {\n      return !!this.serverArgs.cni;\n    },\n\n    showCloudProvider() {\n      return !!this.agentArgs['cloud-provider-name'];\n    },\n\n    /**\n     * The chart names of the addons applicable to the current kube version and selected cloud provider\n     */\n    addonNames() {\n      const names = [];\n      const cni = this.serverConfig.cni;\n\n      if (typeof cni === 'string') {\n        names.push(...cni.split(',').map((x) => `rke2-${ x }`));\n      } else if (Array.isArray(cni)) {\n        names.push(...cni.map((x) => `rke2-${ x }`));\n      }\n\n      if (this.showCloudProvider) { // Shouldn't be removed such that changes to it will re-trigger this watch\n        if (this.agentConfig?.['cloud-provider-name'] === 'rancher-vsphere') {\n          names.push('rancher-vsphere-cpi', 'rancher-vsphere-csi');\n        }\n\n        if (this.agentConfig?.['cloud-provider-name'] === HARVESTER) {\n          names.push(HARVESTER_CLOUD_PROVIDER);\n        }\n      }\n\n      return names;\n    },\n\n    /**\n     * The charts of the addons applicable to the current kube version and selected cloud provider\n     *\n     * These are the charts themselves and do not include chart readme or values\n     */\n    addonVersions() {\n      const versions = this.addonNames.map((name) => this.versionInfo[name]?.chart);\n\n      return versions.filter((x) => !!x);\n    },\n\n    cloudProviderOptions() {\n      const out = [{\n        label: this.$store.getters['i18n/t']('cluster.rke2.cloudProvider.defaultValue.label'),\n        value: '',\n      }];\n\n      if (!!this.agentArgs['cloud-provider-name']?.options) {\n        const preferred = this.$store.getters['plugins/cloudProviderForDriver'](this.provider);\n\n        for (const opt of this.agentArgs['cloud-provider-name']?.options) {\n          // If we don't have a preferred provider... show all options\n          const showAllOptions = preferred === undefined;\n          // If we have a preferred provider... only show default, preferred and external\n          const isPreferred = opt === preferred;\n          const isExternal = opt === 'external';\n          let disabled = false;\n\n          if ((this.isHarvesterExternalCredential || this.isHarvesterIncompatible) && isPreferred) {\n            disabled = true;\n          }\n\n          if (showAllOptions || isPreferred || isExternal) {\n            out.push({\n              label: this.$store.getters['i18n/withFallback'](`cluster.cloudProvider.\"${ opt }\".label`, null, opt),\n              value: opt,\n              disabled,\n            });\n          }\n        }\n      }\n\n      const cur = this.agentConfig?.['cloud-provider-name'];\n\n      if (cur && !out.find((x) => x.value === cur)) {\n        out.unshift({ label: `${ cur } (Current)`, value: cur });\n      }\n\n      return out;\n    },\n\n    canManageMembers() {\n      return canViewClusterMembershipEditor(this.$store);\n    },\n\n    isHarvesterDriver() {\n      return this.$route.query.type === HARVESTER;\n    },\n\n    defaultVersion() {\n      const all = this.versionOptions.filter((x) => !!x.value);\n      const first = all[0]?.value;\n      const preferred = all.find((x) => x.value === this.defaultRke2)?.value;\n\n      const rke2 = this.getAllOptionsAfterCurrentVersion(this.rke2Versions, null);\n      const showRke2 = rke2.length;\n      let out;\n\n      if (this.isHarvesterDriver && showRke2) {\n        const satisfiesVersion = rke2.filter((v) => {\n          return isHarvesterSatisfiesVersion(v.value);\n        }) || [];\n\n        if (satisfiesVersion.length > 0) {\n          out = satisfiesVersion[0]?.value;\n        }\n      }\n\n      if (!out) {\n        out = preferred || first;\n      }\n\n      return out;\n    },\n\n    appsOSWarning() {\n      if (this.mode !== _EDIT) {\n        return null;\n      }\n      const { linuxWorkerCount, windowsWorkerCount } = this.value?.mgmt?.status || {};\n\n      if (!windowsWorkerCount) {\n        if (!!this.machinePools.find((pool) => {\n          return pool?.config?.os === 'windows';\n        })) {\n          return this.t('cluster.banner.os', { newOS: 'Windows', existingOS: 'Linux' });\n        }\n      } else if (!linuxWorkerCount) {\n        if (this.machinePools.find((pool) => {\n          return pool?.config?.os === 'linux';\n        })) {\n          return this.t('cluster.banner.os', { newOS: 'Linux', existingOS: 'Windows' });\n        }\n      }\n\n      return null;\n    },\n\n    showForm() {\n      return !!this.credentialId || !this.needCredential;\n    },\n\n    isHarvesterExternalCredential() {\n      return this.credential?.harvestercredentialConfig?.clusterType === 'external';\n    },\n\n    isHarvesterIncompatible() {\n      let ccmRke2Version = (this.chartVersions['harvester-cloud-provider'] || {})['version'];\n      let csiRke2Version = (this.chartVersions['harvester-csi-driver'] || {})['version'];\n\n      const ccmVersion = this.harvesterVersionRange?.['harvester-cloud-provider'];\n      const csiVersion = this.harvesterVersionRange?.['harvester-csi-provider'];\n\n      if ((ccmRke2Version || '').endsWith('00')) {\n        ccmRke2Version = ccmRke2Version.slice(0, -2);\n      }\n\n      if ((csiRke2Version || '').endsWith('00')) {\n        csiRke2Version = csiRke2Version.slice(0, -2);\n      }\n\n      if (ccmVersion && csiVersion) {\n        if (semver.satisfies(ccmRke2Version, ccmVersion) &&\n          semver.satisfies(csiRke2Version, csiVersion)) {\n          return false;\n        } else {\n          return true;\n        }\n      } else {\n        return false;\n      }\n    },\n\n    validationPassed() {\n      const validRequiredPools = this.hasMachinePools ? this.hasRequiredNodes() : true;\n\n      let base = (this.provider === 'custom' || this.isElementalCluster || !!this.credentialId || !this.needCredential);\n\n      // and in all of the validation statuses for each machine pool\n      Object.values(this.machinePoolValidation).forEach((v) => (base = base && v));\n\n      return validRequiredPools && base;\n    },\n    currentCluster() {\n      if (this.mode === _EDIT) {\n        return { ...this.value };\n      } else {\n        return this.$store.getters['customisation/getPreviewCluster'];\n      }\n    }\n  },\n\n  watch: {\n    clusterBadgeAbbreviation: {\n      immediate: true,\n      handler(neu) {\n        if (!neu) {\n          return;\n        }\n\n        if (Object.keys(neu.badge).length <= 0) {\n          return { ...this.value };\n        }\n\n        const obj = {\n          [CLUSTER_BADGE.ICON_TEXT]: neu.badge.iconText, [CLUSTER_BADGE.COLOR]: neu.badge.color, [CLUSTER_BADGE.TEXT]: neu.badge.text\n        };\n\n        this.value.metadata.annotations = {\n          ...this.value.metadata.annotations,\n          ...obj\n        };\n      }\n    },\n\n    credentialId(val) {\n      if (val) {\n        this.credential = this.$store.getters['rancher/byId'](NORMAN.CLOUD_CREDENTIAL, this.credentialId);\n\n        if (this.isHarvesterDriver) {\n          this.setHarvesterVersionRange();\n        }\n      } else {\n        this.credential = null;\n      }\n\n      this.value.spec.cloudCredentialSecretName = val;\n    },\n\n    addonNames(neu, old) {\n      // To catch the 'some addons' --> 'no addons' case also check array length (`difference([], [1,2,3]) === []`)\n      const diff = old.length !== neu.length || difference(neu, old).length;\n\n      if (diff) {\n        // Allow time for addonNames to update... then fetch any missing addons\n        this.$nextTick(() => this.initAddons());\n      }\n    },\n\n    selectedVersion() {\n      this.versionInfo = {}; // Invalidate cache such that version info relevent to selected kube version is updated\n\n      // Allow time for addonNames to update... then fetch any missing addons\n      this.$nextTick(() => this.initAddons());\n      if (this.mode === _CREATE) {\n        this.initServerAgentArgs();\n      }\n    },\n\n    showCni(neu) {\n      // Update `serverConfig.cni to recalculate addonNames...\n      // ... which will eventually update `value.spec.rkeConfig.chartValues`\n      if (neu) {\n        // Type supports CNI, assign default if we can\n        if (!this.serverConfig.cni) {\n          const def = this.serverArgs.cni.default;\n\n          set(this.serverConfig, 'cni', def);\n        }\n      } else {\n        // Type doesn't support cni, clear `cni`\n        set(this.serverConfig, 'cni', undefined);\n      }\n    },\n\n    showCloudProvider(neu) {\n      if (!neu) {\n        // No cloud provider available? Then clear cloud provider setting. This will recalculate addonNames...\n        // ... which will eventually update `value.spec.rkeConfig.chartValues`\n        set(this.agentConfig, 'cloud-provider-name', undefined);\n      }\n    },\n  },\n\n  created() {\n    this.registerBeforeHook(this.saveMachinePools, 'save-machine-pools', 1);\n    this.registerBeforeHook(this.setRegistryConfig, 'set-registry-config');\n    this.registerAfterHook(this.cleanupMachinePools, 'cleanup-machine-pools');\n    this.registerAfterHook(this.saveRoleBindings, 'save-role-bindings');\n\n    // Register any hooks for this extension provider\n    if (this.extensionProvider?.registerSaveHooks) {\n      this.extensionProvider.registerSaveHooks(this.registerBeforeHook, this.registerAfterHook, this.value);\n    }\n  },\n\n  methods: {\n    set,\n\n    /**\n     * Initialize all the cluster specs\n     */\n    async initSpecs() {\n      if (!this.value.spec) {\n        set(this.value, 'spec', {});\n      }\n\n      if (!this.value.spec.machineSelectorConfig) {\n        set(this.value.spec, 'machineSelectorConfig', []);\n      }\n\n      if (!this.value.spec.machineSelectorConfig.find((x) => !x.machineLabelSelector)) {\n        this.value.spec.machineSelectorConfig.unshift({ config: {} });\n      }\n\n      if (this.value.spec.cloudCredentialSecretName) {\n        await this.$store.dispatch('rancher/findAll', { type: NORMAN.CLOUD_CREDENTIAL });\n        this.credentialId = `${ this.value.spec.cloudCredentialSecretName }`;\n      }\n\n      if (!this.value.spec.kubernetesVersion) {\n        set(this.value.spec, 'kubernetesVersion', this.defaultVersion);\n      }\n\n      if (this.rkeConfig.etcd?.s3?.bucket) {\n        this.s3Backup = true;\n      }\n\n      if (!this.rkeConfig.etcd) {\n        set(this.rkeConfig, 'etcd', {\n          disableSnapshots:     false,\n          s3:                   null,\n          snapshotRetention:    5,\n          snapshotScheduleCron: '0 */5 * * *',\n        });\n      } else if (typeof this.rkeConfig.etcd.disableSnapshots === 'undefined') {\n        const disableSnapshots = !this.rkeConfig.etcd.snapshotRetention && !this.rkeConfig.etcd.snapshotScheduleCron;\n\n        set(this.rkeConfig.etcd, 'disableSnapshots', disableSnapshots);\n      }\n\n      // Namespaces if required - this is mainly for custom provisioners via extensions that want\n      // to allow creating their resources in a different namespace\n      if (this.needsNamespace) {\n        this.allNamespaces = await this.$store.dispatch('management/findAll', { type: NAMESPACE });\n      }\n\n      if (!this.machinePools) {\n        await this.initMachinePools(this.value.spec.rkeConfig.machinePools);\n        if (this.mode === _CREATE && !this.machinePools.length) {\n          await this.addMachinePool();\n        }\n      }\n\n      if (this.value.spec.defaultPodSecurityAdmissionConfigurationTemplateName === undefined) {\n        set(this.value.spec, 'defaultPodSecurityAdmissionConfigurationTemplateName', '');\n      }\n    },\n\n    /**\n     * Fetch RKE versions and their configurations to be mapped to the form\n     */\n    async fetchRke2Versions() {\n      if (!this.rke2Versions) {\n        const hash = {\n          rke2Versions: this.$store.dispatch('management/request', { url: '/v1-rke2-release/releases' }),\n          k3sVersions:  this.$store.dispatch('management/request', { url: '/v1-k3s-release/releases' }),\n        };\n\n        if (this.$store.getters['management/canList'](MANAGEMENT.PSA)) {\n          hash.allPSAs = await this.$store.dispatch('management/findAll', { type: MANAGEMENT.PSA });\n        }\n\n        // Get the latest versions from the global settings if possible\n        const globalSettings = await this.$store.getters['management/all'](MANAGEMENT.SETTING) || [];\n        const defaultRke2Setting = globalSettings.find((setting) => setting.id === 'rke2-default-version') || {};\n        const defaultK3sSetting = globalSettings.find((setting) => setting.id === 'k3s-default-version') || {};\n\n        let defaultRke2 = defaultRke2Setting?.value || defaultRke2Setting?.default;\n        let defaultK3s = defaultK3sSetting?.value || defaultK3sSetting?.default;\n\n        // RKE2: Use the channel if we can not get the version from the settings\n        if (!defaultRke2) {\n          hash.rke2Channels = this.$store.dispatch('management/request', { url: '/v1-rke2-release/channels' });\n        }\n\n        // K3S: Use the channel if we can not get the version from the settings\n        if (!defaultK3s) {\n          hash.k3sChannels = this.$store.dispatch('management/request', { url: '/v1-k3s-release/channels' });\n        }\n\n        const res = await allHash(hash);\n\n        this.allPSAs = res.allPSAs || [];\n        this.rke2Versions = res.rke2Versions.data || [];\n        this.k3sVersions = res.k3sVersions.data || [];\n\n        if (!defaultRke2) {\n          const rke2Channels = res.rke2Channels.data || [];\n\n          defaultRke2 = rke2Channels.find((x) => x.id === 'default')?.latest;\n        }\n\n        if (!defaultK3s) {\n          const k3sChannels = res.k3sChannels.data || [];\n\n          defaultK3s = k3sChannels.find((x) => x.id === 'default')?.latest;\n        }\n\n        if (!this.rke2Versions.length && !this.k3sVersions.length) {\n          throw new Error('No version info found in KDM');\n        }\n\n        // Store default versions\n        this.defaultRke2 = defaultRke2;\n        this.defaultK3s = defaultK3s;\n      }\n    },\n\n    cleanAgentConfiguration(model, key) {\n      if (!model || !model[key]) {\n        return;\n      }\n\n      const v = model[key];\n\n      if (Array.isArray(v) && v.length === 0) {\n        delete model[key];\n      } else if (v && typeof v === 'object') {\n        Object.keys(v).forEach((k) => {\n          // delete these auxiliary props used in podAffinity and nodeAffinity that shouldn't be sent to the server\n          if (k === '_namespaceOption' || k === '_namespaces' || k === '_anti' || k === '_id') {\n            delete v[k];\n          }\n\n          // prevent cleanup of \"namespaceSelector\" when an empty object because it represents all namespaces in pod/node affinity\n          // https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.25/#podaffinityterm-v1-core\n          if (k !== 'namespaceSelector') {\n            this.cleanAgentConfiguration(v, k);\n          }\n        });\n\n        if (Object.keys(v).length === 0) {\n          delete model[key];\n        }\n      }\n    },\n\n    /**\n     * Clean agent configuration objects, so we only send values when the user has configured something\n     */\n    agentConfigurationCleanup() {\n      this.cleanAgentConfiguration(this.value.spec, CLUSTER_AGENT_CUSTOMIZATION);\n      this.cleanAgentConfiguration(this.value.spec, FLEET_AGENT_CUSTOMIZATION);\n    },\n\n    /**\n     * Ensure we have empty models for the two agent configurations\n     */\n    setAgentConfiguration() {\n      // Cluster Agent Configuration\n      if (!this.value.spec[CLUSTER_AGENT_CUSTOMIZATION]) {\n        set(this.value.spec, CLUSTER_AGENT_CUSTOMIZATION, {});\n      }\n\n      // Fleet Agent Configuration\n      if (!this.value.spec[FLEET_AGENT_CUSTOMIZATION]) {\n        set(this.value.spec, FLEET_AGENT_CUSTOMIZATION, {});\n      }\n    },\n\n    /**\n     * set instanceNameLimit to 15 to all pool machine if truncateHostnames checkbox is clicked\n     */\n    truncateHostname(neu) {\n      if (neu) {\n        this.value.defaultHostnameLengthLimit = NETBIOS_TRUNCATION_LENGTH;\n        this.truncateLimit = NETBIOS_TRUNCATION_LENGTH;\n      } else {\n        this.truncateLimit = 0;\n        this.value.removeDefaultHostnameLengthLimit();\n      }\n    },\n\n    /**\n     * Get machine pools from the cluster configuration\n     * this.value.spec.rkeConfig.machinePools\n     */\n    async initMachinePools(existing) {\n      const out = [];\n\n      if (existing?.length) {\n        for (const pool of existing) {\n          let type;\n\n          if (this.isElementalCluster) {\n            type = ELEMENTAL_SCHEMA_IDS.MACHINE_INV_SELECTOR_TEMPLATES;\n          } else {\n            type = `${ CAPI.MACHINE_CONFIG_GROUP }.${ pool.machineConfigRef.kind.toLowerCase() }`;\n          }\n\n          let config;\n          let configMissing = false;\n\n          if (this.$store.getters['management/canList'](type)) {\n            try {\n              config = await this.$store.dispatch('management/find', {\n                type,\n                id: `${ this.value.metadata.namespace }/${ pool.machineConfigRef.name }`,\n              });\n            } catch (e) {\n              // Some users can't see the config, that's ok.\n              // we will display a banner for a 404 only for elemental\n              if (e?.status === 404) {\n                if (this.isElementalCluster) {\n                  configMissing = true;\n                }\n              }\n            }\n          }\n\n          // @TODO what if the pool is missing?\n          const id = `pool${ ++this.lastIdx }`;\n\n          out.push({\n            id,\n            remove: false,\n            create: false,\n            update: true,\n            pool:   clone(pool),\n            config: config ? await this.$store.dispatch('management/clone', { resource: config }) : null,\n            configMissing\n          });\n        }\n      }\n\n      this.machinePools = out;\n    },\n\n    async addMachinePool(idx) {\n      // this.machineConfigSchema is the schema for the Machine Pool's machine configuration for the given provider\n      if (!this.machineConfigSchema) {\n        return;\n      }\n\n      const numCurrentPools = this.machinePools.length || 0;\n\n      let config;\n\n      if (this.extensionProvider?.createMachinePoolMachineConfig) {\n        config = await this.extensionProvider.createMachinePoolMachineConfig(idx, this.machinePools, this.value);\n      } else {\n        // Default - use the schema\n        config = await this.$store.dispatch('management/createPopulated', {\n          type:     this.machineConfigSchema.id,\n          metadata: { namespace: DEFAULT_WORKSPACE }\n        });\n\n        // If there is no specific model, the applyDefaults does nothing by default\n        config.applyDefaults(idx, this.machinePools);\n      }\n\n      const name = `pool${ ++this.lastIdx }`;\n\n      const pool = {\n        id:     name,\n        config,\n        remove: false,\n        create: true,\n        update: false,\n        uid:    name,\n        pool:   {\n          name,\n          etcdRole:             numCurrentPools === 0,\n          controlPlaneRole:     numCurrentPools === 0,\n          workerRole:           true,\n          hostnamePrefix:       '',\n          labels:               {},\n          quantity:             1,\n          unhealthyNodeTimeout: '0m',\n          machineConfigRef:     {\n            kind: this.machineConfigSchema.attributes?.kind,\n            name: null,\n          },\n          drainBeforeDelete: true\n        },\n      };\n\n      if (this.provider === VMWARE_VSPHERE) {\n        pool.pool.machineOS = 'linux';\n      }\n\n      if (this.isElementalCluster) {\n        pool.pool.machineConfigRef.apiVersion = `${ this.machineConfigSchema.attributes.group }/${ this.machineConfigSchema.attributes.version }`;\n      }\n\n      this.machinePools.push(pool);\n\n      this.$nextTick(() => {\n        if (this.$refs.pools?.select) {\n          this.$refs.pools.select(name);\n        }\n      });\n    },\n\n    removeMachinePool(idx) {\n      const entry = this.machinePools[idx];\n\n      if (!entry) {\n        return;\n      }\n\n      if (entry.create) {\n        // If this is a new pool that isn't saved yet, it can just be dropped\n        removeObject(this.machinePools, entry);\n      } else {\n        // Mark for removal on save\n        entry.remove = true;\n      }\n    },\n\n    async syncMachineConfigWithLatest(machinePool) {\n      if (machinePool?.config?.id) {\n        // Use management/request instead of management/find to avoid overwriting the current machine pool in the store\n        const _latestConfig = await this.$store.dispatch('management/request', { url: `/v1/${ machinePool.config.type }s/${ machinePool.config.id }` });\n        const latestConfig = await this.$store.dispatch('management/create', _latestConfig);\n\n        const clonedCurrentConfig = await this.$store.dispatch('management/clone', { resource: machinePool.config });\n        const clonedLatestConfig = await this.$store.dispatch('management/clone', { resource: latestConfig });\n\n        // We don't allow the user to edit any of the fields in metadata from the UI so it's safe to override it with the\n        // metadata defined by the latest backend value. This is primarily used to ensure the resourceVersion is up to date.\n        delete clonedCurrentConfig.metadata;\n\n        if (this.provider === VMWARE_VSPHERE) {\n          machinePool.config = vspherePoolConfigMerge(clonedLatestConfig, clonedCurrentConfig);\n        } else {\n          machinePool.config = merge(clonedLatestConfig, clonedCurrentConfig);\n        }\n      }\n    },\n\n    async saveMachinePools(hookContext) {\n      if (hookContext === CONTEXT_HOOK_EDIT_YAML) {\n        await new Promise((resolve, reject) => {\n          this.$store.dispatch('cluster/promptModal', {\n            component:      'GenericPrompt',\n            componentProps: {\n              title:     this.t('cluster.rke2.modal.editYamlMachinePool.title'),\n              body:      this.t('cluster.rke2.modal.editYamlMachinePool.body'),\n              applyMode: 'editAndContinue',\n              confirm:   async(confirmed) => {\n                if (confirmed) {\n                  await this.validateMachinePool();\n\n                  if (this.errors.length) {\n                    reject(new Error('Machine Pool validation errors'));\n                  }\n\n                  resolve();\n                } else {\n                  reject(new Error('User Cancelled'));\n                }\n              }\n            },\n          });\n        });\n      }\n\n      const finalPools = [];\n\n      // If the extension provider wants to do this, let them\n      if (this.extensionProvider?.saveMachinePoolConfigs) {\n        return await this.extensionProvider.saveMachinePoolConfigs(this.machinePools, this.value);\n      }\n\n      for (const entry of this.machinePools) {\n        if (entry.remove) {\n          continue;\n        }\n\n        await this.syncMachineConfigWithLatest(entry);\n\n        // Capitals and such aren't allowed;\n        set(entry.pool, 'name', normalizeName(entry.pool.name) || 'pool');\n\n        const prefix = `${ this.value.metadata.name }-${ entry.pool.name }`.substr(0, 50).toLowerCase();\n\n        if (entry.create) {\n          if (!entry.config.metadata?.name) {\n            entry.config.metadata.generateName = `nc-${ prefix }-`;\n          }\n\n          const neu = await entry.config.save();\n\n          entry.config = neu;\n          entry.pool.machineConfigRef.name = neu.metadata.name;\n          entry.create = false;\n          entry.update = true;\n        } else if (entry.update) {\n          entry.config = await entry.config.save();\n        }\n\n        // Ensure Elemental clusters have a hostname prefix\n        if (this.isElementalCluster && !entry.pool.hostnamePrefix) {\n          entry.pool.hostnamePrefix = `${ prefix }-`;\n        }\n\n        finalPools.push(entry.pool);\n      }\n\n      this.value.spec.rkeConfig.machinePools = finalPools;\n    },\n\n    async cleanupMachinePools() {\n      for (const entry of this.machinePools) {\n        if (entry.remove && entry.config) {\n          try {\n            await entry.config.remove();\n          } catch (e) { }\n        }\n      }\n    },\n\n    async saveRoleBindings() {\n      await this.value.waitForMgmt();\n\n      if (this.membershipUpdate.save) {\n        await this.membershipUpdate.save(this.value.mgmt.id);\n      }\n    },\n\n    /**\n     * Ensure that all the existing node roles pool are at least 1 each\n     */\n    hasRequiredNodes() {\n      return this.nodeTotals?.color && Object.values(this.nodeTotals.color).every((color) => color !== NODE_TOTAL.error.color);\n    },\n\n    cancelCredential() {\n      if (this.$refs.cruresource) {\n        this.$refs.cruresource.emitOrRoute();\n      }\n    },\n\n    done() {\n      let routeName = 'c-cluster-product-resource';\n\n      if (this.mode === _CREATE && (this.provider === 'import' || this.provider === 'custom')) {\n        // Go show the registration command\n        routeName = 'c-cluster-product-resource-namespace-id';\n      }\n\n      this.$router.push({\n        name:   routeName,\n        params: {\n          cluster:   this.$route.params.cluster,\n          product:   this.$store.getters['productId'],\n          resource:  CAPI.RANCHER_CLUSTER,\n          namespace: this.value.metadata.namespace,\n          id:        this.value.metadata.name,\n        },\n      });\n    },\n\n    showAddonConfirmation() {\n      return new Promise((resolve, reject) => {\n        this.$store.dispatch('cluster/promptModal', {\n          component: 'AddonConfigConfirmationDialog',\n          resources: [(value) => resolve(value)]\n        });\n      });\n    },\n\n    // Set busy before save and clear after save\n    async saveOverride(btnCb) {\n      this.$set(this, 'busy', true);\n\n      // If the provider is from an extension, let it do the provision step\n      if (this.extensionProvider?.provision) {\n        const errors = await this.extensionProvider?.provision(this.value, this.machinePools);\n        const okay = (errors || []).length === 0;\n\n        this.errors = errors;\n        this.$set(this, 'busy', false);\n\n        btnCb(okay);\n\n        if (okay) {\n          // If saved okay, go to the done route\n          return this.done();\n        }\n      }\n\n      // Default save\n      return this._doSaveOverride((done) => {\n        this.$set(this, 'busy', false);\n\n        return btnCb(done);\n      });\n    },\n\n    async _doSaveOverride(btnCb) {\n      // We cannot use the hook, because it is triggered on YAML toggle without restore initialized data\n      this.agentConfigurationCleanup();\n\n      const isEditVersion = this.isEdit && this.liveValue?.spec?.kubernetesVersion !== this.value?.spec?.kubernetesVersion;\n\n      if (isEditVersion) {\n        const shouldContinue = await this.showAddonConfirmation();\n\n        if (!shouldContinue) {\n          return btnCb('cancelled');\n        }\n      }\n\n      this.validateClusterName();\n\n      await this.validateMachinePool();\n\n      if (this.errors.length) {\n        btnCb(false);\n\n        return;\n      }\n\n      try {\n        const clusterId = get(this.credential, 'decodedData.clusterId') || '';\n\n        this.applyChartValues(this.value.spec.rkeConfig);\n\n        const isUpgrade = this.isEdit && this.liveValue?.spec?.kubernetesVersion !== this.value?.spec?.kubernetesVersion;\n\n        if (this.agentConfig?.['cloud-provider-name'] === HARVESTER && clusterId && (this.isCreate || isUpgrade)) {\n          const namespace = this.machinePools?.[0]?.config?.vmNamespace;\n\n          const res = await this.$store.dispatch('management/request', {\n            url:    `/k8s/clusters/${ clusterId }/v1/harvester/kubeconfig`,\n            method: 'POST',\n            data:   {\n              csiClusterRoleName: 'harvesterhci.io:csi-driver',\n              clusterRoleName:    'harvesterhci.io:cloudprovider',\n              namespace,\n              serviceAccountName: this.value.metadata.name,\n            },\n          });\n\n          const kubeconfig = res.data;\n\n          const harvesterKubeconfigSecret = await this.createKubeconfigSecret(kubeconfig);\n\n          set(this.agentConfig, 'cloud-provider-config', `secret://fleet-default:${ harvesterKubeconfigSecret?.metadata?.name }`);\n\n          if (this.isCreate) {\n            set(this.chartValues, `${ HARVESTER_CLOUD_PROVIDER }.global.cattle.clusterName`, this.value.metadata.name);\n          }\n\n          const distroRoot = this.value?.spec?.rkeConfig?.dataDirectories?.k8sDistro?.length ? this.value?.spec?.rkeConfig?.dataDirectories?.k8sDistro : '/var/lib/rancher/rke2';\n\n          set(this.chartValues, `${ HARVESTER_CLOUD_PROVIDER }.cloudConfigPath`, `${ distroRoot }/etc/config-files/cloud-provider-config`);\n        }\n      } catch (err) {\n        this.errors.push(err);\n\n        btnCb(false);\n\n        return;\n      }\n\n      // Remove null profile on machineGlobalConfig - https://github.com/rancher/dashboard/issues/8480\n      if (this.value.spec?.rkeConfig?.machineGlobalConfig?.profile === null) {\n        delete this.value.spec.rkeConfig.machineGlobalConfig.profile;\n      }\n\n      // Store the current data for fleet and cluster agent so that we can re-apply it later if the save fails\n      // The cleanup occurs before save with agentConfigurationCleanup()\n      const clusterAgentDeploymentCustomization = this.value.spec[CLUSTER_AGENT_CUSTOMIZATION] ? JSON.parse(JSON.stringify(this.value.spec[CLUSTER_AGENT_CUSTOMIZATION])) : null;\n      const fleetAgentDeploymentCustomization = this.value.spec[FLEET_AGENT_CUSTOMIZATION] ? JSON.parse(JSON.stringify(this.value.spec[FLEET_AGENT_CUSTOMIZATION])) : null;\n\n      await this.save(btnCb);\n\n      // comes from createEditView mixin\n      // if there are any errors saving, restore the agent config data\n      if (this.errors?.length) {\n        // Ensure the agent configuration is set back to the values before we changed (cleaned) it\n        set(this.value.spec, CLUSTER_AGENT_CUSTOMIZATION, clusterAgentDeploymentCustomization);\n        set(this.value.spec, FLEET_AGENT_CUSTOMIZATION, fleetAgentDeploymentCustomization);\n      }\n    },\n\n    async actuallySave(url) {\n      if (this.extensionProvider?.saveCluster) {\n        return await this.extensionProvider?.saveCluster(this.value, this.schema);\n      }\n\n      if (this.isCreate) {\n        url = url || this.schema.linkFor('collection');\n        const res = await this.value.save({ url });\n\n        if (res) {\n          Object.assign(this.value, res);\n        }\n      } else {\n        await this.value.save();\n      }\n    },\n\n    // create a secret to reference the harvester cluster kubeconfig in rkeConfig\n    async createKubeconfigSecret(kubeconfig = '') {\n      const clusterName = this.value.metadata.name;\n      const secret = await this.$store.dispatch('management/create', {\n        type:     SECRET,\n        metadata: {\n          namespace: 'fleet-default', generateName: 'harvesterconfig', annotations: { [CAPI_ANNOTATIONS.SECRET_AUTH]: clusterName, [CAPI_ANNOTATIONS.SECRET_WILL_DELETE]: 'true' }\n        },\n        data: { credential: base64Encode(kubeconfig) }\n      });\n\n      return secret.save({ url: '/v1/secrets', method: 'POST' });\n    },\n\n    cancel() {\n      this.$router.push({\n        name:   'c-cluster-product-resource',\n        params: {\n          cluster:  this.$route.params.cluster,\n          product:  this.$store.getters['productId'],\n          resource: CAPI.RANCHER_CLUSTER,\n        },\n      });\n    },\n\n    /**\n     * Ensure all chart information required to show addons is available\n     *\n     * This basically means\n     * 1) That the full chart relating to the addon is fetched (which includes core chart, readme and values)\n     * 2) We're ready to cache any values the user provides for each addon\n     */\n    async initAddons() {\n      for (const chartName of this.addonNames) {\n        const entry = this.chartVersions[chartName];\n\n        // prevent fetching of addon config for 'none' CNI option\n        // https://github.com/rancher/dashboard/issues/10338\n        if (this.versionInfo[chartName] || chartName.includes('none')) {\n          continue;\n        }\n\n        try {\n          const res = await this.$store.dispatch('catalog/getVersionInfo', {\n            repoType:    'cluster',\n            repoName:    entry.repo,\n            chartName,\n            versionName: entry.version,\n          });\n\n          set(this.versionInfo, chartName, res);\n          const key = this.chartVersionKey(chartName);\n\n          if (!this.userChartValues[key]) {\n            this.userChartValues[key] = {};\n          }\n        } catch (e) {\n          console.error(`Failed to fetch or process chart info for ${ chartName }`); // eslint-disable-line no-console\n        }\n      }\n    },\n\n    showAddons(key) {\n      this.addonsRev++;\n      this.addonNames.forEach((name) => {\n        const chartValues = this.versionInfo[name]?.questions ? this.initYamlEditor(name) : {};\n\n        set(this.userChartValuesTemp, name, chartValues);\n      });\n      this.refreshComponentWithYamls(key);\n    },\n    refreshComponentWithYamls(key) {\n      const component = this.$refs[key];\n\n      if (component) {\n        this.refreshYamls(component.$refs);\n      }\n    },\n\n    refreshYamls(refs) {\n      const keys = Object.keys(refs).filter((x) => x.startsWith('yaml'));\n\n      for (const k of keys) {\n        const entry = refs[k];\n        const list = isArray(entry) ? entry : [entry];\n\n        for (const component of list) {\n          component?.refresh(); // `yaml` ref can be undefined on switching from Basic to Addon tab (Azure --> Amazon --> addon)\n        }\n      }\n    },\n\n    updateValues(name, values) {\n      set(this.userChartValuesTemp, name, values);\n      this.syncChartValues(name);\n    },\n\n    syncChartValues: throttle(function(name) {\n      const fromChart = this.versionInfo[name]?.values;\n      const fromUser = this.userChartValuesTemp[name];\n      const different = diff(fromChart, fromUser);\n\n      this.userChartValues[this.chartVersionKey(name)] = different;\n    }, 250, { leading: true }),\n\n    initYamlEditor(name) {\n      const defaultChartValue = this.versionInfo[name];\n      const key = this.chartVersionKey(name);\n\n      return merge({}, defaultChartValue?.values || {}, this.userChartValues[key] || {});\n    },\n\n    initServerAgentArgs() {\n      for (const k in this.serverArgs) {\n        if (this.serverConfig[k] === undefined) {\n          const def = this.serverArgs[k].default;\n\n          set(this.serverConfig, k, (def !== undefined ? def : undefined));\n        }\n      }\n\n      for (const k in this.agentArgs) {\n        if (this.agentConfig?.[k] === undefined) {\n          const def = this.agentArgs[k].default;\n\n          set(this.agentConfig, k, (def !== undefined ? def : undefined));\n        }\n      }\n\n      if (!this.serverConfig?.profile) {\n        set(this.serverConfig, 'profile', null);\n      }\n    },\n\n    chartVersionKey(name) {\n      const addonVersion = this.addonVersions.find((av) => av.name === name);\n\n      return addonVersion ? `${ name }-${ addonVersion.version }` : name;\n    },\n\n    onMembershipUpdate(update) {\n      this.$set(this, 'membershipUpdate', update);\n    },\n\n    async initRegistry() {\n      // Check for an existing cluster scoped registry\n      const clusterRegistry = this.agentConfig?.['system-default-registry'] || '';\n\n      // Check for the global registry\n      this.systemRegistry = (await this.$store.dispatch('management/find', { type: MANAGEMENT.SETTING, id: SETTING.SYSTEM_DEFAULT_REGISTRY })).value || '';\n\n      // The order of precedence is to use the cluster scoped registry\n      // if it exists, then use the global scoped registry as a fallback\n      if (clusterRegistry) {\n        this.registryHost = clusterRegistry;\n      } else {\n        this.registryHost = this.systemRegistry;\n      }\n\n      let registrySecret = null;\n      let regs = this.rkeConfig.registries;\n\n      if (!regs) {\n        regs = {};\n        set(this.rkeConfig, 'registries', regs);\n      }\n\n      if (!regs.configs) {\n        set(regs, 'configs', {});\n      }\n\n      if (!regs.mirrors) {\n        set(regs, 'mirrors', {});\n      }\n\n      const config = regs.configs[this.registryHost];\n\n      if (config) {\n        registrySecret = config.authConfigSecretName;\n      }\n\n      this.registrySecret = registrySecret;\n\n      const hasMirrorsOrAuthConfig = Object.keys(regs.configs).length > 0 || Object.keys(regs.mirrors).length > 0;\n\n      if (this.registryHost || registrySecret || hasMirrorsOrAuthConfig) {\n        this.showCustomRegistryInput = true;\n\n        if (hasMirrorsOrAuthConfig) {\n          this.showCustomRegistryAdvancedInput = true;\n        }\n      }\n    },\n\n    setRegistryConfig() {\n      const hostname = (this.registryHost || '').trim();\n\n      if (this.systemRegistry) {\n        // Empty string overrides the system default to nothing\n        set(this.agentConfig, 'system-default-registry', '');\n      } else {\n        // No need to set anything\n        set(this.agentConfig, 'system-default-registry', undefined);\n      }\n      if (!hostname || hostname === this.systemRegistry) {\n        // Undefined removes the key which uses the global setting without hardcoding it into the config\n        set(this.agentConfig, 'system-default-registry', undefined);\n      } else {\n        set(this.agentConfig, 'system-default-registry', hostname);\n      }\n\n      if (hostname && this.registrySecret) {\n        // For a registry with basic auth, but no mirrors,\n        // add a single registry config with the basic auth secret.\n        const basicAuthConfig = {\n          [hostname]: {\n            authConfigSecretName: this.registrySecret,\n            caBundle:             null,\n            insecureSkipVerify:   false,\n            tlsSecretName:        null,\n          }\n        };\n\n        const rkeConfig = this.value.spec.rkeConfig;\n\n        if (!rkeConfig) {\n          this.value.spec.rkeConfig = { registries: { configs: basicAuthConfig } };\n        } else if (rkeConfig.registries.configs && Object.keys(rkeConfig.registries.configs).length > 0) {\n          // If some existing authentication secrets are already configured\n          // for registry mirrors, the basic auth is added to the existing ones.\n          const existingConfigs = rkeConfig.registries.configs;\n\n          this.value.spec.rkeConfig.registries.configs = { ...basicAuthConfig, ...existingConfigs };\n        } else {\n          const existingMirrorAndAuthConfig = this.value.spec.rkeConfig.registries;\n\n          this.value.spec.rkeConfig.registries = {\n            ...existingMirrorAndAuthConfig,\n            configs: basicAuthConfig\n          };\n        }\n      }\n    },\n\n    updateConfigs(configs) {\n      // Update authentication configuration\n      // for each mirror\n      if (!this.value.spec?.rkeConfig) {\n        this.value.spec.rkeConfig = { registries: {} };\n      }\n      set(this.value.spec.rkeConfig.registries, 'configs', configs);\n    },\n\n    getAllOptionsAfterCurrentVersion(versions, currentVersion, defaultVersion) {\n      const out = (versions || []).filter((obj) => !!obj.serverArgs).map((obj) => {\n        let disabled = false;\n        let experimental = false;\n        let isCurrentVersion = false;\n        let label = obj.id;\n\n        if (currentVersion) {\n          disabled = compare(obj.id, currentVersion) < 0;\n          isCurrentVersion = compare(obj.id, currentVersion) === 0;\n        }\n\n        if (defaultVersion) {\n          experimental = compare(defaultVersion, obj.id) < 0;\n        }\n\n        if (isCurrentVersion) {\n          label = `${ label } ${ this.t('cluster.kubernetesVersion.current') }`;\n        }\n\n        if (experimental) {\n          label = `${ label } ${ this.t('cluster.kubernetesVersion.experimental') }`;\n        }\n\n        return {\n          label,\n          value:      obj.id,\n          sort:       sortable(obj.id),\n          serverArgs: obj.serverArgs,\n          agentArgs:  obj.agentArgs,\n          charts:     obj.charts,\n          disabled,\n        };\n      });\n\n      if (currentVersion && !out.find((obj) => obj.value === currentVersion)) {\n        out.push({\n          label: `${ currentVersion } ${ this.t('cluster.kubernetesVersion.current') }`,\n          value: currentVersion,\n          sort:  sortable(currentVersion),\n        });\n      }\n\n      const sorted = sortBy(out, 'sort:desc');\n\n      const mostRecentPatchVersions = this.getMostRecentPatchVersions(sorted);\n\n      const sortedWithDeprecatedLabel = sorted.map((optionData) => {\n        const majorMinor = `${ semver.major(optionData.value) }.${ semver.minor(optionData.value) }`;\n\n        if (mostRecentPatchVersions[majorMinor] === optionData.value) {\n          return optionData;\n        }\n\n        return {\n          ...optionData,\n          label: `${ optionData.label } ${ this.t('cluster.kubernetesVersion.deprecated') }`\n        };\n      });\n\n      return sortedWithDeprecatedLabel;\n    },\n\n    getMostRecentPatchVersions(sortedVersions) {\n      // Get the most recent patch version for each Kubernetes minor version.\n      const versionMap = {};\n\n      sortedVersions.forEach((version) => {\n        const majorMinor = `${ semver.major(version.value) }.${ semver.minor(version.value) }`;\n\n        if (!versionMap[majorMinor]) {\n          // Because we start with a sorted list of versions, we know the\n          // highest patch version is first in the list, so we only keep the\n          // first of each minor version in the list.\n          versionMap[majorMinor] = version.value;\n        }\n      });\n\n      return versionMap;\n    },\n\n    filterOutDeprecatedPatchVersions(allVersions, currentVersion) {\n      // Get the most recent patch version for each Kubernetes minor version.\n      const mostRecentPatchVersions = this.getMostRecentPatchVersions(allVersions);\n\n      const filteredVersions = allVersions.filter((version) => {\n        // Always show pre-releases\n        if (semver.prerelease(version.value)) {\n          return true;\n        }\n\n        const majorMinor = `${ semver.major(version.value) }.${ semver.minor(version.value) }`;\n\n        // Always show current version, else show if we haven't shown anything for this major.minor version yet\n        if (version.value === currentVersion || mostRecentPatchVersions[majorMinor] === version.value) {\n          return true;\n        }\n\n        return false;\n      });\n\n      return filteredVersions;\n    },\n\n    generateYaml() {\n      const resource = this.value;\n      const inStore = this.$store.getters['currentStore'](resource);\n      const schemas = this.$store.getters[`${ inStore }/all`](SCHEMA);\n      const clonedResource = clone(resource);\n\n      this.applyChartValues(clonedResource.spec.rkeConfig);\n\n      const out = createYaml(schemas, resource.type, clonedResource);\n\n      return out;\n    },\n\n    applyChartValues(rkeConfig) {\n      rkeConfig.chartValues = {};\n      this.addonNames.forEach((name) => {\n        const key = this.chartVersionKey(name);\n        const userValues = this.userChartValues[key];\n\n        if (userValues) {\n          set(rkeConfig.chartValues, name, userValues);\n        }\n      });\n    },\n    get,\n\n    setHarvesterDefaultCloudProvider() {\n      if (this.isHarvesterDriver &&\n        this.mode === _CREATE &&\n        this.agentConfig &&\n        !this.agentConfig['cloud-provider-name'] &&\n        !this.isHarvesterExternalCredential &&\n        !this.isHarvesterIncompatible\n      ) {\n        this.agentConfig['cloud-provider-name'] = HARVESTER;\n      } else {\n        this.agentConfig['cloud-provider-name'] = '';\n      }\n    },\n\n    async setHarvesterVersionRange() {\n      const clusterId = this.credential?.decodedData?.clusterId;\n      const clusterType = this.credential?.decodedData?.clusterType;\n\n      if (clusterId && clusterType === 'imported') {\n        const url = `/k8s/clusters/${ clusterId }/v1`;\n        const res = await this.$store.dispatch('cluster/request', { url: `${ url }/${ HCI.SETTING }s` });\n\n        const version = (res?.data || []).find((s) => s.id === 'harvester-csi-ccm-versions');\n\n        if (version) {\n          this.harvesterVersionRange = JSON.parse(version.value || version.default || '{}');\n        } else {\n          this.harvesterVersionRange = {};\n        }\n      }\n      this.setHarvesterDefaultCloudProvider();\n    },\n    toggleCustomRegistry(neu) {\n      this.showCustomRegistryInput = neu;\n      if (this.registryHost) {\n        this.registryHost = null;\n        this.registrySecret = null;\n      } else {\n        this.initRegistry();\n      }\n    },\n\n    /**\n     * Reset PSA on several input changes for given conditions\n     */\n    togglePsaDefault() {\n      // This option is created from the server and is guaranteed to exist #8032\n      const hardcodedTemplate = 'rancher-restricted';\n      const cisValue = this.agentConfig?.profile || this.serverConfig?.profile;\n\n      if (!this.cisOverride) {\n        if (cisValue) {\n          set(this.value.spec, 'defaultPodSecurityAdmissionConfigurationTemplateName', hardcodedTemplate);\n        }\n      }\n    },\n\n    handleCisChange() {\n      this.togglePsaDefault();\n      this.updateCisProfile();\n    },\n\n    updateCisProfile() {\n      // If the user selects any Worker CIS Profile,\n      // protect-kernel-defaults should be set to false\n      // in the RKE2 worker/agent config.\n      const selectedCisProfile = this.agentConfig?.profile;\n\n      if (selectedCisProfile) {\n        set(this.agentConfig, 'protect-kernel-defaults', true);\n      } else {\n        set(this.agentConfig, 'protect-kernel-defaults', false);\n      }\n    },\n    updateAdditionalManifest(neu) {\n      this.value.spec.rkeConfig.additionalManifest = neu;\n    },\n\n    /**\n     * Handle k8s changes side effects, like PSA resets\n     */\n    handleKubernetesChange(value, old) {\n      if (value) {\n        this.togglePsaDefault();\n\n        // If Harvester driver, reset cloud provider if not compatible\n        if (this.isHarvesterDriver && this.mode === _CREATE && this.isHarvesterIncompatible) {\n          this.setHarvesterDefaultCloudProvider();\n        }\n      }\n    },\n\n    handleShowDeprecatedPatchVersionsChanged(value) {\n      this.showDeprecatedPatchVersions = value;\n    },\n    /**\n     * Track Machine Pool validation status\n     */\n    machinePoolValidationChanged(id, value) {\n      if (value === undefined) {\n        this.$delete(this.machinePoolValidation, id);\n      } else {\n        this.$set(this.machinePoolValidation, id, value);\n      }\n    },\n    handleEnabledSystemServicesChanged(val) {\n      set(this.serverConfig, 'disable', val);\n    },\n\n    handleCiliumValuesChanged(neu) {\n      if (neu === undefined) {\n        return;\n      }\n\n      const name = this.chartVersionKey('rke2-cilium');\n\n      set(this, 'userChartValues', {\n        ...this.userChartValues,\n        [name]: { ...neu }\n      });\n    },\n\n    handleCisChanged() {\n      this.handleCisChange();\n    },\n    handlePsaDefaultChanged() {\n      this.togglePsaDefault();\n    },\n    handleMachinePoolError(error) {\n      this.machinePoolErrors = merge(this.machinePoolErrors, error);\n\n      const errors = Object.entries(this.machinePoolErrors)\n        .map((x) => {\n          if (!x[1].length) {\n            return;\n          }\n\n          const formattedFields = (() => {\n            switch (x[1].length) {\n            case 1:\n              return x[1][0];\n            case 2:\n              return `${ x[1][0] } and ${ x[1][1] }`;\n            default: {\n              const [head, ...rest] = x[1];\n\n              return `${ rest.join(', ') }, and ${ head }`;\n            }\n            }\n          })();\n\n          return this.t('cluster.banner.machinePoolError', {\n            count: x[1].length, pool_name: x[0], fields: formattedFields\n          }, true);\n        })\n        .filter((x) => x);\n\n      if (!errors) {\n        return;\n      }\n\n      this.errors = errors;\n    },\n    handleS3BackupChanged(neu) {\n      this.s3Backup = neu;\n      if (neu) {\n        // We need to make sure that s3 doesn't already have an existing value otherwise when editing a cluster with s3 defined this will clear s3.\n        if (isEmpty(this.rkeConfig.etcd?.s3)) {\n          set(this.rkeConfig.etcd, 's3', {});\n        }\n      } else {\n        set(this.rkeConfig.etcd, 's3', null);\n      }\n    },\n    handleConfigEtcdExposeMetricsChanged(neu) {\n      set(this.serverConfig, 'etcd-expose-metrics', neu);\n    },\n    handleRegistryHostChanged(neu) {\n      this.registryHost = neu;\n    },\n    handleRegistrySecretChanged(neu) {\n      this.registrySecret = neu;\n    },\n    validateClusterName() {\n      if (!this.value.metadata.name && this.agentConfig?.['cloud-provider-name'] === HARVESTER) {\n        this.errors.push(this.t('validation.required', { key: this.t('cluster.name.label') }, true));\n      }\n    },\n    async validateMachinePool() {\n      if (this.errors) {\n        clear(this.errors);\n      }\n      if (this.value.cloudProvider === 'aws') {\n        const missingProfileName = this.machinePools.some((mp) => !mp.config.iamInstanceProfile);\n\n        if (missingProfileName) {\n          this.errors.push(this.t('cluster.validation.iamInstanceProfileName', {}, true));\n        }\n      }\n\n      for (const [index] of this.machinePools.entries()) { // validator machine config\n        if (typeof this.$refs.pool[index]?.test === 'function') {\n          try {\n            const res = await this.$refs.pool[index].test();\n\n            if (Array.isArray(res) && res.length > 0) {\n              this.errors.push(...res);\n            }\n          } catch (e) {\n            this.errors.push(e);\n          }\n        }\n      }\n    }\n  }\n};\n</script>\n\n<template>\n  <Loading v-if=\"$fetchState.pending && !loadedOnce\" />\n  <Banner\n    v-else-if=\"$fetchState.error\"\n    color=\"error\"\n    :label=\"$fetchState.error\"\n  />\n  <CruResource\n    v-else\n    ref=\"cruresource\"\n    :mode=\"mode\"\n    :validation-passed=\"validationPassed && fvFormIsValid\"\n    :resource=\"value\"\n    :errors=\"errors\"\n    :cancel-event=\"true\"\n    :done-route=\"doneRoute\"\n    :apply-hooks=\"applyHooks\"\n    :generate-yaml=\"generateYaml\"\n    class=\"rke2\"\n    component-testid=\"rke2-custom-create\"\n    @done=\"done\"\n    @finish=\"saveOverride\"\n    @cancel=\"cancel\"\n    @error=\"e => errors = e\"\n  >\n    <div class=\"header-warnings\">\n      <Banner\n        v-if=\"isEdit\"\n        color=\"warning\"\n        data-testid=\"edit-cluster-reprovisioning-documentation\"\n      >\n        <span v-clean-html=\"t('cluster.banner.rke2-k3-reprovisioning', {}, true)\" />\n      </Banner>\n    </div>\n    <SelectCredential\n      v-if=\"needCredential\"\n      v-model=\"credentialId\"\n      :mode=\"mode\"\n      :provider=\"provider\"\n      :cancel=\"cancelCredential\"\n      :showing-form=\"showForm\"\n      :default-on-cancel=\"true\"\n      data-testid=\"select-credential\"\n      class=\"mt-20\"\n    />\n\n    <div\n      v-if=\"showForm\"\n      data-testid=\"form\"\n      class=\"mt-20\"\n    >\n      <NameNsDescription\n        v-if=\"!isView\"\n        v-model=\"value\"\n        :mode=\"mode\"\n        :namespaced=\"needsNamespace\"\n        :namespace-options=\"allNamespaces\"\n        name-label=\"cluster.name.label\"\n        name-placeholder=\"cluster.name.placeholder\"\n        description-label=\"cluster.description.label\"\n        description-placeholder=\"cluster.description.placeholder\"\n        :rules=\"{ name: fvGetAndReportPathRules('metadata.name') }\"\n      >\n        <template\n          slot=\"customize\"\n        >\n          <ClusterAppearance\n            :name=\"clusterName\"\n            :currentCluster=\"currentCluster\"\n            :mode=\"mode\"\n          />\n        </template>\n      </NameNsDescription>\n\n      <Banner\n        v-if=\"appsOSWarning\"\n        color=\"error\"\n      >\n        {{ appsOSWarning }}\n      </Banner>\n\n      <!-- Pools Extras -->\n      <template v-if=\"hasMachinePools\">\n        <div class=\"clearfix\">\n          <h2\n            v-t=\"'cluster.tabs.machinePools'\"\n            class=\"pull-left\"\n          />\n          <div\n            v-if=\"!isView\"\n            class=\"pull-right\"\n          >\n            <BadgeState\n              v-clean-tooltip=\"nodeTotals.tooltip.etcd\"\n              :color=\"nodeTotals.color.etcd\"\n              :icon=\"nodeTotals.icon.etcd\"\n              :label=\"nodeTotals.label.etcd\"\n              class=\"mr-10\"\n            />\n            <BadgeState\n              v-clean-tooltip=\"nodeTotals.tooltip.controlPlane\"\n              :color=\"nodeTotals.color.controlPlane\"\n              :icon=\"nodeTotals.icon.controlPlane\"\n              :label=\"nodeTotals.label.controlPlane\"\n              class=\"mr-10\"\n            />\n            <BadgeState\n              v-clean-tooltip=\"nodeTotals.tooltip.worker\"\n              :color=\"nodeTotals.color.worker\"\n              :icon=\"nodeTotals.icon.worker\"\n              :label=\"nodeTotals.label.worker\"\n            />\n          </div>\n        </div>\n\n        <!-- Extra Tabs for Machine Pool -->\n        <Tabbed\n          ref=\"pools\"\n          :side-tabs=\"true\"\n          :show-tabs-add-remove=\"!isView\"\n          @addTab=\"addMachinePool($event)\"\n          @removeTab=\"removeMachinePool($event)\"\n        >\n          <template v-for=\"(obj, idx) in machinePools\">\n            <Tab\n              v-if=\"!obj.remove\"\n              :key=\"obj.id\"\n              :name=\"obj.id\"\n              :label=\"obj.pool.name || '(Not Named)'\"\n              :show-header=\"false\"\n              :error=\"!machinePoolValidation[obj.id]\"\n            >\n              <MachinePool\n                ref=\"pool\"\n                :value=\"obj\"\n                :cluster=\"value\"\n                :mode=\"mode\"\n                :provider=\"provider\"\n                :credential-id=\"credentialId\"\n                :idx=\"idx\"\n                :machine-pools=\"machinePools\"\n                :busy=\"busy\"\n                :pool-id=\"obj.id\"\n                :pool-create-mode=\"obj.create\"\n                @error=\"handleMachinePoolError\"\n                @validationChanged=\"v => machinePoolValidationChanged(obj.id, v)\"\n              />\n            </Tab>\n          </template>\n          <div v-if=\"!unremovedMachinePools.length\">\n            {{ t('cluster.machinePool.noPoolsDisclaimer') }}\n          </div>\n        </Tabbed>\n        <div class=\"spacer\" />\n      </template>\n\n      <!-- Cluster Tabs -->\n      <h2 v-t=\"'cluster.tabs.cluster'\" />\n      <Tabbed\n        :side-tabs=\"true\"\n        class=\"min-height\"\n      >\n        <Tab\n          name=\"basic\"\n          label-key=\"cluster.tabs.basic\"\n          :weight=\"11\"\n          @active=\"refreshComponentWithYamls('tab-Basics')\"\n        >\n          <!-- Basic -->\n          <Basics\n            ref=\"tab-Basics\"\n            v-model=\"value\"\n            :live-value=\"liveValue\"\n            :mode=\"mode\"\n            :provider=\"provider\"\n            :user-chart-values=\"userChartValues\"\n            :credential=\"credential\"\n            :cis-override=\"cisOverride\"\n            :all-psas=\"allPSAs\"\n            :addon-versions=\"addonVersions\"\n            :show-deprecated-patch-versions=\"showDeprecatedPatchVersions\"\n            :selected-version=\"selectedVersion\"\n            :is-harvester-driver=\"isHarvesterDriver\"\n            :is-harvester-incompatible=\"isHarvesterIncompatible\"\n            :version-options=\"versionOptions\"\n            :is-elemental-cluster=\"isElementalCluster\"\n            :have-arg-info=\"haveArgInfo\"\n            :show-cni=\"showCni\"\n            :show-cloud-provider=\"showCloudProvider\"\n            :cloud-provider-options=\"cloudProviderOptions\"\n            @cilium-values-changed=\"handleCiliumValuesChanged\"\n            @enabled-system-services-changed=\"handleEnabledSystemServicesChanged\"\n            @kubernetes-changed=\"handleKubernetesChange\"\n            @cis-changed=\"handleCisChanged\"\n            @psa-default-changed=\"handlePsaDefaultChanged\"\n            @show-deprecated-patch-versions-changed=\"handleShowDeprecatedPatchVersionsChanged\"\n          />\n        </Tab>\n\n        <!-- Member Roles -->\n        <Tab\n          v-if=\"canManageMembers\"\n          name=\"memberRoles\"\n          label-key=\"cluster.tabs.memberRoles\"\n          :weight=\"10\"\n        >\n          <MemberRoles\n            v-model=\"value\"\n            :mode=\"mode\"\n            :on-membership-update=\"onMembershipUpdate\"\n          />\n        </Tab>\n        <!-- etcd -->\n        <Tab\n          name=\"etcd\"\n          label-key=\"cluster.tabs.etcd\"\n        >\n          <Etcd\n            v-model=\"value\"\n            :mode=\"mode\"\n            :s3-backup=\"s3Backup\"\n            :register-before-hook=\"registerBeforeHook\"\n            :selected-version=\"selectedVersion\"\n            @s3-backup-changed=\"handleS3BackupChanged\"\n            @config-etcd-expose-metrics-changed=\"handleConfigEtcdExposeMetricsChanged\"\n          />\n        </Tab>\n\n        <!-- Networking -->\n        <Tab\n          v-if=\"haveArgInfo\"\n          name=\"networking\"\n          label-key=\"cluster.tabs.networking\"\n        >\n          <Networking\n            v-model=\"value\"\n            :mode=\"mode\"\n            :selected-version=\"selectedVersion\"\n            :truncate-limit=\"truncateLimit\"\n            @truncate-hostname=\"truncateHostname\"\n          />\n        </Tab>\n\n        <!-- Upgrade -->\n        <Tab\n          name=\"upgrade\"\n          label-key=\"cluster.tabs.upgrade\"\n        >\n          <Upgrade\n            v-model=\"value\"\n            :mode=\"mode\"\n          />\n        </Tab>\n\n        <!-- Registries -->\n        <Tab\n          name=\"registry\"\n          label-key=\"cluster.tabs.registry\"\n        >\n          <Registries\n            v-model=\"value\"\n            :mode=\"mode\"\n            :register-before-hook=\"registerBeforeHook\"\n            :show-custom-registry-input=\"showCustomRegistryInput\"\n            :registry-host=\"registryHost\"\n            :registry-secret=\"registrySecret\"\n            :show-custom-registry-advanced-input=\"showCustomRegistryAdvancedInput\"\n            @update-configs-changed=\"updateConfigs\"\n            @custom-registry-changed=\"toggleCustomRegistry\"\n            @registry-host-changed=\"handleRegistryHostChanged\"\n            @registry-secret-changed=\"handleRegistrySecretChanged\"\n          />\n        </Tab>\n\n        <!-- Add-on Config -->\n        <Tab\n          name=\"addons\"\n          label-key=\"cluster.tabs.addons\"\n          @active=\"showAddons('tab-addOnConfig')\"\n        >\n          <AddOnConfig\n            ref=\"tab-addOnConfig\"\n            v-model=\"value\"\n            :mode=\"mode\"\n            :version-info=\"versionInfo\"\n            :addon-versions=\"addonVersions\"\n            :addons-rev=\"addonsRev\"\n            :user-chart-values-temp=\"userChartValuesTemp\"\n            :init-yaml-editor=\"initYamlEditor\"\n            @update-questions=\"syncChartValues\"\n            @update-values=\"updateValues\"\n            @additional-manifest-changed=\"updateAdditionalManifest\"\n          />\n        </Tab>\n\n        <!-- Cluster Agent Configuration -->\n        <Tab\n          name=\"clusteragentconfig\"\n          label-key=\"cluster.agentConfig.tabs.cluster\"\n        >\n          <AgentConfiguration\n            v-if=\"value.spec.clusterAgentDeploymentCustomization\"\n            v-model=\"value.spec.clusterAgentDeploymentCustomization\"\n            data-testid=\"rke2-cluster-agent-config\"\n            type=\"cluster\"\n            :mode=\"mode\"\n          />\n        </Tab>\n\n        <!-- Fleet Agent Configuration -->\n        <Tab\n          name=\"fleetagentconfig\"\n          label-key=\"cluster.agentConfig.tabs.fleet\"\n        >\n          <AgentConfiguration\n            v-if=\"value.spec.fleetAgentDeploymentCustomization\"\n            v-model=\"value.spec.fleetAgentDeploymentCustomization\"\n            data-testid=\"rke2-fleet-agent-config\"\n            type=\"fleet\"\n            :mode=\"mode\"\n          />\n        </Tab>\n\n        <!-- Advanced -->\n        <Tab\n          v-if=\"haveArgInfo || agentArgs['protect-kernel-defaults']\"\n          name=\"advanced\"\n          label-key=\"cluster.tabs.advanced\"\n          :weight=\"-1\"\n        >\n          <Advanced\n            v-model=\"value\"\n            :mode=\"mode\"\n            :have-arg-info=\"haveArgInfo\"\n            :selected-version=\"selectedVersion\"\n          />\n        </Tab>\n\n        <AgentEnv\n          v-model=\"value\"\n          :mode=\"mode\"\n        />\n        <Labels\n          v-model=\"value\"\n          :mode=\"mode\"\n        />\n\n        <!-- Extension tabs -->\n        <Tab\n          v-for=\"tab, i in extensionTabs\"\n          :key=\"`${tab.name}${i}`\"\n          :name=\"tab.name\"\n          :label=\"tab.label\"\n          :label-key=\"tab.labelKey\"\n          :weight=\"tab.weight\"\n          :tooltip=\"tab.tooltip\"\n          :show-header=\"tab.showHeader\"\n          :display-alert-icon=\"tab.displayAlertIcon\"\n          :error=\"tab.error\"\n          :badge=\"tab.badge\"\n        >\n          <component\n            :is=\"tab.component\"\n            :resource=\"value\"\n          />\n        </Tab>\n      </Tabbed>\n    </div>\n\n    <Banner\n      v-if=\"unsupportedSelectorConfig\"\n      color=\"warning\"\n      :label=\"t('cluster.banner.warning')\"\n    />\n\n    <template\n      v-if=\"needCredential && !credentialId\"\n      #form-footer\n    >\n      <div><!-- Hide the outer footer --></div>\n    </template>\n  </CruResource>\n</template>\n\n<style lang=\"scss\" scoped>\n.min-height {\n  min-height: 40em;\n}\n\n.patch-version {\n  margin-top: 5px;\n}\n\n.header-warnings .banner {\n  margin-bottom: 0;\n}\n</style>\n"]}]}