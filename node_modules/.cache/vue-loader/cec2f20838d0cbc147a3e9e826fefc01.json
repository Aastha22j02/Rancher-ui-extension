{"remainingRequest":"/home/ubuntu/susecon-2024-ext-demo/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ubuntu/susecon-2024-ext-demo/node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster/index.vue","mtime":1725271280091},{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/babel-loader/lib/index.js","mtime":1725271298942},{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1725271300920}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBDcmVhdGVFZGl0VmlldyBmcm9tICdAc2hlbGwvbWl4aW5zL2NyZWF0ZS1lZGl0LXZpZXcnOwppbXBvcnQgTG9hZGluZyBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9Mb2FkaW5nJzsKaW1wb3J0IENydVJlc291cmNlIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL0NydVJlc291cmNlJzsKaW1wb3J0IFNlbGVjdEljb25HcmlkIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL1NlbGVjdEljb25HcmlkJzsKaW1wb3J0IEVtYmVyUGFnZSBmcm9tICdAc2hlbGwvY29tcG9uZW50cy9FbWJlclBhZ2UnOwppbXBvcnQgeyBUb2dnbGVTd2l0Y2ggfSBmcm9tICdAY29tcG9uZW50cy9Gb3JtL1RvZ2dsZVN3aXRjaCc7CmltcG9ydCB7CiAgQ0hBUlQsIEZST01fQ0xVU1RFUiwgU1VCX1RZUEUsIFJLRV9UWVBFLCBfRURJVCwgX0lNUE9SVCwgX0NPTkZJRywgX1ZJRVcKfSBmcm9tICdAc2hlbGwvY29uZmlnL3F1ZXJ5LXBhcmFtcyc7CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JzsKaW1wb3J0IHsgc29ydEJ5IH0gZnJvbSAnQHNoZWxsL3V0aWxzL3NvcnQnOwppbXBvcnQgeyBzZXQgfSBmcm9tICdAc2hlbGwvdXRpbHMvb2JqZWN0JzsKaW1wb3J0IHsgUFJPVklTSU9ORVIsIF9SS0UxLCBfUktFMiB9IGZyb20gJ0BzaGVsbC9zdG9yZS9wcmVmcyc7CmltcG9ydCB7IGZpbHRlckFuZEFycmFuZ2VDaGFydHMgfSBmcm9tICdAc2hlbGwvc3RvcmUvY2F0YWxvZyc7CmltcG9ydCB7IENBVEFMT0cgfSBmcm9tICdAc2hlbGwvY29uZmlnL2xhYmVscy1hbm5vdGF0aW9ucyc7CmltcG9ydCB7IENBUEksIE1BTkFHRU1FTlQsIERFRkFVTFRfV09SS1NQQUNFIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy90eXBlcyc7CmltcG9ydCB7IG1hcEZlYXR1cmUsIFJLRTIgYXMgUktFMl9GRUFUVVJFLCBSS0UxX1VJIH0gZnJvbSAnQHNoZWxsL3N0b3JlL2ZlYXR1cmVzJzsKaW1wb3J0IHsgYWxsSGFzaCB9IGZyb20gJ0BzaGVsbC91dGlscy9wcm9taXNlJzsKaW1wb3J0IHsgQkxBTktfQ0xVU1RFUiB9IGZyb20gJ0BzaGVsbC9zdG9yZS9zdG9yZS10eXBlcy5qcyc7CmltcG9ydCB7IEVMRU1FTlRBTF9QUk9EVUNUX05BTUUsIEVMRU1FTlRBTF9DTFVTVEVSX1BST1ZJREVSIH0gZnJvbSAnLi4vLi4vY29uZmlnL2VsZW1lbnRhbC10eXBlcyc7CmltcG9ydCBSa2UyQ29uZmlnIGZyb20gJy4vcmtlMic7CmltcG9ydCBJbXBvcnQgZnJvbSAnLi9pbXBvcnQnOwoKY29uc3QgU09SVF9HUk9VUFMgPSB7CiAgdGVtcGxhdGU6ICAxLAogIGtvbnRhaW5lcjogMiwKICBya2UxOiAgICAgIDMsCiAgcmtlMjogICAgICAzLAogIHJlZ2lzdGVyOiAgNCwKICBjdXN0b206ICAgIDUsCiAgY3VzdG9tMTogICA1LAogIGN1c3RvbTI6ICAgNSwKfTsKCi8vIHVTZWQgdG8gcHJveHkgc3R5bGVzaGVldHMgZm9yIGN1c3RvbSBkcml2ZXJzIHRoYXQgcHJvdmlkZSBjdXN0b20gVUkgKFJLRTEpCmNvbnN0IFBST1hZX0VORFBPSU5UID0gJy9tZXRhL3Byb3h5JzsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnQ3J1Q2x1c3RlcicsCgogIGNvbXBvbmVudHM6IHsKICAgIENydVJlc291cmNlLAogICAgRW1iZXJQYWdlLAogICAgSW1wb3J0LAogICAgTG9hZGluZywKICAgIFJrZTJDb25maWcsCiAgICBTZWxlY3RJY29uR3JpZCwKICAgIFRvZ2dsZVN3aXRjaAogIH0sCgogIG1peGluczogW0NyZWF0ZUVkaXRWaWV3XSwKCiAgcHJvcHM6IHsKICAgIHJlYWxNb2RlOiB7CiAgICAgIHR5cGU6ICAgICBTdHJpbmcsCiAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgfSwKCiAgICBtb2RlOiB7CiAgICAgIHR5cGU6ICAgICBTdHJpbmcsCiAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgfSwKCiAgICB2YWx1ZTogewogICAgICB0eXBlOiAgICBPYmplY3QsCiAgICAgIGRlZmF1bHQ6IG51bGwsCiAgICB9LAoKICAgIC8qKgogICAgICogSW5oZXJpdGVkIGdsb2JhbCBpZGVudGlmaWVyIHByZWZpeCBmb3IgdGVzdHMKICAgICAqIERlZmluZSBhIHRlcm0gYmFzZWQgb24gdGhlIHBhcmVudCBjb21wb25lbnQgdG8gYXZvaWQgY29uZmxpY3RzIG9uIG11bHRpcGxlIGNvbXBvbmVudHMKICAgICAqLwogICAgY29tcG9uZW50VGVzdGlkOiB7CiAgICAgIHR5cGU6ICAgIFN0cmluZywKICAgICAgZGVmYXVsdDogJ2NsdXN0ZXItbWFuYWdlci1jcmVhdGUnCiAgICB9CiAgfSwKCiAgYXN5bmMgZmV0Y2goKSB7CiAgICBjb25zdCBoYXNoID0gewogICAgICAvLyBUaGVzZSBhcmVuJ3QgZXhwbGljaXRseSB1c2VkLCBidXQgbmVlZCB0byBiZSBsaXN0ZW5pbmcgZm9yIGNoYW5nZSBldmVudHMKICAgICAgbWdtdENsdXN0ZXJzOiB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9maW5kQWxsJywgeyB0eXBlOiBNQU5BR0VNRU5ULkNMVVNURVIgfSksCiAgICAgIHByb3ZDbHVzdGVyczogdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZEFsbCcsIHsgdHlwZTogQ0FQSS5SQU5DSEVSX0NMVVNURVIgfSksCgogICAgICBjYXRhbG9nOiB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnY2F0YWxvZy9sb2FkJyksCiAgICB9OwoKICAgIGlmICh0aGlzLiRzdG9yZS5nZXR0ZXJzW2BtYW5hZ2VtZW50L2Nhbkxpc3RgXShNQU5BR0VNRU5ULk5PREVfRFJJVkVSKSkgewogICAgICBoYXNoLm5vZGVEcml2ZXJzID0gdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZEFsbCcsIHsgdHlwZTogTUFOQUdFTUVOVC5OT0RFX0RSSVZFUiB9KTsKICAgIH0KCiAgICBpZiAodGhpcy4kc3RvcmUuZ2V0dGVyc1tgbWFuYWdlbWVudC9jYW5MaXN0YF0oTUFOQUdFTUVOVC5LT05UQUlORVJfRFJJVkVSKSkgewogICAgICBoYXNoLmtvbnRhaW5lckRyaXZlcnMgPSB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9maW5kQWxsJywgeyB0eXBlOiBNQU5BR0VNRU5ULktPTlRBSU5FUl9EUklWRVIgfSk7CiAgICB9CgogICAgaWYgKCB0aGlzLnZhbHVlLmlkICYmICF0aGlzLnZhbHVlLmlzUmtlMiApIHsKICAgICAgLy8gVGhlc2UgYXJlIG5lZWRlZCB0byByZXNvbHZlIHJlZmVyZW5jZXMgaW4gdGhlIG1nbXQgY2x1c3RlciAtPiBub2RlIHBvb2wgLT4gbm9kZSB0ZW1wbGF0ZSB0byBmaWd1cmUgb3V0IHdoYXQgcHJvdmlkZXIgdGhlIGNsdXN0ZXIgaXMgdXNpbmcKICAgICAgLy8gc28gdGhhdCB0aGUgZWRpdCBpZnJhbWUgZm9yIGVtYmVyIHBhZ2VzIGNhbiBnbyB0byB0aGUgcmlnaHQgcGxhY2UuCiAgICAgIGlmICh0aGlzLiRzdG9yZS5nZXR0ZXJzW2BtYW5hZ2VtZW50L2Nhbkxpc3RgXShNQU5BR0VNRU5ULk5PREVfUE9PTCkpIHsKICAgICAgICBoYXNoLnJrZTFOb2RlUG9vbHMgPSB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9maW5kQWxsJywgeyB0eXBlOiBNQU5BR0VNRU5ULk5PREVfUE9PTCB9KTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuJHN0b3JlLmdldHRlcnNbYG1hbmFnZW1lbnQvY2FuTGlzdGBdKE1BTkFHRU1FTlQuTk9ERV9URU1QTEFURSkpIHsKICAgICAgICBoYXNoLnJrZTFOb2RlVGVtcGxhdGVzID0gdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21hbmFnZW1lbnQvZmluZEFsbCcsIHsgdHlwZTogTUFOQUdFTUVOVC5OT0RFX1RFTVBMQVRFIH0pOwogICAgICB9CiAgICB9CgogICAgY29uc3QgcmVzID0gYXdhaXQgYWxsSGFzaChoYXNoKTsKCiAgICB0aGlzLm5vZGVEcml2ZXJzID0gcmVzLm5vZGVEcml2ZXJzIHx8IFtdOwogICAgdGhpcy5rb250YWluZXJEcml2ZXJzID0gcmVzLmtvbnRhaW5lckRyaXZlcnMgfHwgW107CgogICAgaWYgKCAhdGhpcy52YWx1ZS5zcGVjICkgewogICAgICBzZXQodGhpcy52YWx1ZSwgJ3NwZWMnLCB7fSk7CiAgICB9CgogICAgaWYgKCAhdGhpcy52YWx1ZS5pZCApIHsKICAgICAgaWYgKCAhdGhpcy52YWx1ZS5tZXRhZGF0YSApIHsKICAgICAgICBzZXQodGhpcy52YWx1ZSwgJ21ldGFkYXRhJywge30pOwogICAgICB9CgogICAgICBzZXQodGhpcy52YWx1ZS5tZXRhZGF0YSwgJ25hbWVzcGFjZScsIERFRkFVTFRfV09SS1NQQUNFKTsKICAgIH0KCiAgICAvLyBGb3IgdGhlIG5vZGUgZHJpdmVycywgbG9vayBmb3IgY3VzdG9tIFVJIHRoYXQgd2UgY2FuIHVzZSB0byBzaG93IGFuIGljb24gKGlmIG5vdCBidWlsdC1pbikKICAgIHRoaXMubm9kZURyaXZlcnMuZm9yRWFjaCgoZHJpdmVyKSA9PiB7CiAgICAgIGlmICghZHJpdmVyLnNwZWM/LmJ1aWx0aW4gJiYgZHJpdmVyLnNwZWM/LnVpVXJsICYmIGRyaXZlci5zcGVjPy5hY3RpdmUpIHsKICAgICAgICBjb25zdCBuYW1lID0gZHJpdmVyLnNwZWM/LmRpc3BsYXlOYW1lIHx8IGRyaXZlci5pZDsKICAgICAgICBsZXQgY3NzVXJsID0gZHJpdmVyLnNwZWMudWlVcmwucmVwbGFjZSgvXC5qcyQvLCAnLmNzcycpOwoKICAgICAgICBpZiAoY3NzVXJsLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBjc3NVcmwuc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkgewogICAgICAgICAgY3NzVXJsID0gYCR7IFBST1hZX0VORFBPSU5UIH0vJHsgY3NzVXJsIH1gOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5sb2FkU3R5bGVzaGVldChjc3NVcmwsIGBkcml2ZXItdWktY3NzLSR7IGRyaXZlci5pZCB9YCk7CgogICAgICAgIHRoaXMuaWNvbkNsYXNzZXNbbmFtZV0gPSBgbWFjaGluZS1kcml2ZXIgJHsgbmFtZSB9YDsKICAgICAgfQogICAgfSk7CgogICAgLy8gQ3VzdG9tIFByb3ZpZGVycyBmcm9tIGV4dGVuc2lvbnMgLSBpbml0aWFsaXplIGVhY2ggd2l0aCB0aGUgc3RvcmUgYW5kIHRoZSBpMThuIHNlcnZpY2UKICAgIC8vIFdyYXAgaW4gdHJ5IC4uLiBjYXRjaCwgdG8gcHJldmVudCBlcnJvcnMgaW4gYW4gZXh0ZW5zaW9uIGJyZWFraW5nIHRoZSBwYWdlCiAgICB0cnkgewogICAgICBjb25zdCBleHRlbnNpb25DbGFzc2VzID0gdGhpcy4kcGx1Z2luLmxpc3REeW5hbWljKCdwcm92aXNpb25lcicpLm1hcCgobmFtZSkgPT4gdGhpcy4kcGx1Z2luLmdldER5bmFtaWMoJ3Byb3Zpc2lvbmVyJywgbmFtZSkpOwoKICAgICAgLy8gV2UgY2FuJ3QgcGFzcyBpbiB0aGlzLiRzdG9yZSBhcyB0aGlzIGxlYWRzIHRvIGEgY2lyY3VsYXItcmVmZXJlbmNlIHRoYXQgY2F1c2VzIFZ1ZSB0byBmcmVlemUsCiAgICAgIC8vIHNvIHBhc3MgaW4gc3BlY2lmaWMgc2VydmljZXMgdGhhdCB0aGUgcHJvdmlzaW9uZXIgZXh0ZW5zaW9uIG1heSBuZWVkCiAgICAgIHRoaXMuZXh0ZW5zaW9ucyA9IGV4dGVuc2lvbkNsYXNzZXMubWFwKChjKSA9PiBuZXcgYyh7CiAgICAgICAgZGlzcGF0Y2g6IHRoaXMuJHN0b3JlLmRpc3BhdGNoLAogICAgICAgIGdldHRlcnM6ICB0aGlzLiRzdG9yZS5nZXR0ZXJzLAogICAgICAgIGF4aW9zOiAgICB0aGlzLiRzdG9yZS4kYXhpb3MsCiAgICAgICAgJHBsdWdpbjogIHRoaXMuJHN0b3JlLmFwcC4kcGx1Z2luLAogICAgICAgIHQ6ICAgICAgICAoLi4uYXJncykgPT4gdGhpcy50LmFwcGx5KHRoaXMsIGFyZ3MpLAogICAgICAgIGlzQ3JlYXRlOiB0aGlzLmlzQ3JlYXRlLAogICAgICAgIGlzRWRpdDogICB0aGlzLmlzRWRpdCwKICAgICAgICBpc1ZpZXc6ICAgdGhpcy5pc1ZpZXcsCiAgICAgIH0pKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgbG9hZGluZyBwcm92aXNpb25lcihzKSBmcm9tIGV4dGVuc2lvbnMnLCBlKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCiAgICB9CiAgfSwKCiAgZGF0YSgpIHsKICAgIGNvbnN0IHN1YlR5cGUgPSB0aGlzLiRyb3V0ZS5xdWVyeVtTVUJfVFlQRV0gfHwgbnVsbDsKICAgIGNvbnN0IHJrZVR5cGUgPSB0aGlzLiRyb3V0ZS5xdWVyeVtSS0VfVFlQRV0gfHwgbnVsbDsKICAgIGNvbnN0IGNoYXJ0ID0gdGhpcy4kcm91dGUucXVlcnlbQ0hBUlRdIHx8IG51bGw7CiAgICBjb25zdCBpc0ltcG9ydCA9IHRoaXMucmVhbE1vZGUgPT09IF9JTVBPUlQ7CgogICAgcmV0dXJuIHsKICAgICAgbm9kZURyaXZlcnM6ICAgICAgW10sCiAgICAgIGtvbnRhaW5lckRyaXZlcnM6IFtdLAogICAgICBleHRlbnNpb25zOiAgICAgICBbXSwKICAgICAgc3ViVHlwZSwKICAgICAgcmtlVHlwZSwKICAgICAgY2hhcnQsCiAgICAgIGlzSW1wb3J0LAogICAgICBwcm92aWRlckNsdXN0ZXI6ICBudWxsLAogICAgICBpY29uQ2xhc3NlczogICAgICB7fSwKICAgIH07CiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcEdldHRlcnMoeyBhbGxDaGFydHM6ICdjYXRhbG9nL2NoYXJ0cycgfSksCiAgICAuLi5tYXBHZXR0ZXJzKCd0eXBlLW1hcCcsIFsnYWN0aXZlUHJvZHVjdHMnXSksCiAgICAvLyBuZWVkZWQgdG8gcmVjcmVhdGUgbG9naWMgb24gbWFwUHJlZiBpbiBvcmRlciB0byBpbmNvcnBvcmF0ZSB0aGUgbG9naWMgYXJvdW5kIHRoZSBya2VUeXBlIHF1ZXJ5IHBhcmFtCiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vcmFuY2hlci9kYXNoYm9hcmQvaXNzdWVzLzYyOTkKICAgIHByZWZlcnJlZFByb3Zpc2lvbmVyOiB7CiAgICAgIGdldCgpIHsKICAgICAgICBpZiAodGhpcy5ya2VUeXBlKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5ya2VUeXBlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLmdldHRlcnNbJ3ByZWZzL2dldCddKFBST1ZJU0lPTkVSKTsKICAgICAgfSwKICAgICAgc2V0KHZhbHVlKSB7CiAgICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3ByZWZzL3NldCcsIHsga2V5OiBQUk9WSVNJT05FUiwgdmFsdWUgfSk7CiAgICAgIH0KICAgIH0sCiAgICBfUktFMTogKCkgPT4gX1JLRTEsCiAgICBfUktFMjogKCkgPT4gX1JLRTIsCgogICAgZW1iZXJMaW5rKCkgewogICAgICBpZiAodGhpcy52YWx1ZSkgewogICAgICAgIGlmICh0aGlzLnZhbHVlLnByb3Zpc2lvbmVyKSB7CiAgICAgICAgICBjb25zdCBtYXRjaGluZ1N1YnR5cGUgPSB0aGlzLnN1YlR5cGVzLmZpbmQoKHN0KSA9PiBzdC5pZC50b0xvd2VyQ2FzZSgpID09PSB0aGlzLnZhbHVlLnByb3Zpc2lvbmVyLnRvTG93ZXJDYXNlKCkpOwoKICAgICAgICAgIGlmIChtYXRjaGluZ1N1YnR5cGUpIHsKICAgICAgICAgICAgdGhpcy5zZWxlY3RUeXBlKG1hdGNoaW5nU3VidHlwZS5pZCwgZmFsc2UpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBGb3IgY3VzdG9tIFJLRTIgY2x1c3RlcnMsIGRvbid0IGxvYWQgYW4gRW1iZXIgcGFnZS4KICAgICAgICAvLyBJdCBzaG91bGQgYmUgdGhlIGRhc2hib2FyZC4KICAgICAgICBpZiAoIHRoaXMudmFsdWUuaXNSa2UyICYmICgodGhpcy52YWx1ZS5pc0N1c3RvbSAmJiB0aGlzLm1vZGUgPT09IF9FRElUKSB8fCAodGhpcy52YWx1ZS5pc0N1c3RvbSAmJiB0aGlzLmFzID09PSBfQ09ORklHICYmIHRoaXMubW9kZSA9PT0gX1ZJRVcpIHx8ICh0aGlzLnN1YlR5cGUgfHwgJycpLnRvTG93ZXJDYXNlKCkgPT09ICdjdXN0b20nKSkgewogICAgICAgICAgLy8gRm9yIGFkbWlucywgdGhpcy52YWx1ZS5pc0N1c3RvbSBpcyB1c2VkIHRvIGNoZWNrIGlmIGl0IGlzIGEgY3VzdG9tIGNsdXN0ZXIuCiAgICAgICAgICAvLyBGb3IgY2x1c3RlciBvd25lcnMsIHRoaXMuc3VidHlwZSBpcyB1c2VkLgogICAgICAgICAgdGhpcy5zZWxlY3RUeXBlKCdjdXN0b20nLCBmYWxzZSk7CgogICAgICAgICAgcmV0dXJuICcnOwogICAgICAgIH0KICAgICAgICAvLyBGb3IgUktFMi9LM3MgY2x1c3RlcnMgcHJvdmlzaW9uZWQgaW4gUmFuY2hlciB3aXRoIG5vZGUgcG9vbHMsCiAgICAgICAgLy8gZG8gbm90IHVzZSBhbiBpRnJhbWVkIEVtYmVyIHBhZ2UuCiAgICAgICAgaWYgKCB0aGlzLnZhbHVlLmlzUmtlMiAmJiB0aGlzLnZhbHVlLm1hY2hpbmVQcm92aWRlciApIHsKICAgICAgICAgIC8vIEVkaXQgZXhpc3RpbmcgUktFMgogICAgICAgICAgdGhpcy5zZWxlY3RUeXBlKHRoaXMudmFsdWUubWFjaGluZVByb3ZpZGVyLCBmYWxzZSk7CgogICAgICAgICAgcmV0dXJuICcnOwogICAgICAgIH0KICAgICAgICBpZiAoIHRoaXMuc3ViVHlwZSApIHsKICAgICAgICAgIC8vIGlmIGRyaXZlciB0eXBlIGhhcyBhIGN1c3RvbSBmb3JtIGNvbXBvbmVudCwgZG9uJ3QgbG9hZCBhbiBlbWJlciBwYWdlCiAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFN1YlR5cGUuY29tcG9uZW50KSB7CiAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgIH0KICAgICAgICAgIC8vIEZvciBSS0UxIGFuZCBob3N0ZWQgS3ViZXJuZXRlcyBDbHVzdGVycywgc2V0IHRoZSBlbWJlciBsaW5rCiAgICAgICAgICAvLyBzbyB0aGF0IHdlIGxvYWQgdGhlIHBhZ2UgcmF0aGVyIHRoYW4gdXNpbmcgUktFMiBjcmVhdGUKICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkU3ViVHlwZT8uZW1iZXJMaW5rKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkU3ViVHlwZS5lbWJlckxpbms7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5zZWxlY3RUeXBlKHRoaXMuc3ViVHlwZSwgZmFsc2UpOwoKICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9CgogICAgICAgIGlmICggdGhpcy52YWx1ZS5tZ210Py5lbWJlckVkaXRQYXRoICkgewogICAgICAgICAgLy8gSWZyYW1lIGFuIG9sZCBwYWdlCiAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZS5tZ210LmVtYmVyRWRpdFBhdGg7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gJyc7CiAgICB9LAoKICAgIHJrZTJFbmFibGVkOiAgIG1hcEZlYXR1cmUoUktFMl9GRUFUVVJFKSwKICAgIHJrZTFVaUVuYWJsZWQ6IG1hcEZlYXR1cmUoUktFMV9VSSksCgogICAgLy8gdG9kbyBuYiBpcyB0aGlzIGluZm8gc3RvcmVkIGFueXdoZXJlIGVsc2UuLj8KICAgIHNlbGVjdGVkU3ViVHlwZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3ViVHlwZSA/IHRoaXMuc3ViVHlwZXMuZmluZCgocykgPT4gcy5pZCA9PT0gdGhpcy5zdWJUeXBlKSA6IG51bGw7CiAgICB9LAoKICAgIHByb3Zpc2lvbmVyOiB7CiAgICAgIGdldCgpIHsKICAgICAgICAvLyBUaGlzIGNhbiBpbmNvcnJlY3RseSByZXR1cm4gcmtlMSBpbnN0ZWFkCiAgICAgICAgLy8gb2YgcmtlMiBmb3IgY2x1c3RlciBvd25lcnMuCiAgICAgICAgaWYgKCAhdGhpcy5ya2UyRW5hYmxlZCApIHsKICAgICAgICAgIHJldHVybiBfUktFMTsKICAgICAgICB9CgogICAgICAgIGlmICggIXRoaXMucmtlMVVpRW5hYmxlZCApIHsKICAgICAgICAgIHJldHVybiBfUktFMjsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzLnByZWZlcnJlZFByb3Zpc2lvbmVyOwogICAgICB9LAoKICAgICAgc2V0KG5ldSkgewogICAgICAgIHRoaXMucHJlZmVycmVkUHJvdmlzaW9uZXIgPSBuZXU7CiAgICAgIH0sCiAgICB9LAoKICAgIGlzUmtlMSgpIHsKICAgICAgcmV0dXJuIHRoaXMucHJvdmlzaW9uZXIgPT09IF9SS0UxOwogICAgfSwKCiAgICBpc1JrZTIoKSB7CiAgICAgIHJldHVybiB0aGlzLnZhbHVlLmlzUmtlMiB8fCAhdGhpcy5pc1JrZTE7CiAgICB9LAoKICAgIHRlbXBsYXRlT3B0aW9ucygpIHsKICAgICAgaWYgKCAhdGhpcy5ya2UyRW5hYmxlZCApIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KCiAgICAgIGNvbnN0IG91dCA9IGZpbHRlckFuZEFycmFuZ2VDaGFydHModGhpcy5hbGxDaGFydHMsIHsgc2hvd1R5cGVzOiBDQVRBTE9HLl9DTFVTVEVSX1RQTCB9KTsKCiAgICAgIHJldHVybiBvdXQ7CiAgICB9LAoKICAgIHN1YlR5cGVzKCkgewogICAgICBjb25zdCBnZXR0ZXJzID0gdGhpcy4kc3RvcmUuZ2V0dGVyczsKICAgICAgY29uc3QgaXNJbXBvcnQgPSB0aGlzLmlzSW1wb3J0OwogICAgICBjb25zdCBpc0VsZW1lbnRhbEFjdGl2ZSA9ICEhdGhpcy5hY3RpdmVQcm9kdWN0cy5maW5kKChpdGVtKSA9PiBpdGVtLm5hbWUgPT09IEVMRU1FTlRBTF9QUk9EVUNUX05BTUUpOwogICAgICBsZXQgb3V0ID0gW107CgogICAgICBjb25zdCB0ZW1wbGF0ZXMgPSB0aGlzLnRlbXBsYXRlT3B0aW9uczsKICAgICAgY29uc3QgdnVlS29udGFpbmVyVHlwZXMgPSBnZXR0ZXJzWydwbHVnaW5zL2NsdXN0ZXJEcml2ZXJzJ107CiAgICAgIGNvbnN0IG1hY2hpbmVUeXBlcyA9IHRoaXMubm9kZURyaXZlcnMuZmlsdGVyKCh4KSA9PiB4LnNwZWMuYWN0aXZlICYmIHguc3RhdGUgPT09ICdhY3RpdmUnKTsKCiAgICAgIHRoaXMua29udGFpbmVyRHJpdmVycy5maWx0ZXIoKHgpID0+IChpc0ltcG9ydCA/IHguc2hvd0ltcG9ydCA6IHguc2hvd0NyZWF0ZSkpLmZvckVhY2goKG9iaikgPT4gewogICAgICAgIGlmICggdnVlS29udGFpbmVyVHlwZXMuaW5jbHVkZXMob2JqLmRyaXZlck5hbWUpICkgewogICAgICAgICAgYWRkVHlwZShvYmouZHJpdmVyTmFtZSwgJ2tvbnRhaW5lcicsIGZhbHNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYWRkVHlwZShvYmouZHJpdmVyTmFtZSwgJ2tvbnRhaW5lcicsIGZhbHNlLCAoaXNJbXBvcnQgPyBvYmouZW1iZXJJbXBvcnRQYXRoIDogb2JqLmVtYmVyQ3JlYXRlUGF0aCkpOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICBpZiAoIGlzSW1wb3J0ICkgewogICAgICAgIGFkZFR5cGUoJ2ltcG9ydCcsICdjdXN0b20nLCBmYWxzZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGVtcGxhdGVzLmZvckVhY2goKGNoYXJ0KSA9PiB7CiAgICAgICAgICBvdXQucHVzaCh7CiAgICAgICAgICAgIGlkOiAgICAgICAgICBgY2hhcnQ6JHsgY2hhcnQuaWQgfWAsCiAgICAgICAgICAgIGxhYmVsOiAgICAgICBjaGFydC5jaGFydE5hbWVEaXNwbGF5LAogICAgICAgICAgICBkZXNjcmlwdGlvbjogY2hhcnQuY2hhcnREZXNjcmlwdGlvbiwKICAgICAgICAgICAgaWNvbjogICAgICAgIGNoYXJ0Lmljb24gfHwgcmVxdWlyZSgnfnNoZWxsL2Fzc2V0cy9pbWFnZXMvZ2VuZXJpYy1jYXRhbG9nLnN2ZycpLAogICAgICAgICAgICBncm91cDogICAgICAgJ3RlbXBsYXRlJywKICAgICAgICAgICAgdGFnOiAgICAgICAgIGdldHRlcnNbJ2kxOG4vdCddKCdnZW5lcmljLnRlY2hQcmV2aWV3JykKICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICBpZiAodGhpcy5pc1JrZTEgKSB7CiAgICAgICAgICBtYWNoaW5lVHlwZXMuZm9yRWFjaCgodHlwZSkgPT4gewogICAgICAgICAgICBjb25zdCBpZCA9IHR5cGUuc3BlYy5kaXNwbGF5TmFtZSB8fCB0eXBlLmlkOwoKICAgICAgICAgICAgYWRkVHlwZShpZCwgX1JLRTEsIGZhbHNlLCBgL2cvY2x1c3RlcnMvYWRkL2xhdW5jaC8keyBpZCB9YCwgdGhpcy5pY29uQ2xhc3Nlc1tpZF0sIHR5cGUpOwogICAgICAgICAgfSk7CgogICAgICAgICAgYWRkVHlwZSgnY3VzdG9tJywgJ2N1c3RvbTEnLCBmYWxzZSwgJy9nL2NsdXN0ZXJzL2FkZC9sYXVuY2gvY3VzdG9tJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1hY2hpbmVUeXBlcy5mb3JFYWNoKCh0eXBlKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGlkID0gdHlwZS5zcGVjLmRpc3BsYXlOYW1lIHx8IHR5cGUuaWQ7CgogICAgICAgICAgICBhZGRUeXBlKGlkLCBfUktFMiwgZmFsc2UsIG51bGwsIHVuZGVmaW5lZCwgdHlwZSk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBhZGRUeXBlKCdjdXN0b20nLCAnY3VzdG9tMicsIGZhbHNlKTsKCiAgICAgICAgICBpZiAoaXNFbGVtZW50YWxBY3RpdmUpIHsKICAgICAgICAgICAgYWRkVHlwZShFTEVNRU5UQUxfQ0xVU1RFUl9QUk9WSURFUiwgJ2N1c3RvbTInLCBmYWxzZSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBBZGQgZnJvbSBleHRlbnNpb25zCiAgICAgICAgdGhpcy5leHRlbnNpb25zLmZvckVhY2goKGV4dCkgPT4gewogICAgICAgICAgLy8gaWYgdGhlIHJrZSB0b2dnbGUgaXMgc2V0IHRvIHJrZTEsIGRvbid0IGFkZCBleHRlbnNpb25zIHRoYXQgc3BlY2lmeSBya2UyIGdyb3VwCiAgICAgICAgICAvLyBkZWZhdWx0IGdyb3VwIGlzIHJrZTIKICAgICAgICAgIGlmICghdGhpcy5pc1JrZTIgJiYgKGV4dC5ncm91cCA9PT0gX1JLRTIgfHwgIWV4dC5ncm91cCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgLy8gRG8gbm90IHNob3cgdGhlIGV4dGVuc2lvbiBwcm92aXNpb25lciBvbiB0aGUgaW1wb3J0IGNsdXN0ZXIgcGFnZSB1bmxlc3MgaXRzIGV4cGxpY2l0bHkgc2V0IHRvIGRvIHNvCiAgICAgICAgICBpZiAoaXNJbXBvcnQgJiYgIWV4dC5zaG93SW1wb3J0KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8vIEFsbG93IGV4dGVuc2lvbnMgdG8gb3ZlcndyaXRlIHByb3Zpc2lvbmVycyB3aXRoIHRoZSBzYW1lIGlkCiAgICAgICAgICBvdXQgPSBvdXQuZmlsdGVyKCh0eXBlKSA9PiB0eXBlLmlkICE9PSBleHQuaWQpOwogICAgICAgICAgYWRkRXh0ZW5zaW9uVHlwZShleHQsIGdldHRlcnMpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gb3V0OwoKICAgICAgZnVuY3Rpb24gYWRkRXh0ZW5zaW9uVHlwZShleHQsIGdldHRlcnMpIHsKICAgICAgICBsZXQgaWNvbkNsYXNzID0gZXh0Lmljb25DbGFzczsKICAgICAgICBsZXQgaWNvbiA9IGV4dC5pY29uOwoKICAgICAgICBpZiAoaWNvbikgewogICAgICAgICAgaWNvbkNsYXNzID0gdW5kZWZpbmVkOwogICAgICAgIH0gZWxzZSBpZiAoIWljb25DbGFzcykgewogICAgICAgICAgaWNvbiA9IHJlcXVpcmUoJ35zaGVsbC9hc3NldHMvaW1hZ2VzL2dlbmVyaWMtZHJpdmVyLnN2ZycpOwogICAgICAgIH0KCiAgICAgICAgY29uc3Qgc3VidHlwZSA9IHsKICAgICAgICAgIGlkOiAgICAgICAgICBleHQuaWQsCiAgICAgICAgICBsYWJlbDogICAgICAgZXh0LmxhYmVsIHx8IGdldHRlcnNbJ2kxOG4vdCddKGBjbHVzdGVyLnByb3ZpZGVyLiR7IGV4dC5pZCB9YCksCiAgICAgICAgICBkZXNjcmlwdGlvbjogZXh0LmRlc2NyaXB0aW9uLAogICAgICAgICAgaWNvbiwKICAgICAgICAgIGljb25DbGFzcywKICAgICAgICAgIGdyb3VwOiAgICAgICBleHQuZ3JvdXAgfHwgX1JLRTIsCiAgICAgICAgICBkaXNhYmxlZDogICAgZXh0LmRpc2FibGVkIHx8IGZhbHNlLAogICAgICAgICAgbGluazogICAgICAgIGV4dC5saW5rLAogICAgICAgICAgdGFnOiAgICAgICAgIGV4dC50YWcsCiAgICAgICAgICBjb21wb25lbnQ6ICAgZXh0LmNvbXBvbmVudAogICAgICAgIH07CgogICAgICAgIG91dC5wdXNoKHN1YnR5cGUpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBhZGRUeXBlKGlkLCBncm91cCwgZGlzYWJsZWQgPSBmYWxzZSwgZW1iZXJMaW5rID0gbnVsbCwgaWNvbkNsYXNzID0gdW5kZWZpbmVkLCBwcm92aWRlckNvbmZpZyA9IHVuZGVmaW5lZCkgewogICAgICAgIGNvbnN0IGxhYmVsID0gZ2V0dGVyc1snaTE4bi93aXRoRmFsbGJhY2snXShgY2x1c3Rlci5wcm92aWRlci4iJHsgaWQgfSJgLCBudWxsLCBpZCk7CiAgICAgICAgY29uc3QgZGVzY3JpcHRpb24gPSBnZXR0ZXJzWydpMThuL3dpdGhGYWxsYmFjayddKGBjbHVzdGVyLnByb3ZpZGVyRGVzY3JpcHRpb24uIiR7IGlkIH0iYCwgbnVsbCwgJycpOwogICAgICAgIGNvbnN0IHRhZyA9ICcnOwoKICAgICAgICBsZXQgaWNvbjsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGljb24gPSByZXF1aXJlKGB+c2hlbGwvYXNzZXRzL2ltYWdlcy9wcm92aWRlcnMvJHsgaWQgfS5zdmdgKTsKICAgICAgICB9IGNhdGNoIChlKSB7fQoKICAgICAgICBpZiAoaWNvbikgewogICAgICAgICAgaWNvbkNsYXNzID0gdW5kZWZpbmVkOwogICAgICAgIH0gZWxzZSBpZiAoIWljb25DbGFzcykgewogICAgICAgICAgaWNvbiA9IHJlcXVpcmUoJ35zaGVsbC9hc3NldHMvaW1hZ2VzL2dlbmVyaWMtZHJpdmVyLnN2ZycpOwogICAgICAgIH0KCiAgICAgICAgY29uc3Qgc3VidHlwZSA9IHsKICAgICAgICAgIGlkLAogICAgICAgICAgbGFiZWwsCiAgICAgICAgICBkZXNjcmlwdGlvbiwKICAgICAgICAgIGljb24sCiAgICAgICAgICBpY29uQ2xhc3MsCiAgICAgICAgICBncm91cCwKICAgICAgICAgIGRpc2FibGVkLAogICAgICAgICAgZW1iZXJMaW5rLAogICAgICAgICAgdGFnLAogICAgICAgICAgcHJvdmlkZXJDb25maWcKICAgICAgICB9OwoKICAgICAgICBvdXQucHVzaChzdWJ0eXBlKTsKICAgICAgfQogICAgfSwKCiAgICBncm91cGVkU3ViVHlwZXMoKSB7CiAgICAgIGNvbnN0IG91dCA9IHt9OwoKICAgICAgZm9yICggY29uc3Qgcm93IG9mIHRoaXMuc3ViVHlwZXMgKSB7CiAgICAgICAgY29uc3QgbmFtZSA9IHJvdy5ncm91cDsKICAgICAgICBsZXQgZW50cnkgPSBvdXRbbmFtZV07CgogICAgICAgIGlmICggIWVudHJ5ICkgewogICAgICAgICAgZW50cnkgPSB7CiAgICAgICAgICAgIG5hbWUsCiAgICAgICAgICAgIGxhYmVsOiB0aGlzLiRzdG9yZS5nZXR0ZXJzWydpMThuL3dpdGhGYWxsYmFjayddKGBjbHVzdGVyLnByb3ZpZGVyR3JvdXAuIiR7IHRoaXMuaXNJbXBvcnQgPyAncmVnaXN0ZXItJyA6ICdjcmVhdGUtJyB9JHsgbmFtZSB9ImAsIG51bGwsIG5hbWUpLAogICAgICAgICAgICB0eXBlczogW10sCiAgICAgICAgICAgIHNvcnQ6ICBTT1JUX0dST1VQU1tuYW1lXSwKICAgICAgICAgIH07CgogICAgICAgICAgb3V0W25hbWVdID0gZW50cnk7CiAgICAgICAgfQoKICAgICAgICBlbnRyeS50eXBlcy5wdXNoKHJvdyk7CiAgICAgIH0KCiAgICAgIGZvciAoIGNvbnN0IGsgaW4gb3V0ICkgewogICAgICAgIG91dFtrXS50eXBlcyA9IHNvcnRCeShvdXRba10udHlwZXMsICdsYWJlbCcpOwogICAgICB9CgogICAgICByZXR1cm4gc29ydEJ5KE9iamVjdC52YWx1ZXMob3V0KSwgJ3NvcnQnKTsKICAgIH0sCgogICAgZmlyc3ROb2RlRHJpdmVySXRlbSgpIHsKICAgICAgcmV0dXJuIHRoaXMuZ3JvdXBlZFN1YlR5cGVzLmZpbmRJbmRleCgob2JqKSA9PiBbX1JLRTEsIF9SS0UyXS5pbmNsdWRlcyhvYmoubmFtZSkpOwogICAgfSwKCiAgICBmaXJzdEN1c3RvbUNsdXN0ZXJJdGVtKCkgewogICAgICByZXR1cm4gdGhpcy5ncm91cGVkU3ViVHlwZXMuZmluZEluZGV4KChvYmopID0+IFsnY3VzdG9tJywgJ2N1c3RvbTEnLCAnY3VzdG9tMiddLmluY2x1ZGVzKG9iai5uYW1lKSk7CiAgICB9LAogIH0sCgogIG1ldGhvZHM6IHsKICAgIHNob3dSa2VUb2dnbGUoaSkgewogICAgICBpZiAodGhpcy5pc0ltcG9ydCB8fCAhdGhpcy5ya2UyRW5hYmxlZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZmlyc3ROb2RlRHJpdmVySXRlbSA+PSAwKSB7CiAgICAgICAgcmV0dXJuIGkgPT09IHRoaXMuZmlyc3ROb2RlRHJpdmVySXRlbTsKICAgICAgfQoKICAgICAgcmV0dXJuIGkgPT09IHRoaXMuZmlyc3RDdXN0b21DbHVzdGVySXRlbTsKICAgIH0sCgogICAgbG9hZFN0eWxlc2hlZXQodXJsLCBpZCkgewogICAgICBpZiAoICFpZCApIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdsb2FkU3R5bGVzaGVldCBjYWxsZWQgd2l0aG91dCBhbiBpZCcpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyBDaGVjayBpZiB0aGUgc3R5bGVzaGVldCBoYXMgYWxyZWFkeSBiZWVuIGxvYWRlZAogICAgICBpZiAoICQoYCMke2lkfWApLmxlbmd0aCA+IDAgKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaW5rJyk7CgogICAgICBsaW5rLm9uZXJyb3IgPSAoKSA9PiB7CiAgICAgICAgbGluay5yZW1vdmUoKTsKICAgICAgfTsKICAgICAgbGluay5yZWwgPSAnc3R5bGVzaGVldCc7CiAgICAgIGxpbmsuc3JjID0gdXJsOwogICAgICBsaW5rLmhyZWYgPSB1cmw7CiAgICAgIGxpbmsuaWQgPSBpZDsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ0hFQUQnKVswXS5hcHBlbmRDaGlsZChsaW5rKTsKICAgIH0sCgogICAgY2FuY2VsKCkgewogICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgbmFtZTogICAnYy1jbHVzdGVyLXByb2R1Y3QtcmVzb3VyY2UnLAogICAgICAgIHBhcmFtczogewogICAgICAgICAgY2x1c3RlcjogIHRoaXMuJHJvdXRlLnBhcmFtcy5jbHVzdGVyLAogICAgICAgICAgcHJvZHVjdDogIHRoaXMuJHN0b3JlLmdldHRlcnNbJ3Byb2R1Y3RJZCddLAogICAgICAgICAgcmVzb3VyY2U6IENBUEkuUkFOQ0hFUl9DTFVTVEVSLAogICAgICAgIH0sCiAgICAgIH0pOwogICAgfSwKCiAgICBjb2xvckZvcihvYmopIHsKICAgICAgcmV0dXJuIGBjb2xvciR7IFNPUlRfR1JPVVBTW29iai5ncm91cF0gfHwgMSB9YDsKICAgIH0sCgogICAgY2xpY2tlZFR5cGUob2JqKSB7CiAgICAgIGNvbnN0IGlkID0gb2JqLmlkOwogICAgICBjb25zdCBwYXJ0cyA9IGlkLnNwbGl0KCc6JywgMik7CgogICAgICBpZiAoIHBhcnRzWzBdID09PSAnY2hhcnQnICkgewogICAgICAgIGNvbnN0IGNoYXJ0ID0gdGhpcy4kc3RvcmUuZ2V0dGVyc1snY2F0YWxvZy9jaGFydCddKHsga2V5OiBwYXJ0c1sxXSB9KTsKICAgICAgICBsZXQgbG9jYWxDbHVzdGVyOwoKICAgICAgICBpZiAodGhpcy4kc3RvcmUuZ2V0dGVyc1tgbWFuYWdlbWVudC9jYW5MaXN0YF0oTUFOQUdFTUVOVC5DTFVTVEVSKSkgewogICAgICAgICAgbG9jYWxDbHVzdGVyID0gdGhpcy4kc3RvcmUuZ2V0dGVyc1snbWFuYWdlbWVudC9hbGwnXShNQU5BR0VNRU5ULkNMVVNURVIpLmZpbmQoKHgpID0+IHguaXNMb2NhbCk7CiAgICAgICAgfQoKICAgICAgICBjaGFydC5nb1RvSW5zdGFsbChGUk9NX0NMVVNURVIsIGxvY2FsQ2x1c3Rlcj8uaWQgfHwgQkxBTktfQ0xVU1RFUiwgdHJ1ZSk7CgogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAob2JqLmxpbmspIHsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaChvYmoubGluayk7CgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy4kcm91dGVyLmFwcGx5UXVlcnkoeyBbU1VCX1RZUEVdOiBpZCwgW1JLRV9UWVBFXTogdGhpcy5wcmVmZXJyZWRQcm92aXNpb25lciB9KTsKICAgICAgdGhpcy5zZWxlY3RUeXBlKGlkKTsKICAgIH0sCgogICAgc2VsZWN0VHlwZSh0eXBlLCBmZXRjaCA9IHRydWUpIHsKICAgICAgY29uc3QgcGFydHMgPSB0eXBlLnNwbGl0KCc6JywgMik7CgogICAgICBpZiAoIHBhcnRzWzBdID09PSAnY2hhcnQnICkgewogICAgICAgIHRoaXMuc3ViVHlwZSA9ICdjaGFydCc7CiAgICAgICAgdGhpcy4kZW1pdCgnc2V0LXN1YnR5cGUnLCB0aGlzLiRzdG9yZS5nZXR0ZXJzWydpMThuL3dpdGhGYWxsYmFjayddKGBjbHVzdGVyLnByb3ZpZGVyLmNoYXJ0YCkpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc3ViVHlwZSA9IHR5cGU7CiAgICAgICAgdGhpcy4kZW1pdCgnc2V0LXN1YnR5cGUnLCB0aGlzLiRzdG9yZS5nZXR0ZXJzWydpMThuL3dpdGhGYWxsYmFjayddKGBjbHVzdGVyLnByb3ZpZGVyLiIkeyB0eXBlIH0iYCwgbnVsbCwgdHlwZSkpOwogICAgICB9CgogICAgICBpZiAoIGZldGNoICkgewogICAgICAgIHRoaXMuJGZldGNoKCk7CiAgICAgIH0KICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster","sourcesContent":["<script>\nimport CreateEditView from '@shell/mixins/create-edit-view';\nimport Loading from '@shell/components/Loading';\nimport CruResource from '@shell/components/CruResource';\nimport SelectIconGrid from '@shell/components/SelectIconGrid';\nimport EmberPage from '@shell/components/EmberPage';\nimport { ToggleSwitch } from '@components/Form/ToggleSwitch';\nimport {\n  CHART, FROM_CLUSTER, SUB_TYPE, RKE_TYPE, _EDIT, _IMPORT, _CONFIG, _VIEW\n} from '@shell/config/query-params';\nimport { mapGetters } from 'vuex';\nimport { sortBy } from '@shell/utils/sort';\nimport { set } from '@shell/utils/object';\nimport { PROVISIONER, _RKE1, _RKE2 } from '@shell/store/prefs';\nimport { filterAndArrangeCharts } from '@shell/store/catalog';\nimport { CATALOG } from '@shell/config/labels-annotations';\nimport { CAPI, MANAGEMENT, DEFAULT_WORKSPACE } from '@shell/config/types';\nimport { mapFeature, RKE2 as RKE2_FEATURE, RKE1_UI } from '@shell/store/features';\nimport { allHash } from '@shell/utils/promise';\nimport { BLANK_CLUSTER } from '@shell/store/store-types.js';\nimport { ELEMENTAL_PRODUCT_NAME, ELEMENTAL_CLUSTER_PROVIDER } from '../../config/elemental-types';\nimport Rke2Config from './rke2';\nimport Import from './import';\n\nconst SORT_GROUPS = {\n  template:  1,\n  kontainer: 2,\n  rke1:      3,\n  rke2:      3,\n  register:  4,\n  custom:    5,\n  custom1:   5,\n  custom2:   5,\n};\n\n// uSed to proxy stylesheets for custom drivers that provide custom UI (RKE1)\nconst PROXY_ENDPOINT = '/meta/proxy';\n\nexport default {\n  name: 'CruCluster',\n\n  components: {\n    CruResource,\n    EmberPage,\n    Import,\n    Loading,\n    Rke2Config,\n    SelectIconGrid,\n    ToggleSwitch\n  },\n\n  mixins: [CreateEditView],\n\n  props: {\n    realMode: {\n      type:     String,\n      required: true,\n    },\n\n    mode: {\n      type:     String,\n      required: true,\n    },\n\n    value: {\n      type:    Object,\n      default: null,\n    },\n\n    /**\n     * Inherited global identifier prefix for tests\n     * Define a term based on the parent component to avoid conflicts on multiple components\n     */\n    componentTestid: {\n      type:    String,\n      default: 'cluster-manager-create'\n    }\n  },\n\n  async fetch() {\n    const hash = {\n      // These aren't explicitly used, but need to be listening for change events\n      mgmtClusters: this.$store.dispatch('management/findAll', { type: MANAGEMENT.CLUSTER }),\n      provClusters: this.$store.dispatch('management/findAll', { type: CAPI.RANCHER_CLUSTER }),\n\n      catalog: this.$store.dispatch('catalog/load'),\n    };\n\n    if (this.$store.getters[`management/canList`](MANAGEMENT.NODE_DRIVER)) {\n      hash.nodeDrivers = this.$store.dispatch('management/findAll', { type: MANAGEMENT.NODE_DRIVER });\n    }\n\n    if (this.$store.getters[`management/canList`](MANAGEMENT.KONTAINER_DRIVER)) {\n      hash.kontainerDrivers = this.$store.dispatch('management/findAll', { type: MANAGEMENT.KONTAINER_DRIVER });\n    }\n\n    if ( this.value.id && !this.value.isRke2 ) {\n      // These are needed to resolve references in the mgmt cluster -> node pool -> node template to figure out what provider the cluster is using\n      // so that the edit iframe for ember pages can go to the right place.\n      if (this.$store.getters[`management/canList`](MANAGEMENT.NODE_POOL)) {\n        hash.rke1NodePools = this.$store.dispatch('management/findAll', { type: MANAGEMENT.NODE_POOL });\n      }\n\n      if (this.$store.getters[`management/canList`](MANAGEMENT.NODE_TEMPLATE)) {\n        hash.rke1NodeTemplates = this.$store.dispatch('management/findAll', { type: MANAGEMENT.NODE_TEMPLATE });\n      }\n    }\n\n    const res = await allHash(hash);\n\n    this.nodeDrivers = res.nodeDrivers || [];\n    this.kontainerDrivers = res.kontainerDrivers || [];\n\n    if ( !this.value.spec ) {\n      set(this.value, 'spec', {});\n    }\n\n    if ( !this.value.id ) {\n      if ( !this.value.metadata ) {\n        set(this.value, 'metadata', {});\n      }\n\n      set(this.value.metadata, 'namespace', DEFAULT_WORKSPACE);\n    }\n\n    // For the node drivers, look for custom UI that we can use to show an icon (if not built-in)\n    this.nodeDrivers.forEach((driver) => {\n      if (!driver.spec?.builtin && driver.spec?.uiUrl && driver.spec?.active) {\n        const name = driver.spec?.displayName || driver.id;\n        let cssUrl = driver.spec.uiUrl.replace(/\\.js$/, '.css');\n\n        if (cssUrl.startsWith('http://') || cssUrl.startsWith('https://')) {\n          cssUrl = `${ PROXY_ENDPOINT }/${ cssUrl }`;\n        }\n\n        this.loadStylesheet(cssUrl, `driver-ui-css-${ driver.id }`);\n\n        this.iconClasses[name] = `machine-driver ${ name }`;\n      }\n    });\n\n    // Custom Providers from extensions - initialize each with the store and the i18n service\n    // Wrap in try ... catch, to prevent errors in an extension breaking the page\n    try {\n      const extensionClasses = this.$plugin.listDynamic('provisioner').map((name) => this.$plugin.getDynamic('provisioner', name));\n\n      // We can't pass in this.$store as this leads to a circular-reference that causes Vue to freeze,\n      // so pass in specific services that the provisioner extension may need\n      this.extensions = extensionClasses.map((c) => new c({\n        dispatch: this.$store.dispatch,\n        getters:  this.$store.getters,\n        axios:    this.$store.$axios,\n        $plugin:  this.$store.app.$plugin,\n        t:        (...args) => this.t.apply(this, args),\n        isCreate: this.isCreate,\n        isEdit:   this.isEdit,\n        isView:   this.isView,\n      }));\n    } catch (e) {\n      console.error('Error loading provisioner(s) from extensions', e); // eslint-disable-line no-console\n    }\n  },\n\n  data() {\n    const subType = this.$route.query[SUB_TYPE] || null;\n    const rkeType = this.$route.query[RKE_TYPE] || null;\n    const chart = this.$route.query[CHART] || null;\n    const isImport = this.realMode === _IMPORT;\n\n    return {\n      nodeDrivers:      [],\n      kontainerDrivers: [],\n      extensions:       [],\n      subType,\n      rkeType,\n      chart,\n      isImport,\n      providerCluster:  null,\n      iconClasses:      {},\n    };\n  },\n\n  computed: {\n    ...mapGetters({ allCharts: 'catalog/charts' }),\n    ...mapGetters('type-map', ['activeProducts']),\n    // needed to recreate logic on mapPref in order to incorporate the logic around the rkeType query param\n    // https://github.com/rancher/dashboard/issues/6299\n    preferredProvisioner: {\n      get() {\n        if (this.rkeType) {\n          return this.rkeType;\n        }\n\n        return this.$store.getters['prefs/get'](PROVISIONER);\n      },\n      set(value) {\n        this.$store.dispatch('prefs/set', { key: PROVISIONER, value });\n      }\n    },\n    _RKE1: () => _RKE1,\n    _RKE2: () => _RKE2,\n\n    emberLink() {\n      if (this.value) {\n        if (this.value.provisioner) {\n          const matchingSubtype = this.subTypes.find((st) => st.id.toLowerCase() === this.value.provisioner.toLowerCase());\n\n          if (matchingSubtype) {\n            this.selectType(matchingSubtype.id, false);\n          }\n        }\n        // For custom RKE2 clusters, don't load an Ember page.\n        // It should be the dashboard.\n        if ( this.value.isRke2 && ((this.value.isCustom && this.mode === _EDIT) || (this.value.isCustom && this.as === _CONFIG && this.mode === _VIEW) || (this.subType || '').toLowerCase() === 'custom')) {\n          // For admins, this.value.isCustom is used to check if it is a custom cluster.\n          // For cluster owners, this.subtype is used.\n          this.selectType('custom', false);\n\n          return '';\n        }\n        // For RKE2/K3s clusters provisioned in Rancher with node pools,\n        // do not use an iFramed Ember page.\n        if ( this.value.isRke2 && this.value.machineProvider ) {\n          // Edit existing RKE2\n          this.selectType(this.value.machineProvider, false);\n\n          return '';\n        }\n        if ( this.subType ) {\n          // if driver type has a custom form component, don't load an ember page\n          if (this.selectedSubType.component) {\n            return '';\n          }\n          // For RKE1 and hosted Kubernetes Clusters, set the ember link\n          // so that we load the page rather than using RKE2 create\n          if (this.selectedSubType?.emberLink) {\n            return this.selectedSubType.emberLink;\n          }\n\n          this.selectType(this.subType, false);\n\n          return '';\n        }\n\n        if ( this.value.mgmt?.emberEditPath ) {\n          // Iframe an old page\n          return this.value.mgmt.emberEditPath;\n        }\n      }\n\n      return '';\n    },\n\n    rke2Enabled:   mapFeature(RKE2_FEATURE),\n    rke1UiEnabled: mapFeature(RKE1_UI),\n\n    // todo nb is this info stored anywhere else..?\n    selectedSubType() {\n      return this.subType ? this.subTypes.find((s) => s.id === this.subType) : null;\n    },\n\n    provisioner: {\n      get() {\n        // This can incorrectly return rke1 instead\n        // of rke2 for cluster owners.\n        if ( !this.rke2Enabled ) {\n          return _RKE1;\n        }\n\n        if ( !this.rke1UiEnabled ) {\n          return _RKE2;\n        }\n\n        return this.preferredProvisioner;\n      },\n\n      set(neu) {\n        this.preferredProvisioner = neu;\n      },\n    },\n\n    isRke1() {\n      return this.provisioner === _RKE1;\n    },\n\n    isRke2() {\n      return this.value.isRke2 || !this.isRke1;\n    },\n\n    templateOptions() {\n      if ( !this.rke2Enabled ) {\n        return [];\n      }\n\n      const out = filterAndArrangeCharts(this.allCharts, { showTypes: CATALOG._CLUSTER_TPL });\n\n      return out;\n    },\n\n    subTypes() {\n      const getters = this.$store.getters;\n      const isImport = this.isImport;\n      const isElementalActive = !!this.activeProducts.find((item) => item.name === ELEMENTAL_PRODUCT_NAME);\n      let out = [];\n\n      const templates = this.templateOptions;\n      const vueKontainerTypes = getters['plugins/clusterDrivers'];\n      const machineTypes = this.nodeDrivers.filter((x) => x.spec.active && x.state === 'active');\n\n      this.kontainerDrivers.filter((x) => (isImport ? x.showImport : x.showCreate)).forEach((obj) => {\n        if ( vueKontainerTypes.includes(obj.driverName) ) {\n          addType(obj.driverName, 'kontainer', false);\n        } else {\n          addType(obj.driverName, 'kontainer', false, (isImport ? obj.emberImportPath : obj.emberCreatePath));\n        }\n      });\n\n      if ( isImport ) {\n        addType('import', 'custom', false);\n      } else {\n        templates.forEach((chart) => {\n          out.push({\n            id:          `chart:${ chart.id }`,\n            label:       chart.chartNameDisplay,\n            description: chart.chartDescription,\n            icon:        chart.icon || require('~shell/assets/images/generic-catalog.svg'),\n            group:       'template',\n            tag:         getters['i18n/t']('generic.techPreview')\n          });\n        });\n\n        if (this.isRke1 ) {\n          machineTypes.forEach((type) => {\n            const id = type.spec.displayName || type.id;\n\n            addType(id, _RKE1, false, `/g/clusters/add/launch/${ id }`, this.iconClasses[id], type);\n          });\n\n          addType('custom', 'custom1', false, '/g/clusters/add/launch/custom');\n        } else {\n          machineTypes.forEach((type) => {\n            const id = type.spec.displayName || type.id;\n\n            addType(id, _RKE2, false, null, undefined, type);\n          });\n\n          addType('custom', 'custom2', false);\n\n          if (isElementalActive) {\n            addType(ELEMENTAL_CLUSTER_PROVIDER, 'custom2', false);\n          }\n        }\n\n        // Add from extensions\n        this.extensions.forEach((ext) => {\n          // if the rke toggle is set to rke1, don't add extensions that specify rke2 group\n          // default group is rke2\n          if (!this.isRke2 && (ext.group === _RKE2 || !ext.group)) {\n            return;\n          }\n          // Do not show the extension provisioner on the import cluster page unless its explicitly set to do so\n          if (isImport && !ext.showImport) {\n            return;\n          }\n          // Allow extensions to overwrite provisioners with the same id\n          out = out.filter((type) => type.id !== ext.id);\n          addExtensionType(ext, getters);\n        });\n      }\n\n      return out;\n\n      function addExtensionType(ext, getters) {\n        let iconClass = ext.iconClass;\n        let icon = ext.icon;\n\n        if (icon) {\n          iconClass = undefined;\n        } else if (!iconClass) {\n          icon = require('~shell/assets/images/generic-driver.svg');\n        }\n\n        const subtype = {\n          id:          ext.id,\n          label:       ext.label || getters['i18n/t'](`cluster.provider.${ ext.id }`),\n          description: ext.description,\n          icon,\n          iconClass,\n          group:       ext.group || _RKE2,\n          disabled:    ext.disabled || false,\n          link:        ext.link,\n          tag:         ext.tag,\n          component:   ext.component\n        };\n\n        out.push(subtype);\n      }\n\n      function addType(id, group, disabled = false, emberLink = null, iconClass = undefined, providerConfig = undefined) {\n        const label = getters['i18n/withFallback'](`cluster.provider.\"${ id }\"`, null, id);\n        const description = getters['i18n/withFallback'](`cluster.providerDescription.\"${ id }\"`, null, '');\n        const tag = '';\n\n        let icon;\n\n        try {\n          icon = require(`~shell/assets/images/providers/${ id }.svg`);\n        } catch (e) {}\n\n        if (icon) {\n          iconClass = undefined;\n        } else if (!iconClass) {\n          icon = require('~shell/assets/images/generic-driver.svg');\n        }\n\n        const subtype = {\n          id,\n          label,\n          description,\n          icon,\n          iconClass,\n          group,\n          disabled,\n          emberLink,\n          tag,\n          providerConfig\n        };\n\n        out.push(subtype);\n      }\n    },\n\n    groupedSubTypes() {\n      const out = {};\n\n      for ( const row of this.subTypes ) {\n        const name = row.group;\n        let entry = out[name];\n\n        if ( !entry ) {\n          entry = {\n            name,\n            label: this.$store.getters['i18n/withFallback'](`cluster.providerGroup.\"${ this.isImport ? 'register-' : 'create-' }${ name }\"`, null, name),\n            types: [],\n            sort:  SORT_GROUPS[name],\n          };\n\n          out[name] = entry;\n        }\n\n        entry.types.push(row);\n      }\n\n      for ( const k in out ) {\n        out[k].types = sortBy(out[k].types, 'label');\n      }\n\n      return sortBy(Object.values(out), 'sort');\n    },\n\n    firstNodeDriverItem() {\n      return this.groupedSubTypes.findIndex((obj) => [_RKE1, _RKE2].includes(obj.name));\n    },\n\n    firstCustomClusterItem() {\n      return this.groupedSubTypes.findIndex((obj) => ['custom', 'custom1', 'custom2'].includes(obj.name));\n    },\n  },\n\n  methods: {\n    showRkeToggle(i) {\n      if (this.isImport || !this.rke2Enabled) {\n        return false;\n      }\n\n      if (this.firstNodeDriverItem >= 0) {\n        return i === this.firstNodeDriverItem;\n      }\n\n      return i === this.firstCustomClusterItem;\n    },\n\n    loadStylesheet(url, id) {\n      if ( !id ) {\n        console.error('loadStylesheet called without an id'); // eslint-disable-line no-console\n\n        return;\n      }\n\n      // Check if the stylesheet has already been loaded\n      if ( $(`#${id}`).length > 0 ) { // eslint-disable-line\n        return;\n      }\n\n      const link = document.createElement('link');\n\n      link.onerror = () => {\n        link.remove();\n      };\n      link.rel = 'stylesheet';\n      link.src = url;\n      link.href = url;\n      link.id = id;\n      document.getElementsByTagName('HEAD')[0].appendChild(link);\n    },\n\n    cancel() {\n      this.$router.push({\n        name:   'c-cluster-product-resource',\n        params: {\n          cluster:  this.$route.params.cluster,\n          product:  this.$store.getters['productId'],\n          resource: CAPI.RANCHER_CLUSTER,\n        },\n      });\n    },\n\n    colorFor(obj) {\n      return `color${ SORT_GROUPS[obj.group] || 1 }`;\n    },\n\n    clickedType(obj) {\n      const id = obj.id;\n      const parts = id.split(':', 2);\n\n      if ( parts[0] === 'chart' ) {\n        const chart = this.$store.getters['catalog/chart']({ key: parts[1] });\n        let localCluster;\n\n        if (this.$store.getters[`management/canList`](MANAGEMENT.CLUSTER)) {\n          localCluster = this.$store.getters['management/all'](MANAGEMENT.CLUSTER).find((x) => x.isLocal);\n        }\n\n        chart.goToInstall(FROM_CLUSTER, localCluster?.id || BLANK_CLUSTER, true);\n\n        return;\n      }\n      if (obj.link) {\n        this.$router.push(obj.link);\n\n        return;\n      }\n\n      this.$router.applyQuery({ [SUB_TYPE]: id, [RKE_TYPE]: this.preferredProvisioner });\n      this.selectType(id);\n    },\n\n    selectType(type, fetch = true) {\n      const parts = type.split(':', 2);\n\n      if ( parts[0] === 'chart' ) {\n        this.subType = 'chart';\n        this.$emit('set-subtype', this.$store.getters['i18n/withFallback'](`cluster.provider.chart`));\n      } else {\n        this.subType = type;\n        this.$emit('set-subtype', this.$store.getters['i18n/withFallback'](`cluster.provider.\"${ type }\"`, null, type));\n      }\n\n      if ( fetch ) {\n        this.$fetch();\n      }\n    },\n  },\n};\n</script>\n\n<template>\n  <Loading v-if=\"$fetchState.pending\" />\n  <div\n    v-else-if=\"emberLink\"\n    class=\"embed\"\n  >\n    <EmberPage\n      :force-new=\"true\"\n      :src=\"emberLink\"\n    />\n  </div>\n  <CruResource\n    v-else\n    :mode=\"mode\"\n    :validation-passed=\"true\"\n    :selected-subtype=\"subType\"\n    :resource=\"value\"\n    :errors=\"errors\"\n    :subtypes=\"subTypes\"\n    :cancel-event=\"true\"\n    :prevent-enter-submit=\"true\"\n    class=\"create-cluster\"\n    @finish=\"save\"\n    @cancel=\"cancel\"\n    @select-type=\"selectType\"\n    @error=\"e=>errors = e\"\n  >\n    <template #subtypes>\n      <div\n        v-for=\"(obj, i) in groupedSubTypes\"\n        :key=\"obj.id\"\n        class=\"mb-20\"\n        style=\"width: 100%;\"\n      >\n        <h4>\n          <div\n            v-if=\"showRkeToggle(i) && rke1UiEnabled\"\n            class=\"grouped-type\"\n          >\n            <ToggleSwitch\n              v-model=\"provisioner\"\n              data-testid=\"cluster-manager-create-rke-switch\"\n              class=\"rke-switch\"\n              :off-value=\"_RKE1\"\n              :off-label=\"t('cluster.toggle.v1')\"\n              :on-value=\"_RKE2\"\n              :on-label=\"t('cluster.toggle.v2')\"\n            />\n          </div>\n          {{ obj.label }}\n        </h4>\n        <SelectIconGrid\n          :rows=\"obj.types\"\n          key-field=\"id\"\n          name-field=\"label\"\n          side-label-field=\"tag\"\n          :color-for=\"colorFor\"\n          :component-testid=\"'cluster-manager-create-grid-' + i\"\n          @clicked=\"clickedType\"\n        />\n      </div>\n    </template>\n\n    <Import\n      v-if=\"isImport\"\n      v-model=\"value\"\n      :mode=\"mode\"\n      :provider=\"subType\"\n    />\n    <template v-else-if=\"subType\">\n      <!-- allow extensions to provide their own cluster provisioning form -->\n      <component\n        :is=\"selectedSubType.component\"\n        v-if=\"selectedSubType && selectedSubType.component\"\n        v-model=\"value\"\n        :initial-value=\"initialValue\"\n        :live-value=\"liveValue\"\n        :mode=\"mode\"\n        :provider=\"subType\"\n        :provider-config=\"selectedSubType.providerConfig\"\n      />\n      <Rke2Config\n        v-else\n        v-model=\"value\"\n        :initial-value=\"initialValue\"\n        :live-value=\"liveValue\"\n        :mode=\"mode\"\n        :provider=\"subType\"\n        :provider-config=\"selectedSubType.providerConfig\"\n      />\n    </template>\n\n    <template\n      v-if=\"subType\"\n      #form-footer\n    >\n      <div><!-- Hide the outer footer --></div>\n    </template>\n  </CruResource>\n</template>\n\n<style lang='scss'>\n  .grouped-type {\n    position: relative;\n  }\n\n  .rke-switch {\n    margin-top: -10px;\n    position: absolute;\n    right: 0;\n  }\n</style>\n"]}]}