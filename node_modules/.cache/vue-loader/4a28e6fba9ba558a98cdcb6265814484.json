{"remainingRequest":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ubuntu/suseconf/node_modules/@rancher/shell/components/auth/RoleDetailEdit.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/components/auth/RoleDetailEdit.vue","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1725271300920}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JzsKaW1wb3J0IHsgTUFOQUdFTUVOVCwgUkJBQyB9IGZyb20gJ0BzaGVsbC9jb25maWcvdHlwZXMnOwppbXBvcnQgQ3J1UmVzb3VyY2UgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvQ3J1UmVzb3VyY2UnOwppbXBvcnQgQ3JlYXRlRWRpdFZpZXcgZnJvbSAnQHNoZWxsL21peGlucy9jcmVhdGUtZWRpdC12aWV3JzsKaW1wb3J0IEZvcm1WYWxpZGF0aW9uIGZyb20gJ0BzaGVsbC9taXhpbnMvZm9ybS12YWxpZGF0aW9uJzsKaW1wb3J0IEVycm9yIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vRXJyb3InOwppbXBvcnQgeyBSYWRpb0dyb3VwIH0gZnJvbSAnQGNvbXBvbmVudHMvRm9ybS9SYWRpbyc7CmltcG9ydCBTZWxlY3QgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvZm9ybS9TZWxlY3QnOwppbXBvcnQgQXJyYXlMaXN0IGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vQXJyYXlMaXN0JzsKaW1wb3J0IE5hbWVOc0Rlc2NyaXB0aW9uIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL2Zvcm0vTmFtZU5zRGVzY3JpcHRpb24nOwppbXBvcnQgVGFiIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL1RhYmJlZC9UYWInOwppbXBvcnQgVGFiYmVkIGZyb20gJ0BzaGVsbC9jb21wb25lbnRzL1RhYmJlZCc7CmltcG9ydCB7IHVjRmlyc3QgfSBmcm9tICdAc2hlbGwvdXRpbHMvc3RyaW5nJzsKaW1wb3J0IFNvcnRhYmxlVGFibGUgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvU29ydGFibGVUYWJsZSc7CmltcG9ydCB7IF9DTE9ORSwgX0RFVEFJTCB9IGZyb20gJ0BzaGVsbC9jb25maWcvcXVlcnktcGFyYW1zJzsKaW1wb3J0IHsgU0NPUEVEX1JFU09VUkNFUyB9IGZyb20gJ0BzaGVsbC9jb25maWcvcm9sZXMnOwppbXBvcnQgeyBCYW5uZXIgfSBmcm9tICdAY29tcG9uZW50cy9CYW5uZXInOwoKaW1wb3J0IHsgU1VCVFlQRV9NQVBQSU5HLCBWRVJCUyB9IGZyb20gJ0BzaGVsbC9tb2RlbHMvbWFuYWdlbWVudC5jYXR0bGUuaW8ucm9sZXRlbXBsYXRlJzsKaW1wb3J0IExvYWRpbmcgZnJvbSAnQHNoZWxsL2NvbXBvbmVudHMvTG9hZGluZyc7Cgpjb25zdCBHTE9CQUwgPSBTVUJUWVBFX01BUFBJTkcuR0xPQkFMLmtleTsKY29uc3QgQ0xVU1RFUiA9IFNVQlRZUEVfTUFQUElORy5DTFVTVEVSLmtleTsKY29uc3QgTkFNRVNQQUNFID0gU1VCVFlQRV9NQVBQSU5HLk5BTUVTUEFDRS5rZXk7CmNvbnN0IFJCQUNfUk9MRSA9IFNVQlRZUEVfTUFQUElORy5SQkFDX1JPTEUua2V5OwoKLyoqCiAqIEhhbmRsZXMgdGhlIFZpZXcsIENyZWF0ZSBhbmQgRWRpdCBvZgogKiAtIG1hbmFnZW1lbnQuY2F0dGxlLmlvLmdsb2JhbHJvbGUKICogLSBtYW5hZ2VtZW50LmNhdHRsZS5pby5yb2xldGVtcGxhdGUKICogLSByYmFjLmF1dGhvcml6YXRpb24uazhzLmlvLnJvbGUKICogLSByYmFjLmF1dGhvcml6YXRpb24uazhzLmlvLmNsdXN0ZXJyb2xlCiAqCiAqIG1hbmFnZW1lbnQuY2F0dGxlLmlvLnJvbGV0ZW1wbGF0ZSBpcyBmdXJ0aGVyIHNwbGl0IGludG8gdHdvIHR5cGVzCiAqIC0gQ2x1c3RlcgogKiAtIFByb2plY3QvTmFtZXNwYWNlCiAqCiAqIFRoZSBhYm92ZSBtZWFucyB0aGVyZSBhcmUgNCB0eXBlcyA9PT4gNSBzdWJ0eXBlcyBoYW5kbGVkIGJ5IHRoaXMgY29tcG9uZW50CiAqCiAqIFRoaXMgY29tcG9uZW50IGlzIHVzZWQgaW4gdGhlc2UgZml2ZSBmb3JtczoKICoKICogMS4gQ2x1c3RlciBFeHBsb3JlciA+IE1vcmUgUmVzb3VyY2VzID4gUkJBQyA+IENsdXN0ZXJSb2xlcwogKiAgIC0gU2hvdWxkIHNob3cgbGlzdCBvZiBjbHVzdGVyIHNjb3BlZCByZXNvdXJjZXMgYW5kIG5hbWVzcGFjZWQgcmVzb3VyY2VzCiAqIDIuIENsdXN0ZXIgRXhwbG9yZXIgPiBNb3JlIFJlc291cmNlcyA+IFJCQUMgPiBSb2xlcwogKiAgIC0gU2hvdWxkIHNob3cgbGlzdCBvZiBuYW1lc3BhY2VkIHJlc291cmNlcwogKiAzLiBVc2VycyAmIEF1dGhlbnRpY2F0aW9uID4gUm9sZXMgPiBHbG9iYWwKICogICAtIFNob3VsZCBzaG93IGdsb2JhbCwgY2x1c3RlciBhbmQgbmFtZXNwYWNlIHNjb3BlZCByZXNvdXJjZXMKICogNC4gVXNlcnMgJiBBdXRoZW50aWNhdGlvbiA+IFJvbGVzID4gQ2x1c3RlcgogKiAgIC0gU2hvdWxkIHNob3cgY2x1c3RlciBhbmQgbmFtZXNwYWNlIHNjb3BlZCByZXNvdXJjZXMKICogNS4gVXNlcnMgJiBBdXRoZW50aWNhdGlvbiA+IFJvbGVzID4gUHJvamVjdHMgJiBOYW1lc3BhY2VzCiAqICAgLSBTaG91bGQgc2hvdyBvbmx5IG5hbWVzcGFjZSBzY29wZWQgcmVzb3VyY2VzCiAqLwpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgQXJyYXlMaXN0LAogICAgQ3J1UmVzb3VyY2UsCiAgICBSYWRpb0dyb3VwLAogICAgU2VsZWN0LAogICAgTmFtZU5zRGVzY3JpcHRpb24sCiAgICBUYWIsCiAgICBUYWJiZWQsCiAgICBTb3J0YWJsZVRhYmxlLAogICAgTG9hZGluZywKICAgIEVycm9yLAogICAgQmFubmVyCiAgfSwKCiAgbWl4aW5zOiBbQ3JlYXRlRWRpdFZpZXcsIEZvcm1WYWxpZGF0aW9uXSwKCiAgYXN5bmMgZmV0Y2goKSB7CiAgICAvLyBXZSBkb24ndCB3YW50IHRvIGdldCBhbGwgc2NoZW1hcyBmcm9tIHRoZSBjbHVzdGVyIGJlY2F1c2UgdGhlcmUgYXJlCiAgICAvLyB0d28gcHJvYmxlbXMgd2l0aCB0aGF0OgogICAgLy8gLSBJbiB0aGUgbG9jYWwgY2x1c3RlciwgdGhhdCB5aWVsZHMgb3ZlciA1MDAtMSwwMDAgc2NoZW1hcywgbW9zdCBvZiB3aGljaCBhcmVuJ3QgbWVhbnQgdG8KICAgIC8vICAgYmUgZWRpdGVkIGJ5IGh1bWFucy4KICAgIC8vIC0gUG9wdWxhdGluZyB0aGUgbGlzdCBkaXJlY3RseSBmcm9tIHRoZSBzY2hlbWFzIHdvdWxkbid0IGluY2x1ZGUgcmVzb3VyY2VzIHRoYXQgbWF5CiAgICAvLyAgIGJlIGluIGRvd25zdHJlYW0gY2x1c3RlcnMgYnV0IG5vdCB0aGUgbG9jYWwgY2x1c3Rlci4gRm9yIGV4YW1wbGUsIGlmIHRoZSBsb2dnaW5nCiAgICAvLyAgIGFwcGxpY2F0aW9uIGlzbid0IGluc3RhbGxlZCBpbiB0aGUgbG9jYWwgY2x1c3RlciwgeW91IHdvdWxkbid0IHNlZSBsb2dnaW5nIHJlc291cmNlcwogICAgLy8gICBzdWNoIGFzIEZsb3dzIGluIHRoZSByZXNvdXJjZSBsaXN0LCB3aGljaCB5b3UgbWlnaHQgd2FudCBpbiBvcmRlciB0bwogICAgLy8gICBjcmVhdGUgYSByb2xlIHRoYXQgaXMgaW50ZW5kZWQgdG8gYmUgdXNlZCBieSBzb21lb25lIHdpdGggYWNjZXNzIHRvIGEgY2x1c3RlciB3aGVyZQogICAgLy8gICBsb2dnaW5nIGlzIGluc3RhbGxlZC4KICAgIC8vIFRoZXJlZm9yZSB3ZSB1c2UgYSBoYXJkY29kZWQgbGlzdCB0aGF0IGlzIGVzc2VudGlhbGx5IGludGVuZGVkCiAgICAvLyB0byBiZSBpbi1hcHAgZG9jdW1lbnRhdGlvbiBmb3IgY29udmVuaWVuY2Ugb25seSwgd2hpbGUgYWxsb3dpbmcKICAgIC8vIHVzZXJzIHRvIGZyZWVseSB0eXBlIGluIHJlc291cmNlcyB0aGF0IGFyZSBub3Qgc2hvd24gaW4gdGhlIGxpc3QuCgogICAgaWYgKHRoaXMudmFsdWUuc3VidHlwZSA9PT0gQ0xVU1RFUiB8fCB0aGlzLnZhbHVlLnN1YnR5cGUgPT09IE5BTUVTUEFDRSkgewogICAgICAoYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goYG1hbmFnZW1lbnQvZmluZEFsbGAsIHsgdHlwZTogTUFOQUdFTUVOVC5ST0xFX1RFTVBMQVRFIH0pKS5mb3JFYWNoKCh0ZW1wbGF0ZSkgPT4gewogICAgICAgIC8vIEVuc3VyZSB3ZSBoYXZlIHF1aWNrIGFjY2VzcyB0byBhIHNwZWNpZmljIHRlbXBsYXRlLiBUaGlzIGFsbG93cyB1bnNlbGVjdGVkIGRyb3AgZG93bnMgdG8gc2hvdyB0aGUgY29ycmVjdCB2YWx1ZQogICAgICAgIHRoaXMua2V5ZWRUZW1wbGF0ZU9wdGlvbnNbdGVtcGxhdGUuaWRdID0gewogICAgICAgICAgbGFiZWw6IHRlbXBsYXRlLm5hbWVEaXNwbGF5LAogICAgICAgICAgdmFsdWU6IHRlbXBsYXRlLmlkCiAgICAgICAgfTsKICAgICAgfSk7CiAgICAgIHRoaXMudGVtcGxhdGVPcHRpb25zID0gT2JqZWN0LnZhbHVlcyh0aGlzLmtleWVkVGVtcGxhdGVPcHRpb25zKTsKICAgIH0KICAgIGlmICh0aGlzLnJlYWxNb2RlID09PSBfQ0xPTkUpIHsKICAgICAgdGhpcy52YWx1ZS5kaXNwbGF5TmFtZSA9ICcnOwogICAgICB0aGlzLnZhbHVlLmJ1aWx0aW4gPSBmYWxzZTsKICAgIH0KICB9LAoKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZGVmYXVsdFJ1bGU6IHsKICAgICAgICBhcGlHcm91cHM6ICAgICAgIFsnJ10sCiAgICAgICAgbm9uUmVzb3VyY2VVUkxzOiBbXSwKICAgICAgICByZXNvdXJjZU5hbWVzOiAgIFtdLAogICAgICAgIHJlc291cmNlczogICAgICAgW10sCiAgICAgICAgdmVyYnM6ICAgICAgICAgICBbXQogICAgICB9LAogICAgICB2ZXJiT3B0aW9uczogICAgICAgICAgVkVSQlMsCiAgICAgIHRlbXBsYXRlT3B0aW9uczogICAgICBbXSwKICAgICAga2V5ZWRUZW1wbGF0ZU9wdGlvbnM6IHt9LAogICAgICByZXNvdXJjZXM6ICAgICAgICAgICAgdGhpcy52YWx1ZS5yZXNvdXJjZXMsCiAgICAgIHNjb3BlZFJlc291cmNlczogICAgICBTQ09QRURfUkVTT1VSQ0VTLAogICAgICBkZWZhdWx0VmFsdWU6ICAgICAgICAgZmFsc2UsCiAgICAgIHNlbGVjdEZvY3VzZWQ6ICAgICAgICBudWxsLAogICAgICBmdkZvcm1SdWxlU2V0czogICAgICAgWwogICAgICAgIHsgcGF0aDogJ2Rpc3BsYXlOYW1lJywgcnVsZXM6IFsncmVxdWlyZWQnXSB9CiAgICAgIF0sCiAgICB9OwogIH0sCgogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLiRzZXQodGhpcy52YWx1ZSwgJ3J1bGVzJywgdGhpcy52YWx1ZS5ydWxlcyB8fCBbXSk7CiAgICB0aGlzLnZhbHVlLnJ1bGVzLmZvckVhY2goKHJ1bGUpID0+IHsKICAgICAgaWYgKHJ1bGUudmVyYnNbMF0gPT09ICcqJykgewogICAgICAgIHRoaXMuJHNldChydWxlLCAndmVyYnMnLCBbLi4uVkVSQlNdKTsKICAgICAgfQogICAgfSk7CgogICAgY29uc3QgcXVlcnkgPSB7IC4uLnRoaXMuJHJvdXRlLnF1ZXJ5IH07CiAgICBjb25zdCB7IHJvbGVDb250ZXh0IH0gPSBxdWVyeTsKCiAgICBpZiAocm9sZUNvbnRleHQgJiYgdGhpcy52YWx1ZS51cGRhdGVTdWJ0eXBlKSB7CiAgICAgIHRoaXMudmFsdWUudXBkYXRlU3VidHlwZShyb2xlQ29udGV4dCk7CiAgICB9CgogICAgLy8gU2V0IHRoZSBkZWZhdWx0IHZhbHVlIGZvciB0aGUgbWFwcGVkIHN1YnR5cGUKICAgIHRoaXMuZGVmYXVsdFZhbHVlID0gISF0aGlzLnZhbHVlW1NVQlRZUEVfTUFQUElOR1t0aGlzLnZhbHVlLnN1YnR5cGVdLmRlZmF1bHRLZXldOwoKICAgIHN3aXRjaCAodGhpcy52YWx1ZS5zdWJ0eXBlKSB7CiAgICBjYXNlIENMVVNURVI6CiAgICBjYXNlIE5BTUVTUEFDRToKICAgICAgdGhpcy4kc2V0KHRoaXMudmFsdWUsICdyb2xlVGVtcGxhdGVOYW1lcycsIHRoaXMudmFsdWUucm9sZVRlbXBsYXRlTmFtZXMgfHwgW10pOwogICAgICB0aGlzLiRzZXQodGhpcy52YWx1ZSwgJ2xvY2tlZCcsICEhdGhpcy52YWx1ZS5sb2NrZWQpOwogICAgICBicmVhazsKICAgIH0KCiAgICAvLyBPbiBzYXZlIGhvb2sgcmVxdWVzdAogICAgaWYgKHRoaXMucmVnaXN0ZXJCZWZvcmVIb29rKSB7CiAgICAgIHRoaXMucmVnaXN0ZXJCZWZvcmVIb29rKCgpID0+IHsKICAgICAgICAvLyBNYXAgZGVmYXVsdCB2YWx1ZSBiYWNrIHRvIGl0cyBvd24ga2V5IGZvciBnaXZlbiBzdWJ0eXBlCiAgICAgICAgdGhpcy52YWx1ZVtTVUJUWVBFX01BUFBJTkdbdGhpcy52YWx1ZS5zdWJ0eXBlXS5kZWZhdWx0S2V5XSA9ICEhdGhpcy5kZWZhdWx0VmFsdWU7CiAgICAgIH0pOwogICAgfQoKICAgIGlmICh0aGlzLnZhbHVlPy5tZXRhZGF0YT8ubmFtZSAmJiAhdGhpcy52YWx1ZS5kaXNwbGF5TmFtZSkgewogICAgICB0aGlzLiRzZXQodGhpcy52YWx1ZSwgJ2Rpc3BsYXlOYW1lJywgdGhpcy52YWx1ZS5tZXRhZGF0YS5uYW1lKTsKICAgIH0KCiAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgIHRoaXMuJGVtaXQoJ3NldC1zdWJ0eXBlJywgdGhpcy5sYWJlbCk7CiAgICB9KTsKICB9LAoKICBjb21wdXRlZDogewogICAgLi4ubWFwR2V0dGVycyhbJ3JlbGVhc2VOb3Rlc1VybCddKSwKCiAgICBzaG93UmVzdHJpY3RlZEFkbWluRGVwcmVjYXRpb25CYW5uZXIoKSB7CiAgICAgIHJldHVybiB0aGlzLnZhbHVlLnN1YnR5cGUgPT09IEdMT0JBTCAmJiB0aGlzLnZhbHVlLmlkID09PSAncmVzdHJpY3RlZC1hZG1pbic7CiAgICB9LAoKICAgIGxhYmVsKCkgewogICAgICByZXR1cm4gdGhpcy50KGByYmFjLnJvbGV0ZW1wbGF0ZS5zdWJ0eXBlcy4keyB0aGlzLnZhbHVlLnN1YnR5cGUgfS5sYWJlbGApOwogICAgfSwKICAgIGRlZmF1bHRMYWJlbCgpIHsKICAgICAgcmV0dXJuIHRoaXMudChgcmJhYy5yb2xldGVtcGxhdGUuc3VidHlwZXMuJHsgdGhpcy52YWx1ZS5zdWJ0eXBlIH0uZGVmYXVsdExhYmVsYCk7CiAgICB9LAogICAgbG9ja2VkT3B0aW9ucygpIHsKICAgICAgcmV0dXJuIFsKICAgICAgICB7CiAgICAgICAgICB2YWx1ZTogdHJ1ZSwKICAgICAgICAgIGxhYmVsOiB0aGlzLnQoJ3JiYWMucm9sZXRlbXBsYXRlLmxvY2tlZC55ZXMnKQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdmFsdWU6IGZhbHNlLAogICAgICAgICAgbGFiZWw6IHRoaXMudCgncmJhYy5yb2xldGVtcGxhdGUubG9ja2VkLm5vJykKICAgICAgICB9CiAgICAgIF07CiAgICB9LAogICAgcmVzb3VyY2VPcHRpb25zKCkgewogICAgICBjb25zdCBvcHRpb25zID0gW107CgogICAgICBjb25zdCBzY29wZXMgPSBPYmplY3Qua2V5cyh0aGlzLnNjb3BlZFJlc291cmNlcyk7CgogICAgICBzY29wZXMuZm9yRWFjaCgoc2NvcGUpID0+IHsKICAgICAgICBpZiAoc2NvcGUgPT09ICdnbG9iYWxTY29wZWRBcGlHcm91cHMnICYmIHRoaXMudmFsdWUudHlwZSAhPT0gTUFOQUdFTUVOVC5HTE9CQUxfUk9MRSkgewogICAgICAgICAgLy8gSWYgd2UgYXJlIG5vdCBpbiB0aGUgZ2xvYmFsIHJvbGUgY3JlYXRpb24gZm9ybSwKICAgICAgICAgIC8vIHNraXAgYWRkaW5nIHRoZSBnbG9iYWwtc2NvcGVkIHJlc291cmNlcy4KICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHNjb3BlID09PSAnY2x1c3RlclNjb3BlZEFwaUdyb3VwcycgJiYgKHRoaXMudmFsdWUudHlwZSA9PT0gUkJBQy5ST0xFIHx8IHRoaXMudmFsdWUuc3VidHlwZSA9PT0gTkFNRVNQQUNFKSkgewogICAgICAgICAgLy8gSWYgd2UgYXJlIGluIGEgcHJvamVjdC9uYW1lc3BhY2Ugcm9sZSBjcmVhdGlvbiBmb3JtLAogICAgICAgICAgLy8gYWRkaXRpb25hbGx5IHNraXAgYWRkaW5nIHRoZSBjbHVzdGVyLXNjb3BlZCByZXNvdXJjZXMuCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGFwaUdyb3Vwc0luU2NvcGUgPSB0aGlzLnNjb3BlZFJlc291cmNlc1tzY29wZV07CgogICAgICAgIGNvbnN0IGFwaUdyb3VwTmFtZXMgPSBPYmplY3Qua2V5cyhhcGlHcm91cHNJblNjb3BlKTsKCiAgICAgICAgLy8gUHV0IGVhY2ggQVBJIGdyb3VwIGFzIGEgaGVhZGVyIGFuZCBwdXQgaXRzIHJlc291cmNlcyB1bmRlciBpdC4KICAgICAgICBhcGlHcm91cE5hbWVzLmZvckVhY2goKGFwaUdyb3VwKSA9PiB7CiAgICAgICAgICAvLyBBZGQgQVBJIGdyb3VwIGFzIHRoZSBoZWFkZXIgZm9yIGEgZ3JvdXAgb2YgcmVsYXRlZCByZXNvdXJjZXMuCiAgICAgICAgICBsZXQgYXBpR3JvdXBMYWJlbCA9IGFwaUdyb3VwOwogICAgICAgICAgbGV0IGFwaUdyb3VwVmFsdWUgPSBhcGlHcm91cDsKCiAgICAgICAgICBpZiAoYXBpR3JvdXAgPT09ICdjb3JlS3ViZXJuZXRlc0FwaScpIHsKICAgICAgICAgICAgLy8gSWYgYSByZXNvdXJjZSBiZWxvbmdzIHRvIHRoZSBjb3JlIEt1YmVybmV0ZXMgQVBJLAogICAgICAgICAgICAvLyB0aGUgQVBJIGdyb3VwIGlzIHRlY2huaWNhbGx5IGFuIGVtcHR5IHN0cmluZyBidXQKICAgICAgICAgICAgLy8gd2Ugd2lsbCBsYWJlbCBpdCAiQ29yZSBLOHMgQVBJLCBDbHVzdGVyIFNjb3BlZC4iCgogICAgICAgICAgICAvLyBTb21lIGNvcmUgS3ViZXJuZXRlcyByZXNvdXJjZXMgYXJlIG5hbWVzcGFjZWQsCiAgICAgICAgICAgIC8vIGluIHdoaWNoIGNhc2UgdGhleSBnbyB1bmRlciBhIGRpZmZlcmVudCBoZWFkaW5nCiAgICAgICAgICAgIC8vICJDb3JlIEs4cyBBUEksIE5hbWVzcGFjZWQuIiBUaGlzIGxldHMgdXMKICAgICAgICAgICAgLy8gc2VwYXJhdGUgdGhlbSBieSBzY29wZS4KICAgICAgICAgICAgY29uc3QgbGFiZWxGb3JOb0FwaUdyb3VwID0gdGhpcy50KCdyYmFjLnJvbGV0ZW1wbGF0ZS50YWJzLmdyYW50UmVzb3VyY2VzLm5vQXBpR3JvdXBDbHVzdGVyU2NvcGUnKTsKICAgICAgICAgICAgY29uc3QgbGFiZWxGb3JOYW1lc3BhY2VkUmVzb3VyY2VzV2l0aE5vQXBpR3JvdXAgPSB0aGlzLnQoJ3JiYWMucm9sZXRlbXBsYXRlLnRhYnMuZ3JhbnRSZXNvdXJjZXMubm9BcGlHcm91cE5hbWVzcGFjZVNjb3BlJyk7CgogICAgICAgICAgICBhcGlHcm91cExhYmVsID0gc2NvcGUuaW5jbHVkZXMoJ2NsdXN0ZXInKSA/IGxhYmVsRm9yTm9BcGlHcm91cCA6IGxhYmVsRm9yTmFtZXNwYWNlZFJlc291cmNlc1dpdGhOb0FwaUdyb3VwOwogICAgICAgICAgICBhcGlHcm91cFZhbHVlID0gJyc7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGFwaUdyb3VwID09PSAnbmV1dmVjdG9yQXBpJykgewogICAgICAgICAgICAvLyBTb21lIE5ldVZlY3RvciByZXNvdXJjZXMgYXJlIG5hbWVzcGFjZWQsIGluIHdoaWNoIGNhc2UgdGhleSBnbyB1bmRlciBhIGRpZmZlcmVudCBoZWFkaW5nCiAgICAgICAgICAgIGNvbnN0IGxhYmVsRm9yQ2x1c3RlclNjb3BlZCA9IHRoaXMudCgncmJhYy5yb2xldGVtcGxhdGUudGFicy5ncmFudFJlc291cmNlcy5uZXV2ZWN0b3IubGFiZWxDbHVzdGVyU2NvcGVkJyk7CiAgICAgICAgICAgIGNvbnN0IGxhYmVsRm9yTmFtZXNwYWNlU2NvcGVkID0gdGhpcy50KCdyYmFjLnJvbGV0ZW1wbGF0ZS50YWJzLmdyYW50UmVzb3VyY2VzLm5ldXZlY3Rvci5sYWJlbE5hbWVzcGFjZVNjb3BlZCcpOwoKICAgICAgICAgICAgYXBpR3JvdXBMYWJlbCA9IHNjb3BlLmluY2x1ZGVzKCdjbHVzdGVyJykgPyBsYWJlbEZvckNsdXN0ZXJTY29wZWQgOiBsYWJlbEZvck5hbWVzcGFjZVNjb3BlZDsKICAgICAgICAgICAgYXBpR3JvdXBWYWx1ZSA9ICdhcGkubmV1dmVjdG9yLmNvbSc7CiAgICAgICAgICB9CgogICAgICAgICAgb3B0aW9ucy5wdXNoKHsKICAgICAgICAgICAga2luZDogICAgICAnZ3JvdXAnLAogICAgICAgICAgICBvcHRpb25LZXk6IGFwaUdyb3VwTGFiZWwsCiAgICAgICAgICAgIGxhYmVsOiAgICAgYXBpR3JvdXBMYWJlbCwKICAgICAgICAgICAgdmFsdWU6ICAgICBhcGlHcm91cFZhbHVlLAogICAgICAgICAgICBkaXNhYmxlZDogIHRydWUsCiAgICAgICAgICB9KTsKCiAgICAgICAgICBjb25zdCByZXNvdXJjZXNJbkFwaUdyb3VwID0gdGhpcy5zY29wZWRSZXNvdXJjZXNbc2NvcGVdW2FwaUdyb3VwXS5yZXNvdXJjZXM7CgogICAgICAgICAgLy8gQWRkIG5vbi1kZXByZWNhdGVkIHJlc291cmNlcyB0byB0aGUgcmVzb3VyY2Ugb3B0aW9ucyBsaXN0CiAgICAgICAgICByZXNvdXJjZXNJbkFwaUdyb3VwLmZvckVhY2goKHJlc291cmNlTmFtZSkgPT4gewogICAgICAgICAgICBvcHRpb25zLnB1c2goewogICAgICAgICAgICAgIGxhYmVsOiAgICAgcmVzb3VyY2VOYW1lLAogICAgICAgICAgICAgIC8vIFVzZSB1bmlxdWUga2V5IGZvciByZXNvdXJjZSBsaXN0IGluIHRoZSBTZWxlY3QgZHJvcGRvd24KICAgICAgICAgICAgICBvcHRpb25LZXk6IGFwaUdyb3VwVmFsdWUuY29uY2F0KHJlc291cmNlTmFtZSksCiAgICAgICAgICAgICAgdmFsdWU6ICAgICB7CiAgICAgICAgICAgICAgICByZXNvdXJjZU5hbWU6IHJlc291cmNlTmFtZS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgYXBpR3JvdXBWYWx1ZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICAvLyBJZiB0aGUgQVBJIGdyb3VwIGhhcyBhbnkgZGVwcmVjYXRlZCBvcHRpb25zLAogICAgICAgICAgLy8gbGlzdCB0aGVtIGFzICJSZXNvdXJjZSBOYW1lIChkZXByZWNhdGVkKSIKICAgICAgICAgIGlmICh0aGlzLnNjb3BlZFJlc291cmNlc1tzY29wZV1bYXBpR3JvdXBdLmRlcHJlY2F0ZWRSZXNvdXJjZXMpIHsKICAgICAgICAgICAgY29uc3QgZGVwcmVjYXRlZFJlc291cmNlc0luQXBpR3JvdXAgPSB0aGlzLnNjb3BlZFJlc291cmNlc1tzY29wZV1bYXBpR3JvdXBdLmRlcHJlY2F0ZWRSZXNvdXJjZXM7CiAgICAgICAgICAgIGNvbnN0IGRlcHJlY2F0ZWRMYWJlbCA9IHRoaXMudCgncmJhYy5yb2xldGVtcGxhdGUudGFicy5ncmFudFJlc291cmNlcy5kZXByZWNhdGVkTGFiZWwnKTsKCiAgICAgICAgICAgIGRlcHJlY2F0ZWRSZXNvdXJjZXNJbkFwaUdyb3VwLmZvckVhY2goKHJlc291cmNlTmFtZSkgPT4gewogICAgICAgICAgICAgIG9wdGlvbnMucHVzaCh7CiAgICAgICAgICAgICAgICBsYWJlbDogICAgIGAkeyByZXNvdXJjZU5hbWUgfSAkeyBkZXByZWNhdGVkTGFiZWwgfWAsCiAgICAgICAgICAgICAgICBvcHRpb25LZXk6IGFwaUdyb3VwVmFsdWUuY29uY2F0KHJlc291cmNlTmFtZSksCiAgICAgICAgICAgICAgICB2YWx1ZTogICAgIHsKICAgICAgICAgICAgICAgICAgcmVzb3VyY2VOYW1lOiByZXNvdXJjZU5hbWUudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgICAgICAgYXBpR3JvdXBWYWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICBvcHRpb25zLnB1c2goewogICAgICAgIC8vIFRoaXMgaGlkZGVuIG9wdGlvbiBpcyB0byB3b3JrIGFyb3VuZCBhIGJ1ZyBpbiB0aGUgU2VsZWN0CiAgICAgICAgLy8gY29tcG9uZW50IHdoZXJlIGFuIG9wdGlvbiBtYXJrZWQgYXMgZGlzYWJsZWQKICAgICAgICAvLyBpcyBzdGlsbCBzZWxlY3RlZCBieSBkZWZhdWx0IGlmIGlzIHZhbHVlIGlzIGFuIGVtcHR5IHN0cmluZy4KCiAgICAgICAgLy8gSW4gdGhlIFJvbGUgb3IgUHJvamVjdCBSb2xlIGZvcm0sIGFuIEFQSSBncm91cCB3aWxsIGJlIHRoZQogICAgICAgIC8vIGRlZmF1bHQgY2hvaWNlIGZvciB0aGUgbmFtZXNwYWNlIHZhbHVlIGJlY2F1c2UgdGhlcmUncyBvbmx5CiAgICAgICAgLy8gb25lIG9wdGlvbiB3aXRoIHRoZSB2YWx1ZSBhcyBhbiBlbXB0eSBzdHJpbmcgYW5kIHRoYXQncyB0aGUgZGVmYXVsdAogICAgICAgIC8vIHZhbHVlIGZvciB0aGUgbmFtZXNwYWNlLiBJdCdzIG5vdCBnb29kIHRvIGhhdmUgYW4gQVBJCiAgICAgICAgLy8gZ3JvdXAgYXMgdGhlIGRlZmF1bHQgdmFsdWUgZm9yIGEgcmVzb3VyY2UuCiAgICAgICAgLy8gQWRkaW5nIHRoaXMgb3B0aW9uIG1lYW5zIHRoZXJlIGFyZSBsZWFzdCB0d28gdmFsdWVzIHdpdGggYW4KICAgICAgICAvLyBlbXB0eSBzdHJpbmcgaW4gdGhlIG9wdGlvbnMsIHByZXZlbnRpbmcgdGhlIFNlbGVjdCBmcm9tCiAgICAgICAgLy8gc2VsZWN0aW5nIGEgZGlzYWJsZWQgaGVhZGVyIGdyb3VwIGFzIHRoZSByZXNvdXJjZSBieSBkZWZhdWx0LgoKICAgICAgICAvLyBUaGlzIGJ1ZyBpcyBzdWNoIGFuIGVkZ2UgY2FzZSB0aGF0IEkgY2FuJ3QgaW1hZ2luZSBhbnlvbmUKICAgICAgICAvLyBlbHNlIGhpdHRpbmcgaXQsIHNvIEkgZmlndXJlZCB0aGUgd29ya2Fyb3VuZCBpcyBiZXR0ZXIKICAgICAgICAvLyB0aGFuIGZpeGluZyB0aGUgc2VsZWN0LgogICAgICAgIGtpbmQ6ICAgICAgJ2dyb3VwJywKICAgICAgICBvcHRpb25LZXk6ICdoaWRkZW5PcHRpb24nLAogICAgICAgIGxhYmVsOiAgICAgJ18nLAogICAgICAgIHZhbHVlOiAgICAgJycsCiAgICAgICAgZGlzYWJsZWQ6ICB0cnVlLAogICAgICB9KTsKCiAgICAgIHJldHVybiBvcHRpb25zOwogICAgfSwKCiAgICBuZXdVc2VyRGVmYXVsdE9wdGlvbnMoKSB7CiAgICAgIHJldHVybiBbCiAgICAgICAgewogICAgICAgICAgdmFsdWU6IHRydWUsCiAgICAgICAgICBsYWJlbDogdGhpcy50KGByYmFjLnJvbGV0ZW1wbGF0ZS5zdWJ0eXBlcy4keyB0aGlzLnZhbHVlLnN1YnR5cGUgfS55ZXNgKQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdmFsdWU6IGZhbHNlLAogICAgICAgICAgbGFiZWw6IHRoaXMudCgncmJhYy5yb2xldGVtcGxhdGUubmV3VXNlckRlZmF1bHQubm8nKQogICAgICAgIH0KICAgICAgXTsKICAgIH0sCiAgICBpc1JhbmNoZXJSb2xlVGVtcGxhdGUoKSB7CiAgICAgIHJldHVybiB0aGlzLnZhbHVlLnN1YnR5cGUgPT09IENMVVNURVIgfHwgdGhpcy52YWx1ZS5zdWJ0eXBlID09PSBOQU1FU1BBQ0U7CiAgICB9LAogICAgaXNOYW1lc3BhY2VkKCkgewogICAgICByZXR1cm4gdGhpcy52YWx1ZS5zdWJ0eXBlID09PSBSQkFDX1JPTEU7CiAgICB9LAogICAgaXNSYW5jaGVyVHlwZSgpIHsKICAgICAgcmV0dXJuIHRoaXMudmFsdWUuc3VidHlwZSA9PT0gR0xPQkFMIHx8IHRoaXMudmFsdWUuc3VidHlwZSA9PT0gQ0xVU1RFUiB8fCB0aGlzLnZhbHVlLnN1YnR5cGUgPT09IE5BTUVTUEFDRTsKICAgIH0sCiAgICBpc0RldGFpbCgpIHsKICAgICAgcmV0dXJuIHRoaXMuYXMgPT09IF9ERVRBSUw7CiAgICB9LAogICAgaXNCdWlsdGluKCkgewogICAgICByZXR1cm4gdGhpcy52YWx1ZS5idWlsdGluOwogICAgfSwKICAgIGRvbmVMb2NhdGlvbk92ZXJyaWRlKCkgewogICAgICByZXR1cm4gdGhpcy52YWx1ZS5saXN0TG9jYXRpb247CiAgICB9LAogICAgcnVsZUNsYXNzKCkgewogICAgICByZXR1cm4gYGNvbCAkeyB0aGlzLmlzTmFtZXNwYWNlZCA/ICdzcGFuLTQnIDogJ3NwYW4tMycgfWA7CiAgICB9LAogICAgLy8gRGV0YWlsIFZpZXcKICAgIHJ1bGVzKCkgewogICAgICByZXR1cm4gdGhpcy5jcmVhdGVSdWxlcyh0aGlzLnZhbHVlKTsKICAgIH0sCiAgICBydWxlSGVhZGVycygpIHsKICAgICAgY29uc3QgdmVyYkhlYWRlcnMgPSBWRVJCUy5tYXAoKHZlcmIpID0+ICh7CiAgICAgICAgbmFtZTogICAgICB2ZXJiLAogICAgICAgIGtleTogICAgICAgdWNGaXJzdCh2ZXJiKSwKICAgICAgICB2YWx1ZTogICAgIHRoaXMudmVyYktleSh2ZXJiKSwKICAgICAgICBmb3JtYXR0ZXI6ICdDaGVja2VkJywKICAgICAgICBhbGlnbjogICAgICdjZW50ZXInCiAgICAgIH0pKTsKCiAgICAgIHJldHVybiBbCiAgICAgICAgLi4udmVyYkhlYWRlcnMsCiAgICAgICAgewogICAgICAgICAgbmFtZTogICAgICAnY3VzdG9tJywKICAgICAgICAgIGxhYmVsS2V5OiAgJ3RhYmxlSGVhZGVycy5jdXN0b21WZXJicycsCiAgICAgICAgICBrZXk6ICAgICAgIHVjRmlyc3QoJ2N1c3RvbScpLAogICAgICAgICAgdmFsdWU6ICAgICAnaGFzQ3VzdG9tVmVyYnMnLAogICAgICAgICAgZm9ybWF0dGVyOiAnQ2hlY2tlZCcsCiAgICAgICAgICBhbGlnbjogICAgICdjZW50ZXInCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAgICAgICdyZXNvdXJjZXMnLAogICAgICAgICAgbGFiZWxLZXk6ICAndGFibGVIZWFkZXJzLnJlc291cmNlcycsCiAgICAgICAgICB2YWx1ZTogICAgICdyZXNvdXJjZXMnLAogICAgICAgICAgZm9ybWF0dGVyOiAnbGlzdCcsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAgICAgICd1cmwnLAogICAgICAgICAgbGFiZWxLZXk6ICAndGFibGVIZWFkZXJzLnVybCcsCiAgICAgICAgICB2YWx1ZTogICAgICdub25SZXNvdXJjZVVSTHMnLAogICAgICAgICAgZm9ybWF0dGVyOiAnbGlzdCcsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAgICAgICdhcGlHcm91cHMnLAogICAgICAgICAgbGFiZWxLZXk6ICAndGFibGVIZWFkZXJzLmFwaUdyb3VwJywKICAgICAgICAgIHZhbHVlOiAgICAgJ2FwaUdyb3VwcycsCiAgICAgICAgICBmb3JtYXR0ZXI6ICdsaXN0JywKICAgICAgICB9CiAgICAgIF07CiAgICB9LAogICAgaW5oZXJpdGVkUnVsZXMoKSB7CiAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUluaGVyaXRlZFJ1bGVzKHRoaXMudmFsdWUsIFtdLCBmYWxzZSk7CiAgICB9CiAgfSwKCiAgbWV0aG9kczogewoKICAgIHNldFJ1bGUoa2V5LCBydWxlLCBldmVudCkgewogICAgICAvLyBUaGUga2V5IGlzIHRoZSBhc3BlY3Qgb2YgYSBwZXJtaXNzaW9ucyBydWxlCiAgICAgIC8vIHRoYXQgaXMgYmVpbmcgc2V0LCBmb3IgZXhhbXBsZSwgInZlcmJzLCIgInJlc291cmNlcyIsCiAgICAgIC8vICJhcGlHcm91cHMiIG9yICJub25SZXNvdXJjZVVybHMuIgoKICAgICAgLy8gVGhlIGV2ZW50L3ZhbHVlIGNvbnRhaW5zIG5hbWUgb2YgYSByZXNvdXJjZSwKICAgICAgLy8gZm9yIGV4YW1wbGUsICJBcHBzLiIKCiAgICAgIC8vIFRoZSAncnVsZScgY29udGFpbnMgdGhlIHRoZSBjb250ZW50cyBvZiBlYWNoIHJvdyBvZiB0aGUKICAgICAgLy8gcm9sZSBjcmVhdGlvbiBmb3JtIHVuZGVyIEdyYW50IFJlc291cmNlcy4gRWFjaAogICAgICAvLyBydWxlIGNvbnRhaW5zIHRoZXNlIGZpZWxkczoKICAgICAgLy8gLSBhcGlHcm91cHMKICAgICAgLy8gLSBub25SZXNvdXJjZVVSTHMKICAgICAgLy8gLSByZXNvdXJjZU5hbWVzCiAgICAgIC8vIC0gcmVzb3VyY2VzCiAgICAgIC8vIC0gdmVyYnMKCiAgICAgIHN3aXRjaCAoa2V5KSB7CiAgICAgIGNhc2UgJ2FwaUdyb3Vwcyc6CgogICAgICAgIGlmIChldmVudCB8fCAoZXZlbnQgPT09ICcnKSkgewogICAgICAgICAgdGhpcy4kc2V0KHJ1bGUsICdhcGlHcm91cHMnLCBbZXZlbnRdKTsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAndmVyYnMnOgoKICAgICAgICBpZiAoZXZlbnQpIHsKICAgICAgICAgIHRoaXMuJHNldChydWxlLCAndmVyYnMnLCBbZXZlbnRdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kc2V0KHJ1bGUsICd2ZXJicycsIFtdKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdyZXNvdXJjZXMnOgogICAgICAgIGlmIChldmVudD8ucmVzb3VyY2VOYW1lKSB7CiAgICAgICAgICAvLyBJZiB3ZSBhcmUgdXBkYXRpbmcgdGhlIHJlc291cmNlcyBkZWZpbmVkIGluIGEgcnVsZSwKICAgICAgICAgIC8vIHRoZSBldmVudCB3aWxsIGJlIGFuIG9iamVjdCB3aXRoIHRoZQogICAgICAgICAgLy8gcHJvcGVydGllcyBhcGlHcm91cFZhbHVlIGFuZCByZXNvdXJjZU5hbWUuCiAgICAgICAgICB0aGlzLiRzZXQocnVsZSwgJ3Jlc291cmNlcycsIFtldmVudC5yZXNvdXJjZU5hbWVdKTsKICAgICAgICAgIC8vIEF1dG9tYXRpY2FsbHkgZmlsbCBpbiB0aGUgQVBJIGdyb3VwIG9mIHRoZQogICAgICAgICAgLy8gc2VsZWN0ZWQgcmVzb3VyY2UuCiAgICAgICAgICB0aGlzLiRzZXQocnVsZSwgJ2FwaUdyb3VwcycsIFtldmVudC5hcGlHcm91cFZhbHVlXSk7CiAgICAgICAgfSBlbHNlIGlmIChldmVudD8ubGFiZWwpIHsKICAgICAgICAgIC8vIFdoZW4gdGhlIHVzZXIgY3JlYXRlcyBhIG5ldyByZXNvdXJjZSBuYW1lIGluIHRoZSByZXNvdXJjZQogICAgICAgICAgLy8gZmllbGQgaW5zdGVhZCBvZiBzZWxlY3RpbmcgYW4gZXhpc3Rpbmcgb25lLAogICAgICAgICAgLy8gd2UgaGF2ZSB0byB0cmVhdCB0aGF0IGRpZmZlcmVudGx5IGJlY2F1c2UgdGhlIGluY29taW5nIGV2ZW50CiAgICAgICAgICAvLyBpcyBzaGFwZWQgbGlrZSB7ImxhYmVsIjoic29tZXRoaW5nIn0gaW5zdGVhZCBvZgogICAgICAgICAgLy8gdGhlIHNhbWUgZm9ybWF0IGFzIHRoZSBvdGhlciBvcHRpb25zOgogICAgICAgICAgLy8geyByZXNvdXJjZU5hbWU6ICJzb21ldGhpbmciLCBhcGlHcm91cFZhbHVlOiAiIiB9CiAgICAgICAgICB0aGlzLiRzZXQocnVsZSwgJ3Jlc291cmNlcycsIFtldmVudC5sYWJlbF0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLiRzZXQocnVsZSwgJ3Jlc291cmNlcycsIFtdKTsKICAgICAgICAgIHRoaXMuJHNldChydWxlLCAnYXBpR3JvdXBzJywgW10pOwogICAgICAgIH0KICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ25vblJlc291cmNlVVJMcyc6CiAgICAgICAgaWYgKGV2ZW50KSB7CiAgICAgICAgICB0aGlzLiRzZXQocnVsZSwgJ25vblJlc291cmNlVVJMcycsIFtldmVudF0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLiRzZXQocnVsZSwgJ25vblJlc291cmNlVVJMcycsIFtdKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAogICAgZ2V0UnVsZShrZXksIHJ1bGUpIHsKICAgICAgcmV0dXJuIHJ1bGVba2V5XT8uWzBdIHx8IG51bGw7CiAgICB9LAogICAgdXBkYXRlU2VsZWN0VmFsdWUocm93LCBrZXksIGV2ZW50KSB7CiAgICAgIGNvbnN0IHZhbHVlID0gZXZlbnQubGFiZWwgPyBldmVudC52YWx1ZSA6IGV2ZW50OwoKICAgICAgdGhpcy4kc2V0KHJvdywga2V5LCB2YWx1ZSk7CiAgICB9LAogICAgY2FuY2VsKCkgewogICAgICB0aGlzLmRvbmUoKTsKICAgIH0sCiAgICBhc3luYyBhY3R1YWxseVNhdmUodXJsKSB7CiAgICAgIC8vIEdvIHRocm91Z2ggYWxsIG9mIHRoZSBncnVsZXMgYW5kIHJlcGxhY2UgZG91YmxlIHF1b3RlIGFwaUdyb3VwcwogICAgICAvLyBrOFMgZG9jdW1lbnRhdGlvbiBzaG93cyB1c2luZyBlbXB0eSBydWxlcyBhcyAiIiAtIHdlIGNoYW5nZSB0aGlzIHRvIGVtcHR5IHN0cmluZyB3aGVuIHVzZWQKICAgICAgdGhpcy52YWx1ZS5ydWxlcz8uZm9yRWFjaCgocnVsZSkgPT4gewogICAgICAgIGlmIChydWxlLmFwaUdyb3VwcykgewogICAgICAgICAgcnVsZS5hcGlHcm91cHMgPSBydWxlLmFwaUdyb3Vwcy5tYXAoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgIC8vIElmIHRoZSBncm91cCBpcyB0d28gZG91YmxlIHF1b3RlcyAoIiIpIHJlcGxhY2UgaWYgd2l0aCBlbXB0eSBzdHJpbmcKICAgICAgICAgICAgaWYgKGdyb3VwLnRyaW0oKSA9PT0gJ1wiXCInKSB7CiAgICAgICAgICAgICAgZ3JvdXAgPSAnJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIGlmICggdGhpcy5pc0NyZWF0ZSApIHsKICAgICAgICB1cmwgPSB1cmwgfHwgdGhpcy5zY2hlbWEubGlua0ZvcignY29sbGVjdGlvbicpOwogICAgICAgIGF3YWl0IHRoaXMudmFsdWUuc2F2ZSh7IHVybCwgcmVkaXJlY3RVbmF1dGhvcml6ZWQ6IGZhbHNlIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGF3YWl0IHRoaXMudmFsdWUuc2F2ZSh7IHJlZGlyZWN0VW5hdXRob3JpemVkOiBmYWxzZSB9KTsKICAgICAgfQogICAgfSwKICAgIC8vIERldGFpbCBWaWV3CiAgICB2ZXJiS2V5KHZlcmIpIHsKICAgICAgcmV0dXJuIGBoYXMkeyB1Y0ZpcnN0KHZlcmIpIH1gOwogICAgfSwKICAgIGNyZWF0ZVJ1bGVzKHJvbGUpIHsKICAgICAgcmV0dXJuIChyb2xlLnJ1bGVzIHx8IFtdKS5tYXAoKHJ1bGUsIGkpID0+IHsKICAgICAgICBjb25zdCB0YWJsZVJ1bGUgPSB7CiAgICAgICAgICBpbmRleDogICAgICAgICAgIGksCiAgICAgICAgICBhcGlHcm91cHM6ICAgICAgIHJ1bGUuYXBpR3JvdXBzIHx8IFsnJ10sCiAgICAgICAgICByZXNvdXJjZXM6ICAgICAgIHJ1bGUucmVzb3VyY2VzIHx8IFtdLAogICAgICAgICAgbm9uUmVzb3VyY2VVUkxzOiBydWxlLm5vblJlc291cmNlVVJMcyB8fCBbXQogICAgICAgIH07CgogICAgICAgIFZFUkJTLmZvckVhY2goKHZlcmIpID0+IHsKICAgICAgICAgIGNvbnN0IGtleSA9IHRoaXMudmVyYktleSh2ZXJiKTsKCiAgICAgICAgICB0YWJsZVJ1bGVba2V5XSA9IHJ1bGUudmVyYnNbMF0gPT09ICcqJyB8fCBydWxlLnZlcmJzLmluY2x1ZGVzKHZlcmIpOwogICAgICAgICAgdGFibGVSdWxlLmhhc0N1c3RvbVZlcmJzID0gcnVsZS52ZXJicy5zb21lKCh2ZXJiKSA9PiAhVkVSQlMuaW5jbHVkZXModmVyYikpOwogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gdGFibGVSdWxlOwogICAgICB9KTsKICAgIH0sCiAgICBjcmVhdGVJbmhlcml0ZWRSdWxlcyhwYXJlbnQsIHJlcyA9IFtdLCBzaG93UGFyZW50ID0gdHJ1ZSkgewogICAgICBpZiAoIXBhcmVudC5yb2xlVGVtcGxhdGVOYW1lcykgewogICAgICAgIHJldHVybiBbXTsKICAgICAgfQoKICAgICAgcGFyZW50LnJvbGVUZW1wbGF0ZU5hbWVzCiAgICAgICAgLm1hcCgocnRuKSA9PiB0aGlzLiRzdG9yZS5nZXR0ZXJzW2BtYW5hZ2VtZW50L2J5SWRgXShNQU5BR0VNRU5ULlJPTEVfVEVNUExBVEUsIHJ0bikpCiAgICAgICAgLmZvckVhY2goKHJ0KSA9PiB7CiAgICAgICAgICAvLyBBZGQgU2VsZgogICAgICAgICAgcmVzLnB1c2goewogICAgICAgICAgICBzaG93UGFyZW50LAogICAgICAgICAgICBwYXJlbnQsCiAgICAgICAgICAgIHRlbXBsYXRlOiBydCwKICAgICAgICAgICAgcnVsZXM6ICAgIHRoaXMuY3JlYXRlUnVsZXMocnQpCiAgICAgICAgICB9KTsKICAgICAgICAgIC8vIEFkZCBpbmhlcml0ZWQKICAgICAgICAgIHRoaXMuY3JlYXRlSW5oZXJpdGVkUnVsZXMocnQsIHJlcyk7CiAgICAgICAgfSk7CgogICAgICByZXR1cm4gcmVzOwogICAgfSwKICB9Cn07Cg=="},{"version":3,"sources":["RoleDetailEdit.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"RoleDetailEdit.vue","sourceRoot":"node_modules/@rancher/shell/components/auth","sourcesContent":["<script>\nimport { mapGetters } from 'vuex';\nimport { MANAGEMENT, RBAC } from '@shell/config/types';\nimport CruResource from '@shell/components/CruResource';\nimport CreateEditView from '@shell/mixins/create-edit-view';\nimport FormValidation from '@shell/mixins/form-validation';\nimport Error from '@shell/components/form/Error';\nimport { RadioGroup } from '@components/Form/Radio';\nimport Select from '@shell/components/form/Select';\nimport ArrayList from '@shell/components/form/ArrayList';\nimport NameNsDescription from '@shell/components/form/NameNsDescription';\nimport Tab from '@shell/components/Tabbed/Tab';\nimport Tabbed from '@shell/components/Tabbed';\nimport { ucFirst } from '@shell/utils/string';\nimport SortableTable from '@shell/components/SortableTable';\nimport { _CLONE, _DETAIL } from '@shell/config/query-params';\nimport { SCOPED_RESOURCES } from '@shell/config/roles';\nimport { Banner } from '@components/Banner';\n\nimport { SUBTYPE_MAPPING, VERBS } from '@shell/models/management.cattle.io.roletemplate';\nimport Loading from '@shell/components/Loading';\n\nconst GLOBAL = SUBTYPE_MAPPING.GLOBAL.key;\nconst CLUSTER = SUBTYPE_MAPPING.CLUSTER.key;\nconst NAMESPACE = SUBTYPE_MAPPING.NAMESPACE.key;\nconst RBAC_ROLE = SUBTYPE_MAPPING.RBAC_ROLE.key;\n\n/**\n * Handles the View, Create and Edit of\n * - management.cattle.io.globalrole\n * - management.cattle.io.roletemplate\n * - rbac.authorization.k8s.io.role\n * - rbac.authorization.k8s.io.clusterrole\n *\n * management.cattle.io.roletemplate is further split into two types\n * - Cluster\n * - Project/Namespace\n *\n * The above means there are 4 types ==> 5 subtypes handled by this component\n *\n * This component is used in these five forms:\n *\n * 1. Cluster Explorer > More Resources > RBAC > ClusterRoles\n *   - Should show list of cluster scoped resources and namespaced resources\n * 2. Cluster Explorer > More Resources > RBAC > Roles\n *   - Should show list of namespaced resources\n * 3. Users & Authentication > Roles > Global\n *   - Should show global, cluster and namespace scoped resources\n * 4. Users & Authentication > Roles > Cluster\n *   - Should show cluster and namespace scoped resources\n * 5. Users & Authentication > Roles > Projects & Namespaces\n *   - Should show only namespace scoped resources\n */\nexport default {\n  components: {\n    ArrayList,\n    CruResource,\n    RadioGroup,\n    Select,\n    NameNsDescription,\n    Tab,\n    Tabbed,\n    SortableTable,\n    Loading,\n    Error,\n    Banner\n  },\n\n  mixins: [CreateEditView, FormValidation],\n\n  async fetch() {\n    // We don't want to get all schemas from the cluster because there are\n    // two problems with that:\n    // - In the local cluster, that yields over 500-1,000 schemas, most of which aren't meant to\n    //   be edited by humans.\n    // - Populating the list directly from the schemas wouldn't include resources that may\n    //   be in downstream clusters but not the local cluster. For example, if the logging\n    //   application isn't installed in the local cluster, you wouldn't see logging resources\n    //   such as Flows in the resource list, which you might want in order to\n    //   create a role that is intended to be used by someone with access to a cluster where\n    //   logging is installed.\n    // Therefore we use a hardcoded list that is essentially intended\n    // to be in-app documentation for convenience only, while allowing\n    // users to freely type in resources that are not shown in the list.\n\n    if (this.value.subtype === CLUSTER || this.value.subtype === NAMESPACE) {\n      (await this.$store.dispatch(`management/findAll`, { type: MANAGEMENT.ROLE_TEMPLATE })).forEach((template) => {\n        // Ensure we have quick access to a specific template. This allows unselected drop downs to show the correct value\n        this.keyedTemplateOptions[template.id] = {\n          label: template.nameDisplay,\n          value: template.id\n        };\n      });\n      this.templateOptions = Object.values(this.keyedTemplateOptions);\n    }\n    if (this.realMode === _CLONE) {\n      this.value.displayName = '';\n      this.value.builtin = false;\n    }\n  },\n\n  data() {\n    return {\n      defaultRule: {\n        apiGroups:       [''],\n        nonResourceURLs: [],\n        resourceNames:   [],\n        resources:       [],\n        verbs:           []\n      },\n      verbOptions:          VERBS,\n      templateOptions:      [],\n      keyedTemplateOptions: {},\n      resources:            this.value.resources,\n      scopedResources:      SCOPED_RESOURCES,\n      defaultValue:         false,\n      selectFocused:        null,\n      fvFormRuleSets:       [\n        { path: 'displayName', rules: ['required'] }\n      ],\n    };\n  },\n\n  created() {\n    this.$set(this.value, 'rules', this.value.rules || []);\n    this.value.rules.forEach((rule) => {\n      if (rule.verbs[0] === '*') {\n        this.$set(rule, 'verbs', [...VERBS]);\n      }\n    });\n\n    const query = { ...this.$route.query };\n    const { roleContext } = query;\n\n    if (roleContext && this.value.updateSubtype) {\n      this.value.updateSubtype(roleContext);\n    }\n\n    // Set the default value for the mapped subtype\n    this.defaultValue = !!this.value[SUBTYPE_MAPPING[this.value.subtype].defaultKey];\n\n    switch (this.value.subtype) {\n    case CLUSTER:\n    case NAMESPACE:\n      this.$set(this.value, 'roleTemplateNames', this.value.roleTemplateNames || []);\n      this.$set(this.value, 'locked', !!this.value.locked);\n      break;\n    }\n\n    // On save hook request\n    if (this.registerBeforeHook) {\n      this.registerBeforeHook(() => {\n        // Map default value back to its own key for given subtype\n        this.value[SUBTYPE_MAPPING[this.value.subtype].defaultKey] = !!this.defaultValue;\n      });\n    }\n\n    if (this.value?.metadata?.name && !this.value.displayName) {\n      this.$set(this.value, 'displayName', this.value.metadata.name);\n    }\n\n    this.$nextTick(() => {\n      this.$emit('set-subtype', this.label);\n    });\n  },\n\n  computed: {\n    ...mapGetters(['releaseNotesUrl']),\n\n    showRestrictedAdminDeprecationBanner() {\n      return this.value.subtype === GLOBAL && this.value.id === 'restricted-admin';\n    },\n\n    label() {\n      return this.t(`rbac.roletemplate.subtypes.${ this.value.subtype }.label`);\n    },\n    defaultLabel() {\n      return this.t(`rbac.roletemplate.subtypes.${ this.value.subtype }.defaultLabel`);\n    },\n    lockedOptions() {\n      return [\n        {\n          value: true,\n          label: this.t('rbac.roletemplate.locked.yes')\n        },\n        {\n          value: false,\n          label: this.t('rbac.roletemplate.locked.no')\n        }\n      ];\n    },\n    resourceOptions() {\n      const options = [];\n\n      const scopes = Object.keys(this.scopedResources);\n\n      scopes.forEach((scope) => {\n        if (scope === 'globalScopedApiGroups' && this.value.type !== MANAGEMENT.GLOBAL_ROLE) {\n          // If we are not in the global role creation form,\n          // skip adding the global-scoped resources.\n          return;\n        }\n        if (scope === 'clusterScopedApiGroups' && (this.value.type === RBAC.ROLE || this.value.subtype === NAMESPACE)) {\n          // If we are in a project/namespace role creation form,\n          // additionally skip adding the cluster-scoped resources.\n          return;\n        }\n        const apiGroupsInScope = this.scopedResources[scope];\n\n        const apiGroupNames = Object.keys(apiGroupsInScope);\n\n        // Put each API group as a header and put its resources under it.\n        apiGroupNames.forEach((apiGroup) => {\n          // Add API group as the header for a group of related resources.\n          let apiGroupLabel = apiGroup;\n          let apiGroupValue = apiGroup;\n\n          if (apiGroup === 'coreKubernetesApi') {\n            // If a resource belongs to the core Kubernetes API,\n            // the API group is technically an empty string but\n            // we will label it \"Core K8s API, Cluster Scoped.\"\n\n            // Some core Kubernetes resources are namespaced,\n            // in which case they go under a different heading\n            // \"Core K8s API, Namespaced.\" This lets us\n            // separate them by scope.\n            const labelForNoApiGroup = this.t('rbac.roletemplate.tabs.grantResources.noApiGroupClusterScope');\n            const labelForNamespacedResourcesWithNoApiGroup = this.t('rbac.roletemplate.tabs.grantResources.noApiGroupNamespaceScope');\n\n            apiGroupLabel = scope.includes('cluster') ? labelForNoApiGroup : labelForNamespacedResourcesWithNoApiGroup;\n            apiGroupValue = '';\n          }\n\n          if (apiGroup === 'neuvectorApi') {\n            // Some NeuVector resources are namespaced, in which case they go under a different heading\n            const labelForClusterScoped = this.t('rbac.roletemplate.tabs.grantResources.neuvector.labelClusterScoped');\n            const labelForNamespaceScoped = this.t('rbac.roletemplate.tabs.grantResources.neuvector.labelNamespaceScoped');\n\n            apiGroupLabel = scope.includes('cluster') ? labelForClusterScoped : labelForNamespaceScoped;\n            apiGroupValue = 'api.neuvector.com';\n          }\n\n          options.push({\n            kind:      'group',\n            optionKey: apiGroupLabel,\n            label:     apiGroupLabel,\n            value:     apiGroupValue,\n            disabled:  true,\n          });\n\n          const resourcesInApiGroup = this.scopedResources[scope][apiGroup].resources;\n\n          // Add non-deprecated resources to the resource options list\n          resourcesInApiGroup.forEach((resourceName) => {\n            options.push({\n              label:     resourceName,\n              // Use unique key for resource list in the Select dropdown\n              optionKey: apiGroupValue.concat(resourceName),\n              value:     {\n                resourceName: resourceName.toLowerCase(),\n                apiGroupValue\n              }\n            });\n          });\n\n          // If the API group has any deprecated options,\n          // list them as \"Resource Name (deprecated)\"\n          if (this.scopedResources[scope][apiGroup].deprecatedResources) {\n            const deprecatedResourcesInApiGroup = this.scopedResources[scope][apiGroup].deprecatedResources;\n            const deprecatedLabel = this.t('rbac.roletemplate.tabs.grantResources.deprecatedLabel');\n\n            deprecatedResourcesInApiGroup.forEach((resourceName) => {\n              options.push({\n                label:     `${ resourceName } ${ deprecatedLabel }`,\n                optionKey: apiGroupValue.concat(resourceName),\n                value:     {\n                  resourceName: resourceName.toLowerCase(),\n                  apiGroupValue\n                }\n              });\n            });\n          }\n        });\n      });\n\n      options.push({\n        // This hidden option is to work around a bug in the Select\n        // component where an option marked as disabled\n        // is still selected by default if is value is an empty string.\n\n        // In the Role or Project Role form, an API group will be the\n        // default choice for the namespace value because there's only\n        // one option with the value as an empty string and that's the default\n        // value for the namespace. It's not good to have an API\n        // group as the default value for a resource.\n        // Adding this option means there are least two values with an\n        // empty string in the options, preventing the Select from\n        // selecting a disabled header group as the resource by default.\n\n        // This bug is such an edge case that I can't imagine anyone\n        // else hitting it, so I figured the workaround is better\n        // than fixing the select.\n        kind:      'group',\n        optionKey: 'hiddenOption',\n        label:     '_',\n        value:     '',\n        disabled:  true,\n      });\n\n      return options;\n    },\n\n    newUserDefaultOptions() {\n      return [\n        {\n          value: true,\n          label: this.t(`rbac.roletemplate.subtypes.${ this.value.subtype }.yes`)\n        },\n        {\n          value: false,\n          label: this.t('rbac.roletemplate.newUserDefault.no')\n        }\n      ];\n    },\n    isRancherRoleTemplate() {\n      return this.value.subtype === CLUSTER || this.value.subtype === NAMESPACE;\n    },\n    isNamespaced() {\n      return this.value.subtype === RBAC_ROLE;\n    },\n    isRancherType() {\n      return this.value.subtype === GLOBAL || this.value.subtype === CLUSTER || this.value.subtype === NAMESPACE;\n    },\n    isDetail() {\n      return this.as === _DETAIL;\n    },\n    isBuiltin() {\n      return this.value.builtin;\n    },\n    doneLocationOverride() {\n      return this.value.listLocation;\n    },\n    ruleClass() {\n      return `col ${ this.isNamespaced ? 'span-4' : 'span-3' }`;\n    },\n    // Detail View\n    rules() {\n      return this.createRules(this.value);\n    },\n    ruleHeaders() {\n      const verbHeaders = VERBS.map((verb) => ({\n        name:      verb,\n        key:       ucFirst(verb),\n        value:     this.verbKey(verb),\n        formatter: 'Checked',\n        align:     'center'\n      }));\n\n      return [\n        ...verbHeaders,\n        {\n          name:      'custom',\n          labelKey:  'tableHeaders.customVerbs',\n          key:       ucFirst('custom'),\n          value:     'hasCustomVerbs',\n          formatter: 'Checked',\n          align:     'center'\n        },\n        {\n          name:      'resources',\n          labelKey:  'tableHeaders.resources',\n          value:     'resources',\n          formatter: 'list',\n        },\n        {\n          name:      'url',\n          labelKey:  'tableHeaders.url',\n          value:     'nonResourceURLs',\n          formatter: 'list',\n        },\n        {\n          name:      'apiGroups',\n          labelKey:  'tableHeaders.apiGroup',\n          value:     'apiGroups',\n          formatter: 'list',\n        }\n      ];\n    },\n    inheritedRules() {\n      return this.createInheritedRules(this.value, [], false);\n    }\n  },\n\n  methods: {\n\n    setRule(key, rule, event) {\n      // The key is the aspect of a permissions rule\n      // that is being set, for example, \"verbs,\" \"resources\",\n      // \"apiGroups\" or \"nonResourceUrls.\"\n\n      // The event/value contains name of a resource,\n      // for example, \"Apps.\"\n\n      // The 'rule' contains the the contents of each row of the\n      // role creation form under Grant Resources. Each\n      // rule contains these fields:\n      // - apiGroups\n      // - nonResourceURLs\n      // - resourceNames\n      // - resources\n      // - verbs\n\n      switch (key) {\n      case 'apiGroups':\n\n        if (event || (event === '')) {\n          this.$set(rule, 'apiGroups', [event]);\n        }\n\n        break;\n\n      case 'verbs':\n\n        if (event) {\n          this.$set(rule, 'verbs', [event]);\n        } else {\n          this.$set(rule, 'verbs', []);\n        }\n        break;\n\n      case 'resources':\n        if (event?.resourceName) {\n          // If we are updating the resources defined in a rule,\n          // the event will be an object with the\n          // properties apiGroupValue and resourceName.\n          this.$set(rule, 'resources', [event.resourceName]);\n          // Automatically fill in the API group of the\n          // selected resource.\n          this.$set(rule, 'apiGroups', [event.apiGroupValue]);\n        } else if (event?.label) {\n          // When the user creates a new resource name in the resource\n          // field instead of selecting an existing one,\n          // we have to treat that differently because the incoming event\n          // is shaped like {\"label\":\"something\"} instead of\n          // the same format as the other options:\n          // { resourceName: \"something\", apiGroupValue: \"\" }\n          this.$set(rule, 'resources', [event.label]);\n        } else {\n          this.$set(rule, 'resources', []);\n          this.$set(rule, 'apiGroups', []);\n        }\n        break;\n\n      case 'nonResourceURLs':\n        if (event) {\n          this.$set(rule, 'nonResourceURLs', [event]);\n        } else {\n          this.$set(rule, 'nonResourceURLs', []);\n        }\n        break;\n\n      default:\n        break;\n      }\n    },\n    getRule(key, rule) {\n      return rule[key]?.[0] || null;\n    },\n    updateSelectValue(row, key, event) {\n      const value = event.label ? event.value : event;\n\n      this.$set(row, key, value);\n    },\n    cancel() {\n      this.done();\n    },\n    async actuallySave(url) {\n      // Go through all of the grules and replace double quote apiGroups\n      // k8S documentation shows using empty rules as \"\" - we change this to empty string when used\n      this.value.rules?.forEach((rule) => {\n        if (rule.apiGroups) {\n          rule.apiGroups = rule.apiGroups.map((group) => {\n            // If the group is two double quotes (\"\") replace if with empty string\n            if (group.trim() === '\\\"\\\"') {\n              group = '';\n            }\n\n            return group;\n          });\n        }\n      });\n\n      if ( this.isCreate ) {\n        url = url || this.schema.linkFor('collection');\n        await this.value.save({ url, redirectUnauthorized: false });\n      } else {\n        await this.value.save({ redirectUnauthorized: false });\n      }\n    },\n    // Detail View\n    verbKey(verb) {\n      return `has${ ucFirst(verb) }`;\n    },\n    createRules(role) {\n      return (role.rules || []).map((rule, i) => {\n        const tableRule = {\n          index:           i,\n          apiGroups:       rule.apiGroups || [''],\n          resources:       rule.resources || [],\n          nonResourceURLs: rule.nonResourceURLs || []\n        };\n\n        VERBS.forEach((verb) => {\n          const key = this.verbKey(verb);\n\n          tableRule[key] = rule.verbs[0] === '*' || rule.verbs.includes(verb);\n          tableRule.hasCustomVerbs = rule.verbs.some((verb) => !VERBS.includes(verb));\n        });\n\n        return tableRule;\n      });\n    },\n    createInheritedRules(parent, res = [], showParent = true) {\n      if (!parent.roleTemplateNames) {\n        return [];\n      }\n\n      parent.roleTemplateNames\n        .map((rtn) => this.$store.getters[`management/byId`](MANAGEMENT.ROLE_TEMPLATE, rtn))\n        .forEach((rt) => {\n          // Add Self\n          res.push({\n            showParent,\n            parent,\n            template: rt,\n            rules:    this.createRules(rt)\n          });\n          // Add inherited\n          this.createInheritedRules(rt, res);\n        });\n\n      return res;\n    },\n  }\n};\n</script>\n\n<template>\n  <Loading v-if=\"$fetchState.pending\" />\n  <CruResource\n    v-else\n    class=\"receiver\"\n    :can-yaml=\"!isCreate\"\n    :mode=\"mode\"\n    :resource=\"value\"\n    :errors=\"fvUnreportedValidationErrors\"\n    :validation-passed=\"fvFormIsValid\"\n    :cancel-event=\"true\"\n    @error=\"e=>errors = e\"\n    @finish=\"save\"\n    @cancel=\"cancel\"\n  >\n    <Banner\n      v-if=\"showRestrictedAdminDeprecationBanner\"\n      color=\"warning\"\n      class=\"mb-20\"\n    >\n      <span v-clean-html=\"t('rbac.globalRoles.role.restricted-admin.deprecation', { releaseNotesUrl }, true)\" />\n    </Banner>\n    <template v-if=\"isDetail\">\n      <SortableTable\n        key-field=\"index\"\n        :rows=\"rules\"\n        :headers=\"ruleHeaders\"\n        :table-actions=\"false\"\n        :row-actions=\"false\"\n        :search=\"false\"\n      />\n      <div\n        v-for=\"(inherited, index) of inheritedRules\"\n        :key=\"index\"\n      >\n        <div class=\"spacer\" />\n        <h3>\n          Inherited from {{ inherited.template.nameDisplay }}\n          <template v-if=\"inherited.showParent\">\n            {{ inherited.parent ? '(' + inherited.parent.nameDisplay + ')' : '' }}\n          </template>\n        </h3>\n        <SortableTable\n          key-field=\"index\"\n          :rows=\"inherited.rules\"\n          :headers=\"ruleHeaders\"\n          :table-actions=\"false\"\n          :row-actions=\"false\"\n          :search=\"false\"\n        />\n      </div>\n    </template>\n    <template v-else>\n      <NameNsDescription\n        v-model=\"value\"\n        :namespaced=\"isNamespaced\"\n        :mode=\"mode\"\n        name-key=\"displayName\"\n        description-key=\"description\"\n        label=\"Name\"\n        :rules=\"{ name: fvGetAndReportPathRules('displayName') }\"\n      />\n      <div\n        v-if=\"isRancherType\"\n        class=\"row\"\n      >\n        <div class=\"col span-6\">\n          <RadioGroup\n            v-model=\"defaultValue\"\n            name=\"storageSource\"\n            :label=\"defaultLabel\"\n            class=\"mb-10\"\n            data-testid=\"roletemplate-creator-default-options\"\n            :options=\"newUserDefaultOptions\"\n            :mode=\"mode\"\n          />\n        </div>\n        <div\n          v-if=\"isRancherRoleTemplate\"\n          class=\"col span-6\"\n        >\n          <RadioGroup\n            v-model=\"value.locked\"\n            name=\"storageSource\"\n            :label=\"t('rbac.roletemplate.locked.label')\"\n            class=\"mb-10\"\n            data-testid=\"roletemplate-locked-options\"\n            :options=\"lockedOptions\"\n            :mode=\"mode\"\n          />\n        </div>\n      </div>\n      <div class=\"spacer\" />\n      <Tabbed :side-tabs=\"true\">\n        <Tab\n          name=\"grant-resources\"\n          :label=\"t('rbac.roletemplate.tabs.grantResources.label')\"\n          :weight=\"1\"\n        >\n          <Error\n            :value=\"value.rules\"\n            :rules=\"fvGetAndReportPathRules('rules')\"\n            as-banner\n          />\n          <ArrayList\n            v-model=\"value.rules\"\n            label=\"Resources\"\n            :disabled=\"isBuiltin\"\n            :remove-allowed=\"!isBuiltin\"\n            :add-allowed=\"!isBuiltin\"\n            :default-add-value=\"defaultRule\"\n            :initial-empty-row=\"true\"\n            :show-header=\"true\"\n            add-label=\"Add Resource\"\n            :mode=\"mode\"\n          >\n            <template #column-headers>\n              <div class=\"column-headers row\">\n                <div :class=\"ruleClass\">\n                  <span class=\"text-label\">{{ t('rbac.roletemplate.tabs.grantResources.tableHeaders.verbs') }}\n                    <span class=\"required\">*</span>\n                  </span>\n                </div>\n                <div :class=\"ruleClass\">\n                  <span class=\"text-label\">\n                    {{ t('rbac.roletemplate.tabs.grantResources.tableHeaders.resources') }}\n                    <i\n                      v-clean-tooltip=\"t('rbac.roletemplate.tabs.grantResources.resourceOptionInfo')\"\n                      class=\"icon icon-info\"\n                    />\n                    <span\n                      v-if=\"isNamespaced\"\n                      class=\"required\"\n                    >*</span>\n                  </span>\n                </div>\n                <div :class=\"ruleClass\">\n                  <span class=\"text-label\">{{ t('rbac.roletemplate.tabs.grantResources.tableHeaders.apiGroups') }}</span>\n                </div>\n                <div\n                  v-if=\"!isNamespaced\"\n                  :class=\"ruleClass\"\n                >\n                  <span class=\"text-label\">{{ t('rbac.roletemplate.tabs.grantResources.tableHeaders.nonResourceUrls') }}</span>\n                </div>\n              </div>\n            </template>\n            <template #columns=\"props\">\n              <div class=\"columns row mr-20\">\n                <div :class=\"ruleClass\">\n                  <Select\n                    :value=\"props.row.value.verbs\"\n                    class=\"lg\"\n                    :disabled=\"isBuiltin\"\n                    :taggable=\"true\"\n                    :searchable=\"true\"\n                    :options=\"verbOptions\"\n                    :multiple=\"true\"\n                    :mode=\"mode\"\n                    :data-testid=\"`grant-resources-verbs${props.i}`\"\n                    @input=\"updateSelectValue(props.row.value, 'verbs', $event)\"\n                  />\n                </div>\n                <div :class=\"ruleClass\">\n                  <Select\n                    :value=\"getRule('resources', props.row.value)\"\n                    :disabled=\"isBuiltin\"\n                    :options=\"resourceOptions\"\n                    option-key=\"optionKey\"\n                    :searchable=\"true\"\n                    :taggable=\"true\"\n                    :mode=\"mode\"\n                    :data-testid=\"`grant-resources-resources${props.i}`\"\n                    @input=\"setRule('resources', props.row.value, $event)\"\n                    @createdListItem=\"setRule('resources', props.row.value, $event)\"\n                  />\n                </div>\n                <div :class=\"ruleClass\">\n                  <input\n                    :value=\"getRule('apiGroups', props.row.value)\"\n                    :disabled=\"isBuiltin\"\n                    :mode=\"mode\"\n                    :data-testid=\"`grant-resources-api-groups${props.i}`\"\n                    @input=\"setRule('apiGroups', props.row.value, $event.target.value)\"\n                  >\n                </div>\n                <div\n                  v-if=\"!isNamespaced\"\n                  :class=\"ruleClass\"\n                >\n                  <input\n                    :value=\"getRule('nonResourceURLs', props.row.value)\"\n                    :disabled=\"isBuiltin\"\n                    :mode=\"mode\"\n                    :data-testid=\"`grant-resources-non-resource-urls${props.i}`\"\n                    @input=\"setRule('nonResourceURLs', props.row.value, $event.target.value)\"\n                  >\n                </div>\n              </div>\n            </template>\n          </ArrayList>\n        </Tab>\n        <Tab\n          v-if=\"isRancherRoleTemplate\"\n          name=\"inherit-from\"\n          label=\"Inherit From\"\n          :weight=\"0\"\n        >\n          <ArrayList\n            v-model=\"value.roleTemplateNames\"\n            :disabled=\"isBuiltin\"\n            :remove-allowed=\"!isBuiltin\"\n            :add-allowed=\"!isBuiltin\"\n            label=\"Resources\"\n            add-label=\"Add Resource\"\n            :mode=\"mode\"\n          >\n            <template #columns=\"props\">\n              <div class=\"columns row mr-20\">\n                <div class=\"col span-12\">\n                  <Select\n                    v-model=\"props.row.value\"\n                    class=\"lg\"\n                    :taggable=\"false\"\n                    :disabled=\"isBuiltin\"\n                    :searchable=\"true\"\n                    :options=\"selectFocused === props.i ? templateOptions : [keyedTemplateOptions[props.row.value]]\"\n                    option-key=\"value\"\n                    option-label=\"label\"\n                    :mode=\"mode\"\n                    @on-focus=\"selectFocused = props.i\"\n                    @on-blur=\"selectFocused = null\"\n                  />\n                </div>\n              </div>\n            </template>\n          </ArrayList>\n        </Tab>\n      </Tabbed>\n    </template>\n  </CruResource>\n</template>\n\n<style lang=\"scss\" scoped>\n  .required {\n    color: var(--error);\n  }\n\n  ::v-deep {\n    .column-headers {\n      margin-right: 75px;\n      margin-bottom: 5px;\n    }\n\n    .box {\n      align-items: initial;\n\n      .remove {\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: flex-end;\n      }\n    }\n\n    .columns {\n      & > .col {\n        &:not(:first-of-type) {\n          height: $input-height;\n        }\n\n        &:first-of-type {\n          min-height: $input-height;\n        }\n\n        & > * {\n          height: 100%;\n        }\n      }\n    }\n  }\n</style>\n"]}]}