{"remainingRequest":"/home/ubuntu/susecon-2024-ext-demo/node_modules/ts-loader/index.js??ref--17-1!/home/ubuntu/susecon-2024-ext-demo/node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster/__tests__/CustomCommand.test.ts","dependencies":[{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster/__tests__/CustomCommand.test.ts","mtime":1725271280091},{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/babel-loader/lib/index.js","mtime":1725271298942},{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/susecon-2024-ext-demo/node_modules/ts-loader/index.js","mtime":1725271299135}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgbW91bnQgfSBmcm9tICdAdnVlL3Rlc3QtdXRpbHMnOwppbXBvcnQgQ3VzdG9tQ29tbWFuZCBmcm9tICdAc2hlbGwvZWRpdC9wcm92aXNpb25pbmcuY2F0dGxlLmlvLmNsdXN0ZXIvQ3VzdG9tQ29tbWFuZC52dWUnOwppbXBvcnQgeyBjbGVhbkh0bWxEaXJlY3RpdmUgfSBmcm9tICdAc2hlbGwvcGx1Z2lucy9jbGVhbi1odG1sLWRpcmVjdGl2ZSc7Cmplc3QubW9jaygnQHNoZWxsL3V0aWxzL2NsaXBib2FyZCcsICgpID0+IHsKICAgIHJldHVybiB7IGNvcHlUZXh0VG9DbGlwYm9hcmQ6IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHt9KSkgfTsKfSk7CmRlc2NyaWJlKCdjb21wb25lbnQ6IEN1c3RvbUNvbW1hbmQnLCAoKSA9PiB7CiAgICBjb25zdCB0b2tlbiA9ICdNWV9UT0tFTic7CiAgICBjb25zdCBpcCA9ICdNWV9JUCc7CiAgICBjb25zdCBjaGVja1N1bSA9ICdNWV9DSEVDS1NVTSc7CiAgICBjb25zdCB3cmFwcGVyID0gbW91bnQoQ3VzdG9tQ29tbWFuZCwgewogICAgICAgIG1vY2tzOiB7CiAgICAgICAgICAgICRzdG9yZTogewogICAgICAgICAgICAgICAgZ2V0dGVyczogewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdG9yZTogKCkgPT4gJ2N1cnJlbnRfc3RvcmUnLAogICAgICAgICAgICAgICAgICAgICdtYW5hZ2VtZW50L3NjaGVtYUZvcic6IGplc3QuZm4oKSwKICAgICAgICAgICAgICAgICAgICAnY3VycmVudF9zdG9yZS9hbGwnOiBqZXN0LmZuKCksCiAgICAgICAgICAgICAgICAgICAgJ2kxOG4vdCc6IGplc3QuZm4oKSwKICAgICAgICAgICAgICAgICAgICAnaTE4bi93aXRoRmFsbGJhY2snOiBqZXN0LmZuKCksCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICBwcm9wc0RhdGE6IHsKICAgICAgICAgICAgY2x1c3Rlcjoge30sCiAgICAgICAgICAgIGNsdXN0ZXJUb2tlbjogewogICAgICAgICAgICAgICAgaW5zZWN1cmVOb2RlQ29tbWFuZDogYCBjdXJsIC0taW5zZWN1cmUgLWZMICR7aXB9L3N5c3RlbS1hZ2VudC1pbnN0YWxsLnNoIHwgc3VkbyAgc2ggLXMgLSAtLXNlcnZlciAke2lwfSAtLWxhYmVsICdjYXR0bGUuaW8vb3M9bGludXgnIC0tdG9rZW4gJHt0b2tlbn0gLS1jYS1jaGVja3N1bSAke2NoZWNrU3VtfWAsCiAgICAgICAgICAgICAgICBub2RlQ29tbWFuZDogYCBjdXJsIC1mTCAke2lwfS9zeXN0ZW0tYWdlbnQtaW5zdGFsbC5zaCB8IHN1ZG8gIHNoIC1zIC0gLS1zZXJ2ZXIgJHtpcH0gLS1sYWJlbCAnY2F0dGxlLmlvL29zPWxpbnV4JyAtLXRva2VuICR7dG9rZW59IC0tY2EtY2hlY2tzdW0gJHtjaGVja1N1bX1gCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGRhdGE6ICgpID0+ICh7CiAgICAgICAgICAgIGFkZHJlc3M6ICcnLAogICAgICAgICAgICBjb250cm9sUGxhbmU6IHRydWUsCiAgICAgICAgICAgIGV0Y2Q6IHRydWUsCiAgICAgICAgICAgIGluc2VjdXJlOiBmYWxzZSwKICAgICAgICAgICAgaW50ZXJuYWxBZGRyZXNzOiAnJywKICAgICAgICAgICAgbGFiZWxzOiB7fSwKICAgICAgICAgICAgbm9kZU5hbWU6ICcnLAogICAgICAgICAgICB0YWludHM6IFtdLAogICAgICAgICAgICB3b3JrZXI6IHRydWUsCiAgICAgICAgfSksCiAgICAgICAgZGlyZWN0aXZlczogeyBjbGVhbkh0bWxEaXJlY3RpdmUgfQogICAgfSk7CiAgICBpdCgnc2hvdWxkIHJldHVybiBsaW51eCBjb21tYW5kcyB3aXRoIHRoZSByaWdodCBmbGFncyBiYXNlZCBvbiBjbHVzdGVyIGluZm9ybWF0aW9uJywgKCkgPT4gewogICAgICAgIGNvbnN0IHZhbHVlID0gYGN1cmwgLWZMICR7aXB9L3N5c3RlbS1hZ2VudC1pbnN0YWxsLnNoIHwgc3VkbyAgc2ggLXMgLSAtLXNlcnZlciAke2lwfSAtLWxhYmVsICdjYXR0bGUuaW8vb3M9bGludXgnIC0tdG9rZW4gJHt0b2tlbn0gLS1jYS1jaGVja3N1bSAke2NoZWNrU3VtfSAtLWV0Y2QgLS1jb250cm9scGxhbmUgLS13b3JrZXJgOwogICAgICAgIGNvbnN0IGVsZW1lbnQgPSB3cmFwcGVyLmZpbmQoJyNjb3BpZWRMaW51eCcpLmVsZW1lbnQ7CiAgICAgICAgZXhwZWN0KGVsZW1lbnQudGV4dENvbnRlbnQpLnRvQ29udGFpbih2YWx1ZSk7CiAgICB9KTsKICAgIGl0KCdzaG91bGQgbm90IGRpc3BsYXkgd2FybmluZyBtZXNzYWdlIGlmIGFsbCBub2RlIHJvbGVzIGFyZSBzZWxlY3RlZCcsIGFzeW5jICgpID0+IHsKICAgICAgICBhd2FpdCB3cmFwcGVyLnNldERhdGEoewogICAgICAgICAgICBjb250cm9sUGxhbmU6IHRydWUsCiAgICAgICAgICAgIGV0Y2Q6IHRydWUsCiAgICAgICAgICAgIHdvcmtlcjogdHJ1ZSwKICAgICAgICB9KTsKICAgICAgICBjb25zdCBlbGVtZW50ID0gd3JhcHBlci5maW5kKCdbZGF0YS10ZXN0aWQ9Im5vZGUtcm9sZS13YXJuaW5nIl0nKS5lbGVtZW50OwogICAgICAgIGV4cGVjdChlbGVtZW50KS50b0JlVW5kZWZpbmVkKCk7CiAgICB9KTsKICAgIGRlc2NyaWJlKCdzaG91bGQgZGlzcGxheSB3YXJuaW5nIG1lc3NhZ2UgaWYgYXQgbGVhc3Qgb25lIG9mIHRoZSBub2RlIHJvbGVzIGlzIHVuc2VsZWN0ZWQnLCAoKSA9PiB7CiAgICAgICAgaXQuZWFjaChbCiAgICAgICAgICAgIFt0cnVlLCB0cnVlLCBmYWxzZV0sCiAgICAgICAgICAgIFt0cnVlLCBmYWxzZSwgdHJ1ZV0sCiAgICAgICAgICAgIFt0cnVlLCBmYWxzZSwgZmFsc2VdLAogICAgICAgICAgICBbZmFsc2UsIHRydWUsIHRydWVdLAogICAgICAgICAgICBbZmFsc2UsIHRydWUsIGZhbHNlXSwKICAgICAgICAgICAgW2ZhbHNlLCBmYWxzZSwgdHJ1ZV0sCiAgICAgICAgICAgIFtmYWxzZSwgZmFsc2UsIGZhbHNlXSwKICAgICAgICBdKSgnY29udHJvbFBsYW5lOiAlcCwgZXRjZDogJXAsIHdvcmtlcjogJXAnLCBhc3luYyAoY29udHJvbFBsYW5lLCBldGNkLCB3b3JrZXIpID0+IHsKICAgICAgICAgICAgYXdhaXQgd3JhcHBlci5zZXREYXRhKHsKICAgICAgICAgICAgICAgIGNvbnRyb2xQbGFuZSwKICAgICAgICAgICAgICAgIGV0Y2QsCiAgICAgICAgICAgICAgICB3b3JrZXIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSB3cmFwcGVyLmZpbmQoJ1tkYXRhLXRlc3RpZD0ibm9kZS1yb2xlLXdhcm5pbmciXScpLmVsZW1lbnQ7CiAgICAgICAgICAgIGV4cGVjdChlbGVtZW50KS50b0JlRGVmaW5lZCgpOwogICAgICAgIH0pOwogICAgfSk7Cn0pOwo="},{"version":3,"file":"/home/ubuntu/susecon-2024-ext-demo/node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster/__tests__/CustomCommand.test.ts","sourceRoot":"","sources":["/home/ubuntu/susecon-2024-ext-demo/node_modules/@rancher/shell/edit/provisioning.cattle.io.cluster/__tests__/CustomCommand.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { mount } from '@vue/test-utils';\nimport CustomCommand from '@shell/edit/provisioning.cattle.io.cluster/CustomCommand.vue';\nimport { cleanHtmlDirective } from '@shell/plugins/clean-html-directive';\njest.mock('@shell/utils/clipboard', () => {\n  return { copyTextToClipboard: jest.fn(() => Promise.resolve({})) };\n});\n\ndescribe('component: CustomCommand', () => {\n  const token = 'MY_TOKEN';\n  const ip = 'MY_IP';\n  const checkSum = 'MY_CHECKSUM';\n  const wrapper = mount(CustomCommand, {\n    mocks: {\n      $store: {\n        getters: {\n          currentStore:           () => 'current_store',\n          'management/schemaFor': jest.fn(),\n          'current_store/all':    jest.fn(),\n          'i18n/t':               jest.fn(),\n          'i18n/withFallback':    jest.fn(),\n        }\n      },\n    },\n    propsData: {\n      cluster:      {},\n      clusterToken: {\n        insecureNodeCommand: ` curl --insecure -fL ${ ip }/system-agent-install.sh | sudo  sh -s - --server ${ ip } --label 'cattle.io/os=linux' --token ${ token } --ca-checksum ${ checkSum }`,\n        nodeCommand:         ` curl -fL ${ ip }/system-agent-install.sh | sudo  sh -s - --server ${ ip } --label 'cattle.io/os=linux' --token ${ token } --ca-checksum ${ checkSum }`\n      }\n    },\n    data: () => ({\n      address:         '',\n      controlPlane:    true,\n      etcd:            true,\n      insecure:        false,\n      internalAddress: '',\n      labels:          {},\n      nodeName:        '',\n      taints:          [],\n      worker:          true,\n    }),\n\n    directives: { cleanHtmlDirective }\n  });\n\n  it('should return linux commands with the right flags based on cluster information', () => {\n    const value = `curl -fL ${ ip }/system-agent-install.sh | sudo  sh -s - --server ${ ip } --label 'cattle.io/os=linux' --token ${ token } --ca-checksum ${ checkSum } --etcd --controlplane --worker`;\n    const element = wrapper.find('#copiedLinux').element;\n\n    expect(element.textContent).toContain(value);\n  });\n\n  it('should not display warning message if all node roles are selected', async() => {\n    await wrapper.setData({\n      controlPlane: true,\n      etcd:         true,\n      worker:       true,\n    });\n\n    const element = wrapper.find('[data-testid=\"node-role-warning\"]').element;\n\n    expect(element).toBeUndefined();\n  });\n\n  describe('should display warning message if at least one of the node roles is unselected', () => {\n    it.each([\n      [true, true, false],\n      [true, false, true],\n      [true, false, false],\n      [false, true, true],\n      [false, true, false],\n      [false, false, true],\n      [false, false, false],\n    ])('controlPlane: %p, etcd: %p, worker: %p', async(\n      controlPlane,\n      etcd,\n      worker\n    ) => {\n      await wrapper.setData({\n        controlPlane,\n        etcd,\n        worker\n      });\n\n      const element = wrapper.find('[data-testid=\"node-role-warning\"]').element;\n\n      expect(element).toBeDefined();\n    });\n  });\n});\n"]}]}