{"remainingRequest":"/home/ubuntu/suseconf/node_modules/ts-loader/index.js??ref--17-1!/home/ubuntu/suseconf/node_modules/@rancher/shell/plugins/steve/accept-or-reject-socket-message.ts","dependencies":[{"path":"/home/ubuntu/suseconf/node_modules/@rancher/shell/plugins/steve/accept-or-reject-socket-message.ts","mtime":1725338146566},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/babel-loader/lib/index.js","mtime":1725271298942},{"path":"/home/ubuntu/suseconf/node_modules/cache-loader/dist/cjs.js","mtime":1725271299021},{"path":"/home/ubuntu/suseconf/node_modules/ts-loader/index.js","mtime":1725271299135}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHBBbmRORmlsdGVyaW5nIGZyb20gJ0BzaGVsbC9wbHVnaW5zL3N0ZXZlL3Byb2plY3RBbmROYW1lc3BhY2VGaWx0ZXJpbmcudXRpbHMnOwovKioKICogVGhlcmUgYXJlIHNjZW5hcmlvcyB3aGVyZSB3ZSBjYW4ndCBzdWJzY3JpYmUgdG8gc3Vic2V0cyBvZiBhIHJlc291cmNlIHR5cGUKICogLSBNdWx0aXBsZSBuYW1lc3BhY2VzIG9yIHByb2plY3RzCiAqIC0gUmVzdWx0IG9mIFBhZ2luYXRpb24gKGEgc2luZ2xlIHBhZ2Ugb2YgcmVzb3VyY2VzIHRoYXQgaGF2ZSBiZWVuIHNvcnRlZCAvIGZpbHRlcmVkKQogKgogKiBGb3IgdGhvc2Ugc2NlbmFyaW9zIHdlIHN1YnNjcmliZSB0byBhbGxsbCBjaGFuZ2VzIEJVVCBpZ25vcmUgY2hhbmdlcyB0aGF0IGFyZSBub3QgYXBwbGljYWJsZSB0byB0aGF0IHN1YnNldAogKi8KY2xhc3MgQWNjZXB0T3JSZWplY3RTb2NrZXRNZXNzYWdlIHsKICAgIHR5cGVJc05hbWVzcGFjZWQoeyBnZXR0ZXJzIH0sIHR5cGUpIHsKICAgICAgICB2YXIgX2E7CiAgICAgICAgcmV0dXJuICgoX2EgPSBnZXR0ZXJzLmhhdmVOYW1lc3BhY2UodHlwZSkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpID4gMDsKICAgIH0KICAgIHR5cGVJc1BhZ2luYXRlZCh7IGdldHRlcnMgfSwgdHlwZSkgewogICAgICAgIHJldHVybiAhIWdldHRlcnMuaGF2ZVBhZ2UodHlwZSk7CiAgICB9CiAgICBmaWx0ZXJlZE5hbWVzcGFjZXMoeyByb290R2V0dGVycyB9KSB7CiAgICAgICAgLy8gTm90ZSAtIGFjdGl2ZU5hbWVzcGFjZUNhY2hlIHNob3VsZCBiZSBhY2N1cmF0ZSBmb3IgYm90aCBuYW1lc3BhY2UvcHJvamVjdCBmaWx0ZXJpbmcgYW5kIHBhZ2luYXRpb24gbmFtZXNwYWNlL3Byb2plY3QgZmlsdGVyaW5nCiAgICAgICAgcmV0dXJuIHJvb3RHZXR0ZXJzLmFjdGl2ZU5hbWVzcGFjZUNhY2hlOwogICAgfQogICAgLyoqCiAgICAgKiBOb3RlIC0gbmFtZXNwYWNlIGNhbiBiZSBhIGxpc3Qgb2YgcHJvamVjdHMgb3IgbmFtZXNwYWNlcwogICAgICovCiAgICBzdWJzY3JpYmVOYW1lc3BhY2UobmFtZXNwYWNlKSB7CiAgICAgICAgaWYgKHBBbmRORmlsdGVyaW5nLmlzQXBwbGljYWJsZSh7IG5hbWVzcGFjZWQ6IG5hbWVzcGFjZSwgdHlwZTogJ24vYScgfSkgJiYgbmFtZXNwYWNlLmxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOyAvLyBBS0Egc3ViIHRvIGV2ZXJ5dGhpbmcKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5hbWVzcGFjZTsKICAgIH0KICAgIHZhbGlkQ2hhbmdlKHsgZ2V0dGVycywgcm9vdEdldHRlcnMgfSwgdHlwZSwgZGF0YSkgewogICAgICAgIC8vIElmIHRoZSByZXNvdXJjZSBpcyBpbiBuYW1lc3BhY2Ugb3V0c2lkZSBvZiB0aGUgb25lJ3Mgd2UgaGF2ZSBzZWxlY3RlZCBpbiB0aGUgaGVhZGVyLi4uIGlnbm9yZSB0aGUgY2hhbmdlCiAgICAgICAgaWYgKHRoaXMudHlwZUlzTmFtZXNwYWNlZCh7IGdldHRlcnMgfSwgdHlwZSkpIHsKICAgICAgICAgICAgY29uc3QgbmFtZXNwYWNlcyA9IHRoaXMuZmlsdGVyZWROYW1lc3BhY2VzKHsgcm9vdEdldHRlcnMgfSk7CiAgICAgICAgICAgIGlmICghbmFtZXNwYWNlc1tkYXRhLm1ldGFkYXRhLm5hbWVzcGFjZV0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBJZiB0aGUgcmVzb3VyY2UgZG9lcyBub3QgbWVldCB0aGUgcHJldmlvdXNseSBmZXRjaGVkIHBhZ2luYXRlZCByZXNvdXJjZS4uLiBpZ25vcmUgdGhlIGNoYW5nZQogICAgICAgIGlmICh0aGlzLnR5cGVJc1BhZ2luYXRlZCh7IGdldHRlcnMgfSwgdHlwZSkpIHsKICAgICAgICAgICAgY29uc3QgcGFnZSA9IGdldHRlcnNbJ2FsbCddKHR5cGUpOwogICAgICAgICAgICByZXR1cm4gISFwYWdlLmZpbmQoKHBSKSA9PiBwUi5pZCA9PT0gZGF0YS5pZCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgdmFsaWRhdGVCYXRjaENoYW5nZSh7IGdldHRlcnMsIHJvb3RHZXR0ZXJzIH0sIGJhdGNoKSB7CiAgICAgICAgY29uc3QgbmFtZXNwYWNlcyA9IHRoaXMuZmlsdGVyZWROYW1lc3BhY2VzKHsgcm9vdEdldHRlcnMgfSk7CiAgICAgICAgY29uc3QgdHlwZUlzID0gewogICAgICAgICAgICBuYW1lc3BhY2VkOiB7fSwKICAgICAgICAgICAgcGFnaW5hdGVkOiB7fSwKICAgICAgICB9OwogICAgICAgIE9iamVjdC5lbnRyaWVzKGJhdGNoKS5mb3JFYWNoKChbdHlwZSwgZW50cmllc10pID0+IHsKICAgICAgICAgICAgdmFyIF9hOwogICAgICAgICAgICBpZiAodHlwZUlzLm5hbWVzcGFjZWRbdHlwZV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgdHlwZUlzLm5hbWVzcGFjZWRbdHlwZV0gPSB0aGlzLnR5cGVJc05hbWVzcGFjZWQoeyBnZXR0ZXJzIH0sIHR5cGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0eXBlSXMubmFtZXNwYWNlZFt0eXBlXSkgewogICAgICAgICAgICAgICAgY29uc3Qgc2NoZW1hID0gZ2V0dGVycy5zY2hlbWFGb3IodHlwZSk7CiAgICAgICAgICAgICAgICBpZiAoISgoX2EgPSBzY2hlbWEgPT09IG51bGwgfHwgc2NoZW1hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzY2hlbWEuYXR0cmlidXRlcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm5hbWVzcGFjZWQpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoZW50cmllcykuZm9yRWFjaCgoaWQpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lc3BhY2UgPSBpZC5zcGxpdCgnLycpWzBdOwogICAgICAgICAgICAgICAgICAgIGlmICghbmFtZXNwYWNlIHx8ICFuYW1lc3BhY2VzW25hbWVzcGFjZV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGVudHJpZXNbaWRdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0eXBlSXMucGFnaW5hdGVkW3R5cGVdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHR5cGVJcy5wYWdpbmF0ZWRbdHlwZV0gPSB0aGlzLnR5cGVJc1BhZ2luYXRlZCh7IGdldHRlcnMgfSwgdHlwZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHR5cGVJcy5wYWdpbmF0ZWRbdHlwZV0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhZ2UgPSBnZXR0ZXJzWydhbGwnXSh0eXBlKTsKICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGVudHJpZXMpLmZvckVhY2goKGlkKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwYWdlLmZpbmQoKHBSKSA9PiBwUi5pZCA9PT0gaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBlbnRyaWVzW2lkXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBiYXRjaDsKICAgIH0KfQpleHBvcnQgZGVmYXVsdCBuZXcgQWNjZXB0T3JSZWplY3RTb2NrZXRNZXNzYWdlKCk7Cg=="},{"version":3,"file":"/home/ubuntu/suseconf/node_modules/@rancher/shell/plugins/steve/accept-or-reject-socket-message.ts","sourceRoot":"","sources":["/home/ubuntu/suseconf/node_modules/@rancher/shell/plugins/steve/accept-or-reject-socket-message.ts"],"names":[],"mappings":"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","sourcesContent":["import pAndNFiltering from '@shell/plugins/steve/projectAndNamespaceFiltering.utils';\n\ntype TypeIsCached = { [type: string]: boolean }\n\n/**\n * There are scenarios where we can't subscribe to subsets of a resource type\n * - Multiple namespaces or projects\n * - Result of Pagination (a single page of resources that have been sorted / filtered)\n *\n * For those scenarios we subscribe to allll changes BUT ignore changes that are not applicable to that subset\n */\nclass AcceptOrRejectSocketMessage {\n  typeIsNamespaced({ getters }: any, type: string): boolean {\n    return getters.haveNamespace(type)?.length > 0;\n  }\n\n  typeIsPaginated({ getters }: any, type: string): boolean {\n    return !!getters.havePage(type);\n  }\n\n  filteredNamespaces({ rootGetters }: any) {\n    // Note - activeNamespaceCache should be accurate for both namespace/project filtering and pagination namespace/project filtering\n    return rootGetters.activeNamespaceCache;\n  }\n\n  /**\n   * Note - namespace can be a list of projects or namespaces\n   */\n  subscribeNamespace(namespace: string[]) {\n    if (pAndNFiltering.isApplicable({ namespaced: namespace, type: 'n/a' }) && namespace.length) {\n      return undefined; // AKA sub to everything\n    }\n\n    return namespace;\n  }\n\n  validChange({ getters, rootGetters }: any, type: string, data: any) {\n    // If the resource is in namespace outside of the one's we have selected in the header... ignore the change\n    if (this.typeIsNamespaced({ getters }, type)) {\n      const namespaces = this.filteredNamespaces({ rootGetters });\n\n      if (!namespaces[data.metadata.namespace]) {\n        return false;\n      }\n    }\n\n    // If the resource does not meet the previously fetched paginated resource... ignore the change\n    if (this.typeIsPaginated({ getters }, type)) {\n      const page = getters['all'](type);\n\n      return !!page.find((pR: any) => pR.id === data.id);\n    }\n\n    return true;\n  }\n\n  validateBatchChange({ getters, rootGetters }: any, batch: { [key: string]: any}) {\n    const namespaces = this.filteredNamespaces({ rootGetters });\n\n    const typeIs: { namespaced: TypeIsCached, paginated: TypeIsCached} = {\n      namespaced: {},\n      paginated:  {},\n    };\n\n    Object.entries(batch).forEach(([type, entries]) => {\n      if (typeIs.namespaced[type] === undefined) {\n        typeIs.namespaced[type] = this.typeIsNamespaced({ getters }, type);\n      }\n      if (typeIs.namespaced[type]) {\n        const schema = getters.schemaFor(type);\n\n        if (!schema?.attributes?.namespaced) {\n          return;\n        }\n\n        Object.keys(entries).forEach((id) => {\n          const namespace = id.split('/')[0];\n\n          if (!namespace || !namespaces[namespace]) {\n            delete entries[id];\n          }\n        });\n      }\n\n      if (typeIs.paginated[type] === undefined) {\n        typeIs.paginated[type] = this.typeIsPaginated({ getters }, type);\n      }\n      if (typeIs.paginated[type]) {\n        const page = getters['all'](type);\n\n        Object.keys(entries).forEach((id) => {\n          if (!page.find((pR: any) => pR.id === id)) {\n            delete entries[id];\n          }\n        });\n      }\n    });\n\n    return batch;\n  }\n}\n\nexport default new AcceptOrRejectSocketMessage();\n"]}]}